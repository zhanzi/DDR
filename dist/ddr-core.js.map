{"version":3,"file":"ddr-core.js","sources":["../node_modules/tslib/tslib.es6.js","../src/core/index.ts","../src/core/exporter/index.ts","../src/core/exporter/excel-fixes.ts","../src/core/exporter/pdf-fixes.ts"],"sourcesContent":["/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise, SuppressedError, Symbol, Iterator */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __esDecorate(ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\r\n    function accept(f) { if (f !== void 0 && typeof f !== \"function\") throw new TypeError(\"Function expected\"); return f; }\r\n    var kind = contextIn.kind, key = kind === \"getter\" ? \"get\" : kind === \"setter\" ? \"set\" : \"value\";\r\n    var target = !descriptorIn && ctor ? contextIn[\"static\"] ? ctor : ctor.prototype : null;\r\n    var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\r\n    var _, done = false;\r\n    for (var i = decorators.length - 1; i >= 0; i--) {\r\n        var context = {};\r\n        for (var p in contextIn) context[p] = p === \"access\" ? {} : contextIn[p];\r\n        for (var p in contextIn.access) context.access[p] = contextIn.access[p];\r\n        context.addInitializer = function (f) { if (done) throw new TypeError(\"Cannot add initializers after decoration has completed\"); extraInitializers.push(accept(f || null)); };\r\n        var result = (0, decorators[i])(kind === \"accessor\" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);\r\n        if (kind === \"accessor\") {\r\n            if (result === void 0) continue;\r\n            if (result === null || typeof result !== \"object\") throw new TypeError(\"Object expected\");\r\n            if (_ = accept(result.get)) descriptor.get = _;\r\n            if (_ = accept(result.set)) descriptor.set = _;\r\n            if (_ = accept(result.init)) initializers.unshift(_);\r\n        }\r\n        else if (_ = accept(result)) {\r\n            if (kind === \"field\") initializers.unshift(_);\r\n            else descriptor[key] = _;\r\n        }\r\n    }\r\n    if (target) Object.defineProperty(target, contextIn.name, descriptor);\r\n    done = true;\r\n};\r\n\r\nexport function __runInitializers(thisArg, initializers, value) {\r\n    var useValue = arguments.length > 2;\r\n    for (var i = 0; i < initializers.length; i++) {\r\n        value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\r\n    }\r\n    return useValue ? value : void 0;\r\n};\r\n\r\nexport function __propKey(x) {\r\n    return typeof x === \"symbol\" ? x : \"\".concat(x);\r\n};\r\n\r\nexport function __setFunctionName(f, name, prefix) {\r\n    if (typeof name === \"symbol\") name = name.description ? \"[\".concat(name.description, \"]\") : \"\";\r\n    return Object.defineProperty(f, \"name\", { configurable: true, value: prefix ? \"\".concat(prefix, \" \", name) : name });\r\n};\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === \"function\" ? Iterator : Object).prototype);\r\n    return g.next = verb(0), g[\"throw\"] = verb(1), g[\"return\"] = verb(2), typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    var desc = Object.getOwnPropertyDescriptor(m, k);\r\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\r\n        desc = { enumerable: true, get: function() { return m[k]; } };\r\n    }\r\n    Object.defineProperty(o, k2, desc);\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = Object.create((typeof AsyncIterator === \"function\" ? AsyncIterator : Object).prototype), verb(\"next\"), verb(\"throw\"), verb(\"return\", awaitReturn), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function awaitReturn(f) { return function (v) { return Promise.resolve(v).then(f, reject); }; }\r\n    function verb(n, f) { if (g[n]) { i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; if (f) i[n] = f(i[n]); } }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: false } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nvar ownKeys = function(o) {\r\n    ownKeys = Object.getOwnPropertyNames || function (o) {\r\n        var ar = [];\r\n        for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;\r\n        return ar;\r\n    };\r\n    return ownKeys(o);\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== \"default\") __createBinding(result, mod, k[i]);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n\r\nexport function __classPrivateFieldIn(state, receiver) {\r\n    if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\r\n    return typeof state === \"function\" ? receiver === state : state.has(receiver);\r\n}\r\n\r\nexport function __addDisposableResource(env, value, async) {\r\n    if (value !== null && value !== void 0) {\r\n        if (typeof value !== \"object\" && typeof value !== \"function\") throw new TypeError(\"Object expected.\");\r\n        var dispose, inner;\r\n        if (async) {\r\n            if (!Symbol.asyncDispose) throw new TypeError(\"Symbol.asyncDispose is not defined.\");\r\n            dispose = value[Symbol.asyncDispose];\r\n        }\r\n        if (dispose === void 0) {\r\n            if (!Symbol.dispose) throw new TypeError(\"Symbol.dispose is not defined.\");\r\n            dispose = value[Symbol.dispose];\r\n            if (async) inner = dispose;\r\n        }\r\n        if (typeof dispose !== \"function\") throw new TypeError(\"Object not disposable.\");\r\n        if (inner) dispose = function() { try { inner.call(this); } catch (e) { return Promise.reject(e); } };\r\n        env.stack.push({ value: value, dispose: dispose, async: async });\r\n    }\r\n    else if (async) {\r\n        env.stack.push({ async: true });\r\n    }\r\n    return value;\r\n\r\n}\r\n\r\nvar _SuppressedError = typeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\r\n    var e = new Error(message);\r\n    return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\r\n};\r\n\r\nexport function __disposeResources(env) {\r\n    function fail(e) {\r\n        env.error = env.hasError ? new _SuppressedError(e, env.error, \"An error was suppressed during disposal.\") : e;\r\n        env.hasError = true;\r\n    }\r\n    var r, s = 0;\r\n    function next() {\r\n        while (r = env.stack.pop()) {\r\n            try {\r\n                if (!r.async && s === 1) return s = 0, env.stack.push(r), Promise.resolve().then(next);\r\n                if (r.dispose) {\r\n                    var result = r.dispose.call(r.value);\r\n                    if (r.async) return s |= 2, Promise.resolve(result).then(next, function(e) { fail(e); return next(); });\r\n                }\r\n                else s |= 1;\r\n            }\r\n            catch (e) {\r\n                fail(e);\r\n            }\r\n        }\r\n        if (s === 1) return env.hasError ? Promise.reject(env.error) : Promise.resolve();\r\n        if (env.hasError) throw env.error;\r\n    }\r\n    return next();\r\n}\r\n\r\nexport function __rewriteRelativeImportExtension(path, preserveJsx) {\r\n    if (typeof path === \"string\" && /^\\.\\.?\\//.test(path)) {\r\n        return path.replace(/\\.(tsx)$|((?:\\.d)?)((?:\\.[^./]+?)?)\\.([cm]?)ts$/i, function (m, tsx, d, ext, cm) {\r\n            return tsx ? preserveJsx ? \".jsx\" : \".js\" : d && (!ext || !cm) ? m : (d + ext + \".\" + cm.toLowerCase() + \"js\");\r\n        });\r\n    }\r\n    return path;\r\n}\r\n\r\nexport default {\r\n    __extends: __extends,\r\n    __assign: __assign,\r\n    __rest: __rest,\r\n    __decorate: __decorate,\r\n    __param: __param,\r\n    __esDecorate: __esDecorate,\r\n    __runInitializers: __runInitializers,\r\n    __propKey: __propKey,\r\n    __setFunctionName: __setFunctionName,\r\n    __metadata: __metadata,\r\n    __awaiter: __awaiter,\r\n    __generator: __generator,\r\n    __createBinding: __createBinding,\r\n    __exportStar: __exportStar,\r\n    __values: __values,\r\n    __read: __read,\r\n    __spread: __spread,\r\n    __spreadArrays: __spreadArrays,\r\n    __spreadArray: __spreadArray,\r\n    __await: __await,\r\n    __asyncGenerator: __asyncGenerator,\r\n    __asyncDelegator: __asyncDelegator,\r\n    __asyncValues: __asyncValues,\r\n    __makeTemplateObject: __makeTemplateObject,\r\n    __importStar: __importStar,\r\n    __importDefault: __importDefault,\r\n    __classPrivateFieldGet: __classPrivateFieldGet,\r\n    __classPrivateFieldSet: __classPrivateFieldSet,\r\n    __classPrivateFieldIn: __classPrivateFieldIn,\r\n    __addDisposableResource: __addDisposableResource,\r\n    __disposeResources: __disposeResources,\r\n    __rewriteRelativeImportExtension: __rewriteRelativeImportExtension,\r\n};\r\n","import { DDRInstance, DDROptions, DDRConfig, APIResponse, DDREvent, ExportOptions } from \"../types\";\r\n\r\n/**\r\n * DDRæ ¸å¿ƒç±»\r\n * æ•°æ®é©±åŠ¨æŠ¥è¡¨çš„ä¸»è¦å®ç°\r\n */\r\nclass DDR implements DDRInstance {\r\n  private container: HTMLElement;\r\n  private config: DDRConfig;\r\n  private data: any[] = [];\r\n  private metadata: Record<string, any> = {};\r\n  private pagination: Record<string, any> | null = null;\r\n  private filters: Record<string, any> = {};\r\n  private options: DDROptions;\r\n  private eventListeners: Map<DDREvent, Function[]> = new Map();\r\n  private formatters: Record<string, Function> = {};\r\n  private initialized: boolean = false;\r\n\r\n  /**\r\n   * åˆ›å»ºDDRå®ä¾‹\r\n   * @param options åˆå§‹åŒ–é€‰é¡¹\r\n   * @returns DDRå®ä¾‹\r\n   */\r\n  static create(options: DDROptions): DDRInstance {\r\n    const instance = new DDR(options);\r\n    instance.init().catch(error => {\r\n      if (options.onError) {\r\n        options.onError(error);\r\n      } else {\r\n        console.error('DDRåˆå§‹åŒ–å¤±è´¥:', error);\r\n      }\r\n    });\r\n    return instance;\r\n  }\r\n\r\n  /**\r\n   * æ³¨å†Œè‡ªå®šä¹‰æ ¼å¼åŒ–å‡½æ•°\r\n   * @param name æ ¼å¼åŒ–å‡½æ•°åç§°\r\n   * @param formatter æ ¼å¼åŒ–å‡½æ•°\r\n   */\r\n  static registerFormatter(name: string, formatter: Function): void {\r\n    DDR.globalFormatters[name] = formatter;\r\n  }\r\n\r\n  // å…¨å±€æ ¼å¼åŒ–å‡½æ•°\r\n  private static globalFormatters: Record<string, Function> = {\r\n    // å†…ç½®æ ¼å¼åŒ–å‡½æ•°\r\n    date: (value: string | number | Date) => {\r\n      const date = new Date(value);\r\n      return date.toLocaleDateString();\r\n    },\r\n    currency: (value: number, params?: { currency?: string, locale?: string }) => {\r\n      const { currency = 'CNY', locale = 'zh-CN' } = params || {};\r\n      return new Intl.NumberFormat(locale, {\r\n        style: 'currency',\r\n        currency\r\n      }).format(value);\r\n    },\r\n    number: (value: number, params?: { precision?: number, thousandSeparator?: boolean }) => {\r\n      const { precision = 2, thousandSeparator = true } = params || {};\r\n      const options = {\r\n        minimumFractionDigits: precision,\r\n        maximumFractionDigits: precision,\r\n        useGrouping: thousandSeparator\r\n      };\r\n      return new Intl.NumberFormat(undefined, options).format(value);\r\n    },\r\n    percentage: (value: number, params?: { precision?: number }) => {\r\n      const { precision = 2 } = params || {};\r\n      return new Intl.NumberFormat(undefined, {\r\n        style: 'percent',\r\n        minimumFractionDigits: precision,\r\n        maximumFractionDigits: precision\r\n      }).format(value);\r\n    }\r\n  };\r\n\r\n  constructor(options: DDROptions) {\r\n    this.options = options;\r\n\r\n    // è·å–å®¹å™¨å…ƒç´ \r\n    if (typeof options.container === 'string') {\r\n      const el = document.querySelector(options.container);\r\n      if (!el) {\r\n        throw new Error(`æ‰¾ä¸åˆ°å®¹å™¨å…ƒç´ : ${options.container}`);\r\n      }\r\n      this.container = el as HTMLElement;\r\n    } else if (options.container instanceof HTMLElement) {\r\n      this.container = options.container;\r\n    } else {\r\n      throw new Error('æ— æ•ˆçš„å®¹å™¨å…ƒç´ ');\r\n    }\r\n\r\n    // åº”ç”¨å®¹å™¨æ ·å¼\r\n    this.container.classList.add('ddr-container');\r\n    if (options.theme) {\r\n      this.container.classList.add(`ddr-theme-${options.theme}`);\r\n    } else {\r\n      this.container.classList.add('ddr-theme-default');\r\n    }\r\n\r\n    // åˆå¹¶æœ¬åœ°å’Œå…¨å±€æ ¼å¼åŒ–å‡½æ•°\r\n    this.formatters = { ...DDR.globalFormatters };\r\n\r\n    // åˆå§‹åŒ–å…ƒæ•°æ®\r\n    if (options.metadata) {\r\n      this.metadata = { ...options.metadata };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * åˆå§‹åŒ–æŠ¥è¡¨\r\n   */\r\n  async init(): Promise<void> {\r\n    try {\r\n      // åŠ è½½é…ç½®\r\n      this.config = await this._loadConfig(this.options.config);\r\n\r\n      // è·å–æ•°æ®\r\n      const apiResponse = await this._fetchData(this.config.dataSource);\r\n      this.data = apiResponse.records;\r\n      this.metadata = apiResponse.metadata || this.metadata;\r\n      this.pagination = apiResponse.pagination || null;\r\n\r\n      // å¤„ç†åˆ†ç»„å°è®¡ï¼ˆå¦‚æœå¯ç”¨ï¼‰\r\n      if (this.config.grouping?.enabled) {\r\n        this.data = this._processGrouping(this.data);\r\n        console.log(`ğŸ“Š åˆ†ç»„å¤„ç†å®Œæˆï¼Œæ•°æ®è¡Œæ•°ï¼š${this.data.length}`);\r\n      }\r\n\r\n      // æ¸²æŸ“æŠ¥è¡¨\r\n      this._render();\r\n\r\n      this.initialized = true;\r\n      this._emitEvent('data-loaded', { data: this.data });\r\n\r\n      if (this.options.onLoad) {\r\n        this.options.onLoad();\r\n      }\r\n    } catch (error) {\r\n      this._emitEvent('error', { error });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * é‡æ–°åŠ è½½æ•°æ®\r\n   * @param params é¢å¤–çš„æŸ¥è¯¢å‚æ•°\r\n   */\r\n  async reload(params?: Record<string, any>): Promise<void> {\r\n    if (!this.initialized) {\r\n      throw new Error('DDRå°šæœªåˆå§‹åŒ–');\r\n    }\r\n\r\n    try {\r\n      const apiResponse = await this._fetchData(this.config.dataSource, params);\r\n      this.data = apiResponse.records;\r\n\r\n      // åªæœ‰åœ¨APIè¿”å›äº†å…ƒæ•°æ®æ—¶æ‰æ›´æ–°\r\n      if (apiResponse.metadata) {\r\n        this.metadata = apiResponse.metadata;\r\n        this._emitEvent('metadata-updated', { metadata: this.metadata });\r\n      }\r\n\r\n      this.pagination = apiResponse.pagination || null;\r\n\r\n      // å¤„ç†åˆ†ç»„å°è®¡ï¼ˆå¦‚æœå¯ç”¨ï¼‰\r\n      if (this.config.grouping?.enabled) {\r\n        this.data = this._processGrouping(this.data);\r\n        console.log(`ğŸ“Š é‡æ–°åŠ è½½ååˆ†ç»„å¤„ç†å®Œæˆï¼Œæ•°æ®è¡Œæ•°ï¼š${this.data.length}`);\r\n      }\r\n\r\n      // é‡æ–°æ¸²æŸ“\r\n      this._render();\r\n      this._emitEvent('data-loaded', { data: this.data });\r\n    } catch (error) {\r\n      this._emitEvent('error', { error });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * åˆ·æ–°å…ƒæ•°æ®\r\n   */\r\n  async refreshMetadata(): Promise<void> {\r\n    if (!this.initialized) {\r\n      throw new Error('DDRå°šæœªåˆå§‹åŒ–');\r\n    }\r\n\r\n    try {\r\n      // å¦‚æœé…ç½®äº†ç‹¬ç«‹çš„å…ƒæ•°æ®APIåˆ™ä½¿ç”¨å®ƒ\r\n      if (this.config.dataSource.metadataSource) {\r\n        const response = await this._fetchMetadata(this.config.dataSource.metadataSource);\r\n        this.metadata = response.metadata || {};\r\n      } else {\r\n        // å¦åˆ™é‡æ–°è·å–æ‰€æœ‰æ•°æ®\r\n        const apiResponse = await this._fetchData(this.config.dataSource);\r\n        if (apiResponse.metadata) {\r\n          this.metadata = apiResponse.metadata;\r\n        }\r\n      }\r\n\r\n      // é‡æ–°æ¸²æŸ“è¡¨å¤´å’Œè¡¨å°¾\r\n      this._renderHeaderFooter();\r\n      this._emitEvent('metadata-updated', { metadata: this.metadata });\r\n    } catch (error) {\r\n      this._emitEvent('error', { error });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * æ›´æ–°å…ƒæ•°æ®\r\n   * @param metadata è¦æ›´æ–°çš„å…ƒæ•°æ®\r\n   */\r\n  updateMetadata(metadata: Record<string, any>): void {\r\n    // æ£€æŸ¥æ˜¯å¦åŒ…å«æ•°æ®æ›´æ–°\r\n    if (metadata.data && Array.isArray(metadata.data)) {\r\n      console.log('ğŸ“Š é€šè¿‡updateMetadataæ›´æ–°æ•°æ®ï¼Œå…±', metadata.data.length, 'æ¡è®°å½•');\r\n      this.data = metadata.data;\r\n\r\n      // ä»metadataä¸­ç§»é™¤dataï¼Œé¿å…æ±¡æŸ“å…ƒæ•°æ®\r\n      const { data, ...metadataWithoutData } = metadata;\r\n      this.metadata = { ...this.metadata, ...metadataWithoutData };\r\n\r\n      if (this.initialized) {\r\n        // é‡æ–°æ¸²æŸ“æ•´ä¸ªæŠ¥è¡¨ï¼ˆåŒ…æ‹¬æ•°æ®è¡¨æ ¼ï¼‰\r\n        this._render();\r\n        this._emitEvent('data-loaded', { data: this.data });\r\n        this._emitEvent('metadata-updated', { metadata: this.metadata });\r\n      }\r\n    } else {\r\n      // åªæ›´æ–°å…ƒæ•°æ®ï¼Œä¸æ¶‰åŠæ•°æ®å˜æ›´\r\n      this.metadata = { ...this.metadata, ...metadata };\r\n\r\n      if (this.initialized) {\r\n        // åªé‡æ–°æ¸²æŸ“è¡¨å¤´å’Œè¡¨å°¾\r\n        this._renderHeaderFooter();\r\n        this._emitEvent('metadata-updated', { metadata: this.metadata });\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * å¯¼å‡ºä¸ºExcelæˆ–PDF\r\n   * @param type å¯¼å‡ºç±»å‹\r\n   * @param options å¯¼å‡ºé€‰é¡¹\r\n   */\r\n  async exportTo(type: \"excel\" | \"pdf\", options?: ExportOptions): Promise<void> {\r\n    if (!this.initialized) {\r\n      throw new Error('DDRå°šæœªåˆå§‹åŒ–');\r\n    }\r\n\r\n    try {\r\n      this._emitEvent('export-start', { type, options });\r\n        // å¯¼å…¥å¯¼å‡ºæ¨¡å—ï¼ŒæŒ‰éœ€åŠ è½½ä»¥å‡å°åŒ…ä½“ç§¯\r\n      // ä¿®æ”¹ä¸ºä½¿ç”¨é™æ€å¯¼å…¥ï¼Œé¿å…ä»£ç æ‹†åˆ†\r\n      const { Exporter } = await import('../core/exporter');\r\n\r\n      // æ‰§è¡Œå¯¼å‡º\r\n      if (type === 'excel') {\r\n        // Excelå¯¼å‡ºä¼ é€’DOMå…ƒç´ ä»¥ä¿ç•™æ ·å¼\r\n        await Exporter.toExcel(this.container, options);\r\n      } else if (type === 'pdf') {\r\n        // PDFå¯¼å‡ºä¼ é€’DOMå…ƒç´ å’Œé…ç½®\r\n        await Exporter.toPDF(this.container, this.config, options);\r\n      }\r\n\r\n      this._emitEvent('export-complete', {\r\n        type,\r\n        fileName: options?.fileName || `${this.config.meta.name}.${type === 'excel' ? 'xlsx' : 'pdf'}`\r\n      });\r\n    } catch (error) {\r\n      this._emitEvent('error', { error });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * é”€æ¯å®ä¾‹å¹¶æ¸…ç†èµ„æº\r\n   */\r\n  destroy(): void {\r\n    // æ¸…é™¤DOM\r\n    this.container.innerHTML = '';\r\n\r\n    // ç§»é™¤äº‹ä»¶ç›‘å¬å™¨\r\n    this.eventListeners.clear();\r\n\r\n    // æ¸…é™¤å¼•ç”¨\r\n    this.data = [];\r\n    this.metadata = {};\r\n    this.initialized = false;\r\n  }\r\n\r\n  /**\r\n   * è®¾ç½®è¿‡æ»¤æ¡ä»¶\r\n   * @param filters è¿‡æ»¤æ¡ä»¶\r\n   */\r\n  setFilter(filters: Record<string, any>): void {\r\n    this.filters = { ...this.filters, ...filters };\r\n  }\r\n\r\n  /**\r\n   * æ·»åŠ äº‹ä»¶ç›‘å¬\r\n   * @param event äº‹ä»¶åç§°\r\n   * @param callback å›è°ƒå‡½æ•°\r\n   */\r\n  on(event: DDREvent, callback: Function): void {\r\n    if (!this.eventListeners.has(event)) {\r\n      this.eventListeners.set(event, []);\r\n    }\r\n    this.eventListeners.get(event)!.push(callback);\r\n  }\r\n\r\n  /**\r\n   * ç§»é™¤äº‹ä»¶ç›‘å¬\r\n   * @param event äº‹ä»¶åç§°\r\n   * @param callback å›è°ƒå‡½æ•°\r\n   */\r\n  off(event: DDREvent, callback: Function): void {\r\n    if (this.eventListeners.has(event)) {\r\n      const callbacks = this.eventListeners.get(event)!;\r\n      const index = callbacks.indexOf(callback);\r\n      if (index !== -1) {\r\n        callbacks.splice(index, 1);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * æ‰§è¡Œæ‰“å° - ä½¿ç”¨ä¸PDFå¯¼å‡ºä¸€è‡´çš„é€»è¾‘\r\n   */\r\n  async print(): Promise<void> {\r\n    try {\r\n      console.log('å¼€å§‹æ‰“å°ï¼Œä½¿ç”¨PDFå¯¼å‡ºé€»è¾‘ç”Ÿæˆæ‰“å°å†…å®¹');\r\n\r\n      // å¯¼å…¥å¯¼å‡ºæ¨¡å—\r\n      const { Exporter } = await import('../core/exporter');\r\n\r\n      // ä½¿ç”¨PDFå¯¼å‡ºçš„é€»è¾‘ç”Ÿæˆæ‰“å°å†…å®¹ï¼Œä½†ä¸ä¿å­˜æ–‡ä»¶\r\n      await Exporter.toPrint(this.container, this.config, {\r\n        watermark: this.config.features?.watermark,\r\n        pdf: this.config.features?.pdfConfig || {}\r\n      });\r\n\r\n    } catch (error) {\r\n      console.error('æ‰“å°å¤±è´¥ï¼Œé™çº§åˆ°ç®€å•æ‰“å°:', error);\r\n\r\n      // é™çº§åˆ°åŸæ¥çš„ç®€å•æ‰“å°æ–¹å¼\r\n      this._simplePrint();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ç®€å•æ‰“å°æ–¹å¼ï¼ˆé™çº§æ–¹æ¡ˆï¼‰\r\n   */\r\n  private _simplePrint(): void {\r\n    // åˆ›å»ºæ‰“å°æ ·å¼\r\n    const style = document.createElement('style');\r\n    style.textContent = `\r\n      @media print {\r\n        body * {\r\n          visibility: hidden;\r\n        }\r\n        .ddr-container, .ddr-container * {\r\n          visibility: visible;\r\n        }\r\n        .ddr-container {\r\n          position: absolute;\r\n          left: 0;\r\n          top: 0;\r\n          width: 100% !important;\r\n          height: auto !important;\r\n          overflow: visible !important;\r\n        }\r\n        .ddr-table-container {\r\n          overflow: visible !important;\r\n          height: auto !important;\r\n        }\r\n        .ddr-table {\r\n          page-break-inside: auto;\r\n        }\r\n        .ddr-table-row {\r\n          page-break-inside: avoid;\r\n          page-break-after: auto;\r\n        }\r\n        .ddr-header, .ddr-footer {\r\n          page-break-inside: avoid;\r\n        }\r\n      }\r\n    `;\r\n    document.head.appendChild(style);\r\n\r\n    // æ‰§è¡Œæ‰“å°\r\n    window.print();\r\n\r\n    // ç§»é™¤æ‰“å°æ ·å¼\r\n    setTimeout(() => {\r\n      document.head.removeChild(style);\r\n    }, 100);\r\n  }\r\n\r\n  /**\r\n   * è·å–åŸå§‹æ•°æ®\r\n   * @returns æ•°æ®æ•°ç»„\r\n   */\r\n  getData(): any[] {\r\n    return [...this.data];\r\n  }\r\n\r\n  /**\r\n   * è·å–å…ƒæ•°æ®\r\n   * @returns å…ƒæ•°æ®å¯¹è±¡\r\n   */\r\n  getMetadata(): Record<string, any> {\r\n    return { ...this.metadata };\r\n  }\r\n\r\n  /**\r\n   * ä»å…ƒæ•°æ®ä¸­æ ¹æ®è·¯å¾„è·å–å€¼\r\n   * @param path è·¯å¾„ï¼Œä¾‹å¦‚ï¼š\"company.name\"\r\n   * @returns æ‰¾åˆ°çš„å€¼æˆ–undefined\r\n   */\r\n  private _getValueByPath(path?: string): any {\r\n    if (!path) return undefined;\r\n    return path.split('.').reduce((acc, part) =>\r\n      acc && acc[part] !== undefined ? acc[part] : undefined, this.metadata);\r\n  }\r\n\r\n  /**\r\n   * åŠ è½½é…ç½®\r\n   * @param config é…ç½®è·¯å¾„æˆ–å¯¹è±¡\r\n   * @returns åŠ è½½åçš„é…ç½®\r\n   */\r\n  private async _loadConfig(config: string | DDRConfig): Promise<DDRConfig> {\r\n    if (typeof config === 'string') {\r\n      // æ”¯æŒæœ¬åœ°JSONæˆ–è¿œç¨‹API\r\n      if (config.startsWith('http')) {\r\n        const response = await fetch(config);\r\n        if (!response.ok) {\r\n          throw new Error(`åŠ è½½é…ç½®å¤±è´¥: ${response.statusText}`);\r\n        }\r\n        return await response.json();\r\n      } else {\r\n        // åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œå¯èƒ½éœ€è¦æ ¹æ®ç¯å¢ƒè°ƒæ•´å¯¼å…¥æ–¹å¼\r\n        // è¿™é‡Œç®€åŒ–å¤„ç†\r\n        try {\r\n          // å°è¯•ä»ç›¸å¯¹è·¯å¾„åŠ è½½\r\n          const response = await fetch(config);\r\n          if (!response.ok) {\r\n            throw new Error(`åŠ è½½é…ç½®å¤±è´¥: ${response.statusText}`);\r\n          }\r\n          return await response.json();\r\n        } catch (error) {\r\n          throw new Error(`åŠ è½½é…ç½®å¤±è´¥: ${error instanceof Error ? error.message : String(error)}`);\r\n        }\r\n      }\r\n    } else {\r\n      return config;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * è·å–æ•°æ®\r\n   * @param dataSource æ•°æ®æºé…ç½®\r\n   * @param extraParams é¢å¤–çš„æŸ¥è¯¢å‚æ•°\r\n   * @returns APIå“åº”å¯¹è±¡\r\n   */\r\n  private async _fetchData(\r\n    dataSource: DDRConfig['dataSource'],\r\n    extraParams?: Record<string, any>\r\n  ): Promise<{\r\n    records: any[];\r\n    metadata?: Record<string, any>;\r\n    pagination?: Record<string, any>;\r\n  }> {\r\n    // ä¼˜å…ˆçº§1ï¼šå¦‚æœç›´æ¥æä¾›äº†æ•°æ®ï¼Œåˆ™ä½¿ç”¨ç›´æ¥æ•°æ®\r\n    if (dataSource.data && Array.isArray(dataSource.data)) {\r\n      console.log('ğŸ“Š ä½¿ç”¨ç›´æ¥æä¾›çš„æ•°æ®ï¼Œå…±', dataSource.data.length, 'æ¡è®°å½•');\r\n      return {\r\n        records: dataSource.data,\r\n        metadata: this.metadata\r\n      };\r\n    }\r\n\r\n    // ä¼˜å…ˆçº§2ï¼šå¦‚æœæœ‰æ¨¡æ‹Ÿæ•°æ®åˆ™ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®\r\n    if (dataSource.mock && (!this.options.debug || window.location.hostname === 'localhost')) {\r\n      console.log('ğŸ“Š ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼Œå…±', dataSource.mock.length, 'æ¡è®°å½•');\r\n      return {\r\n        records: dataSource.mock,\r\n        metadata: this.metadata\r\n      };\r\n    }\r\n\r\n    // ä¼˜å…ˆçº§3ï¼šå¦‚æœæ²¡æœ‰APIé…ç½®ï¼Œåˆ™è¿”å›ç©ºæ•°æ®\r\n    if (!dataSource.api) {\r\n      console.warn('âš ï¸ æœªé…ç½®APIåœ°å€ä¸”æœªæä¾›ç›´æ¥æ•°æ®ï¼Œè¿”å›ç©ºæ•°æ®é›†');\r\n      return {\r\n        records: [],\r\n        metadata: this.metadata\r\n      };\r\n    }\r\n\r\n    // åˆå¹¶å‚æ•°\r\n    const params = { ...dataSource.params, ...this.filters, ...extraParams };\r\n\r\n    // æ„å»ºè¯·æ±‚é€‰é¡¹\r\n    const options: RequestInit = {\r\n      method: dataSource.method || 'GET',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        ...(dataSource.headers || {})\r\n      }\r\n    };\r\n\r\n    // å¯¹äºPOSTè¯·æ±‚ï¼Œæ·»åŠ body\r\n    if (options.method === 'POST') {\r\n      options.body = JSON.stringify(params);\r\n    }\r\n\r\n    // å¯¹äºGETè¯·æ±‚ï¼Œæ·»åŠ æŸ¥è¯¢å‚æ•°\r\n    let url = dataSource.api;\r\n    if (options.method === 'GET' && Object.keys(params).length > 0) {\r\n      const queryParams = new URLSearchParams();\r\n      Object.entries(params).forEach(([key, value]) => {\r\n        queryParams.append(key, String(value));\r\n      });\r\n      url += `?${queryParams.toString()}`;\r\n    }\r\n\r\n    // å‘é€è¯·æ±‚\r\n    const response = await fetch(url, options);\r\n    if (!response.ok) {\r\n      throw new Error(`APIè¯·æ±‚å¤±è´¥: ${response.statusText}`);\r\n    }\r\n\r\n    // è§£æå“åº”\r\n    const result: APIResponse = await response.json();\r\n\r\n    // æ£€æŸ¥APIè¿”å›çŠ¶æ€\r\n    if (!result.success) {\r\n      throw new Error(`APIé”™è¯¯: ${result.message || `çŠ¶æ€ç  ${result.code}`}`);\r\n    }\r\n\r\n    // æå–æ•°æ®\r\n    return {\r\n      records: result.data.records || [],\r\n      metadata: result.data.metadata,\r\n      pagination: result.data.pagination\r\n    };\r\n  }\r\n\r\n  /**\r\n   * è·å–å…ƒæ•°æ®\r\n   * @param metadataSource å…ƒæ•°æ®æºé…ç½®\r\n   * @returns å…ƒæ•°æ®å¯¹è±¡\r\n   */\r\n  private async _fetchMetadata(metadataSource: DDRConfig['dataSource']['metadataSource']): Promise<{\r\n    metadata: Record<string, any>;\r\n  }> {\r\n    if (!metadataSource) {\r\n      throw new Error('æœªé…ç½®å…ƒæ•°æ®æº');\r\n    }\r\n\r\n    // æ„å»ºè¯·æ±‚é€‰é¡¹\r\n    const options: RequestInit = {\r\n      method: metadataSource.method || 'GET',\r\n      headers: {\r\n        'Content-Type': 'application/json'\r\n      }\r\n    };\r\n\r\n    // å¯¹äºPOSTè¯·æ±‚ï¼Œæ·»åŠ body\r\n    if (options.method === 'POST' && metadataSource.params) {\r\n      options.body = JSON.stringify(metadataSource.params);\r\n    }\r\n\r\n    // å¯¹äºGETè¯·æ±‚ï¼Œæ·»åŠ æŸ¥è¯¢å‚æ•°\r\n    let url = metadataSource.api;\r\n    if (options.method === 'GET' && metadataSource.params && Object.keys(metadataSource.params).length > 0) {\r\n      const queryParams = new URLSearchParams();\r\n      Object.entries(metadataSource.params).forEach(([key, value]) => {\r\n        queryParams.append(key, String(value));\r\n      });\r\n      url += `?${queryParams.toString()}`;\r\n    }\r\n\r\n    // å‘é€è¯·æ±‚\r\n    const response = await fetch(url, options);\r\n    if (!response.ok) {\r\n      throw new Error(`å…ƒæ•°æ®APIè¯·æ±‚å¤±è´¥: ${response.statusText}`);\r\n    }\r\n\r\n    // è§£æå“åº”\r\n    const result: APIResponse = await response.json();\r\n\r\n    // æ£€æŸ¥APIè¿”å›çŠ¶æ€\r\n    if (!result.success) {\r\n      throw new Error(`å…ƒæ•°æ®APIé”™è¯¯: ${result.message || `çŠ¶æ€ç  ${result.code}`}`);\r\n    }\r\n\r\n    // æå–å…ƒæ•°æ®\r\n    return {\r\n      metadata: result.data.metadata || {}\r\n    };\r\n  }\r\n\r\n  /**\r\n   * æ¸²æŸ“æŠ¥è¡¨\r\n   */\r\n  private _render(): void {\r\n    // æ¸…ç©ºå®¹å™¨\r\n    this.container.innerHTML = '';\r\n\r\n    // åˆ›å»ºåŒ…è£…å™¨\r\n    const wrapper = document.createElement('div');\r\n    wrapper.className = 'ddr-wrapper';\r\n\r\n    // åº”ç”¨å¸ƒå±€è®¾ç½®\r\n    if (this.config.layout) {\r\n      if (this.config.layout.height) {\r\n        wrapper.style.height = typeof this.config.layout.height === 'number'\r\n          ? `${this.config.layout.height}px`\r\n          : this.config.layout.height;\r\n      }\r\n\r\n      if (this.config.layout.bordered) {\r\n        wrapper.classList.add('ddr-bordered');\r\n      }\r\n    }\r\n\r\n    this.container.appendChild(wrapper);\r\n\r\n    // æ ¹æ®æ•°æ®é‡é€‰æ‹©æ¸²æŸ“æ¨¡å¼\r\n    const renderMode = this._determineRenderMode();\r\n    wrapper.setAttribute('data-render-mode', renderMode);\r\n\r\n    // æ¸²æŸ“è¡¨å¤´å’Œè¡¨å°¾\r\n    this._renderHeaderFooter(wrapper);\r\n\r\n    // æ¸²æŸ“æ•°æ®è¡¨æ ¼\r\n    if (renderMode === 'canvas') {\r\n      this._renderCanvas(wrapper);\r\n    } else {\r\n      this._renderDOM(wrapper);\r\n    }\r\n\r\n    // æ·»åŠ æ°´å°\r\n    if (this.config.features?.watermark) {\r\n      this._addWatermark(wrapper, this.config.features.watermark);\r\n    }\r\n\r\n    this._emitEvent('render-complete');\r\n  }  /**\r\n   * æ¸²æŸ“è¡¨å¤´å’Œè¡¨å°¾\r\n   * @param container å®¹å™¨å…ƒç´ \r\n   */\r\n  private _renderHeaderFooter(container?: HTMLElement): void {\r\n    const wrapper = container || this.container.querySelector('.ddr-wrapper') as HTMLElement;\r\n    if (!wrapper) return;\r\n\r\n    // ç§»é™¤æ—§çš„è¡¨å¤´å’Œè¡¨å°¾\r\n    const oldHeader = wrapper.querySelector('.ddr-report-header');\r\n    const oldFooter = wrapper.querySelector('.ddr-report-footer');\r\n\r\n    if (oldHeader) {\r\n      wrapper.removeChild(oldHeader);\r\n    }\r\n\r\n    if (oldFooter) {\r\n      wrapper.removeChild(oldFooter);\r\n    }\r\n\r\n    // æ·»åŠ æ–°çš„è¡¨å¤´\r\n    if (this.config.header) {\r\n      const header = this._createHeader(this.config.header);\r\n      if (header) {\r\n        wrapper.insertBefore(header, wrapper.firstChild);\r\n\r\n        // ä½¿ç”¨MutationObserverç›‘å¬è¡¨å¤´é«˜åº¦å˜åŒ–\r\n        const resizeObserver = new ResizeObserver((entries) => {\r\n          for (const entry of entries) {\r\n            // è·å–å‡†ç¡®çš„headeré«˜åº¦\r\n            const headerHeight = entry.contentRect.height;\r\n            wrapper.style.setProperty('--header-height', `${headerHeight}px`);\r\n\r\n            // ç¡®ä¿è¡¨æ ¼å®¹å™¨çš„ä½ç½®å’Œé«˜åº¦æ­£ç¡®\r\n            const tableContainer = wrapper.querySelector('.ddr-table-container') as HTMLElement;\r\n            if (tableContainer) {\r\n              // ä¸å†ç›´æ¥è®¾ç½®topï¼Œä½¿ç”¨marginæ¥æ§åˆ¶ä½ç½®ï¼Œé¿å…ç»å¯¹å®šä½å¯¼è‡´çš„é‡å \r\n              tableContainer.style.marginTop = '10px';\r\n              tableContainer.style.maxHeight = `calc(100% - ${headerHeight + 10}px - var(--footer-height, 0px))`;\r\n            }\r\n          }\r\n        });\r\n\r\n        // å¼€å§‹ç›‘å¬è¡¨å¤´å°ºå¯¸å˜åŒ–\r\n        resizeObserver.observe(header);\r\n\r\n        // ç«‹å³æ‰§è¡Œä¸€æ¬¡è®¡ç®—\r\n        const headerHeight = header.getBoundingClientRect().height;\r\n        wrapper.style.setProperty('--header-height', `${headerHeight}px`);\r\n\r\n        // ç¡®ä¿è¡¨æ ¼å®¹å™¨çš„é«˜åº¦å’Œä½ç½®æ­£ç¡®\r\n        const tableContainer = wrapper.querySelector('.ddr-table-container') as HTMLElement;\r\n        if (tableContainer) {\r\n          tableContainer.style.marginTop = '10px';\r\n          tableContainer.style.maxHeight = `calc(100% - ${headerHeight + 10}px - var(--footer-height, 0px))`;\r\n        }\r\n      }\r\n    }\r\n      // è¡¨å°¾ç°åœ¨åœ¨_renderDOMä¸­å¤„ç†\r\n    // åˆå§‹æ¸²æŸ“æ—¶ä¸å†åœ¨è¿™é‡Œæ·»åŠ é¡µè„šï¼Œè€Œæ˜¯åœ¨æ¸²æŸ“å®Œè¡¨æ ¼åæ·»åŠ \r\n    // è¿™æ ·å¯ä»¥ç¡®ä¿é¡µè„šæ”¾ç½®åœ¨è¡¨æ ¼å®¹å™¨ä¹‹å\r\n    if (this.config.footer && this.initialized) {\r\n      // åªåœ¨åˆ·æ–°å…ƒæ•°æ®æ—¶æ·»åŠ é¡µè„š\r\n      const footer = this._createFooter(this.config.footer);\r\n      if (footer) {\r\n        // å°è¯•æŸ¥æ‰¾è¡¨æ ¼å®¹å™¨ï¼Œå¦‚æœæ‰¾åˆ°åˆ™åœ¨å…¶åæ·»åŠ é¡µè„š\r\n        const tableContainer = wrapper.querySelector('.ddr-table-container');\r\n        if (tableContainer) {\r\n          wrapper.insertBefore(footer, tableContainer.nextSibling);\r\n        } else {\r\n          wrapper.appendChild(footer);\r\n        }\r\n      }\r\n    }\r\n  }\r\n    /**\r\n   * åˆ›å»ºè¡¨å¤´\r\n   * @param headerConfig è¡¨å¤´é…ç½®\r\n   * @returns è¡¨å¤´å…ƒç´ \r\n   */\r\n  private _createHeader(headerConfig: DDRConfig['header']): HTMLElement | null {\r\n    if (!headerConfig) return null;\r\n\r\n    const headerElement = document.createElement('div');\r\n    headerElement.className = 'ddr-report-header';\r\n    // ä¸å†è®¾ç½®å›ºå®šé«˜åº¦ï¼Œæ”¹ä¸ºæœ€å°é«˜åº¦ï¼Œè®©å…¶è‡ªåŠ¨é€‚åº”å†…å®¹\r\n    headerElement.style.minHeight = `${headerConfig.height || 80}px`;\r\n\r\n    // åˆ›å»ºé¡¶éƒ¨åŒºåŸŸå®¹å™¨ï¼ˆLogo + æ ‡é¢˜ï¼‰\r\n    const topContainer = document.createElement('div');\r\n    topContainer.className = 'ddr-header-top';\r\n\r\n    // æ¸²æŸ“Logo\r\n    if (headerConfig.logo) {\r\n      const logoContainer = document.createElement('div');\r\n      logoContainer.className = `ddr-header-logo ddr-header-logo-${headerConfig.logo.position || 'left'}`;\r\n\r\n      const logoImg = document.createElement('img');\r\n      logoImg.alt = 'Logo';\r\n      // ä¼˜å…ˆä½¿ç”¨å…ƒæ•°æ®ä¸­çš„logo\r\n      logoImg.src = headerConfig.logo.metadataKey\r\n        ? this._getValueByPath(headerConfig.logo.metadataKey) || headerConfig.logo.url || ''\r\n        : headerConfig.logo.url || '';\r\n\r\n      if (headerConfig.logo.width) {\r\n        logoImg.width = headerConfig.logo.width;\r\n      }\r\n\r\n      if (headerConfig.logo.height) {\r\n        logoImg.height = headerConfig.logo.height;\r\n      }\r\n\r\n      logoContainer.appendChild(logoImg);\r\n      topContainer.appendChild(logoContainer);\r\n    }\r\n\r\n    // åˆ›å»ºä¸­é—´æ ‡é¢˜åŒºåŸŸ\r\n    const centerContainer = document.createElement('div');\r\n    centerContainer.className = 'ddr-header-center';\r\n\r\n    // æ¸²æŸ“æ ‡é¢˜åˆ°ä¸­é—´åŒºåŸŸ\r\n    if (headerConfig.title) {\r\n      const titleText = typeof headerConfig.title === 'string'\r\n        ? headerConfig.title\r\n        : headerConfig.title.metadataPath\r\n          ? this._getValueByPath(headerConfig.title.metadataPath) || headerConfig.title.text\r\n          : headerConfig.title.text;\r\n\r\n      const titleElement = document.createElement('h2');\r\n      titleElement.className = 'ddr-header-title';\r\n      titleElement.textContent = titleText;\r\n\r\n      if (typeof headerConfig.title === 'object' && headerConfig.title.style) {\r\n        Object.assign(titleElement.style, headerConfig.title.style);\r\n      }\r\n\r\n      centerContainer.appendChild(titleElement);\r\n    }\r\n\r\n    // æ¸²æŸ“å‰¯æ ‡é¢˜åˆ°ä¸­é—´åŒºåŸŸ\r\n    if (headerConfig.subtitle) {\r\n      const subtitleElement = document.createElement('div');\r\n      subtitleElement.className = 'ddr-header-subtitle';\r\n\r\n      // å¤„ç†å‰¯æ ‡é¢˜æ–‡æœ¬\r\n      let subtitleText = '';\r\n      if (typeof headerConfig.subtitle === 'string') {\r\n        subtitleText = headerConfig.subtitle;\r\n      } else if (typeof headerConfig.subtitle === 'object' && headerConfig.subtitle !== null) {\r\n        const subtitleObj = headerConfig.subtitle as any;\r\n        subtitleText = subtitleObj.text || String(headerConfig.subtitle);\r\n      } else {\r\n        subtitleText = String(headerConfig.subtitle);\r\n      }\r\n\r\n      subtitleElement.textContent = subtitleText;\r\n\r\n      // åº”ç”¨å‰¯æ ‡é¢˜æ ·å¼(å¦‚æœæœ‰)\r\n      if (typeof headerConfig.subtitle === 'object' && headerConfig.subtitle !== null) {\r\n        const subtitleObj = headerConfig.subtitle as any;\r\n        if (subtitleObj.style) {\r\n          Object.assign(subtitleElement.style, subtitleObj.style);\r\n        }\r\n      }\r\n\r\n      centerContainer.appendChild(subtitleElement);\r\n    }\r\n\r\n    topContainer.appendChild(centerContainer);\r\n    headerElement.appendChild(topContainer);\r\n\r\n    // æ¸²æŸ“å­—æ®µ\r\n    if (headerConfig.fields && headerConfig.fields.length > 0) {\r\n      const fieldsContainer = document.createElement('div');\r\n      fieldsContainer.className = 'ddr-header-fields';\r\n\r\n      const leftFields = document.createElement('div');\r\n      leftFields.className = 'ddr-header-fields-left';\r\n\r\n      const rightFields = document.createElement('div');\r\n      rightFields.className = 'ddr-header-fields-right';\r\n\r\n      headerConfig.fields.forEach(field => {\r\n        const fieldElement = document.createElement('div');\r\n        fieldElement.className = 'ddr-header-field';\r\n\r\n        // åˆ›å»ºæ ‡ç­¾\r\n        const labelElement = document.createElement('span');\r\n        labelElement.className = 'ddr-field-label';\r\n        labelElement.textContent = field.label || '';\r\n        fieldElement.appendChild(labelElement);\r\n\r\n        // åˆ›å»ºå€¼\r\n        const valueElement = document.createElement('span');\r\n        valueElement.className = 'ddr-field-value';\r\n\r\n        // ä¼˜å…ˆä»å…ƒæ•°æ®è·å–å€¼\r\n        let value = field.metadataPath\r\n          ? this._getValueByPath(field.metadataPath)\r\n          : field.value || '';\r\n\r\n        // åº”ç”¨æ ¼å¼åŒ–å‡½æ•°(å¦‚æœæœ‰)\r\n        if (value !== undefined && field.formatter && this.formatters[field.formatter]) {\r\n          value = this.formatters[field.formatter](value);\r\n        }\r\n\r\n        valueElement.textContent = value !== undefined ? String(value) : '';\r\n        fieldElement.appendChild(valueElement);\r\n\r\n        // åº”ç”¨è‡ªå®šä¹‰æ ·å¼\r\n        if (field.style) {\r\n          Object.assign(fieldElement.style, field.style);\r\n        }\r\n\r\n        // æ ¹æ®ä½ç½®æ·»åŠ åˆ°å·¦ä¾§æˆ–å³ä¾§\r\n        if (field.position === 'right') {\r\n          rightFields.appendChild(fieldElement);\r\n        } else {\r\n          leftFields.appendChild(fieldElement);\r\n        }\r\n      });\r\n\r\n      fieldsContainer.appendChild(leftFields);\r\n      fieldsContainer.appendChild(rightFields);\r\n      headerElement.appendChild(fieldsContainer);\r\n    }\r\n\r\n    return headerElement;\r\n  }\r\n\r\n  /**\r\n   * åˆ›å»ºè¡¨å°¾\r\n   * @param footerConfig è¡¨å°¾é…ç½®\r\n   * @returns è¡¨å°¾å…ƒç´ \r\n   */  private _createFooter(footerConfig: DDRConfig['footer']): HTMLElement | null {\r\n    if (!footerConfig) return null;\r\n\r\n    const footerElement = document.createElement('div');\r\n    footerElement.className = 'ddr-report-footer';\r\n    // æ”¹ä¸ºæœ€å°é«˜åº¦è€Œä¸æ˜¯å›ºå®šé«˜åº¦ï¼Œå…è®¸å†…å®¹å¢åŠ æ—¶è‡ªåŠ¨æ‰©å±•\r\n    footerElement.style.minHeight = `${footerConfig.height || 100}px`;\r\n\r\n    // å¦‚æœéœ€è¦å›ºå®šåœ¨åº•éƒ¨\r\n    if (footerConfig.fixed) {\r\n      footerElement.classList.add('ddr-footer-fixed');\r\n    }\r\n\r\n    // æ¸²æŸ“æ±‡æ€»è¡Œ\r\n    if (footerConfig.summary && footerConfig.summary.length > 0) {\r\n      const summaryElement = document.createElement('div');\r\n      summaryElement.className = 'ddr-footer-summary';\r\n\r\n      footerConfig.summary.forEach(summaryConfig => {\r\n        const summaryItem = document.createElement('div');\r\n        summaryItem.className = 'ddr-summary-item';\r\n\r\n        const labelElement = document.createElement('span');\r\n        labelElement.className = 'ddr-summary-label';\r\n        labelElement.textContent = `${summaryConfig.column}åˆè®¡:`;\r\n\r\n        const valueElement = document.createElement('span');\r\n        valueElement.className = 'ddr-summary-value';\r\n\r\n        // è·å–æ±‡æ€»å€¼ï¼Œä¼˜å…ˆä½¿ç”¨å…ƒæ•°æ®ä¸­çš„é¢„è®¡ç®—å€¼\r\n        let summaryValue;\r\n        if (summaryConfig.metadataPath) {\r\n          summaryValue = this._getValueByPath(summaryConfig.metadataPath);\r\n        } else {\r\n          // å‰ç«¯è®¡ç®—æ±‡æ€»å€¼\r\n          summaryValue = this._calculateSummary(this.data, summaryConfig);\r\n        }\r\n\r\n        // åº”ç”¨æ ¼å¼åŒ–å‡½æ•°(å¦‚æœæœ‰)\r\n        if (summaryConfig.formatter && this.formatters[summaryConfig.formatter]) {\r\n          summaryValue = this.formatters[summaryConfig.formatter](summaryValue);\r\n        }\r\n\r\n        valueElement.textContent = summaryValue !== undefined ? String(summaryValue) : '';\r\n\r\n        summaryItem.appendChild(labelElement);\r\n        summaryItem.appendChild(valueElement);\r\n        summaryElement.appendChild(summaryItem);\r\n      });\r\n\r\n      footerElement.appendChild(summaryElement);\r\n    }\r\n\r\n    // æ¸²æŸ“å­—æ®µ\r\n    if (footerConfig.fields && footerConfig.fields.length > 0) {\r\n      const fieldsContainer = document.createElement('div');\r\n      fieldsContainer.className = 'ddr-footer-fields';\r\n\r\n      footerConfig.fields.forEach(field => {\r\n        const fieldElement = document.createElement('div');\r\n        fieldElement.className = `ddr-footer-field ddr-align-${field.position || 'left'}`;\r\n\r\n        // åˆ›å»ºæ ‡ç­¾\r\n        const labelElement = document.createElement('span');\r\n        labelElement.className = 'ddr-field-label';\r\n        labelElement.textContent = field.label || '';\r\n        fieldElement.appendChild(labelElement);\r\n\r\n        // åˆ›å»ºå€¼\r\n        const valueElement = document.createElement('span');\r\n        valueElement.className = 'ddr-field-value';\r\n\r\n        // ä¼˜å…ˆä»å…ƒæ•°æ®è·å–å€¼\r\n        let value = field.metadataPath\r\n          ? this._getValueByPath(field.metadataPath)\r\n          : field.value || '';\r\n\r\n        // åº”ç”¨æ ¼å¼åŒ–å‡½æ•°(å¦‚æœæœ‰)\r\n        if (value !== undefined && field.formatter && this.formatters[field.formatter]) {\r\n          value = this.formatters[field.formatter](value);\r\n        }\r\n\r\n        valueElement.textContent = value !== undefined ? String(value) : '';\r\n        fieldElement.appendChild(valueElement);\r\n\r\n        // åº”ç”¨è‡ªå®šä¹‰æ ·å¼\r\n        if (field.style) {\r\n          Object.assign(fieldElement.style, field.style);\r\n        }\r\n\r\n        fieldsContainer.appendChild(fieldElement);\r\n      });\r\n\r\n      footerElement.appendChild(fieldsContainer);\r\n    }\r\n\r\n    // æ¸²æŸ“ç­¾ååŒºåŸŸ\r\n    if (footerConfig.signatures && footerConfig.signatures.length > 0) {\r\n      const signaturesElement = document.createElement('div');\r\n      signaturesElement.className = 'ddr-footer-signatures';\r\n\r\n      footerConfig.signatures.forEach(signature => {\r\n        const signatureItem = document.createElement('div');\r\n        signatureItem.className = 'ddr-signature-item';\r\n\r\n        // ç­¾åæ ‡ç­¾\r\n        const labelElement = document.createElement('div');\r\n        labelElement.className = 'ddr-signature-label';\r\n        labelElement.textContent = signature.label || '';\r\n        signatureItem.appendChild(labelElement);\r\n\r\n        // ç­¾åäºº\r\n        const nameElement = document.createElement('div');\r\n        nameElement.className = 'ddr-signature-name';\r\n\r\n        // ä¼˜å…ˆä»å…ƒæ•°æ®è·å–ç­¾åäºº\r\n        const name = signature.metadataPath\r\n          ? this._getValueByPath(signature.metadataPath)\r\n          : signature.name || '';\r\n\r\n        nameElement.textContent = name || '';\r\n        signatureItem.appendChild(nameElement);\r\n\r\n        // æ—¥æœŸ\r\n        if (signature.showTimestamp) {\r\n          const dateElement = document.createElement('div');\r\n          dateElement.className = 'ddr-signature-date';\r\n\r\n          // è·å–æ—¶é—´æˆ³\r\n          const timestamp = signature.dateMetadataPath\r\n            ? this._getValueByPath(signature.dateMetadataPath)\r\n            : null;\r\n\r\n          if (timestamp) {\r\n            dateElement.textContent = new Date(timestamp).toLocaleDateString();\r\n          }\r\n\r\n          signatureItem.appendChild(dateElement);\r\n        }\r\n\r\n        if (signature.width) {\r\n          signatureItem.style.width = `${signature.width}px`;\r\n        }\r\n\r\n        signaturesElement.appendChild(signatureItem);\r\n      });\r\n\r\n      footerElement.appendChild(signaturesElement);\r\n    }\r\n\r\n    // æ¸²æŸ“æ³¨é‡Š\r\n    if (footerConfig.notes) {\r\n      const notesElement = document.createElement('div');\r\n      notesElement.className = 'ddr-footer-notes';\r\n      notesElement.textContent = footerConfig.notes;\r\n      footerElement.appendChild(notesElement);\r\n    }\r\n\r\n    // æ¸²æŸ“é¡µç ä¿¡æ¯\r\n    if (footerConfig.pageInfo && this.pagination) {\r\n      const pageElement = document.createElement('div');\r\n      pageElement.className = `ddr-footer-page ddr-align-${footerConfig.pageInfo.position || 'right'}`;\r\n\r\n      // æ ¼å¼åŒ–é¡µç \r\n      const pageText = footerConfig.pageInfo.format\r\n        .replace('{current}', String(this.pagination.pageNumber || 1))\r\n        .replace('{total}', String(this.pagination.totalPages || 1));\r\n\r\n      pageElement.textContent = pageText;\r\n      footerElement.appendChild(pageElement);\r\n    }\r\n\r\n    return footerElement;\r\n  }\r\n\r\n  /**\r\n   * è®¡ç®—æ±‡æ€»å€¼\r\n   * @param data æ•°æ®æ•°ç»„\r\n   * @param summary æ±‡æ€»é…ç½®\r\n   * @returns æ±‡æ€»å€¼\r\n   */\r\n  private _calculateSummary(data: any[], summary: { column: string; type: string; }): any {\r\n    if (!data.length) return 0;\r\n\r\n    const values = data.map(item => {\r\n      const value = item[summary.column];\r\n      return typeof value === 'number' ? value : 0;\r\n    });\r\n\r\n    switch (summary.type) {\r\n      case 'sum':\r\n        return values.reduce((sum, val) => sum + val, 0);\r\n      case 'avg':\r\n        return values.reduce((sum, val) => sum + val, 0) / values.length;\r\n      case 'count':\r\n        return values.length;\r\n      default:\r\n        return 0;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * å¤„ç†åˆ†ç»„å°è®¡åŠŸèƒ½\r\n   * @param data åŸå§‹æ•°æ®\r\n   * @returns å¤„ç†åçš„æ•°æ®ï¼ˆåŒ…å«å°è®¡å’Œåˆè®¡è¡Œï¼‰\r\n   */\r\n  private _processGrouping(data: any[]): any[] {\r\n    const groupingConfig = this.config.grouping;\r\n    if (!groupingConfig || !groupingConfig.enabled || !data.length) {\r\n      return data;\r\n    }\r\n\r\n    console.log(`ğŸ“Š å¼€å§‹å¤„ç†åˆ†ç»„å°è®¡ï¼ŒåŸå§‹æ•°æ® ${data.length} è¡Œ`);\r\n\r\n    // ä½¿ç”¨å†…ç½®çš„åˆ†ç»„å¤„ç†é€»è¾‘\r\n    return this._processSingleGroupSubtotals(data, {\r\n      groupBy: Array.isArray(groupingConfig.groupBy) ? groupingConfig.groupBy[0] : groupingConfig.groupBy,\r\n      subtotals: groupingConfig.subtotals,\r\n      subtotalLabel: groupingConfig.subtotalLabel || 'å°è®¡',\r\n      showGrandTotal: groupingConfig.showGrandTotal !== false,\r\n      grandTotalLabel: groupingConfig.grandTotalLabel || 'æ€»è®¡'\r\n    });\r\n  }\r\n\r\n  /**\r\n   * å•çº§åˆ†ç»„å¤„ç†ï¼ˆå†…ç½®ç‰ˆæœ¬ï¼‰\r\n   * @param data åŸå§‹æ•°æ®\r\n   * @param options é…ç½®é€‰é¡¹\r\n   * @returns å¤„ç†åçš„æ•°æ®\r\n   */\r\n  private _processSingleGroupSubtotals(data: any[], options: {\r\n    groupBy: string;\r\n    subtotals: Array<{ field: string; type: string; label?: string; }>;\r\n    subtotalLabel: string;\r\n    showGrandTotal: boolean;\r\n    grandTotalLabel: string;\r\n  }): any[] {\r\n    const { groupBy, subtotals, subtotalLabel, showGrandTotal, grandTotalLabel } = options;\r\n\r\n    if (!data.length || !groupBy) return data;\r\n\r\n    // æŒ‰åˆ†ç»„å­—æ®µåˆ†ç»„\r\n    const grouped: Record<string, any[]> = {};\r\n    data.forEach(item => {\r\n      const groupKey = item[groupBy];\r\n      if (!grouped[groupKey]) {\r\n        grouped[groupKey] = [];\r\n      }\r\n      grouped[groupKey].push({\r\n        ...item,\r\n        _rowType: 'data',\r\n        _level: 0,\r\n        _groupKey: groupKey\r\n      });\r\n    });\r\n\r\n    const result: any[] = [];\r\n    const grandTotals: Record<string, { type: string; values: number[]; }> = {};\r\n\r\n    // å¤„ç†æ¯ä¸ªåˆ†ç»„\r\n    Object.keys(grouped).forEach(groupKey => {\r\n      const groupData = grouped[groupKey];\r\n\r\n      // æ·»åŠ åˆ†ç»„æ•°æ®\r\n      result.push(...groupData);\r\n\r\n      // åˆ›å»ºå°è®¡è¡Œ\r\n      const subtotalRow: any = {\r\n        [groupBy]: `${groupKey} ${subtotalLabel}`,\r\n        _rowType: 'subtotal',\r\n        _level: 1,\r\n        _groupKey: groupKey,\r\n        _isSubtotal: true\r\n      };\r\n\r\n      // è·å–æ‰€æœ‰åˆ—çš„å­—æ®µåï¼Œç”¨äºæ¸…ç©ºéæ±‡æ€»å­—æ®µ\r\n      const allFields = this.config.columns.map(col => col.key);\r\n\r\n      // å…ˆå°†æ‰€æœ‰å­—æ®µè®¾ä¸ºç©ºå€¼ï¼ˆé™¤äº†åˆ†ç»„å­—æ®µï¼‰\r\n      allFields.forEach(field => {\r\n        if (field !== groupBy) {\r\n          subtotalRow[field] = null;\r\n        }\r\n      });\r\n\r\n      // è®¡ç®—å„å­—æ®µçš„å°è®¡ï¼ˆåªè®¡ç®—é…ç½®äº†çš„å­—æ®µï¼‰\r\n      subtotals.forEach(subtotalConfig => {\r\n        const { field, type = 'sum' } = subtotalConfig;\r\n        const subtotalValue = this._calculateGroupSummary(groupData, field, type);\r\n        subtotalRow[field] = subtotalValue;\r\n\r\n        // ç´¯è®¡åˆ°æ€»è®¡\r\n        if (showGrandTotal && subtotalValue !== null) {\r\n          if (!grandTotals[field]) {\r\n            grandTotals[field] = { type, values: [] };\r\n          }\r\n          grandTotals[field].values.push(subtotalValue);\r\n        }\r\n      });\r\n\r\n      result.push(subtotalRow);\r\n    });\r\n\r\n    // æ·»åŠ æ€»è®¡è¡Œ\r\n    if (showGrandTotal && subtotals.length > 0) {\r\n      const grandTotalRow: any = {\r\n        [groupBy]: grandTotalLabel,\r\n        _rowType: 'total',\r\n        _level: 0,\r\n        _isGrandTotal: true\r\n      };\r\n\r\n      // è·å–æ‰€æœ‰åˆ—çš„å­—æ®µåï¼Œç”¨äºæ¸…ç©ºéæ±‡æ€»å­—æ®µ\r\n      const allFields = this.config.columns.map(col => col.key);\r\n\r\n      // å…ˆå°†æ‰€æœ‰å­—æ®µè®¾ä¸ºç©ºå€¼ï¼ˆé™¤äº†åˆ†ç»„å­—æ®µï¼‰\r\n      allFields.forEach(field => {\r\n        if (field !== groupBy) {\r\n          grandTotalRow[field] = null;\r\n        }\r\n      });\r\n\r\n      // åªè®¡ç®—é…ç½®äº†çš„å­—æ®µ\r\n      subtotals.forEach(subtotalConfig => {\r\n        const { field, type = 'sum' } = subtotalConfig;\r\n        if (grandTotals[field]) {\r\n          const { values } = grandTotals[field];\r\n          if (type === 'sum') {\r\n            grandTotalRow[field] = values.reduce((sum, val) => sum + val, 0);\r\n          } else if (type === 'avg') {\r\n            // å¯¹äºå¹³å‡å€¼ï¼Œéœ€è¦é‡æ–°è®¡ç®—æ‰€æœ‰åŸå§‹æ•°æ®çš„å¹³å‡å€¼\r\n            grandTotalRow[field] = this._calculateGroupSummary(data, field, type);\r\n          } else {\r\n            // å…¶ä»–ç±»å‹ä¹Ÿé‡æ–°è®¡ç®—\r\n            grandTotalRow[field] = this._calculateGroupSummary(data, field, type);\r\n          }\r\n        }\r\n      });\r\n\r\n      result.push(grandTotalRow);\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * è®¡ç®—åˆ†ç»„æ±‡æ€»å€¼\r\n   * @param data æ•°æ®æ•°ç»„\r\n   * @param field å­—æ®µå\r\n   * @param type æ±‡æ€»ç±»å‹\r\n   * @returns æ±‡æ€»å€¼\r\n   */\r\n  private _calculateGroupSummary(data: any[], field: string, type: string): number | null {\r\n    if (!data.length) return null;\r\n\r\n    const values = data.map(item => {\r\n      const value = item[field];\r\n      return typeof value === 'number' ? value : parseFloat(value) || 0;\r\n    }).filter(val => !isNaN(val));\r\n\r\n    if (!values.length) return null;\r\n\r\n    let result: number;\r\n    switch (type.toLowerCase()) {\r\n      case 'sum':\r\n        result = values.reduce((sum, val) => sum + val, 0);\r\n        break;\r\n      case 'avg':\r\n        result = values.reduce((sum, val) => sum + val, 0) / values.length;\r\n        break;\r\n      case 'count':\r\n        result = values.length;\r\n        break;\r\n      case 'max':\r\n        result = Math.max(...values);\r\n        break;\r\n      case 'min':\r\n        result = Math.min(...values);\r\n        break;\r\n      default:\r\n        result = 0;\r\n    }\r\n\r\n    // æ£€æŸ¥ç»“æœæ˜¯å¦ä¸ºæœ‰æ•ˆæ•°å€¼\r\n    return isNaN(result) || !isFinite(result) ? null : result;\r\n  }\r\n\r\n  /**\r\n   * åº”ç”¨åˆ†ç»„æ ·å¼\r\n   * @param cell å•å…ƒæ ¼å…ƒç´ \r\n   * @param rowData è¡Œæ•°æ®\r\n   * @param column åˆ—é…ç½®\r\n   */\r\n  private _applyGroupingStyles(cell: HTMLTableCellElement, rowData: any, column: any): void {\r\n    const groupingConfig = this.config.grouping;\r\n    if (!groupingConfig || !rowData._rowType) return;\r\n\r\n    // è·å–é»˜è®¤æ ·å¼\r\n    const defaultStyles = this._getDefaultGroupingStyles();\r\n\r\n    // åº”ç”¨è¡Œç±»å‹æ ·å¼\r\n    if (rowData._rowType === 'subtotal') {\r\n      // åº”ç”¨å°è®¡è¡Œæ ·å¼\r\n      const subtotalStyle = groupingConfig.styles?.subtotalRow || defaultStyles.subtotal;\r\n      Object.assign(cell.style, subtotalStyle);\r\n\r\n      // ä¸ºå°è®¡è¡Œæ·»åŠ CSSç±»\r\n      cell.classList.add('ddr-subtotal-cell');\r\n\r\n    } else if (rowData._rowType === 'total') {\r\n      // åº”ç”¨æ€»è®¡è¡Œæ ·å¼\r\n      const totalStyle = groupingConfig.styles?.totalRow || defaultStyles.total;\r\n      Object.assign(cell.style, totalStyle);\r\n\r\n      // ä¸ºæ€»è®¡è¡Œæ·»åŠ CSSç±»\r\n      cell.classList.add('ddr-total-cell');\r\n\r\n    } else if (rowData._rowType === 'data') {\r\n      // æ™®é€šæ•°æ®è¡Œï¼Œæ£€æŸ¥æ˜¯å¦ä¸ºåˆ†ç»„åˆ—\r\n      const groupByField = Array.isArray(groupingConfig.groupBy)\r\n        ? groupingConfig.groupBy[0]\r\n        : groupingConfig.groupBy;\r\n\r\n      if (column.key === groupByField && groupingConfig.styles?.groupColumn) {\r\n        Object.assign(cell.style, groupingConfig.styles.groupColumn);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * è·å–é»˜è®¤åˆ†ç»„æ ·å¼\r\n   * @returns é»˜è®¤æ ·å¼é…ç½®\r\n   */\r\n  private _getDefaultGroupingStyles(): Record<string, Record<string, any>> {\r\n    return {\r\n      subtotal: {\r\n        fontWeight: 'bold',\r\n        backgroundColor: '#f5f5f5',\r\n        borderTop: '1px solid #d9d9d9'\r\n      },\r\n      total: {\r\n        fontWeight: 'bold',\r\n        backgroundColor: '#e6f7ff',\r\n        color: '#1890ff',\r\n        borderTop: '2px solid #1890ff'\r\n      },\r\n      groupColumn: {\r\n        fontWeight: '500'\r\n      }\r\n    };\r\n  }\r\n\r\n  /**\r\n   * ç¡®å®šæ¸²æŸ“æ¨¡å¼\r\n   * @returns æ¸²æŸ“æ¨¡å¼ 'dom' æˆ– 'canvas'\r\n   */\r\n  private _determineRenderMode(): 'dom' | 'canvas' {\r\n    // å¦‚æœç”¨æˆ·æŒ‡å®šäº†æ¸²æŸ“æ¨¡å¼\r\n    if (this.options.mode === 'dom' || this.options.mode === 'canvas') {\r\n      return this.options.mode;\r\n    }\r\n\r\n    // æ ¹æ®æ•°æ®é‡è‡ªåŠ¨é€‰æ‹©\r\n    if (this.data.length > 5000) {\r\n      return 'canvas';\r\n    }\r\n\r\n    return 'dom';\r\n  }\r\n    /**\r\n   * DOMæ¨¡å¼æ¸²æŸ“\r\n   * @param container å®¹å™¨å…ƒç´ \r\n   */  private _renderDOM(container: HTMLElement): void {\r\n    // åˆ›å»ºè¡¨æ ¼å®¹å™¨\r\n    const tableContainer = document.createElement('div');\r\n    tableContainer.className = 'ddr-table-container';    // æ£€æŸ¥æ˜¯å¦æœ‰æŠ¥è¡¨å¤´éƒ¨ï¼Œå¦‚æœæœ‰ï¼Œç¡®ä¿è¡¨æ ¼å®¹å™¨æœ‰æ­£ç¡®çš„topå€¼\r\n    const headerElement = container.querySelector('.ddr-report-header') as HTMLElement;\r\n    if (headerElement) {\r\n      // ä½¿ç”¨ResizeObserverç›‘å¬è¡¨å¤´å®é™…é«˜åº¦å˜åŒ–\r\n      if (window.ResizeObserver) {\r\n        const resizeObserver = new ResizeObserver(entries => {\r\n          for (const entry of entries) {\r\n            if (entry.target === headerElement) {\r\n              const contentRect = entry.contentRect;\r\n              const headerHeight = contentRect.height;\r\n              // æ›´æ–°CSSå˜é‡\r\n              container.style.setProperty('--header-height', `${headerHeight}px`);\r\n              container.style.setProperty('--table-offset-top', `${headerHeight}px`);\r\n              // ç¡®ä¿è¡¨æ ¼å®¹å™¨æœ‰è¶³å¤Ÿçš„é—´è·\r\n              tableContainer.style.marginTop = '20px';\r\n            }\r\n          }\r\n        });\r\n        resizeObserver.observe(headerElement);\r\n      } else {\r\n        // å…¼å®¹æ€§æ–¹æ¡ˆï¼šä½¿ç”¨getBoundingClientRectå’Œresizeäº‹ä»¶ç›‘å¬\r\n        const updateHeaderSize = () => {\r\n          const headerHeight = headerElement.getBoundingClientRect().height;\r\n          container.style.setProperty('--header-height', `${headerHeight}px`);\r\n          container.style.setProperty('--table-offset-top', `${headerHeight}px`);\r\n          tableContainer.style.marginTop = '20px';\r\n        };\r\n\r\n        updateHeaderSize(); // ç«‹å³æ‰§è¡Œä¸€æ¬¡\r\n        window.addEventListener('resize', updateHeaderSize);\r\n      }\r\n    }\r\n\r\n    const tableWrapper = document.createElement('div');\r\n    tableWrapper.className = 'ddr-table-wrapper';\r\n\r\n    const table = document.createElement('table');\r\n    table.className = 'ddr-table';\r\n\r\n    // åº”ç”¨è¡¨æ ¼æ ·å¼\r\n    if (this.config.layout) {\r\n      if (this.config.layout.stripe) {\r\n        table.classList.add('ddr-table-stripe');\r\n      }\r\n\r\n      if (this.config.layout.hover) {\r\n        table.classList.add('ddr-table-hover');\r\n      }\r\n    }\r\n\r\n    // åˆ›å»ºè¡¨å¤´\r\n    const thead = this._createTableHeader(this.config.columns);\r\n    table.appendChild(thead);\r\n\r\n    // åˆ›å»ºè¡¨ä½“\r\n    const tbody = this._createTableBody(this.config.columns, this.data);\r\n    table.appendChild(tbody);\r\n      tableWrapper.appendChild(table);\r\n    tableContainer.appendChild(tableWrapper);\r\n    container.appendChild(tableContainer);\r\n      // å¦‚æœéœ€è¦åˆ†é¡µ\r\n    if (this.config.features?.pagination && this.pagination) {\r\n      const paginationElement = this._createPagination(this.pagination);\r\n      container.appendChild(paginationElement);\r\n    }\r\n\r\n    // åœ¨æ¸²æŸ“å®Œè¡¨æ ¼åï¼Œå•ç‹¬å¤„ç†é¡µè„šæ·»åŠ \r\n    if (this.config.footer) {\r\n      const footer = this._createFooter(this.config.footer);\r\n      if (footer) {\r\n        // ç¡®ä¿é¡µè„šåœ¨è¡¨æ ¼å®¹å™¨ä¹‹åæ·»åŠ ï¼Œè€Œä¸æ˜¯åŒ…è£…åœ¨ddr-table-containerå†…éƒ¨\r\n        container.appendChild(footer);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Canvasæ¨¡å¼æ¸²æŸ“(å¤§æ•°æ®é‡)\r\n   * @param container å®¹å™¨å…ƒç´ \r\n   */\r\n  private _renderCanvas(container: HTMLElement): void {\r\n    // å¯¹äºå®é™…é¡¹ç›®ï¼Œå¯èƒ½éœ€è¦å¼•å…¥ä¸“é—¨çš„Canvasæ¸²æŸ“åº“\r\n    // è¿™é‡Œç®€åŒ–å¤„ç†ï¼Œä»…æ˜¾ç¤ºä¸€ä¸ªæç¤ºä¿¡æ¯\r\n    const placeholder = document.createElement('div');\r\n    placeholder.className = 'ddr-canvas-placeholder';\r\n    placeholder.textContent = `ä½¿ç”¨Canvasæ¨¡å¼æ¸²æŸ“${this.data.length}è¡Œæ•°æ®`;\r\n    container.appendChild(placeholder);\r\n\r\n    console.log('å®é™…é¡¹ç›®ä¸­éœ€è¦å®ç°Canvasæ¸²æŸ“å¼•æ“');\r\n\r\n    // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œä¼šå¼•å…¥Canvasæ¸²æŸ“å¼•æ“\r\n    // ä¾‹å¦‚: await import('../core/render-engine/canvas-renderer')\r\n  }\r\n\r\n  /**\r\n   * åˆ›å»ºè¡¨å¤´\r\n   * @param columns åˆ—é…ç½®\r\n   * @returns è¡¨å¤´å…ƒç´ \r\n   */\r\n  private _createTableHeader(columns: Array<any>): HTMLElement {\r\n    const thead = document.createElement('thead');\r\n    thead.className = 'ddr-thead';\r\n\r\n    // å¤„ç†åµŒå¥—è¡¨å¤´çš„æƒ…å†µ\r\n    const rowCount = this._calculateHeaderRowCount(columns);\r\n    const rows: HTMLElement[] = Array(rowCount).fill(null).map(() => {\r\n      const tr = document.createElement('tr');\r\n      tr.className = 'ddr-header-row';\r\n      return tr;\r\n    });\r\n\r\n    // å¡«å……è¡¨å¤´å•å…ƒæ ¼\r\n    this._fillHeaderCells(columns, rows, 0, 0);\r\n\r\n    // å°†è¡Œæ·»åŠ åˆ°è¡¨å¤´\r\n    rows.forEach(row => {\r\n      thead.appendChild(row);\r\n    });\r\n\r\n    return thead;\r\n  }\r\n\r\n  /**\r\n   * è®¡ç®—è¡¨å¤´è¡Œæ•°\r\n   * @param columns åˆ—é…ç½®\r\n   * @returns è¡Œæ•°\r\n   */\r\n  private _calculateHeaderRowCount(columns: Array<any>): number {\r\n    let maxDepth = 1;\r\n\r\n    const traverse = (cols: Array<any>, currentDepth: number = 1): void => {\r\n      cols.forEach(col => {\r\n        if (col.children && col.children.length) {\r\n          maxDepth = Math.max(maxDepth, currentDepth + 1);\r\n          traverse(col.children, currentDepth + 1);\r\n        }\r\n      });\r\n    };\r\n\r\n    traverse(columns);\r\n    return maxDepth;\r\n  }\r\n\r\n  /**\r\n   * å¡«å……è¡¨å¤´å•å…ƒæ ¼\r\n   * @param columns åˆ—é…ç½®\r\n   * @param rows è¡Œå…ƒç´ æ•°ç»„\r\n   * @param rowIndex å½“å‰è¡Œç´¢å¼•\r\n   * @param colIndex å½“å‰åˆ—ç´¢å¼•\r\n   * @returns å ç”¨çš„åˆ—æ•°\r\n   */\r\n  private _fillHeaderCells(\r\n    columns: Array<any>,\r\n    rows: HTMLElement[],\r\n    rowIndex: number,\r\n    colIndex: number\r\n  ): number {\r\n    let currentColIndex = colIndex;\r\n\r\n    columns.forEach(column => {\r\n      const cell = document.createElement('th');\r\n      cell.className = 'ddr-header-cell';\r\n      cell.textContent = column.title;\r\n\r\n      // è®¾ç½®å•å…ƒæ ¼æ ·å¼\r\n      if (column.align) {\r\n        cell.style.textAlign = column.align;\r\n      }\r\n\r\n      if (column.width) {\r\n        cell.style.width = typeof column.width === 'number' ? `${column.width}px` : column.width;\r\n      }\r\n\r\n      // å¦‚æœæœ‰å­åˆ—ï¼Œåˆ™è®¾ç½®colspanå’Œrowspan\r\n      if (column.children && column.children.length) {\r\n        const childColSpan = this._fillHeaderCells(column.children, rows, rowIndex + 1, currentColIndex);\r\n        cell.colSpan = childColSpan;\r\n        cell.rowSpan = 1;\r\n        currentColIndex += childColSpan;\r\n      } else {\r\n        cell.colSpan = 1;\r\n        cell.rowSpan = rows.length - rowIndex;\r\n        currentColIndex += 1;\r\n      }\r\n\r\n      rows[rowIndex].appendChild(cell);\r\n    });\r\n\r\n    return currentColIndex - colIndex;\r\n  }\r\n\r\n  /**\r\n   * åˆ›å»ºè¡¨ä½“\r\n   * @param columns åˆ—é…ç½®\r\n   * @param data æ•°æ®æ•°ç»„\r\n   * @returns è¡¨ä½“å…ƒç´ \r\n   */\r\n  private _createTableBody(columns: Array<any>, data: Array<any>): HTMLElement {\r\n    const tbody = document.createElement('tbody');\r\n    tbody.className = 'ddr-tbody';\r\n\r\n    // è·å–æ‰å¹³åŒ–çš„åˆ—\r\n    const flatColumns = this._getFlatColumns(columns);\r\n\r\n    // è®°å½•éœ€è¦åˆå¹¶çš„å•å…ƒæ ¼\r\n    const merges: Map<string, { rowSpan: number, colSpan: number }> = new Map();\r\n\r\n    // å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œæ˜¾ç¤ºç©ºè¡¨æ ¼æç¤º\r\n    if (!data.length) {\r\n      const emptyRow = document.createElement('tr');\r\n      emptyRow.className = 'ddr-empty-row';\r\n\r\n      const emptyCell = document.createElement('td');\r\n      emptyCell.className = 'ddr-empty-cell';\r\n      emptyCell.colSpan = flatColumns.length;\r\n      emptyCell.textContent = this.config.features?.emptyText || 'æš‚æ— æ•°æ®';\r\n\r\n      emptyRow.appendChild(emptyCell);\r\n      tbody.appendChild(emptyRow);\r\n      return tbody;\r\n    }\r\n\r\n    // åˆ›å»ºè¡Œ\r\n    data.forEach((rowData, rowIndex) => {\r\n      const row = document.createElement('tr');\r\n      row.className = 'ddr-body-row';\r\n      row.setAttribute('data-index', String(rowIndex));\r\n\r\n      // æ·»åŠ è¡Œç±»å‹å±æ€§ï¼ˆç”¨äºåˆ†ç»„æ ·å¼ï¼‰\r\n      if (rowData._rowType) {\r\n        row.setAttribute('data-row-type', rowData._rowType);\r\n      }\r\n\r\n      // åº”ç”¨é…ç½®çš„è¡Œé«˜\r\n      if (this.config.layout?.rowHeight) {\r\n        row.style.height = typeof this.config.layout.rowHeight === 'number'\r\n          ? `${this.config.layout.rowHeight}px`\r\n          : this.config.layout.rowHeight;\r\n      }\r\n\r\n      // åˆ›å»ºå•å…ƒæ ¼\r\n      let colIndex = 0;\r\n      flatColumns.forEach(column => {\r\n        // è·³è¿‡éšè—åˆ—\r\n        if (column.visible === false) {\r\n          return;\r\n        }\r\n\r\n        // æ£€æŸ¥æ˜¯å¦å·²ç»è¢«åˆå¹¶è·³è¿‡\r\n        const cellKey = `${rowIndex}-${colIndex}`;\r\n        if (merges.has(cellKey) && merges.get(cellKey)?.rowSpan === 0) {\r\n          colIndex++;\r\n          return;\r\n        }\r\n\r\n        const cell = document.createElement('td');\r\n        cell.className = 'ddr-body-cell';\r\n\r\n        // è·å–å•å…ƒæ ¼å€¼\r\n        let value = rowData[column.key];\r\n\r\n        // åº”ç”¨æ ¼å¼åŒ–å‡½æ•°\r\n        if (column.formatter) {\r\n          if (typeof column.formatter === 'string' && this.formatters[column.formatter]) {\r\n            value = this.formatters[column.formatter](value);\r\n          } else if (typeof column.formatter === 'object') {\r\n            const formatterFunc = this.formatters[column.formatter.type];\r\n            if (formatterFunc) {\r\n              value = formatterFunc(value, column.formatter.params);\r\n            }\r\n          }\r\n        }\r\n\r\n        // è®¾ç½®å•å…ƒæ ¼å†…å®¹ï¼Œå¤„ç†NaNå€¼\r\n        if (value === undefined || value === null || (typeof value === 'number' && isNaN(value))) {\r\n          cell.textContent = '';\r\n        } else {\r\n          cell.textContent = String(value);\r\n        }\r\n\r\n        // è®¾ç½®å•å…ƒæ ¼æ ·å¼\r\n        if (column.align) {\r\n          cell.style.textAlign = column.align;\r\n        }\r\n\r\n        // å¤„ç†å•å…ƒæ ¼åˆå¹¶\r\n        if (column.merge === 'vertical' || column.merge === true) {\r\n          this._handleCellMerge(cell, rowData, column, rowIndex, colIndex, data, merges);\r\n        }\r\n\r\n        // åº”ç”¨åˆ†ç»„æ ·å¼ï¼ˆå¦‚æœå¯ç”¨åˆ†ç»„åŠŸèƒ½ï¼‰\r\n        if (this.config.grouping?.enabled) {\r\n          this._applyGroupingStyles(cell, rowData, column);\r\n        }\r\n\r\n        // åº”ç”¨æ¡ä»¶æ ·å¼\r\n        if (column.style?.conditional) {\r\n          column.style.conditional.forEach((condition: { when: string; style: Record<string, any> }) => {\r\n            // ç®€å•æ¡ä»¶è¡¨è¾¾å¼è§£æ\r\n            // å®é™…é¡¹ç›®ä¸­å¯èƒ½éœ€è¦æ›´å¤æ‚çš„è¡¨è¾¾å¼è§£æ\r\n            const valueToCheck = rowData[column.key];\r\n            try {\r\n              const result = this._evaluateCondition(condition.when, { value: valueToCheck, row: rowData });\r\n              if (result) {\r\n                Object.assign(cell.style, condition.style);\r\n              }\r\n            } catch (e) {\r\n              console.error('æ¡ä»¶è§£æé”™è¯¯:', e);\r\n            }\r\n          });\r\n        }\r\n\r\n        row.appendChild(cell);\r\n        colIndex++;\r\n      });\r\n\r\n      tbody.appendChild(row);\r\n    });\r\n\r\n    return tbody;\r\n  }\r\n\r\n  /**\r\n   * å¤„ç†å•å…ƒæ ¼åˆå¹¶\r\n   */\r\n  private _handleCellMerge(\r\n    td: HTMLTableCellElement,\r\n    rowData: any,\r\n    column: any,\r\n    rowIndex: number,\r\n    colIndex: number,\r\n    data: any[],\r\n    merges: Map<string, { rowSpan: number, colSpan: number }>\r\n  ): void {\r\n    console.log(`ğŸ”„ å¤„ç†åˆ— \"${column.key}\" çš„åˆå¹¶ï¼Œå½“å‰è¡Œ ${rowIndex}ï¼Œå€¼: \"${rowData[column.key]}\"`);\r\n\r\n    const currentValue = rowData[column.key];\r\n    let rowSpan = 1;\r\n\r\n    // å‘ä¸‹æŸ¥æ‰¾ç›¸åŒå€¼çš„è¿ç»­å•å…ƒæ ¼\r\n    for (let i = rowIndex + 1; i < data.length; i++) {\r\n      const nextValue = data[i][column.key];\r\n\r\n      if (nextValue === currentValue) {\r\n        rowSpan++;\r\n\r\n        // æ ‡è®°è¢«åˆå¹¶çš„å•å…ƒæ ¼ï¼Œåé¢é‡åˆ°æ—¶è·³è¿‡\r\n        const skipKey = `${i}-${colIndex}`;\r\n        merges.set(skipKey, { rowSpan: 0, colSpan: 0 });\r\n        console.log(`  âœ… æ‰¾åˆ°ç›¸åŒå€¼ï¼Œè¡Œ ${i}ï¼Œå€¼: \"${nextValue}\"ï¼ŒrowSpan: ${rowSpan}`);\r\n      } else {\r\n        console.log(`  âŒ å€¼ä¸åŒï¼Œè¡Œ ${i}ï¼Œå€¼: \"${nextValue}\" !== \"${currentValue}\"ï¼Œåœæ­¢åˆå¹¶`);\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (rowSpan > 1) {\r\n      td.rowSpan = rowSpan;\r\n      console.log(`ğŸ¯ åˆ— \"${column.key}\" ç¬¬ ${rowIndex} è¡Œè®¾ç½® rowSpan = ${rowSpan}`);\r\n    } else {\r\n      console.log(`ğŸ“ åˆ— \"${column.key}\" ç¬¬ ${rowIndex} è¡Œæ— éœ€åˆå¹¶`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * è¯„ä¼°æ¡ä»¶è¡¨è¾¾å¼\r\n   * @param condition æ¡ä»¶è¡¨è¾¾å¼\r\n   * @param context ä¸Šä¸‹æ–‡å¯¹è±¡\r\n   * @returns æ¡ä»¶ç»“æœ\r\n   */\r\n  private _evaluateCondition(condition: string, context: Record<string, any>): boolean {\r\n    // ç®€åŒ–ç‰ˆæ¡ä»¶è¡¨è¾¾å¼è§£æ\r\n    // å®é™…é¡¹ç›®ä¸­å¯èƒ½éœ€è¦æ›´å¤æ‚çš„è¡¨è¾¾å¼è§£æ\r\n    try {\r\n      // ç®€å•æ›¿æ¢ï¼Œæ”¯æŒvalueå’Œrowå˜é‡\r\n      let expression = condition;\r\n\r\n      // æ›¿æ¢ value å˜é‡\r\n      expression = expression.replace(/value/g, JSON.stringify(context.value));\r\n\r\n      // æ›¿æ¢ row.xxx å˜é‡\r\n      const rowVarMatches = expression.match(/row\\.\\w+/g);\r\n      if (rowVarMatches) {\r\n        rowVarMatches.forEach(match => {\r\n          const prop = match.split('.')[1];\r\n          expression = expression.replace(match, JSON.stringify(context.row[prop]));\r\n        });\r\n      }\r\n\r\n      // ä½¿ç”¨Functionæ„é€ å‡½æ•°æ‰§è¡Œè¡¨è¾¾å¼\r\n      // æ³¨æ„ï¼šè¿™ç§æ–¹å¼åœ¨å®é™…é¡¹ç›®ä¸­å¯èƒ½å­˜åœ¨å®‰å…¨é£é™©\r\n      return new Function(`return ${expression}`)();\r\n    } catch (e) {\r\n      console.error('æ¡ä»¶è§£æé”™è¯¯:', e, condition);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * è·å–æ‰å¹³åŒ–çš„åˆ—é…ç½®\r\n   * @param columns åˆ—é…ç½®\r\n   * @returns æ‰å¹³åŒ–åçš„åˆ—é…ç½®\r\n   */\r\n  private _getFlatColumns(columns: Array<any>): Array<any> {\r\n    const result: Array<any> = [];\r\n\r\n    const flatten = (cols: Array<any>) => {\r\n      cols.forEach(col => {\r\n        if (col.children && col.children.length) {\r\n          flatten(col.children);\r\n        } else {\r\n          result.push(col);\r\n        }\r\n      });\r\n    };\r\n\r\n    flatten(columns);\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * åˆ›å»ºåˆ†é¡µç»„ä»¶\r\n   * @param pagination åˆ†é¡µä¿¡æ¯\r\n   * @returns åˆ†é¡µå…ƒç´ \r\n   */\r\n  private _createPagination(pagination: Record<string, any>): HTMLElement {\r\n    const paginationElement = document.createElement('div');\r\n    paginationElement.className = 'ddr-pagination';\r\n\r\n    const pageInfo = document.createElement('span');\r\n    pageInfo.className = 'ddr-pagination-info';\r\n    pageInfo.textContent = `ç¬¬${pagination.pageNumber || 1}é¡µ/å…±${pagination.totalPages || 1}é¡µ`;\r\n    paginationElement.appendChild(pageInfo);\r\n\r\n    // ä¸Šä¸€é¡µæŒ‰é’®\r\n    const prevBtn = document.createElement('button');\r\n    prevBtn.className = 'ddr-pagination-prev';\r\n    prevBtn.textContent = 'ä¸Šä¸€é¡µ';\r\n    prevBtn.disabled = (pagination.pageNumber || 1) <= 1;\r\n    prevBtn.onclick = () => {\r\n      this.reload({ ...this.filters, pageNumber: (pagination.pageNumber || 1) - 1 });\r\n    };\r\n    paginationElement.appendChild(prevBtn);\r\n\r\n    // é¡µç æŒ‰é’®\r\n    const totalPages = pagination.totalPages || 1;\r\n    const currentPage = pagination.pageNumber || 1;\r\n\r\n    // ç®€å•åˆ†é¡µé€»è¾‘\r\n    let startPage = Math.max(1, currentPage - 2);\r\n    let endPage = Math.min(totalPages, startPage + 4);\r\n\r\n    // è°ƒæ•´startPage\r\n    startPage = Math.max(1, endPage - 4);\r\n\r\n    for (let i = startPage; i <= endPage; i++) {\r\n      const pageBtn = document.createElement('button');\r\n      pageBtn.className = `ddr-pagination-page${i === currentPage ? ' active' : ''}`;\r\n      pageBtn.textContent = String(i);\r\n      pageBtn.onclick = () => {\r\n        if (i !== currentPage) {\r\n          this.reload({ ...this.filters, pageNumber: i });\r\n        }\r\n      };\r\n      paginationElement.appendChild(pageBtn);\r\n    }\r\n\r\n    // ä¸‹ä¸€é¡µæŒ‰é’®\r\n    const nextBtn = document.createElement('button');\r\n    nextBtn.className = 'ddr-pagination-next';\r\n    nextBtn.textContent = 'ä¸‹ä¸€é¡µ';\r\n    nextBtn.disabled = (pagination.pageNumber || 1) >= (pagination.totalPages || 1);\r\n    nextBtn.onclick = () => {\r\n      this.reload({ ...this.filters, pageNumber: (pagination.pageNumber || 1) + 1 });\r\n    };\r\n    paginationElement.appendChild(nextBtn);\r\n\r\n    // æ¯é¡µæ¡æ•°é€‰æ‹©\r\n    const sizeSelect = document.createElement('select');\r\n    sizeSelect.className = 'ddr-pagination-size';\r\n    [10, 20, 50, 100].forEach(size => {\r\n      const option = document.createElement('option');\r\n      option.value = String(size);\r\n      option.textContent = `${size}æ¡/é¡µ`;\r\n      option.selected = size === (pagination.pageSize || 20);\r\n      sizeSelect.appendChild(option);\r\n    });\r\n    sizeSelect.onchange = (e) => {\r\n      const pageSize = Number((e.target as HTMLSelectElement).value);\r\n      this.reload({ ...this.filters, pageSize, pageNumber: 1 });\r\n    };\r\n    paginationElement.appendChild(sizeSelect);\r\n\r\n    return paginationElement;\r\n  }\r\n    /**\r\n   * æ·»åŠ æ°´å°\r\n   * @param container å®¹å™¨å…ƒç´ \r\n   * @param text æ°´å°æ–‡æœ¬\r\n   */\r\n  private _addWatermark(container: HTMLElement, text: string): void {\r\n    // ç§»é™¤ç°æœ‰æ°´å°\r\n    const existingWatermark = container.querySelector('.ddr-watermark');\r\n    if (existingWatermark) {\r\n      container.removeChild(existingWatermark);\r\n    }\r\n\r\n    const watermark = document.createElement('div');\r\n    watermark.className = 'ddr-watermark';\r\n\r\n    // ç¡®ä¿æ°´å°å§‹ç»ˆå¯è§\r\n    watermark.style.zIndex = '10';\r\n\r\n    // å¤„ç†åŠ¨æ€æ›¿æ¢\r\n    if (text.includes('${')) {\r\n      text = text.replace(/\\${([^}]+)}/g, (match, key) => {\r\n        return String(this._getValueByPath(key) || match);\r\n      });\r\n    }\r\n\r\n    // è®¡ç®—éœ€è¦åˆ›å»ºå¤šå°‘è¡Œå’Œåˆ—çš„æ°´å°\r\n    const rows = 5;\r\n    const cols = 4;\r\n\r\n    // åˆ›å»ºæ°´å°ç½‘æ ¼\r\n    for (let i = 0; i < rows * cols; i++) {\r\n      const content = document.createElement('div');\r\n      content.className = 'ddr-watermark-content';\r\n      content.textContent = text;\r\n      // å¢åŠ ä¸é€æ˜åº¦ï¼Œæé«˜å¯è§æ€§\r\n      content.style.opacity = '0.2';\r\n      content.style.color = 'rgba(0, 0, 0, 0.25)';\r\n      content.style.fontSize = '18px';\r\n      watermark.appendChild(content);\r\n    }\r\n\r\n    // è®¾ç½®æ°´å°å±‚çš„ä½ç½®å¹¶é˜²æ­¢æ°´å°è¢«ç¯¡æ”¹\r\n    Object.defineProperty(watermark.style, 'pointerEvents', {\r\n      value: 'none',\r\n      writable: false\r\n    });\r\n\r\n    container.appendChild(watermark);\r\n      // å¢å¼ºç‰ˆï¼šé˜²æ­¢æ°´å°è¢«åˆ é™¤æˆ–ä¿®æ”¹çš„ç›‘è§†å™¨\r\n    const observer = new MutationObserver((mutations) => {\r\n      mutations.forEach((mutation) => {\r\n        // æ£€æŸ¥æ°´å°æ˜¯å¦è¢«ç§»é™¤\r\n        if (mutation.type === 'childList' &&\r\n            Array.from(mutation.removedNodes).some(node =>\r\n              node === watermark ||\r\n              (node instanceof Element && node.querySelector('.ddr-watermark')))\r\n           ) {\r\n          if (!container.contains(watermark)) {\r\n            // å¦‚æœæ°´å°è¢«ç§»é™¤ï¼Œé‡æ–°æ·»åŠ å®ƒ\r\n            const newWatermark = watermark.cloneNode(true) as HTMLElement;\r\n            setTimeout(() => container.appendChild(newWatermark), 100);\r\n          }\r\n        }\r\n\r\n        // æ£€æŸ¥æ°´å°æ ·å¼æ˜¯å¦è¢«ä¿®æ”¹\r\n        if (mutation.type === 'attributes' &&\r\n            mutation.target === watermark &&\r\n            (mutation.attributeName === 'style' || mutation.attributeName === 'class')) {\r\n          // æ¢å¤æ°´å°æ ·å¼\r\n          watermark.className = 'ddr-watermark';\r\n          watermark.style.zIndex = '10';\r\n          watermark.style.opacity = '0.8';\r\n        }\r\n      });\r\n    });\r\n\r\n    // ç›‘è§†å­å…ƒç´ å˜åŒ–å’Œå±æ€§å˜åŒ–\r\n    observer.observe(container, {\r\n      childList: true,\r\n      subtree: true,\r\n      attributes: true,\r\n      attributeFilter: ['style', 'class']\r\n    });\r\n  }\r\n\r\n  /**\r\n   * å‡†å¤‡å¯¼å‡ºæ•°æ®\r\n   * @param options å¯¼å‡ºé€‰é¡¹\r\n   * @returns å¯¼å‡ºæ•°æ®\r\n   */\r\n  private _prepareExportData(options?: ExportOptions): any[] {\r\n    // è·å–æ‰å¹³åŒ–çš„åˆ—\r\n    const flatColumns = this._getFlatColumns(this.config.columns);\r\n\r\n    // è¿‡æ»¤éšè—åˆ—\r\n    const visibleColumns = flatColumns.filter(col =>\r\n      col.visible !== false && (options?.includeHidden || col.visible !== false)\r\n    );\r\n\r\n    // å‡†å¤‡è¡¨å¤´\r\n    const result = [];\r\n\r\n    // æ·»åŠ è¡¨å¤´ä¿¡æ¯(å¦‚æœéœ€è¦)\r\n    if (options?.includeHeader !== false && this.config.header?.showOnExport !== false) {\r\n      if (this.config.header?.title) {\r\n        const titleText = typeof this.config.header.title === 'string'\r\n          ? this.config.header.title\r\n          : this.config.header.title.text;\r\n\r\n        result.push([titleText]);\r\n        result.push([]); // ç©ºè¡Œ\r\n      }\r\n\r\n      if (this.config.header?.fields?.length) {\r\n        this.config.header.fields.forEach(field => {\r\n          const value = field.metadataPath\r\n            ? this._getValueByPath(field.metadataPath)\r\n            : field.value || '';\r\n\r\n          result.push([`${field.label || ''}`, value]);\r\n        });\r\n\r\n        result.push([]); // ç©ºè¡Œ\r\n      }\r\n    }\r\n\r\n    // æ·»åŠ è¡¨æ ¼æ ‡é¢˜è¡Œ\r\n    const headers = visibleColumns.map(col => col.title);\r\n    result.push(headers);\r\n\r\n    // æ·»åŠ æ•°æ®è¡Œ\r\n    this.data.forEach(rowData => {\r\n      const row = visibleColumns.map(column => {\r\n        let value = rowData[column.key];\r\n\r\n        // åº”ç”¨æ ¼å¼åŒ–å‡½æ•°\r\n        if (column.formatter) {\r\n          if (typeof column.formatter === 'string' && this.formatters[column.formatter]) {\r\n            value = this.formatters[column.formatter](value);\r\n          } else if (typeof column.formatter === 'object') {\r\n            const formatterFunc = this.formatters[column.formatter.type];\r\n            if (formatterFunc) {\r\n              value = formatterFunc(value, column.formatter.params);\r\n            }\r\n          }\r\n        }\r\n\r\n        return value;\r\n      });\r\n\r\n      result.push(row);\r\n    });\r\n\r\n    // æ·»åŠ è¡¨å°¾ä¿¡æ¯(å¦‚æœéœ€è¦)\r\n    if (options?.includeFooter !== false && this.config.footer?.showOnExport !== false) {\r\n      result.push([]); // ç©ºè¡Œ\r\n\r\n      // æ·»åŠ æ±‡æ€»ä¿¡æ¯\r\n      if (this.config.footer?.summary?.length) {\r\n        this.config.footer.summary.forEach(sum => {\r\n          let summaryValue;\r\n          if (sum.metadataPath) {\r\n            summaryValue = this._getValueByPath(sum.metadataPath);\r\n          } else {\r\n            summaryValue = this._calculateSummary(this.data, sum);\r\n          }\r\n\r\n          if (sum.formatter && this.formatters[sum.formatter]) {\r\n            summaryValue = this.formatters[sum.formatter](summaryValue);\r\n          }\r\n\r\n          result.push([`${sum.column}åˆè®¡:`, summaryValue]);\r\n        });\r\n\r\n        result.push([]); // ç©ºè¡Œ\r\n      }\r\n\r\n      // æ·»åŠ è¡¨å°¾å­—æ®µ\r\n      if (this.config.footer?.fields?.length) {\r\n        this.config.footer.fields.forEach(field => {\r\n          const value = field.metadataPath\r\n            ? this._getValueByPath(field.metadataPath)\r\n            : field.value || '';\r\n\r\n          result.push([field.label || '', value]);\r\n        });\r\n      }\r\n        // æ·»åŠ ç­¾åä¿¡æ¯\r\n      if (this.config.footer?.signatures?.length) {\r\n        const signatureRow: string[] = [];\r\n\r\n        this.config.footer.signatures.forEach(signature => {\r\n          signatureRow.push(signature.label || '');\r\n\r\n          const name = signature.metadataPath\r\n            ? this._getValueByPath(signature.metadataPath)\r\n            : signature.name || '';\r\n\r\n          signatureRow.push(name);\r\n        });\r\n\r\n        result.push(signatureRow);\r\n      }\r\n\r\n      // æ·»åŠ æ³¨é‡Š\r\n      if (this.config.footer?.notes) {\r\n        result.push([this.config.footer.notes]);\r\n      }\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * è§¦å‘äº‹ä»¶\r\n   * @param event äº‹ä»¶åç§°\r\n   * @param data äº‹ä»¶æ•°æ®\r\n   */\r\n  private _emitEvent(event: DDREvent, data?: any): void {\r\n    if (this.eventListeners.has(event)) {\r\n      const callbacks = this.eventListeners.get(event)!;\r\n      callbacks.forEach(callback => {\r\n        try {\r\n          callback(data);\r\n        } catch (error) {\r\n          console.error(`äº‹ä»¶${event}å¤„ç†é”™è¯¯:`, error);\r\n        }\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\nexport default DDR;\r\n","import * as XLSX from 'xlsx';\n// å°è¯•å¯¼å…¥æ”¯æŒæ ·å¼çš„XLSXåº“\nlet XLSXStyle: any;\ntry {\n  XLSXStyle = require('xlsx-js-style');\n  console.log('ä½¿ç”¨æ”¯æŒæ ·å¼çš„XLSXåº“');\n} catch (e) {\n  XLSXStyle = XLSX;\n  console.log('ä½¿ç”¨æ ‡å‡†XLSXåº“ï¼ˆæ ·å¼æ”¯æŒæœ‰é™ï¼‰');\n}\nimport html2canvas from 'html2canvas';\nimport { jsPDF } from 'jspdf';\nimport { ExportOptions } from '../../types';\nimport { fixPDFExport, setupChineseSupport } from './pdf-fixes';\nimport { applyExcelStyles } from './excel-fixes';\n\n// åº”ç”¨PDFå¯¼å‡ºä¿®å¤\nif (typeof window !== 'undefined') {\n  setTimeout(() => {\n    try {\n      console.log('jsPDFåº“å·²å†…ç½®åˆ°ç»„ä»¶ä¸­');\n      fixPDFExport();\n    } catch (e) {\n      console.warn('åº”ç”¨PDFå¯¼å‡ºä¿®å¤å¤±è´¥:', e);\n    }\n  }, 0);\n}\n\n// å®šä¹‰è¡Œä¿¡æ¯æ¥å£\ninterface RowInfo {\n  index: number;\n  height: number;\n  top: number;\n  isHeader: boolean;\n  content: string;\n}\n\n// å®šä¹‰åˆ†é¡µç‚¹æ¥å£\ninterface PageBreakPoint {\n  rowIndex: number;\n  yPercent: number;\n}\n\n/**\n * æŠ¥è¡¨å¯¼å‡ºæ¨¡å—\n * æ”¯æŒExcelå’ŒPDFæ ¼å¼å¯¼å‡º\n */\nexport class Exporter {\n  /**\n   * å¯¼å‡ºä¸ºExcel\n   * @param data æŠ¥è¡¨æ•°æ®æˆ–DOMå…ƒç´ \n   * @param options å¯¼å‡ºé€‰é¡¹\n   */\n  static async toExcel(data: any[] | HTMLElement, options: ExportOptions = {}): Promise<void> {\n    try {\n      // é»˜è®¤é€‰é¡¹\n      const {\n        fileName = 'æŠ¥è¡¨',\n        sheetName = 'Sheet1',\n        includeHidden = false,\n        styles = {} // è‡ªå®šä¹‰æ ·å¼é€‰é¡¹\n      } = options;\n\n      let excelData: any[][];\n      let domElement: HTMLElement | null = null;\n\n      // åˆ¤æ–­è¾“å…¥ç±»å‹\n      if (data instanceof HTMLElement) {\n        domElement = data;\n        excelData = this.extractDataFromDOM(data);\n      } else {\n        excelData = data;\n      }\n\n      // åˆ›å»ºå·¥ä½œè¡¨ - ä½¿ç”¨æ”¯æŒæ ·å¼çš„åº“\n      const ws = XLSXStyle.utils.aoa_to_sheet(excelData);\n\n      // è®¾ç½®åˆ—å®½\n      const wscols = [];\n      if (excelData.length > 0) {\n        for (let i = 0; i < excelData[0].length; i++) {\n          // è®¡ç®—æœ€å¤§å®½åº¦\n          let maxWidth = 10; // é»˜è®¤å®½åº¦\n          excelData.forEach(row => {\n            if (row[i] && String(row[i]).length > maxWidth) {\n              maxWidth = Math.min(50, String(row[i]).length); // é™åˆ¶æœ€å¤§å®½åº¦\n            }\n          });\n          wscols.push({ wch: maxWidth });\n        }\n        ws['!cols'] = wscols;\n      }\n\n      // ä½¿ç”¨å¢å¼ºçš„æ ·å¼åŠŸèƒ½\n      console.log('Excelå¯¼å‡ºæ•°æ®ç»“æ„:', {\n        dataRows: excelData.length,\n        hasDOMElement: !!domElement,\n        firstRow: excelData[0],\n        lastRow: excelData[excelData.length - 1]\n      });\n\n      // å°è¯•ä½¿ç”¨å¢å¼ºæ ·å¼æ–¹æ³•\n      console.log('ä½¿ç”¨å¢å¼ºæ ·å¼åº”ç”¨åˆ°Excel');\n      try {\n        // ç›´æ¥è°ƒç”¨å¢å¼ºæ ·å¼æ–¹æ³•\n        this.applyEnhancedStylesToExcel(ws, excelData);\n        console.log('å¢å¼ºæ ·å¼åº”ç”¨æˆåŠŸ');\n      } catch (enhancedError) {\n        console.warn('å¢å¼ºæ ·å¼åº”ç”¨å¤±è´¥ï¼Œå›é€€åˆ°åŸºç¡€æ ·å¼:', enhancedError);\n        this.applyBasicStylesToExcel(ws, excelData);\n      }\n\n      // æ£€æŸ¥æ ·å¼æ˜¯å¦è¢«åº”ç”¨\n      const sampleCells = ['A1', 'A2', 'B1', 'B2'];\n      sampleCells.forEach(cellRef => {\n        if (ws[cellRef]) {\n          console.log(`å•å…ƒæ ¼ ${cellRef} æ ·å¼:`, ws[cellRef].s);\n        }\n      });\n\n      // åˆ›å»ºå·¥ä½œç°¿ - ä½¿ç”¨æ”¯æŒæ ·å¼çš„åº“\n      const wb = XLSXStyle.utils.book_new();\n      XLSXStyle.utils.book_append_sheet(wb, ws, sheetName);\n\n      // è®¾ç½®å·¥ä½œç°¿å±æ€§ä»¥æ”¯æŒæ ·å¼\n      if (!wb.Workbook) wb.Workbook = {};\n      if (!wb.Workbook.Views) wb.Workbook.Views = [];\n      wb.Workbook.Views[0] = { RTL: false };\n\n      // å¯¼å‡ºæ–‡ä»¶ - ä½¿ç”¨æ”¯æŒæ ·å¼çš„æ ¼å¼\n      try {\n        // æ£€æŸ¥æ˜¯å¦æœ‰æ ·å¼ä¿¡æ¯\n        let hasStyles = false;\n        const sampleCells = ['A1', 'A2', 'B1'];\n        for (const cellRef of sampleCells) {\n          if (ws[cellRef] && ws[cellRef].s) {\n            hasStyles = true;\n            break;\n          }\n        }\n\n        console.log(`Excelå¯¼å‡ºä¿¡æ¯: å·¥ä½œè¡¨åŒ…å«${Object.keys(ws).length}ä¸ªå•å…ƒæ ¼, æ ·å¼ä¿¡æ¯: ${hasStyles ? 'æœ‰' : 'æ— '}`);\n\n        // è®¾ç½®å·¥ä½œç°¿å±æ€§ä»¥æ”¯æŒæ ·å¼\n        wb.Props = {\n          Title: fileName,\n          Subject: \"æŠ¥è¡¨æ•°æ®\",\n          Author: \"DDRæŠ¥è¡¨ç»„ä»¶\",\n          CreatedDate: new Date()\n        };\n\n        // å°è¯•å¤šç§å¯¼å‡ºæ–¹å¼ä»¥ç¡®ä¿æ ·å¼ç”Ÿæ•ˆ\n        try {\n          // æ–¹å¼1ï¼šä½¿ç”¨æ”¯æŒæ ·å¼çš„å¯¼å‡ºé€‰é¡¹\n          const writeOptions = {\n            bookType: 'xlsx' as const,\n            type: 'buffer' as const,\n            cellStyles: true, // å¯ç”¨æ ·å¼æ”¯æŒ\n            sheetStubs: false,\n            compression: true\n          };\n\n          // ç”Ÿæˆæ–‡ä»¶æ•°æ® - ä½¿ç”¨æ”¯æŒæ ·å¼çš„åº“\n          const excelBuffer = XLSXStyle.write(wb, writeOptions);\n\n          // åˆ›å»ºBlobå¹¶ä¸‹è½½\n          const blob = new Blob([excelBuffer], {\n            type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'\n          });\n\n          const url = window.URL.createObjectURL(blob);\n          const link = document.createElement('a');\n          link.href = url;\n          link.download = `${fileName}.xlsx`;\n          document.body.appendChild(link);\n          link.click();\n          document.body.removeChild(link);\n          window.URL.revokeObjectURL(url);\n\n          console.log('Excelå¯¼å‡ºå®Œæˆï¼ˆBlobæ–¹å¼ï¼Œæ”¯æŒæ ·å¼ï¼‰');\n        } catch (blobError) {\n          console.warn('Blobå¯¼å‡ºå¤±è´¥ï¼Œå°è¯•ç›´æ¥å¯¼å‡º:', blobError);\n\n          // æ–¹å¼2ï¼šç›´æ¥ä½¿ç”¨writeFileï¼ˆå¯èƒ½æ ·å¼æ”¯æŒæ›´å¥½ï¼‰\n          XLSXStyle.writeFile(wb, `${fileName}.xlsx`, {\n            cellStyles: true,\n            compression: true\n          });\n          console.log('Excelå¯¼å‡ºå®Œæˆï¼ˆç›´æ¥å¯¼å‡ºæ–¹å¼ï¼‰');\n        }\n      } catch (error) {\n        console.error('Excelå¯¼å‡ºå¤±è´¥:', error);\n        // é™çº§åˆ°åŸºç¡€å¯¼å‡º\n        try {\n          XLSXStyle.writeFile(wb, `${fileName}.xlsx`);\n          console.log('Excelå¯¼å‡ºå®Œæˆï¼ˆåŸºç¡€æ¨¡å¼ï¼‰');\n        } catch (fallbackError) {\n          console.error('ExcelåŸºç¡€å¯¼å‡ºä¹Ÿå¤±è´¥:', fallbackError);\n          throw fallbackError;\n        }\n      }\n\n      return Promise.resolve();\n    } catch (error) {\n      return Promise.reject(error);\n    }\n  }\n\n  /**\n   * ä»DOMå…ƒç´ æå–æ•°æ®\n   * @param element DOMå…ƒç´ \n   */\n  static extractDataFromDOM(element: HTMLElement): any[][] {\n    const result: any[][] = [];\n\n    // æå–æŠ¥è¡¨æ ‡é¢˜\n    const titleElement = element.querySelector('.ddr-report-header .ddr-header-title');\n    if (titleElement) {\n      result.push([titleElement.textContent?.trim() || '']);\n      result.push([]); // ç©ºè¡Œåˆ†éš”\n    }\n\n    // æå–å…ƒæ•°æ®å­—æ®µ\n    const fieldsElements = element.querySelectorAll('.ddr-header-fields .ddr-header-field');\n    if (fieldsElements.length > 0) {\n      const metadataRow: string[] = [];\n      fieldsElements.forEach(field => {\n        const label = field.querySelector('.ddr-field-label')?.textContent?.trim() || '';\n        const value = field.querySelector('.ddr-field-value')?.textContent?.trim() || '';\n        if (label && value) {\n          metadataRow.push(`${label} ${value}`);\n        }\n      });\n      if (metadataRow.length > 0) {\n        result.push(metadataRow);\n        result.push([]); // ç©ºè¡Œåˆ†éš”\n      }\n    }\n\n    // æå–è¡¨æ ¼æ•°æ®\n    const table = element.querySelector('table');\n    if (table) {\n      const rows = table.querySelectorAll('tr');\n      rows.forEach(row => {\n        const cells = row.querySelectorAll('td, th');\n        const rowData: string[] = [];\n        cells.forEach(cell => {\n          rowData.push(cell.textContent?.trim() || '');\n        });\n        if (rowData.length > 0) {\n          result.push(rowData);\n        }\n      });\n    }\n\n    // æå–è¡¨å°¾ä¿¡æ¯\n    const footerElement = element.querySelector('.ddr-report-footer');\n    if (footerElement) {\n      result.push([]); // ç©ºè¡Œåˆ†éš”\n\n      // æå–æ±‡æ€»ä¿¡æ¯\n      const summaryElements = footerElement.querySelectorAll('.ddr-footer-summary .ddr-summary-item');\n      if (summaryElements.length > 0) {\n        const summaryRow: string[] = [];\n        summaryElements.forEach(item => {\n          const label = item.querySelector('.ddr-summary-label')?.textContent?.trim() || '';\n          const value = item.querySelector('.ddr-summary-value')?.textContent?.trim() || '';\n          if (label && value) {\n            summaryRow.push(`${label} ${value}`);\n          }\n        });\n        if (summaryRow.length > 0) {\n          result.push(summaryRow);\n        }\n      }\n\n      // æå–å…¶ä»–è¡¨å°¾å­—æ®µ\n      const footerFields = footerElement.querySelectorAll('.ddr-footer-fields .ddr-footer-field');\n      if (footerFields.length > 0) {\n        const footerRow: string[] = [];\n        footerFields.forEach(field => {\n          const label = field.querySelector('.ddr-field-label')?.textContent?.trim() || '';\n          const value = field.querySelector('.ddr-field-value')?.textContent?.trim() || '';\n          if (label && value) {\n            footerRow.push(`${label} ${value}`);\n          }\n        });\n        if (footerRow.length > 0) {\n          result.push(footerRow);\n        }\n      }\n    }\n\n    return result;\n  }\n\n  /**\n   * å°†DOMæ ·å¼åº”ç”¨åˆ°Excel\n   * @param ws å·¥ä½œè¡¨\n   * @param data æ•°æ®\n   * @param element DOMå…ƒç´ \n   */\n  static applyDOMStylesToExcel(ws: any, data: any[][], element: HTMLElement): void {\n    console.log('å¼€å§‹åº”ç”¨DOMæ ·å¼åˆ°Excel');\n\n    // ä½¿ç”¨ç®€åŒ–çš„æ ·å¼åº”ç”¨æ–¹å¼ï¼Œæé«˜å…¼å®¹æ€§\n    try {\n      // æŸ¥æ‰¾è¡¨æ ¼å…ƒç´ \n      const table = element.querySelector('table');\n      if (!table) {\n        console.log('æœªæ‰¾åˆ°è¡¨æ ¼ï¼Œä½¿ç”¨é»˜è®¤æ ·å¼');\n        applyExcelStyles(ws, data);\n        return;\n      }\n\n      // åˆ†æDOMç»“æ„\n      const titleElement = element.querySelector('.ddr-report-header .ddr-header-title');\n      const hasTitle = !!titleElement;\n      const hasMetadata = element.querySelectorAll('.ddr-header-fields .ddr-header-field').length > 0;\n\n      console.log('DOMç»“æ„åˆ†æ:', { hasTitle, hasMetadata });\n\n      // è®¡ç®—å„éƒ¨åˆ†åœ¨Excelä¸­çš„è¡Œç´¢å¼•\n      let currentRowIndex = 0;\n\n      // ç®€åŒ–çš„æ ·å¼å®šä¹‰\n      const headerStyle = {\n        font: { bold: true, sz: 12, color: { rgb: \"FFFFFF\" } },\n        fill: { fgColor: { rgb: \"4472C4\" } },\n        alignment: { horizontal: \"center\", vertical: \"center\" }\n      };\n\n      const dataStyle = {\n        font: { sz: 11 },\n        alignment: { vertical: \"center\" }\n      };\n\n      // æ ‡é¢˜è¡Œæ ·å¼\n      if (hasTitle) {\n        const cellRef = XLSX.utils.encode_cell({ r: currentRowIndex, c: 0 });\n        if (ws[cellRef]) {\n          ws[cellRef].s = {\n            font: { bold: true, sz: 16 },\n            alignment: { horizontal: \"center\", vertical: \"center\" }\n          };\n          console.log(`åº”ç”¨æ ‡é¢˜æ ·å¼åˆ° ${cellRef}`);\n        }\n        currentRowIndex += 2; // æ ‡é¢˜ + ç©ºè¡Œ\n      }\n\n      // å…ƒæ•°æ®è¡Œæ ·å¼\n      if (hasMetadata) {\n        currentRowIndex += 2; // å…ƒæ•°æ® + ç©ºè¡Œ\n      }\n\n      // è¡¨æ ¼æ ·å¼ - ç®€åŒ–å¤„ç†\n      const rows = table.querySelectorAll('tr');\n      let isFirstRow = true;\n\n      rows.forEach((row, rowIndex) => {\n        const cells = row.querySelectorAll('td, th');\n        const isHeader = row.querySelector('th') !== null || isFirstRow;\n\n        cells.forEach((cell, cellIndex) => {\n          const excelRowIndex = currentRowIndex + rowIndex;\n          const cellRef = XLSXStyle.utils.encode_cell({ r: excelRowIndex, c: cellIndex });\n\n          if (!ws[cellRef]) return;\n\n          // åº”ç”¨ç®€åŒ–æ ·å¼\n          if (isHeader) {\n            ws[cellRef].s = headerStyle;\n            console.log(`åº”ç”¨è¡¨å¤´æ ·å¼åˆ° ${cellRef}`);\n          } else {\n            ws[cellRef].s = dataStyle;\n          }\n        });\n\n        if (isFirstRow && isHeader) {\n          isFirstRow = false;\n        }\n      });\n\n      console.log('DOMæ ·å¼åº”ç”¨å®Œæˆ');\n    } catch (error) {\n      console.error('åº”ç”¨DOMæ ·å¼å¤±è´¥:', error);\n      // é™çº§åˆ°é»˜è®¤æ ·å¼\n      applyExcelStyles(ws, data);\n    }\n  }\n\n  /**\n   * åº”ç”¨åŸºç¡€æ ·å¼åˆ°Excelï¼ˆå…¼å®¹æ€§æ›´å¥½çš„æ–¹æ³•ï¼‰\n   */\n  static applyBasicStylesToExcel(ws: any, data: any[][]): void {\n    console.log('å¼€å§‹åº”ç”¨åŸºç¡€æ ·å¼åˆ°Excel');\n\n    try {\n      // è·å–æ•°æ®èŒƒå›´\n      const range = XLSXStyle.utils.decode_range(ws['!ref'] || 'A1');\n\n      // åº”ç”¨è¡¨å¤´æ ·å¼ï¼ˆç¬¬ä¸€è¡Œï¼‰\n      for (let col = range.s.c; col <= range.e.c; col++) {\n        const cellRef = XLSXStyle.utils.encode_cell({ r: 0, c: col });\n        if (ws[cellRef]) {\n          ws[cellRef].s = {\n            font: { bold: true, sz: 12 },\n            fill: { fgColor: { rgb: \"DDDDDD\" } },\n            alignment: { horizontal: \"center\", vertical: \"center\" }\n          };\n          console.log(`åº”ç”¨è¡¨å¤´æ ·å¼åˆ° ${cellRef}`);\n        }\n      }\n\n      // åº”ç”¨æ•°æ®è¡Œæ ·å¼\n      for (let row = 1; row <= range.e.r; row++) {\n        for (let col = range.s.c; col <= range.e.c; col++) {\n          const cellRef = XLSXStyle.utils.encode_cell({ r: row, c: col });\n          if (ws[cellRef]) {\n            ws[cellRef].s = {\n              font: { sz: 10 },\n              alignment: { vertical: \"center\" }\n            };\n          }\n        }\n      }\n\n      console.log('åŸºç¡€æ ·å¼åº”ç”¨å®Œæˆ');\n    } catch (error) {\n      console.error('åº”ç”¨åŸºç¡€æ ·å¼å¤±è´¥:', error);\n    }\n  }\n\n  /**\n   * åº”ç”¨å¢å¼ºæ ·å¼åˆ°Excelï¼ˆä½¿ç”¨æ›´å¤šæ ·å¼ç‰¹æ€§ï¼‰\n   */\n  static applyEnhancedStylesToExcel(ws: any, data: any[][]): void {\n    console.log('å¼€å§‹åº”ç”¨å¢å¼ºæ ·å¼åˆ°Excel');\n\n    try {\n      // è·å–æ•°æ®èŒƒå›´\n      const range = XLSXStyle.utils.decode_range(ws['!ref'] || 'A1');\n\n      // å®šä¹‰æ ·å¼\n      const headerStyle = {\n        font: { bold: true, sz: 12, color: { rgb: \"FFFFFF\" } },\n        fill: { fgColor: { rgb: \"4472C4\" } },\n        alignment: { horizontal: \"center\", vertical: \"center\" },\n        border: {\n          top: { style: \"thin\", color: { rgb: \"000000\" } },\n          bottom: { style: \"thin\", color: { rgb: \"000000\" } },\n          left: { style: \"thin\", color: { rgb: \"000000\" } },\n          right: { style: \"thin\", color: { rgb: \"000000\" } }\n        }\n      };\n\n      const dataStyle = {\n        font: { sz: 10 },\n        alignment: { vertical: \"center\" },\n        border: {\n          top: { style: \"thin\", color: { rgb: \"CCCCCC\" } },\n          bottom: { style: \"thin\", color: { rgb: \"CCCCCC\" } },\n          left: { style: \"thin\", color: { rgb: \"CCCCCC\" } },\n          right: { style: \"thin\", color: { rgb: \"CCCCCC\" } }\n        }\n      };\n\n      const alternateRowStyle = {\n        font: { sz: 10 },\n        fill: { fgColor: { rgb: \"F8F9FA\" } },\n        alignment: { vertical: \"center\" },\n        border: {\n          top: { style: \"thin\", color: { rgb: \"CCCCCC\" } },\n          bottom: { style: \"thin\", color: { rgb: \"CCCCCC\" } },\n          left: { style: \"thin\", color: { rgb: \"CCCCCC\" } },\n          right: { style: \"thin\", color: { rgb: \"CCCCCC\" } }\n        }\n      };\n\n      // åº”ç”¨è¡¨å¤´æ ·å¼ï¼ˆç¬¬ä¸€è¡Œï¼‰\n      for (let col = range.s.c; col <= range.e.c; col++) {\n        const cellRef = XLSXStyle.utils.encode_cell({ r: 0, c: col });\n        if (ws[cellRef]) {\n          ws[cellRef].s = headerStyle;\n          console.log(`åº”ç”¨å¢å¼ºè¡¨å¤´æ ·å¼åˆ° ${cellRef}`);\n        }\n      }\n\n      // åº”ç”¨æ•°æ®è¡Œæ ·å¼ï¼ˆäº¤æ›¿è¡Œé¢œè‰²ï¼‰\n      for (let row = 1; row <= range.e.r; row++) {\n        const isAlternateRow = row % 2 === 0;\n        const rowStyle = isAlternateRow ? alternateRowStyle : dataStyle;\n\n        for (let col = range.s.c; col <= range.e.c; col++) {\n          const cellRef = XLSXStyle.utils.encode_cell({ r: row, c: col });\n          if (ws[cellRef]) {\n            ws[cellRef].s = rowStyle;\n          }\n        }\n      }\n\n      // è®¾ç½®åˆ—å®½\n      if (!ws['!cols']) ws['!cols'] = [];\n      for (let col = range.s.c; col <= range.e.c; col++) {\n        ws['!cols'][col] = { wch: 15 }; // è®¾ç½®åˆ—å®½ä¸º15å­—ç¬¦\n      }\n\n      console.log('å¢å¼ºæ ·å¼åº”ç”¨å®Œæˆ');\n    } catch (error) {\n      console.error('åº”ç”¨å¢å¼ºæ ·å¼å¤±è´¥ï¼Œå›é€€åˆ°åŸºç¡€æ ·å¼:', error);\n      // å›é€€åˆ°åŸºç¡€æ ·å¼\n      this.applyBasicStylesToExcel(ws, data);\n    }\n  }\n\n  /**\n   * å°†RGBé¢œè‰²è½¬æ¢ä¸ºåå…­è¿›åˆ¶\n   */\n  static rgbToHex(rgb: string): string {\n    if (!rgb || rgb === 'transparent') return 'FFFFFF';\n\n    const match = rgb.match(/rgb\\((\\d+),\\s*(\\d+),\\s*(\\d+)\\)/);\n    if (match) {\n      const r = parseInt(match[1]);\n      const g = parseInt(match[2]);\n      const b = parseInt(match[3]);\n      return ((r << 16) | (g << 8) | b).toString(16).padStart(6, '0').toUpperCase();\n    }\n\n    return 'FFFFFF';\n  }\n\n  /**\n   * å°†CSSæ–‡æœ¬å¯¹é½è½¬æ¢ä¸ºExcelå¯¹é½\n   */\n  static getExcelAlignment(textAlign: string): string {\n    switch (textAlign) {\n      case 'center': return 'center';\n      case 'right': return 'right';\n      case 'justify': return 'justify';\n      default: return 'left';\n    }\n  }\n\n  /**\n   * å¯¼å‡ºä¸ºPDF\n   * @param element è¦å¯¼å‡ºçš„DOMå…ƒç´ \n   * @param config æŠ¥è¡¨é…ç½®\n   * @param options å¯¼å‡ºé€‰é¡¹\n   */\n  static async toPDF(element: HTMLElement, config?: any, options: ExportOptions = {}): Promise<void> {\n    try {\n      console.log('PDFå¯¼å‡ºå¼€å§‹ï¼Œä½¿ç”¨å†…ç½®jsPDFåº“');\n\n      // é»˜è®¤é€‰é¡¹\n      const {\n        fileName = 'æŠ¥è¡¨',\n        watermark,  // ä¸è®¾ç½®é»˜è®¤å€¼ï¼Œè®©åç»­é€»è¾‘å¤„ç†\n        pdf: pdfOptions = {}\n      } = options;\n\n      // ä»é…ç½®ä¸­è·å–PDFè®¾ç½®ï¼Œé€‰é¡¹å¯ä»¥è¦†ç›–é…ç½®\n      const configPdfSettings = config?.features?.pdfConfig || {};\n      const mergedPdfOptions = { ...configPdfSettings, ...pdfOptions };\n\n      // æ°´å°å¤„ç†ï¼šä¼˜å…ˆä½¿ç”¨æ–¹æ³•å‚æ•°ï¼Œå…¶æ¬¡ä½¿ç”¨é…ç½®ï¼Œæœ€åä½¿ç”¨ç©ºå­—ç¬¦ä¸²\n      const finalWatermark = watermark !== undefined ? watermark : (config?.features?.watermark || '');\n\n      // è°ƒè¯•ä¿¡æ¯ï¼šè¾“å‡ºPDFé…ç½®å’Œæ°´å°å¤„ç†\n      console.log('PDFå¯¼å‡ºé…ç½®:', {\n        configPdfSettings,\n        pdfOptions,\n        mergedPdfOptions\n      });\n      console.log('æ°´å°å¤„ç†:', {\n        'æ–¹æ³•å‚æ•°watermark': watermark,\n        'é…ç½®ä¸­çš„watermark': config?.features?.watermark,\n        'æœ€ç»ˆä½¿ç”¨çš„watermark': finalWatermark\n      });\n\n      // PDFé…ç½®\n      const pageSize = mergedPdfOptions.pageSize || 'A4';\n      const orientation = mergedPdfOptions.orientation || 'portrait';\n      const quality = mergedPdfOptions.quality || 0.95;\n      const multiPage = mergedPdfOptions.multiPage !== false;\n      const relayout = mergedPdfOptions.relayout !== false; // é»˜è®¤é‡æ–°æ’ç‰ˆ\n\n      console.log(`PDFè®¾ç½® - é¡µé¢å¤§å°: ${pageSize}, æ–¹å‘: ${orientation}, é‡æ–°æ’ç‰ˆ: ${relayout}`);\n\n      // è®¾ç½®é¡µè¾¹è·(mm)\n      const margins = {\n        top: mergedPdfOptions.margins?.top || 15,\n        right: mergedPdfOptions.margins?.right || 15,\n        bottom: mergedPdfOptions.margins?.bottom || 15,\n        left: mergedPdfOptions.margins?.left || 15\n      };\n\n      // ä¿å­˜åŸå§‹æ»šåŠ¨ä½ç½®\n      const originalScrollTop = element.scrollTop;\n\n      // åˆ›å»ºä¸´æ—¶å®¹å™¨\n      const tempContainer = element.cloneNode(true) as HTMLElement;\n      tempContainer.style.position = 'absolute';\n      tempContainer.style.left = '-9999px';\n      tempContainer.style.overflow = 'visible';\n      tempContainer.style.height = 'auto';\n\n      // å¦‚æœå¯ç”¨é‡æ–°æ’ç‰ˆï¼Œè®¾ç½®PDFé€‚åˆçš„å®½åº¦\n      if (relayout) {\n        // æ ¹æ®PDFé¡µé¢æ–¹å‘è®¾ç½®åˆé€‚çš„å®½åº¦\n        const pdfWidth = orientation === 'landscape' ?\n          (pageSize === 'A4' ? 297 : 279) : // A4æ¨ªç‰ˆ297mm, Letteræ¨ªç‰ˆ279mm\n          (pageSize === 'A4' ? 210 : 216);  // A4ç«–ç‰ˆ210mm, Letterç«–ç‰ˆ216mm\n\n        // è€ƒè™‘é¡µè¾¹è·ï¼Œè®¾ç½®å†…å®¹å®½åº¦(è½¬æ¢ä¸ºpxï¼Œå‡è®¾96dpi)\n        const contentWidthMm = pdfWidth - margins.left - margins.right;\n        // è°ƒæ•´DPIæ¯”ä¾‹ï¼Œä½¿æ¨ªç‰ˆèƒ½æ˜¾ç¤ºæ›´å¤šå†…å®¹\n        const dpiRatio = orientation === 'landscape' ? 4.0 : 3.78; // æ¨ªç‰ˆä½¿ç”¨ç¨é«˜çš„DPI\n        const contentWidthPx = Math.floor(contentWidthMm * dpiRatio);\n\n        tempContainer.style.width = contentWidthPx + 'px';\n        tempContainer.style.maxWidth = contentWidthPx + 'px';\n\n        // å¼ºåˆ¶è¡¨æ ¼é‡æ–°è®¡ç®—å¸ƒå±€ï¼Œåº”ç”¨æ¨ª/ç«–ç‰ˆé€‚å½“çš„æ ·å¼\n        const tableElements = tempContainer.querySelectorAll('table');\n        tableElements.forEach(table => {\n          const tableElem = table as HTMLElement;\n          tableElem.style.width = '100%';\n          tableElem.style.tableLayout = 'fixed';\n\n          // æ¨ªç‰ˆæ—¶ç‰¹æ®Šå¤„ç†ï¼Œä½¿è¡¨æ ¼æ›´åˆç†åˆ©ç”¨ç©ºé—´\n          if (orientation === 'landscape') {\n            // æ¨ªç‰ˆæ—¶è°ƒæ•´å•å…ƒæ ¼å°ºå¯¸ï¼Œä½¿æ–‡æœ¬æ›´ç´§å‡‘\n            const cells = tableElem.querySelectorAll('td, th');\n            cells.forEach(cell => {\n              (cell as HTMLElement).style.padding = '3px 4px'; // å‡å°å†…è¾¹è·\n            });\n          }\n        });\n      } else {\n        // ç¼©æ”¾æ¨¡å¼ï¼šä¿æŒåŸå§‹å®½åº¦ï¼Œä½†ç¡®ä¿ç­‰æ¯”ä¾‹ç¼©æ”¾\n        tempContainer.style.width = element.clientWidth + 'px';\n        console.log('ä½¿ç”¨ç¼©æ”¾æ¨¡å¼ï¼Œä¿æŒåŸå§‹å®½åº¦:', element.clientWidth + 'px');\n      }\n\n      document.body.appendChild(tempContainer);\n\n      // ç¡®ä¿æ‰€æœ‰å†…å®¹å¯è§\n      const headerElement = tempContainer.querySelector('.ddr-report-header') as HTMLElement;\n      const footerElement = tempContainer.querySelector('.ddr-report-footer') as HTMLElement;\n      const tableContainer = tempContainer.querySelector('.ddr-table-container') as HTMLElement;\n\n      // æ£€æŸ¥å¿…è¦çš„å…ƒç´ æ˜¯å¦å­˜åœ¨\n      if (!tableContainer) {\n        console.warn('æœªæ‰¾åˆ°è¡¨æ ¼å®¹å™¨å…ƒç´ ï¼Œå¯¼å‡ºå¯èƒ½ä¸å®Œæ•´');\n      }\n\n      // ä¼˜åŒ–DOMç»“æ„ä»¥ä¾¿æ›´å¥½åœ°å¯¼å‡º\n      if (tableContainer) {\n        tableContainer.style.maxHeight = 'none';\n        tableContainer.style.height = 'auto';\n        tableContainer.style.overflow = 'visible';\n\n        // ç¡®ä¿è¡¨æ ¼å†…å®¹æ­£ç¡®æ˜¾ç¤º\n        const tableElement = tableContainer.querySelector('table');\n        if (tableElement) {\n          // ç¡®ä¿è¡¨æ ¼å®½åº¦æ­£ç¡®\n          tableElement.style.width = '100%';\n\n          // ç¡®ä¿æ‰€æœ‰å•å…ƒæ ¼éƒ½æœ‰é€‚å½“çš„è¾¹æ¡†\n          const cells = tableElement.querySelectorAll('td, th');\n          cells.forEach(cell => {\n            (cell as HTMLElement).style.border = '1px solid #ddd';\n          });\n        }\n      }\n\n      // ä¼˜åŒ–è¡¨å¤´å’Œè¡¨å°¾\n      if (headerElement) {\n        headerElement.style.position = 'relative';\n        headerElement.style.height = 'auto';\n        headerElement.style.overflow = 'visible';\n      }\n\n      if (footerElement) {\n        footerElement.style.position = 'relative';\n        footerElement.style.height = 'auto';\n        footerElement.style.overflow = 'visible';\n      }\n        // åˆå§‹åŒ–PDF\n      const pdf = new jsPDF({\n        orientation,\n        unit: 'mm',\n        format: pageSize\n      });\n\n      // è®¾ç½®ä¸­æ–‡æ”¯æŒ\n      setupChineseSupport(pdf);\n\n      const pageWidth = pdf.internal.pageSize.getWidth();\n      const pageHeight = pdf.internal.pageSize.getHeight();\n\n      // å†…å®¹åŒºåŸŸé«˜åº¦ï¼ˆå‡å»é¡µè¾¹è·ï¼‰\n      const contentHeight = pageHeight - margins.top - margins.bottom;\n      const contentWidth = pageWidth - margins.left - margins.right;\n\n      // è®¾ç½®å­—ä½“å¤§å°\n      pdf.setFontSize(12);\n\n      if (multiPage) {\n        // -------------- å¤šé¡µå¤„ç† --------------\n\n        // è¡¨å¤´é«˜åº¦(å¦‚æœæœ‰) - ç²¾ç¡®æµ‹é‡å®é™…é«˜åº¦\n        let headerHeight = 0;\n        let headerCanvas;\n        if (headerElement) {\n          try {\n            // é¦–å…ˆè·å–å…ƒç´ çš„å®é™…åƒç´ å°ºå¯¸\n            const headerRect = headerElement.getBoundingClientRect();\n            console.log(`ğŸ“ æŠ¥è¡¨å¤´DOMå°ºå¯¸ï¼š${Math.round(headerRect.width)}px Ã— ${Math.round(headerRect.height)}px`);\n\n            headerCanvas = await html2canvas(headerElement, {\n              scale: 2.0, // é€‚ä¸­çš„æ¸…æ™°åº¦\n              useCORS: true,\n              logging: false,\n              allowTaint: true,\n              backgroundColor: '#FFFFFF' // ç¡®ä¿èƒŒæ™¯è‰²ä¸€è‡´\n            });\n\n            // åŸºäºCanvaså’ŒDOMçš„æ¯”ä¾‹å…³ç³»è®¡ç®—PDFä¸­çš„å®é™…é«˜åº¦\n            // è¿™æ ·å¯ä»¥é¿å…DPIå‡è®¾çš„é—®é¢˜\n            headerHeight = (headerCanvas.height / headerCanvas.width) * contentWidth;\n\n            console.log(`ğŸ“ æŠ¥è¡¨å¤´Canvaså°ºå¯¸ï¼š${headerCanvas.width}px Ã— ${headerCanvas.height}px`);\n            console.log(`ğŸ“ æŠ¥è¡¨å¤´å®é™…é«˜åº¦ï¼š${Math.round(headerHeight * 100) / 100}mm`);\n          } catch (e) {\n            console.warn('æ¸²æŸ“è¡¨å¤´æ—¶å‡ºé”™:', e);\n          }\n        }\n\n        // è¡¨å°¾é«˜åº¦(å¦‚æœæœ‰) - ç²¾ç¡®æµ‹é‡å®é™…é«˜åº¦\n        let footerHeight = 0;\n        let footerCanvas;\n        if (footerElement) {\n          try {\n            // é¦–å…ˆè·å–å…ƒç´ çš„å®é™…åƒç´ å°ºå¯¸\n            const footerRect = footerElement.getBoundingClientRect();\n            console.log(`ğŸ“ æŠ¥è¡¨å°¾DOMå°ºå¯¸ï¼š${Math.round(footerRect.width)}px Ã— ${Math.round(footerRect.height)}px`);\n\n            footerCanvas = await html2canvas(footerElement, {\n              scale: 2.0, // é€‚ä¸­çš„æ¸…æ™°åº¦\n              useCORS: true,\n              logging: false,\n              allowTaint: true,\n              backgroundColor: '#FFFFFF' // ç¡®ä¿èƒŒæ™¯è‰²ä¸€è‡´\n            });\n\n            // åŸºäºCanvaså’ŒDOMçš„æ¯”ä¾‹å…³ç³»è®¡ç®—PDFä¸­çš„å®é™…é«˜åº¦\n            // è¿™æ ·å¯ä»¥é¿å…DPIå‡è®¾çš„é—®é¢˜\n            footerHeight = (footerCanvas.height / footerCanvas.width) * contentWidth;\n\n            console.log(`ğŸ“ æŠ¥è¡¨å°¾Canvaså°ºå¯¸ï¼š${footerCanvas.width}px Ã— ${footerCanvas.height}px`);\n            console.log(`ğŸ“ æŠ¥è¡¨å°¾å®é™…é«˜åº¦ï¼š${Math.round(footerHeight * 100) / 100}mm`);\n          } catch (e) {\n            console.warn('æ¸²æŸ“è¡¨å°¾æ—¶å‡ºé”™:', e);\n          }\n        }\n\n        // æå–è¡¨æ ¼éƒ¨åˆ†\n        const tableElement = tableContainer?.querySelector('table') || tableContainer;\n        if (!tableElement) {\n          throw new Error('æ‰¾ä¸åˆ°è¡¨æ ¼å…ƒç´ ');\n        }\n\n        // è·å–è¡¨æ ¼çš„å®é™…DOMå°ºå¯¸\n        const tableRect = tableElement.getBoundingClientRect();\n        console.log(`ğŸ“ è¡¨æ ¼DOMå°ºå¯¸ï¼š${Math.round(tableRect.width)}px Ã— ${Math.round(tableRect.height)}px`);\n\n        // å°†è¡¨æ ¼è½¬æ¢ä¸ºcanvasï¼Œæé«˜æ¸…æ™°åº¦\n        let tableCanvas;\n        let tableWidth;\n        let tableHeight;\n\n        try {\n          tableCanvas = await html2canvas(tableElement, {\n            scale: 2.0, // é€‚ä¸­çš„æ¸…æ™°åº¦\n            useCORS: true,\n            logging: false,\n            allowTaint: true,\n            backgroundColor: '#FFFFFF' // ç¡®ä¿èƒŒæ™¯è‰²ä¸€è‡´\n          });\n\n          // åŸºäºCanvaså’ŒDOMçš„æ¯”ä¾‹å…³ç³»è®¡ç®—PDFä¸­çš„å®é™…å°ºå¯¸\n          tableWidth = contentWidth; // PDFå†…å®¹åŒºåŸŸå®½åº¦\n          tableHeight = (tableCanvas.height / tableCanvas.width) * tableWidth; // åŸºäºCanvasæ¯”ä¾‹è®¡ç®—\n\n          console.log(`ğŸ“ è¡¨æ ¼Canvaså°ºå¯¸ï¼š${tableCanvas.width}px Ã— ${tableCanvas.height}px`);\n          console.log(`ğŸ“ è¡¨æ ¼å®é™…é«˜åº¦ï¼š${Math.round(tableHeight * 100) / 100}mm`);\n\n          // è®¡ç®—è¡¨æ ¼è¡Œæ•°ä¿¡æ¯\n          const rows = tableElement.querySelectorAll('tr');\n          const totalRows = rows.length;\n\n          // è®¡ç®—è¡¨å¤´è¡Œæ•°\n          let headerRowCount = 0;\n          for (let i = 0; i < rows.length; i++) {\n            if (rows[i].querySelector('th')) {\n              headerRowCount++;\n            } else {\n              break; // é‡åˆ°ç¬¬ä¸€ä¸ªéè¡¨å¤´è¡Œå°±åœæ­¢\n            }\n          }\n\n          const dataRowCount = totalRows - headerRowCount;\n          console.log(`ğŸ“Š è¡¨æ ¼è¡Œæ•°ç»Ÿè®¡ï¼šæ€»è¡Œæ•°=${totalRows}, è¡¨å¤´è¡Œæ•°=${headerRowCount}, æ•°æ®è¡Œæ•°=${dataRowCount}`);\n\n          // é‡æ„åˆ†é¡µç®—æ³• - ç²¾ç¡®è®¡ç®—æ¯é¡µå¯ç”¨ç©ºé—´å’Œè¡Œæ•°\n          console.log(`ğŸ” å¼€å§‹é‡æ„PDFåˆ†é¡µç®—æ³•...`);\n\n          // 1. ç²¾ç¡®æµ‹é‡å„éƒ¨åˆ†å®é™…é«˜åº¦ï¼ˆæ¯«ç±³ï¼‰\n          let actualHeaderHeightMM = 0;\n          let actualFooterHeightMM = 0;\n\n          if (headerCanvas) {\n            actualHeaderHeightMM = headerHeight;\n            console.log(`ğŸ“ æŠ¥è¡¨å¤´å®é™…é«˜åº¦ï¼š${Math.round(actualHeaderHeightMM)}mm`);\n          }\n\n          if (footerCanvas) {\n            actualFooterHeightMM = footerHeight;\n            console.log(`ğŸ“ æŠ¥è¡¨å°¾å®é™…é«˜åº¦ï¼š${Math.round(actualFooterHeightMM)}mm`);\n          }\n\n          // 2. è®¡ç®—å•è¡Œæ•°æ®é«˜åº¦ - ä¿å®ˆä½†å‡†ç¡®çš„æ–¹å¼\n          let dataRowHeightMM: number;\n\n          // ä½¿ç”¨Canvasä¸­çš„å¹³å‡è¡Œé«˜ï¼Œè¿™ä¸å®é™…æ¸²æŸ“æ›´ä¸€è‡´\n          const avgRowHeightCanvas = tableCanvas.height / totalRows;\n          dataRowHeightMM = (avgRowHeightCanvas / tableCanvas.height) * tableHeight;\n\n          console.log(`ğŸ“ Canvasè¡Œé«˜è®¡ç®—ï¼šæ€»é«˜åº¦${tableCanvas.height}px Ã· ${totalRows}è¡Œ = ${Math.round(avgRowHeightCanvas * 100) / 100}px/è¡Œ`);\n          console.log(`ğŸ“ PDFè¡Œé«˜ï¼š${Math.round(dataRowHeightMM * 100) / 100}mm/è¡Œ`);\n\n          // å¦‚æœæœ‰é…ç½®çš„è¡Œé«˜ï¼Œè¿›è¡Œå¯¹æ¯”ä½†ä¸ç›´æ¥ä½¿ç”¨ï¼ˆé¿å…æº¢å‡ºï¼‰\n          if (config?.layout?.rowHeight) {\n            const configRowHeightPx = typeof config.layout.rowHeight === 'number'\n              ? config.layout.rowHeight\n              : parseInt(config.layout.rowHeight);\n            const configRowHeightMM = (configRowHeightPx * 25.4) / 96;\n\n            console.log(`ğŸ“ é…ç½®è¡Œé«˜ï¼š${configRowHeightPx}px â†’ ${Math.round(configRowHeightMM * 100) / 100}mm`);\n            console.log(`ğŸ“ Canvasè¡Œé«˜ï¼š${Math.round(dataRowHeightMM * 100) / 100}mm`);\n            console.log(`ğŸ“ ä½¿ç”¨Canvasè¡Œé«˜ä»¥ç¡®ä¿æ•°æ®å®Œæ•´æ€§`);\n          }\n\n          // 3. é¡µé¢å¸ƒå±€å¸¸é‡ - ä¿å®ˆçš„ç©ºé—´é…ç½®\n          const pageNumberReserve = 15; // é¡µç é¢„ç•™ç©ºé—´(mm) - é€‚ä¸­é¢„ç•™\n          const contentGap = 0; // å†…å®¹é—´è·(mm) - ç§»é™¤é—´è·å®ç°æ— ç¼è¿æ¥\n          const safetyMargin = 3; // å®‰å…¨è¾¹è·(mm) - é€‚ä¸­å®‰å…¨è¾¹è·\n\n          console.log(`ğŸ“ é¡µé¢å¸ƒå±€å‚æ•°ï¼š`);\n          console.log(`- é¡µé¢æ€»é«˜åº¦ï¼š${Math.round(pageHeight)}mm`);\n          console.log(`- ä¸Šä¸‹è¾¹è·ï¼š${margins.top + margins.bottom}mm`);\n          console.log(`- é¡µç é¢„ç•™ï¼š${pageNumberReserve}mm`);\n          console.log(`- å®‰å…¨è¾¹è·ï¼š${safetyMargin}mm`);\n\n          // 4. è®¡ç®—å„é¡µç±»å‹çš„å¯ç”¨æ•°æ®é«˜åº¦\n          const baseAvailableHeight = pageHeight - margins.top - margins.bottom - pageNumberReserve - safetyMargin;\n\n          const firstPageDataHeight = baseAvailableHeight - actualHeaderHeightMM - contentGap;\n          const middlePageDataHeight = baseAvailableHeight;\n          const lastPageDataHeight = baseAvailableHeight - actualFooterHeightMM - contentGap;\n\n          console.log(`ğŸ“ å„é¡µå¯ç”¨æ•°æ®é«˜åº¦ï¼š`);\n          console.log(`- ç¬¬ä¸€é¡µæ•°æ®åŒºï¼š${Math.round(firstPageDataHeight)}mm`);\n          console.log(`- ä¸­é—´é¡µæ•°æ®åŒºï¼š${Math.round(middlePageDataHeight)}mm`);\n          console.log(`- æœ€åé¡µæ•°æ®åŒºï¼š${Math.round(lastPageDataHeight)}mm`);\n\n          // 5. ä¿å®ˆè®¡ç®—å„é¡µæœ€å¤§è¡Œæ•° - ç¡®ä¿æ•°æ®å®Œæ•´æ€§\n          const firstPageMaxRows = Math.floor(firstPageDataHeight / dataRowHeightMM);\n          const middlePageMaxRows = Math.floor(middlePageDataHeight / dataRowHeightMM);\n          const lastPageMaxRows = Math.floor(lastPageDataHeight / dataRowHeightMM);\n\n          console.log(`ğŸ“Š ä¿å®ˆè®¡ç®—çš„å„é¡µæœ€å¤§è¡Œæ•°ï¼š`);\n          console.log(`- ç¬¬ä¸€é¡µï¼š${firstPageMaxRows}è¡Œ (${Math.round(firstPageDataHeight)}mm Ã· ${Math.round(dataRowHeightMM * 100) / 100}mm)`);\n          console.log(`- ä¸­é—´é¡µï¼š${middlePageMaxRows}è¡Œ (${Math.round(middlePageDataHeight)}mm Ã· ${Math.round(dataRowHeightMM * 100) / 100}mm)`);\n          console.log(`- æœ€åé¡µï¼š${lastPageMaxRows}è¡Œ (${Math.round(lastPageDataHeight)}mm Ã· ${Math.round(dataRowHeightMM * 100) / 100}mm)`);\n\n          // éªŒè¯è®¡ç®—å‡†ç¡®æ€§\n          console.log(`ğŸ” ç©ºé—´åˆ©ç”¨ç‡éªŒè¯ï¼š`);\n          console.log(`- ç¬¬ä¸€é¡µï¼š${firstPageMaxRows}è¡Œ Ã— ${Math.round(dataRowHeightMM * 100) / 100}mm = ${Math.round(firstPageMaxRows * dataRowHeightMM)}mmï¼Œå¯ç”¨${Math.round(firstPageDataHeight)}mmï¼Œåˆ©ç”¨ç‡${Math.round((firstPageMaxRows * dataRowHeightMM / firstPageDataHeight) * 100)}%`);\n          console.log(`- ä¸­é—´é¡µï¼š${middlePageMaxRows}è¡Œ Ã— ${Math.round(dataRowHeightMM * 100) / 100}mm = ${Math.round(middlePageMaxRows * dataRowHeightMM)}mmï¼Œå¯ç”¨${Math.round(middlePageDataHeight)}mmï¼Œåˆ©ç”¨ç‡${Math.round((middlePageMaxRows * dataRowHeightMM / middlePageDataHeight) * 100)}%`);\n\n          // 6. é‡æ„åˆ†é¡µç®—æ³• - ç¡®ä¿æ•°æ®å®Œæ•´æ€§\n          const pageBreakPoints: Array<{yPercent: number; endRow: number}> = [];\n          let processedRows = 0;\n          let pageIndex = 0;\n\n          console.log(`ğŸ”„ å¼€å§‹æ™ºèƒ½åˆ†é¡µç®—æ³•ï¼Œæ€»æ•°æ®è¡Œæ•°ï¼š${dataRowCount}`);\n\n          while (processedRows < dataRowCount) {\n            let maxRowsThisPage: number;\n\n            if (pageIndex === 0) {\n              // ç¬¬ä¸€é¡µï¼šåŒ…å«æŠ¥è¡¨å¤´\n              maxRowsThisPage = firstPageMaxRows;\n              console.log(`ğŸ“„ ç¬¬${pageIndex + 1}é¡µï¼ˆé¦–é¡µï¼‰ï¼šæœ€å¤§å¯å®¹çº³${maxRowsThisPage}è¡Œ`);\n            } else {\n              // æ£€æŸ¥æ˜¯å¦ä¸ºæœ€åä¸€é¡µ\n              const remainingRows = dataRowCount - processedRows;\n\n              if (remainingRows <= lastPageMaxRows) {\n                // æœ€åä¸€é¡µï¼šéœ€è¦å®¹çº³æŠ¥è¡¨å°¾\n                maxRowsThisPage = remainingRows;\n                console.log(`ğŸ“„ ç¬¬${pageIndex + 1}é¡µï¼ˆæœ«é¡µï¼‰ï¼šæ˜¾ç¤ºå‰©ä½™${remainingRows}è¡Œ`);\n              } else {\n                // ä¸­é—´é¡µï¼šå…¨éƒ¨ç”¨äºæ•°æ®\n                maxRowsThisPage = middlePageMaxRows;\n                console.log(`ğŸ“„ ç¬¬${pageIndex + 1}é¡µï¼ˆä¸­é—´é¡µï¼‰ï¼šæœ€å¤§å¯å®¹çº³${maxRowsThisPage}è¡Œ`);\n              }\n            }\n\n            const rowsThisPage = Math.min(maxRowsThisPage, dataRowCount - processedRows);\n            processedRows += rowsThisPage;\n\n            console.log(`ğŸ“Š ç¬¬${pageIndex + 1}é¡µå®é™…æ˜¾ç¤ºï¼š${rowsThisPage}è¡Œï¼Œç´¯è®¡å¤„ç†ï¼š${processedRows}/${dataRowCount}è¡Œ`);\n\n            // å¦‚æœè¿˜æœ‰å‰©ä½™æ•°æ®ï¼Œåˆ›å»ºåˆ†é¡µç‚¹\n            if (processedRows < dataRowCount) {\n              // ç²¾ç¡®è®¡ç®—åˆ†é¡µç‚¹ä½ç½®\n              const headerHeightRatio = actualHeaderHeightMM / tableHeight;\n              const dataAreaHeightRatio = 1 - headerHeightRatio - (actualFooterHeightMM / tableHeight);\n              const processedRowsRatio = processedRows / dataRowCount;\n              const breakYPercent = headerHeightRatio + (processedRowsRatio * dataAreaHeightRatio);\n\n              pageBreakPoints.push({\n                yPercent: breakYPercent,\n                endRow: processedRows\n              });\n\n              console.log(`ğŸ“ åˆ›å»ºåˆ†é¡µç‚¹${pageIndex + 1}ï¼šç¬¬${processedRows}è¡Œç»“æŸï¼ŒY=${Math.round(breakYPercent * 100)}%`);\n            }\n\n            pageIndex++;\n          }\n\n          console.log(`âœ… åˆ†é¡µç®—æ³•å®Œæˆï¼šå…±${pageIndex}é¡µï¼Œå¤„ç†${processedRows}è¡Œæ•°æ®ï¼Œåˆ›å»º${pageBreakPoints.length}ä¸ªåˆ†é¡µç‚¹`);\n\n          // è®¡ç®—æ€»é¡µæ•°\n          const pagesNeeded = pageBreakPoints.length + 1;\n          console.log(`ğŸ“Š æ€»è®¡éœ€è¦ ${pagesNeeded} é¡µæ˜¾ç¤º ${dataRowCount} è¡Œæ•°æ®`);\n\n          // è¡¨æ ¼å„éƒ¨åˆ†çš„å›¾åƒæ•°æ®\n          const headerImgData = headerCanvas ? headerCanvas.toDataURL('image/jpeg', quality) : null;\n          const footerImgData = footerCanvas ? footerCanvas.toDataURL('image/jpeg', quality) : null;\n\n          // æ£€æŸ¥æœ€åä¸€é¡µæ˜¯å¦éœ€è¦é¢å¤–é¡µé¢æ˜¾ç¤ºæŠ¥è¡¨å°¾\n          if (footerImgData) {\n            const lastPageRows = pageBreakPoints.length > 0 ?\n              dataRowCount - pageBreakPoints[pageBreakPoints.length - 1].endRow :\n              dataRowCount;\n            const lastPageDataHeightUsed = lastPageRows * dataRowHeightMM;\n            const lastPageRemainingHeight = lastPageDataHeight - lastPageDataHeightUsed;\n\n            console.log(`ğŸ“‹ æŠ¥è¡¨å°¾æ£€æŸ¥ï¼š`);\n            console.log(`- æœ€åä¸€é¡µæ•°æ®è¡Œæ•°ï¼š${lastPageRows}`);\n            console.log(`- æœ€åä¸€é¡µæ•°æ®å ç”¨é«˜åº¦ï¼š${Math.round(lastPageDataHeightUsed)}mm`);\n            console.log(`- æœ€åä¸€é¡µå‰©ä½™é«˜åº¦ï¼š${Math.round(lastPageRemainingHeight)}mm`);\n            console.log(`- æŠ¥è¡¨å°¾éœ€è¦é«˜åº¦ï¼š${Math.round(actualFooterHeightMM + contentGap)}mm`);\n\n            if (lastPageRemainingHeight < actualFooterHeightMM + contentGap) {\n              console.log(`âš ï¸ æœ€åä¸€é¡µç©ºé—´ä¸è¶³ï¼ŒæŠ¥è¡¨å°¾å°†åœ¨æ–°é¡µæ˜¾ç¤º`);\n            } else {\n              console.log(`âœ… æœ€åä¸€é¡µç©ºé—´å……è¶³ï¼ŒæŠ¥è¡¨å°¾å°†åœ¨å½“å‰é¡µæ˜¾ç¤º`);\n            }\n          }\n\n          // é€é¡µæ·»åŠ å†…å®¹\n          for (let page = 0; page < pagesNeeded; page++) {\n            // å¦‚æœä¸æ˜¯ç¬¬ä¸€é¡µï¼Œåˆ›å»ºæ–°é¡µ\n            if (page > 0) {\n              pdf.addPage();\n            }\n\n            let yOffset = margins.top;\n\n            // æ·»åŠ æŠ¥è¡¨å¤´ï¼ˆåªåœ¨ç¬¬ä¸€é¡µæ˜¾ç¤ºï¼‰\n            if (headerImgData && page === 0) {\n              pdf.addImage(\n                headerImgData,\n                'JPEG',\n                margins.left,\n                yOffset,\n                contentWidth,\n                headerHeight\n              );\n              yOffset += headerHeight; // ç§»é™¤é¢å¤–é—´è·ï¼Œå®ç°æ— ç¼è¿æ¥\n            }\n\n            // æ·»åŠ è¡¨æ ¼æ ‡é¢˜è¡Œï¼ˆæ ¹æ®é…ç½®å†³å®šæ˜¯å¦åœ¨æ¯é¡µæ˜¾ç¤ºï¼‰\n            const repeatTableHeader = mergedPdfOptions.repeatTableHeader !== false; // é»˜è®¤ä¸ºtrue\n            if (repeatTableHeader && page > 0 && headerRowCount > 0) {\n              // åœ¨éé¦–é¡µæ·»åŠ è¡¨æ ¼æ ‡é¢˜è¡Œ\n              try {\n                console.log(`ğŸ“„ ç¬¬${page + 1}é¡µæ·»åŠ è¡¨æ ¼æ ‡é¢˜è¡Œ`);\n\n                // åˆ›å»ºåªåŒ…å«è¡¨å¤´çš„ä¸´æ—¶canvasï¼ˆç²¾ç¡®æ§åˆ¶ï¼‰\n                const headerOnlyCanvas = document.createElement('canvas');\n                headerOnlyCanvas.width = tableCanvas.width;\n\n                // ç²¾ç¡®è®¡ç®—è¡¨å¤´é«˜åº¦\n                const headerHeightInCanvas = (headerRowCount / totalRows) * tableCanvas.height;\n                headerOnlyCanvas.height = Math.ceil(headerHeightInCanvas);\n\n                const headerCtx = headerOnlyCanvas.getContext('2d');\n                if (headerCtx) {\n                  // è®¾ç½®ç™½è‰²èƒŒæ™¯\n                  headerCtx.fillStyle = '#ffffff';\n                  headerCtx.fillRect(0, 0, headerOnlyCanvas.width, headerOnlyCanvas.height);\n\n                  // ä»åŸè¡¨æ ¼canvasä¸­ç²¾ç¡®å¤åˆ¶è¡¨å¤´éƒ¨åˆ†\n                  headerCtx.drawImage(\n                    tableCanvas,\n                    0, 0, tableCanvas.width, headerHeightInCanvas,\n                    0, 0, headerOnlyCanvas.width, headerOnlyCanvas.height\n                  );\n\n                  // è®¡ç®—è¡¨å¤´åœ¨PDFä¸­çš„é«˜åº¦\n                  const headerHeightInPDF = (headerOnlyCanvas.height / tableCanvas.height) * tableHeight;\n\n                  // å°†è¡¨å¤´æ·»åŠ åˆ°PDF\n                  const headerImgData = headerOnlyCanvas.toDataURL('image/jpeg', quality);\n                  pdf.addImage(\n                    headerImgData,\n                    'JPEG',\n                    margins.left,\n                    yOffset,\n                    contentWidth,\n                    headerHeightInPDF\n                  );\n\n                  yOffset += headerHeightInPDF; // ä¸æ·»åŠ é¢å¤–é—´è·ï¼Œç¡®ä¿ä¸æ•°æ®è¡Œç´§å¯†è¿æ¥\n                  console.log(`ğŸ“„ ç¬¬${page + 1}é¡µè¡¨æ ¼æ ‡é¢˜è¡Œæ·»åŠ å®Œæˆï¼Œé«˜åº¦ï¼š${Math.round(headerHeightInPDF)}mm`);\n                }\n              } catch (e) {\n                console.warn(`ç¬¬${page + 1}é¡µæ·»åŠ è¡¨æ ¼æ ‡é¢˜è¡Œå¤±è´¥:`, e);\n              }\n            }\n\n            // è®¡ç®—å½“å‰é¡µè¡¨æ ¼éƒ¨åˆ†çš„èµ·å§‹ä½ç½®å’Œç»“æŸä½ç½®\n            let tableStartPercent = 0;\n            let tableEndPercent = 1;\n\n            // æ ¹æ®åˆ†é¡µç‚¹è®¡ç®—æ¯é¡µå†…å®¹èŒƒå›´\n            if (pageBreakPoints.length > 0) {\n              if (page === 0) {\n                // ç¬¬ä¸€é¡µï¼šä»å¼€å§‹åˆ°ç¬¬ä¸€ä¸ªåˆ†é¡µç‚¹\n                tableStartPercent = 0;\n                tableEndPercent = pageBreakPoints[0].yPercent;\n\n                const endRow = pageBreakPoints[0].endRow;\n                console.log(`ğŸ“„ ç¬¬1é¡µï¼šæ˜¾ç¤ºè¡¨å¤´+ç¬¬1-${endRow}è¡Œï¼ŒYèŒƒå›´ï¼š0% åˆ° ${Math.round(pageBreakPoints[0].yPercent * 100)}%`);\n              } else {\n                // åç»­é¡µï¼šä»å‰ä¸€ä¸ªåˆ†é¡µç‚¹åˆ°å½“å‰åˆ†é¡µç‚¹ï¼ˆæˆ–ç»“æŸï¼‰\n                tableStartPercent = pageBreakPoints[page - 1].yPercent;\n                tableEndPercent = page < pageBreakPoints.length ? pageBreakPoints[page].yPercent : 1;\n\n                const startRow = pageBreakPoints[page - 1].endRow + 1;\n                const endRow = page < pageBreakPoints.length ? pageBreakPoints[page].endRow : dataRowCount;\n                console.log(`ğŸ“„ ç¬¬${page + 1}é¡µï¼šæ˜¾ç¤ºç¬¬${startRow}-${endRow}è¡Œï¼ŒYèŒƒå›´ï¼š${Math.round(tableStartPercent * 100)}% åˆ° ${Math.round(tableEndPercent * 100)}%`);\n              }\n            } else {\n              // å•é¡µæ˜¾ç¤ºæ‰€æœ‰å†…å®¹\n              console.log(`ğŸ“„ ç¬¬${page + 1}é¡µï¼šæ˜¾ç¤ºæ‰€æœ‰å†…å®¹ï¼ˆå•é¡µæ¨¡å¼ï¼‰`);\n            }\n\n            // æ ¹æ®åˆ†é¡µè®¡ç®—ç²¾ç¡®è£å‰ªæºå›¾åƒ\n            let sourceY: number;\n            let sourceHeight: number;\n            let tablePartHeight: number;\n\n            if (pageBreakPoints.length > 0) {\n              // å¤šé¡µæ¨¡å¼ï¼šåŸºäºè¡Œè¾¹ç•Œè¿›è¡Œç²¾ç¡®è£å‰ª\n              if (page === 0) {\n                // ç¬¬ä¸€é¡µï¼šä»é¡¶éƒ¨å¼€å§‹åˆ°ç¬¬ä¸€ä¸ªåˆ†é¡µç‚¹\n                const endRow = pageBreakPoints[0].endRow;\n                sourceY = 0; // ä»è¡¨å¤´å¼€å§‹\n\n                // åŸºäºè¡Œè¾¹ç•Œè®¡ç®—ï¼šè¡¨å¤´ + æŒ‡å®šè¡Œæ•°çš„æ•°æ®\n                const headerRowHeightCanvas = (headerRowCount / totalRows) * tableCanvas.height;\n                const dataRowHeightCanvas = tableCanvas.height / totalRows; // å•è¡Œåœ¨Canvasä¸­çš„é«˜åº¦\n                const endRowHeightCanvas = headerRowHeightCanvas + (endRow * dataRowHeightCanvas);\n\n                sourceHeight = Math.floor(endRowHeightCanvas);\n                tablePartHeight = (sourceHeight / tableCanvas.height) * tableHeight;\n\n                console.log(`ğŸ“ ç¬¬1é¡µè¡Œè¾¹ç•Œè£å‰ªï¼šè¡¨å¤´${headerRowCount}è¡Œ+æ•°æ®${endRow}è¡Œï¼ŒCanvasé«˜åº¦=${Math.round(sourceHeight)}pxï¼ŒPDFé«˜åº¦=${Math.round(tablePartHeight)}mm`);\n              } else {\n                // åç»­é¡µï¼šåªè£å‰ªæ•°æ®è¡Œéƒ¨åˆ†ï¼ˆè¡¨å¤´å·²å•ç‹¬æ·»åŠ ï¼‰\n                const startRow = pageBreakPoints[page - 1].endRow;\n                const endRow = page < pageBreakPoints.length ? pageBreakPoints[page].endRow : dataRowCount;\n                const rowsThisPage = endRow - startRow;\n\n                console.log(`ğŸ“ ç¬¬${page + 1}é¡µæ•°æ®è¡Œï¼šç¬¬${startRow + 1}-${endRow}è¡Œï¼ˆ${rowsThisPage}è¡Œï¼‰`);\n\n                // è®¡ç®—æ•°æ®è¡Œçš„è£å‰ªèŒƒå›´ï¼ˆä¸åŒ…å«è¡¨å¤´ï¼‰\n                const headerRowHeightCanvas = (headerRowCount / totalRows) * tableCanvas.height;\n                const dataRowHeightCanvas = tableCanvas.height / totalRows;\n\n                // ä»æ•°æ®è¡Œå¼€å§‹è£å‰ªï¼Œä¸åŒ…å«è¡¨å¤´ï¼Œç²¾ç¡®è®¡ç®—é¿å…å¤šä½™å†…å®¹\n                const startRowHeightCanvas = headerRowHeightCanvas + (startRow * dataRowHeightCanvas);\n                const endRowHeightCanvas = headerRowHeightCanvas + (endRow * dataRowHeightCanvas);\n\n                // æ›´ç²¾ç¡®çš„è£å‰ªä½ç½®è®¡ç®—\n                if (startRow === 0) {\n                  // å¦‚æœæ˜¯ç¬¬ä¸€æ‰¹æ•°æ®è¡Œï¼Œä»è¡¨å¤´ç»“æŸä½ç½®å¼€å§‹ï¼Œä½†è¦åŒ…å«ç¬¬ä¸€è¡Œçš„å®Œæ•´ä¸Šè¾¹æ¡†\n                  sourceY = Math.floor(headerRowHeightCanvas - 1); // å‘å‰åŒ…å«1pxç¡®ä¿è¾¹æ¡†å®Œæ•´\n                } else {\n                  // éç¬¬ä¸€æ‰¹æ•°æ®è¡Œï¼Œç²¾ç¡®ä»è¡Œå¼€å§‹ä½ç½®è£å‰ª\n                  sourceY = Math.floor(startRowHeightCanvas);\n                }\n\n                // ç²¾ç¡®è®¡ç®—ç»“æŸä½ç½®ï¼Œé¿å…åŒ…å«å¤šä½™çš„ç«–çº¿\n                const endY = Math.floor(endRowHeightCanvas); // ç²¾ç¡®åˆ°è¡Œç»“æŸä½ç½®ï¼Œä¸åŒ…å«é¢å¤–å†…å®¹\n                sourceHeight = Math.min(endY - sourceY, tableCanvas.height - sourceY);\n                tablePartHeight = (sourceHeight / tableCanvas.height) * tableHeight;\n\n                console.log(`ğŸ“ ç¬¬${page + 1}é¡µæ•°æ®è¡Œè£å‰ªï¼šç¬¬${startRow + 1}-${endRow}è¡Œï¼ŒCanvasèŒƒå›´=${Math.round(sourceY)}-${Math.round(sourceY + sourceHeight)}pxï¼ŒPDFé«˜åº¦=${Math.round(tablePartHeight)}mm`);\n              }\n            } else {\n              // å•é¡µæ¨¡å¼ï¼šä½¿ç”¨åŸæœ‰é€»è¾‘\n              sourceY = Math.floor(tableStartPercent * tableCanvas.height);\n              sourceHeight = Math.ceil((tableEndPercent - tableStartPercent) * tableCanvas.height);\n              tablePartHeight = (sourceHeight / tableCanvas.height) * tableHeight;\n\n              console.log(`ğŸ“ å•é¡µæ¨¡å¼ï¼šæºé«˜åº¦=${Math.round(sourceHeight)}pxï¼Œç›®æ ‡é«˜åº¦=${Math.round(tablePartHeight)}mm`);\n            }\n\n            // éªŒè¯å¯ç”¨ç©ºé—´å¹¶åŠ¨æ€è°ƒæ•´ï¼ˆæ›´æ™ºèƒ½çš„ç©ºé—´åˆ©ç”¨ï¼‰\n            const maxAllowedHeight = pageHeight - yOffset - margins.bottom - pageNumberReserve;\n\n            if (tablePartHeight > maxAllowedHeight) {\n              console.warn(`âš ï¸ ç¬¬${page + 1}é¡µå†…å®¹é«˜åº¦${Math.round(tablePartHeight)}mmè¶…å‡ºå¯ç”¨ç©ºé—´${Math.round(maxAllowedHeight)}mm`);\n              // åŠ¨æ€è°ƒæ•´ï¼šå¦‚æœè¶…å‡ºä¸å¤šï¼Œå¯ä»¥å‹ç¼©é¡µç é¢„ç•™ç©ºé—´\n              const overflow = tablePartHeight - maxAllowedHeight;\n              if (overflow <= 8) { // å¦‚æœè¶…å‡ºä¸è¶…è¿‡8mmï¼Œå¯ä»¥å‹ç¼©é¡µç ç©ºé—´\n                console.log(`ğŸ“ åŠ¨æ€è°ƒæ•´ï¼šå‹ç¼©é¡µç é¢„ç•™ç©ºé—´${Math.round(overflow)}mm`);\n                // ç»§ç»­ä½¿ç”¨åŸå§‹é«˜åº¦ï¼Œé¡µç ä½ç½®ä¼šè‡ªåŠ¨è°ƒæ•´\n              }\n            }\n\n            try {\n              // åˆ›å»ºä¸´æ—¶canvasæ¥ä¿å­˜è£å‰ªçš„è¡¨æ ¼éƒ¨åˆ†\n              const pageTableCanvas = document.createElement('canvas');\n              pageTableCanvas.width = tableCanvas.width;\n              pageTableCanvas.height = sourceHeight;\n\n              const pageTableCtx = pageTableCanvas.getContext('2d');\n              if (pageTableCtx) {\n                // è®¾ç½®ç™½è‰²èƒŒæ™¯\n                pageTableCtx.fillStyle = '#ffffff';\n                pageTableCtx.fillRect(0, 0, pageTableCanvas.width, pageTableCanvas.height);\n\n                // å°†è¡¨æ ¼å¯¹åº”éƒ¨åˆ†è£å‰ªåˆ°æ–°canvas\n                pageTableCtx.drawImage(\n                  tableCanvas,\n                  0, sourceY, tableCanvas.width, sourceHeight,\n                  0, 0, pageTableCanvas.width, pageTableCanvas.height\n                );\n\n                // å¦‚æœæ˜¯éé¦–é¡µä¸”æ²¡æœ‰è¡¨å¤´ï¼Œéœ€è¦åœ¨é¡¶éƒ¨æ·»åŠ è¾¹æ¡†çº¿\n                if (page > 0 && (!repeatTableHeader || headerRowCount === 0)) {\n                  // åœ¨æ•°æ®è¡Œé¡¶éƒ¨ç»˜åˆ¶è¾¹æ¡†çº¿ï¼Œè¡¥å……è¢«è£å‰ªæ‰çš„ä¸Šè¾¹æ¡†\n                  pageTableCtx.strokeStyle = '#ddd';\n                  pageTableCtx.lineWidth = 1;\n                  pageTableCtx.beginPath();\n                  pageTableCtx.moveTo(0, 0.5);\n                  pageTableCtx.lineTo(pageTableCanvas.width, 0.5);\n                  pageTableCtx.stroke();\n                  console.log(`ğŸ“„ ç¬¬${page + 1}é¡µæ·»åŠ é¡¶éƒ¨è¾¹æ¡†çº¿ï¼ˆæ— è¡¨å¤´æ¨¡å¼ï¼‰`);\n                }\n\n                // å°†è£å‰ªåçš„è¡¨æ ¼éƒ¨åˆ†è½¬æ¢ä¸ºå›¾åƒæ•°æ®\n                const pageTableImgData = pageTableCanvas.toDataURL('image/jpeg', quality);\n\n                // æ·»åŠ è£å‰ªåçš„è¡¨æ ¼éƒ¨åˆ†\n                pdf.addImage(\n                  pageTableImgData,\n                  'JPEG',\n                  margins.left,\n                  yOffset,\n                  contentWidth,\n                  tablePartHeight\n                );\n\n                yOffset += tablePartHeight;\n              }\n            } catch (e) {\n              console.warn('å¤„ç†è¡¨æ ¼é¡µç æ—¶å‡ºé”™:', e);\n            }\n\n            // æ·»åŠ é¡µç ï¼ˆå¦‚æœé¡µæ•°å¤§äº1ï¼‰\n            if (pagesNeeded > 1) {\n              // ä½¿ç”¨è‹±æ–‡æ ¼å¼é¡µç ï¼Œé¿å…ä¸­æ–‡ä¹±ç é—®é¢˜\n              try {\n                pdf.setFontSize(10);\n                pdf.setTextColor(80, 80, 80);\n\n                // æ™ºèƒ½é¡µç ä½ç½®ï¼šæ ¹æ®å†…å®¹é«˜åº¦åŠ¨æ€è°ƒæ•´\n                const contentBottom = yOffset;\n                const minPageNumberY = contentBottom + 5; // å†…å®¹ä¸‹æ–¹è‡³å°‘5mm\n                const maxPageNumberY = pageHeight - margins.bottom + 3; // åœ¨åº•éƒ¨è¾¹è·å†…\n                const pageNumberY = Math.min(maxPageNumberY, Math.max(minPageNumberY, pageHeight - 8));\n\n                pdf.text(\n                  `Page ${page + 1} / ${pagesNeeded}`,\n                  pageWidth / 2,\n                  pageNumberY,\n                  { align: 'center' }\n                );\n\n                console.log(`ç¬¬${page + 1}é¡µæ·»åŠ é¡µç ï¼Œå†…å®¹åº•éƒ¨ï¼š${Math.round(contentBottom)}mmï¼Œé¡µç ä½ç½®ï¼šY=${Math.round(pageNumberY)}mm`);\n              } catch (e) {\n                console.warn('é¡µç æ¸²æŸ“å¤±è´¥:', e);\n              }\n            }\n\n            // æ·»åŠ è¡¨å°¾ï¼ˆåªåœ¨æœ€åä¸€é¡µæ˜¾ç¤ºï¼‰\n            if (footerImgData && page === pagesNeeded - 1) {\n              // è®¡ç®—è¡¨å°¾ä½ç½®ï¼Œç¡®ä¿ä¸è¦†ç›–è¡¨æ ¼å†…å®¹å’Œé¡µç \n              const minFooterY = yOffset; // è¡¨æ ¼å†…å®¹ä¸‹æ–¹æ— é—´è·ï¼Œå®ç°æ— ç¼è¿æ¥\n              const maxFooterY = pageHeight - margins.bottom - pageNumberReserve - footerHeight; // è€ƒè™‘é¡µç ç©ºé—´\n\n              const footerY = Math.max(minFooterY, maxFooterY);\n\n              // å¦‚æœå½“å‰é¡µæ²¡æœ‰è¶³å¤Ÿç©ºé—´æ˜¾ç¤ºè¡¨å°¾ï¼Œåˆ™åˆ›å»ºæ–°é¡µ\n              if (footerY + footerHeight > pageHeight - margins.bottom - pageNumberReserve) {\n                console.log(`ğŸ“„ è¡¨å°¾éœ€è¦æ–°é¡µæ˜¾ç¤ºï¼Œå½“å‰é¡µå‰©ä½™ç©ºé—´ä¸è¶³`);\n                pdf.addPage();\n\n                // åœ¨æ–°é¡µæ·»åŠ è¡¨å°¾\n                pdf.addImage(\n                  footerImgData,\n                  'JPEG',\n                  margins.left,\n                  margins.top,\n                  contentWidth,\n                  footerHeight\n                );\n\n                // åœ¨æ–°é¡µæ·»åŠ é¡µç \n                if (pagesNeeded > 1) {\n                  const newPageNumber = pagesNeeded + 1; // æ–°å¢çš„è¡¨å°¾é¡µ\n                  pdf.setFontSize(10);\n                  pdf.setTextColor(80, 80, 80);\n                  const pageNumberY = pageHeight - margins.bottom + 3;\n                  pdf.text(\n                    `Page ${newPageNumber} / ${newPageNumber}`,\n                    pageWidth / 2,\n                    pageNumberY,\n                    { align: 'center' }\n                  );\n                }\n\n                // åœ¨æ–°é¡µæ·»åŠ æ°´å°\n                if (finalWatermark) {\n                  try {\n                    const watermarkCanvas = document.createElement('canvas');\n                    watermarkCanvas.width = 400;\n                    watermarkCanvas.height = 100;\n                    const ctx = watermarkCanvas.getContext('2d');\n\n                    if (ctx) {\n                      ctx.font = '40px Arial, sans-serif';\n                      ctx.fillStyle = 'rgba(200, 200, 200, 0.3)';\n                      ctx.textAlign = 'center';\n                      ctx.textBaseline = 'middle';\n                      ctx.translate(200, 50);\n                      ctx.rotate(45 * Math.PI / 180);\n                      ctx.fillText(finalWatermark, 0, 0);\n\n                      const watermarkImgData = watermarkCanvas.toDataURL('image/png');\n                      pdf.addImage(\n                        watermarkImgData,\n                        'PNG',\n                        pageWidth / 2 - 50,\n                        pageHeight / 2 - 12.5,\n                        100,\n                        25,\n                        undefined,\n                        'NONE'\n                      );\n                    }\n                  } catch (e) {\n                    console.warn('æ–°é¡µæ°´å°æ·»åŠ å¤±è´¥:', e);\n                  }\n                }\n              } else {\n                // åœ¨å½“å‰é¡µæ·»åŠ è¡¨å°¾\n                console.log(`ğŸ“„ åœ¨ç¬¬${page + 1}é¡µæ·»åŠ è¡¨å°¾ï¼Œä½ç½®ï¼šY=${Math.round(footerY)}mm`);\n                pdf.addImage(\n                  footerImgData,\n                  'JPEG',\n                  margins.left,\n                  footerY,\n                  contentWidth,\n                  footerHeight\n                );\n              }\n            }\n\n            // åœ¨æ¯é¡µæ·»åŠ æ°´å° - æ”¹è¿›ç‰ˆï¼šå…¨é¡µé¢å¹³é“ºæ°´å°\n            if (finalWatermark) {\n              try {\n                console.log(`ç¬¬${page + 1}é¡µå¼€å§‹æ·»åŠ å…¨é¡µé¢æ°´å°: \"${finalWatermark}\"`);\n\n                // åˆ›å»ºå…¨é¡µé¢æ°´å°Canvas\n                const watermarkCanvas = document.createElement('canvas');\n\n                // æ ¹æ®PDFé¡µé¢å°ºå¯¸è®¾ç½®Canvaså°ºå¯¸ï¼ˆæé«˜åˆ†è¾¨ç‡ï¼‰\n                const scale = 2; // æé«˜æ¸…æ™°åº¦\n                watermarkCanvas.width = pageWidth * scale * 4; // è½¬æ¢ä¸ºåƒç´ å¹¶æ”¾å¤§\n                watermarkCanvas.height = pageHeight * scale * 4;\n\n                const ctx = watermarkCanvas.getContext('2d');\n                if (!ctx) {\n                  throw new Error('æ— æ³•åˆ›å»ºcanvasä¸Šä¸‹æ–‡');\n                }\n\n                // è®¾ç½®é€æ˜èƒŒæ™¯\n                ctx.clearRect(0, 0, watermarkCanvas.width, watermarkCanvas.height);\n\n                // è®¡ç®—æ°´å°æ–‡å­—çš„åˆé€‚å¤§å°\n                const textLength = finalWatermark.length;\n                let fontSize = Math.max(24, Math.min(48, 600 / textLength)); // æ ¹æ®æ–‡å­—é•¿åº¦åŠ¨æ€è°ƒæ•´å­—ä½“å¤§å°\n                ctx.font = `${fontSize}px Arial, sans-serif`;\n                ctx.fillStyle = 'rgba(180, 180, 180, 0.15)'; // æ›´æ·¡çš„æ°´å°\n                ctx.textAlign = 'center';\n                ctx.textBaseline = 'middle';\n\n                // æµ‹é‡æ–‡å­—å°ºå¯¸\n                const textMetrics = ctx.measureText(finalWatermark);\n                const textWidth = textMetrics.width;\n                const textHeight = fontSize;\n\n                // è®¡ç®—å¹³é“ºé—´è·ï¼ˆç¡®ä¿æ°´å°ä¸ä¼šé‡å ä¸”è¦†ç›–æ•´ä¸ªé¡µé¢ï¼‰\n                const spacingX = textWidth * 1.8; // æ°´å¹³é—´è·\n                const spacingY = textHeight * 4.5; // å‚ç›´é—´è· - å¢åŠ ä¸Šä¸‹é—´è·\n\n                // è®¡ç®—éœ€è¦çš„è¡Œåˆ—æ•°ï¼ˆç¡®ä¿å®Œå…¨è¦†ç›–é¡µé¢ï¼‰\n                const cols = Math.ceil(watermarkCanvas.width / spacingX) + 2;\n                const rows = Math.ceil(watermarkCanvas.height / spacingY) + 2;\n\n                console.log(`æ°´å°å‚æ•°: å­—ä½“${fontSize}px, æ–‡å­—å®½åº¦${Math.round(textWidth)}px, é—´è·${Math.round(spacingX)}x${Math.round(spacingY)}px, ç½‘æ ¼${cols}x${rows}`);\n\n                // å¹³é“ºç»˜åˆ¶æ°´å°\n                for (let row = 0; row < rows; row++) {\n                  for (let col = 0; col < cols; col++) {\n                    ctx.save();\n\n                    // è®¡ç®—å½“å‰æ°´å°ä½ç½®\n                    const x = (col * spacingX) - spacingX / 2;\n                    const y = (row * spacingY) - spacingY / 2;\n\n                    // ç§»åŠ¨åˆ°æ°´å°ä½ç½®\n                    ctx.translate(x, y);\n\n                    // æ—‹è½¬45åº¦\n                    ctx.rotate(45 * Math.PI / 180);\n\n                    // ç»˜åˆ¶æ°´å°æ–‡å­—\n                    ctx.fillText(finalWatermark, 0, 0);\n\n                    ctx.restore();\n                  }\n                }\n\n                // å°†canvasè½¬æ¢ä¸ºå›¾åƒ\n                const watermarkImgData = watermarkCanvas.toDataURL('image/png');\n\n                // æ·»åŠ æ°´å°å›¾åƒåˆ°PDFï¼ˆè¦†ç›–æ•´ä¸ªé¡µé¢ï¼‰\n                pdf.addImage(\n                  watermarkImgData,\n                  'PNG',\n                  0, // ä»é¡µé¢å·¦ä¸Šè§’å¼€å§‹\n                  0,\n                  pageWidth, // è¦†ç›–æ•´ä¸ªé¡µé¢å®½åº¦\n                  pageHeight, // è¦†ç›–æ•´ä¸ªé¡µé¢é«˜åº¦\n                  undefined,\n                  'NONE'\n                );\n\n                console.log(`ç¬¬${page + 1}é¡µæˆåŠŸæ·»åŠ å…¨é¡µé¢å¹³é“ºæ°´å°`);\n\n              } catch (watermarkError) {\n                console.warn(`ç¬¬${page + 1}é¡µæ·»åŠ æ°´å°å¤±è´¥ï¼Œå°è¯•ç®€åŒ–æ°´å°:`, watermarkError);\n\n                // é™çº§æ–¹æ¡ˆï¼šä½¿ç”¨PDFåŸç”Ÿæ–‡å­—æ°´å°\n                try {\n                  pdf.setTextColor(200, 200, 200);\n                  pdf.setFontSize(30);\n\n                  // åœ¨é¡µé¢ä¸­å¿ƒæ·»åŠ å•ä¸ªæ°´å°\n                  const centerX = pageWidth / 2;\n                  const centerY = pageHeight / 2;\n\n                  pdf.text(finalWatermark, centerX, centerY, {\n                    align: 'center',\n                    baseline: 'middle',\n                    angle: 45\n                  });\n\n                  console.log(`ç¬¬${page + 1}é¡µæ·»åŠ ç®€åŒ–æ°´å°: \"${finalWatermark}\"`);\n                } catch (fallbackError) {\n                  console.warn(`ç¬¬${page + 1}é¡µç®€åŒ–æ°´å°ä¹Ÿå¤±è´¥:`, fallbackError);\n                }\n              }\n            }\n\n            // æ³¨æ„ï¼šæ–°é¡µçš„æ·»åŠ å·²ç»åœ¨å¾ªç¯å¼€å§‹æ—¶å¤„ç†äº†ï¼Œè¿™é‡Œä¸éœ€è¦é‡å¤æ·»åŠ \n          }\n        } catch (e) {\n          console.warn('å¤„ç†è¡¨æ ¼æ—¶å‡ºé”™:', e);\n          // é™çº§å¤„ç†ï¼šä½¿ç”¨html2canvaså¯¹æ•´ä¸ªå…ƒç´ æˆªå›¾\n          const canvas = await html2canvas(tempContainer, {\n            scale: 1.5,\n            useCORS: true,\n            logging: false,\n            allowTaint: true,\n            backgroundColor: '#FFFFFF'\n          });\n\n          const imgData = canvas.toDataURL('image/jpeg', quality);\n\n          // è®¡ç®—ç­‰æ¯”ä¾‹ç¼©æ”¾å°ºå¯¸\n          const canvasAspectRatio = canvas.width / canvas.height;\n          const pageAspectRatio = contentWidth / contentHeight;\n\n          let imgWidth, imgHeight;\n\n          if (relayout) {\n            // é‡æ–°æ’ç‰ˆæ¨¡å¼ï¼šä½¿ç”¨å†…å®¹åŒºåŸŸçš„å®Œæ•´å®½åº¦\n            imgWidth = contentWidth;\n            imgHeight = (canvas.height / canvas.width) * imgWidth;\n            console.log('é‡æ–°æ’ç‰ˆæ¨¡å¼ - å›¾åƒå°ºå¯¸:', { imgWidth, imgHeight });\n          } else {\n            // ç¼©æ”¾æ¨¡å¼ï¼šç­‰æ¯”ä¾‹ç¼©æ”¾ä»¥é€‚åº”é¡µé¢\n            if (canvasAspectRatio > pageAspectRatio) {\n              // å›¾åƒæ›´å®½ï¼Œä»¥å®½åº¦ä¸ºå‡†\n              imgWidth = contentWidth;\n              imgHeight = imgWidth / canvasAspectRatio;\n            } else {\n              // å›¾åƒæ›´é«˜ï¼Œä»¥é«˜åº¦ä¸ºå‡†\n              imgHeight = contentHeight;\n              imgWidth = imgHeight * canvasAspectRatio;\n            }\n            console.log('ç¼©æ”¾æ¨¡å¼ - ç­‰æ¯”ä¾‹ç¼©æ”¾å›¾åƒå°ºå¯¸:', { imgWidth, imgHeight, canvasAspectRatio, pageAspectRatio });\n          }\n\n          pdf.addImage(imgData, 'JPEG', margins.left, margins.top, imgWidth, imgHeight);\n        }\n      }\n\n      // æ°´å°å·²åœ¨æ¯é¡µå¾ªç¯ä¸­æ·»åŠ \n\n      // æ¸…ç†ä¸´æ—¶å…ƒç´ \n      document.body.removeChild(tempContainer);\n\n      // æ¢å¤åŸå§‹æ»šåŠ¨ä½ç½®\n      element.scrollTop = originalScrollTop;\n\n      // ä¿å­˜æ–‡ä»¶\n      pdf.save(`${fileName}.pdf`);\n\n      return Promise.resolve();\n    } catch (error) {\n      console.error('PDFå¯¼å‡ºå¤±è´¥:', error);\n      return Promise.reject(error);\n    }\n  }\n\n  /**\n   * æ‰“å°åŠŸèƒ½ - é‡ç”¨PDFç»˜åˆ¶é€»è¾‘\n   * @param element è¦æ‰“å°çš„DOMå…ƒç´ \n   * @param config æŠ¥è¡¨é…ç½®\n   * @param options æ‰“å°é€‰é¡¹\n   */\n  static async toPrint(element: HTMLElement, config?: any, options: ExportOptions = {}): Promise<void> {\n    try {\n      console.log('å¼€å§‹æ‰“å°ï¼Œé‡ç”¨PDFç»˜åˆ¶é€»è¾‘');\n\n      // ä½¿ç”¨ä¸PDFç›¸åŒçš„å¤„ç†é€»è¾‘ï¼Œä½†ç”ŸæˆHTMLè€Œä¸æ˜¯PDF\n      const {\n        watermark,\n        pdf: pdfOptions = {}\n      } = options;\n\n      // ä»é…ç½®ä¸­è·å–PDFè®¾ç½®\n      const configPdfSettings = config?.features?.pdfConfig || {};\n      const mergedPdfOptions = { ...configPdfSettings, ...pdfOptions };\n\n      // æ°´å°å¤„ç†\n      const finalWatermark = watermark !== undefined ? watermark : (config?.features?.watermark || '');\n\n      // æ‰“å°é…ç½® - ä½¿ç”¨A4çº¸å¼ è®¾ç½®\n      const orientation = mergedPdfOptions.orientation || 'portrait';\n      const pageSize = mergedPdfOptions.pageSize || 'A4';\n\n      console.log(`æ‰“å°è®¾ç½® - é¡µé¢å¤§å°: ${pageSize}, æ–¹å‘: ${orientation}`);\n\n      // åˆ›å»ºæ‰“å°ä¸“ç”¨çš„ä¸´æ—¶å®¹å™¨\n      const printContainer = await this._createPrintContainer(element, config, mergedPdfOptions, finalWatermark);\n\n      // åˆ›å»ºæ‰“å°æ ·å¼\n      const printStyle = this._createPrintStyle(orientation, pageSize);\n\n      // æ·»åŠ æ ·å¼åˆ°é¡µé¢\n      document.head.appendChild(printStyle);\n\n      // å°†æ‰“å°å®¹å™¨æ·»åŠ åˆ°é¡µé¢ï¼ˆéšè—ï¼‰\n      printContainer.style.position = 'fixed';\n      printContainer.style.left = '-9999px';\n      printContainer.style.top = '0';\n      printContainer.style.zIndex = '9999';\n      document.body.appendChild(printContainer);\n\n      // ç­‰å¾…å†…å®¹æ¸²æŸ“å®Œæˆ\n      await new Promise(resolve => setTimeout(resolve, 100));\n\n      // æ˜¾ç¤ºæ‰“å°å®¹å™¨å¹¶éšè—å…¶ä»–å†…å®¹\n      printContainer.style.left = '0';\n      printContainer.style.position = 'absolute';\n\n      // éšè—åŸå§‹å†…å®¹\n      const originalElements = document.querySelectorAll('body > *:not(.ddr-print-container)');\n      originalElements.forEach(el => {\n        (el as HTMLElement).style.display = 'none';\n      });\n\n      // æ‰§è¡Œæ‰“å°\n      window.print();\n\n      // æ¸…ç†ï¼šæ¢å¤åŸå§‹å†…å®¹å¹¶ç§»é™¤æ‰“å°å®¹å™¨å’Œæ°´å°\n      setTimeout(() => {\n        originalElements.forEach(el => {\n          (el as HTMLElement).style.display = '';\n        });\n        document.body.removeChild(printContainer);\n        document.head.removeChild(printStyle);\n\n        // æ¸…ç†æ‰“å°æ°´å°\n        const printWatermarks = document.querySelectorAll('[data-ddr-print-watermark=\"true\"]');\n        printWatermarks.forEach(wm => wm.remove());\n      }, 100);\n\n      console.log('æ‰“å°å®Œæˆ');\n      return Promise.resolve();\n\n    } catch (error) {\n      console.error('æ‰“å°å¤±è´¥:', error);\n      return Promise.reject(error);\n    }\n  }\n\n  /**\n   * åˆ›å»ºæ‰“å°ä¸“ç”¨å®¹å™¨\n   */\n  private static async _createPrintContainer(\n    element: HTMLElement,\n    config: any,\n    pdfOptions: any,\n    watermark: string\n  ): Promise<HTMLElement> {\n    // å…‹éš†åŸå§‹å…ƒç´ \n    const printContainer = element.cloneNode(true) as HTMLElement;\n    printContainer.className = 'ddr-print-container';\n\n    // è®¾ç½®æ‰“å°å®¹å™¨æ ·å¼\n    printContainer.style.width = '100%';\n    printContainer.style.height = 'auto';\n    printContainer.style.overflow = 'visible';\n    printContainer.style.backgroundColor = '#ffffff';\n    printContainer.style.color = '#000000';\n\n    // ç§»é™¤æ‰€æœ‰åŸå§‹æ°´å°ï¼ˆåŒ…æ‹¬æŠ¥è¡¨å¤´ã€æŠ¥è¡¨å°¾ä¸­çš„æ°´å°ï¼‰\n    const existingWatermarks = printContainer.querySelectorAll('.ddr-watermark, .ddr-watermark-content');\n    existingWatermarks.forEach(wm => wm.remove());\n\n    // ç§»é™¤æŠ¥è¡¨å¤´å’ŒæŠ¥è¡¨å°¾ä¸­å¯èƒ½å­˜åœ¨çš„æ°´å°æ ·å¼\n    const headerFooterElements = printContainer.querySelectorAll('.ddr-report-header, .ddr-report-footer');\n    headerFooterElements.forEach(element => {\n      // ç§»é™¤èƒŒæ™¯æ°´å°æ ·å¼\n      const el = element as HTMLElement;\n      el.style.backgroundImage = 'none';\n      el.style.background = 'none';\n\n      // ç§»é™¤å†…éƒ¨çš„æ°´å°å…ƒç´ \n      const innerWatermarks = el.querySelectorAll('[class*=\"watermark\"]');\n      innerWatermarks.forEach(wm => wm.remove());\n    });\n\n    // é‡ç”¨PDFçš„åˆ—å®½é‡åˆ¶é€»è¾‘\n    await this._applyPrintTableLayout(printContainer, config, pdfOptions);\n\n    // ä¼˜åŒ–è¡¨å¤´å’Œè¡¨å°¾\n    const headerElement = printContainer.querySelector('.ddr-report-header') as HTMLElement;\n    if (headerElement) {\n      headerElement.style.pageBreakInside = 'avoid';\n      headerElement.style.marginBottom = '20px';\n    }\n\n    const footerElement = printContainer.querySelector('.ddr-report-footer') as HTMLElement;\n    if (footerElement) {\n      footerElement.style.pageBreakInside = 'avoid';\n      footerElement.style.marginTop = '20px';\n    }\n\n    // æ·»åŠ ç»Ÿä¸€çš„å…¨é¡µé¢æ°´å°\n    if (watermark) {\n      this._addPrintWatermark(printContainer, watermark);\n    }\n\n    return printContainer;\n  }\n\n  /**\n   * åº”ç”¨æ‰“å°è¡¨æ ¼å¸ƒå±€ - é‡ç”¨PDFçš„åˆ—å®½é€»è¾‘\n   */\n  private static async _applyPrintTableLayout(\n    container: HTMLElement,\n    config: any,\n    pdfOptions: any\n  ): Promise<void> {\n    const tableContainer = container.querySelector('.ddr-table-container') as HTMLElement;\n    if (!tableContainer) return;\n\n    tableContainer.style.maxHeight = 'none';\n    tableContainer.style.height = 'auto';\n    tableContainer.style.overflow = 'visible';\n\n    const tableElement = tableContainer.querySelector('table');\n    if (!tableElement) return;\n\n    // è·å–é¡µé¢æ–¹å‘å’Œçº¸å¼ å¤§å°\n    const orientation = pdfOptions.orientation || 'portrait';\n    const pageSize = pdfOptions.pageSize || 'A4';\n\n    console.log(`ğŸ–¨ï¸ åº”ç”¨æ‰“å°è¡¨æ ¼å¸ƒå±€ï¼š${pageSize} ${orientation}`);\n\n    // è®¡ç®—æ‰“å°é¡µé¢çš„å¯ç”¨å®½åº¦ï¼ˆç±»ä¼¼PDFé€»è¾‘ï¼‰\n    const pageWidthMm = orientation === 'landscape' ?\n      (pageSize === 'A4' ? 297 : 279) : // A4æ¨ªç‰ˆ297mm, Letteræ¨ªç‰ˆ279mm\n      (pageSize === 'A4' ? 210 : 216);  // A4ç«–ç‰ˆ210mm, Letterç«–ç‰ˆ216mm\n\n    // å‡å»é¡µè¾¹è·ï¼ˆ15mm * 2ï¼‰\n    const contentWidthMm = pageWidthMm - 30;\n\n    // è½¬æ¢ä¸ºåƒç´ ï¼ˆ96dpiï¼‰\n    const contentWidthPx = Math.floor(contentWidthMm * 3.78);\n\n    console.log(`ğŸ–¨ï¸ æ‰“å°é¡µé¢å®½åº¦ï¼š${pageWidthMm}mmï¼Œå†…å®¹å®½åº¦ï¼š${contentWidthMm}mm (${contentWidthPx}px)`);\n\n    // è®¾ç½®è¡¨æ ¼å®½åº¦å’Œå¸ƒå±€\n    tableElement.style.width = '100%';\n    tableElement.style.maxWidth = `${contentWidthPx}px`;\n    tableElement.style.tableLayout = 'fixed';\n    tableElement.style.borderCollapse = 'collapse';\n\n    // é‡æ–°è®¡ç®—åˆ—å®½ï¼ˆç±»ä¼¼PDFé€»è¾‘ï¼‰\n    if (config?.columns) {\n      const columns = this._getFlatColumns(config.columns);\n      const visibleColumns = columns.filter((col: any) => col.visible !== false);\n\n      // è®¡ç®—æ€»é…ç½®å®½åº¦\n      let totalConfigWidth = 0;\n      visibleColumns.forEach((col: any) => {\n        if (col.width) {\n          totalConfigWidth += typeof col.width === 'number' ? col.width : parseInt(col.width);\n        }\n      });\n\n      console.log(`ğŸ–¨ï¸ åˆ—é…ç½®æ€»å®½åº¦ï¼š${totalConfigWidth}pxï¼Œç›®æ ‡å®½åº¦ï¼š${contentWidthPx}px`);\n\n      // åº”ç”¨åˆ—å®½åˆ°æ‰€æœ‰å•å…ƒæ ¼\n      const colElements = tableElement.querySelectorAll('col');\n      const allRows = tableElement.querySelectorAll('tr');\n\n      visibleColumns.forEach((col: any, index: number) => {\n        let columnWidth: number;\n\n        if (col.width) {\n          const configWidth = typeof col.width === 'number' ? col.width : parseInt(col.width);\n          // æŒ‰æ¯”ä¾‹ç¼©æ”¾åˆ°æ‰“å°é¡µé¢å®½åº¦\n          columnWidth = Math.floor((configWidth / totalConfigWidth) * contentWidthPx);\n        } else {\n          // å¹³å‡åˆ†é…å‰©ä½™å®½åº¦\n          columnWidth = Math.floor(contentWidthPx / visibleColumns.length);\n        }\n\n        console.log(`ğŸ–¨ï¸ åˆ— \"${col.key}\" å®½åº¦ï¼š${columnWidth}px`);\n\n        // è®¾ç½®colå…ƒç´ å®½åº¦\n        if (colElements[index]) {\n          (colElements[index] as HTMLElement).style.width = `${columnWidth}px`;\n        }\n\n        // è®¾ç½®æ‰€æœ‰è¡Œçš„å¯¹åº”å•å…ƒæ ¼å®½åº¦\n        allRows.forEach(row => {\n          const cells = row.querySelectorAll('td, th');\n          if (cells[index]) {\n            const cell = cells[index] as HTMLElement;\n            cell.style.width = `${columnWidth}px`;\n            cell.style.maxWidth = `${columnWidth}px`;\n            cell.style.minWidth = `${columnWidth}px`;\n            cell.style.boxSizing = 'border-box';\n          }\n        });\n      });\n    }\n\n    // ä¼˜åŒ–å•å…ƒæ ¼æ ·å¼\n    const cells = tableElement.querySelectorAll('td, th');\n    cells.forEach(cell => {\n      const cellElement = cell as HTMLElement;\n      cellElement.style.border = '1px solid #ddd';\n      cellElement.style.padding = '6px 8px';\n      cellElement.style.fontSize = '11px';\n      cellElement.style.lineHeight = '1.3';\n      cellElement.style.wordWrap = 'break-word';\n      cellElement.style.overflow = 'hidden';\n    });\n\n    // è¡¨å¤´æ ·å¼\n    const headerCells = tableElement.querySelectorAll('th');\n    headerCells.forEach(cell => {\n      const cellElement = cell as HTMLElement;\n      cellElement.style.backgroundColor = '#f5f5f5';\n      cellElement.style.fontWeight = 'bold';\n      cellElement.style.fontSize = '11px';\n    });\n  }\n\n  /**\n   * è·å–æ‰å¹³åŒ–çš„åˆ—é…ç½®ï¼ˆé‡ç”¨PDFé€»è¾‘ï¼‰\n   */\n  private static _getFlatColumns(columns: any[]): any[] {\n    const flatColumns: any[] = [];\n\n    const flatten = (cols: any[]) => {\n      cols.forEach(col => {\n        if (col.children && col.children.length > 0) {\n          flatten(col.children);\n        } else {\n          flatColumns.push(col);\n        }\n      });\n    };\n\n    flatten(columns);\n    return flatColumns;\n  }\n\n  /**\n   * åˆ›å»ºæ‰“å°æ ·å¼\n   */\n  private static _createPrintStyle(orientation: string, pageSize: string): HTMLStyleElement {\n    const style = document.createElement('style');\n    style.className = 'ddr-print-style';\n\n    // æ ¹æ®é¡µé¢æ–¹å‘å’Œå¤§å°è®¾ç½®æ ·å¼\n    const pageRule = orientation === 'landscape' ? 'landscape' : 'portrait';\n    const sizeRule = pageSize.toLowerCase();\n\n    style.textContent = `\n      @media print {\n        @page {\n          size: ${sizeRule} ${pageRule};\n          margin: 15mm;\n        }\n\n        body {\n          margin: 0;\n          padding: 0;\n          font-family: Arial, sans-serif;\n          font-size: 12px;\n          line-height: 1.4;\n          color: #000;\n          background: #fff;\n        }\n\n        .ddr-print-container {\n          width: 100% !important;\n          height: auto !important;\n          overflow: visible !important;\n          position: relative !important;\n          left: 0 !important;\n          top: 0 !important;\n          margin: 0 !important;\n          padding: 0 !important;\n          box-shadow: none !important;\n          border: none !important;\n        }\n\n        .ddr-table-container {\n          overflow: visible !important;\n          height: auto !important;\n          max-height: none !important;\n        }\n\n        .ddr-table {\n          width: 100% !important;\n          border-collapse: collapse !important;\n          page-break-inside: auto !important;\n        }\n\n        .ddr-table-row {\n          page-break-inside: avoid !important;\n          page-break-after: auto !important;\n        }\n\n        .ddr-header, .ddr-report-header {\n          page-break-inside: avoid !important;\n          page-break-after: avoid !important;\n        }\n\n        .ddr-footer, .ddr-report-footer {\n          page-break-inside: avoid !important;\n          page-break-before: avoid !important;\n        }\n\n        .ddr-print-watermark {\n          position: fixed !important;\n          top: 0 !important;\n          left: 0 !important;\n          width: 100vw !important;\n          height: 100vh !important;\n          pointer-events: none !important;\n          z-index: 999 !important;\n          opacity: 0.15 !important;\n          overflow: hidden !important;\n        }\n\n        .ddr-print-watermark-text {\n          position: absolute !important;\n          font-size: 24px !important;\n          font-weight: bold !important;\n          color: #ccc !important;\n          transform: rotate(-45deg) !important;\n          white-space: nowrap !important;\n          user-select: none !important;\n        }\n\n        /* éšè—ä¸éœ€è¦æ‰“å°çš„å…ƒç´  */\n        .no-print {\n          display: none !important;\n        }\n      }\n    `;\n\n    return style;\n  }\n\n  /**\n   * æ·»åŠ ç»Ÿä¸€çš„å…¨é¡µé¢æ‰“å°æ°´å°\n   */\n  private static _addPrintWatermark(container: HTMLElement, watermark: string): void {\n    console.log(`ğŸ–¨ï¸ æ·»åŠ ç»Ÿä¸€çš„å…¨é¡µé¢æ‰“å°æ°´å°: \"${watermark}\"`);\n\n    // åˆ›å»ºæ°´å°å®¹å™¨ï¼Œè¦†ç›–æ•´ä¸ªæ‰“å°å®¹å™¨\n    const watermarkContainer = document.createElement('div');\n    watermarkContainer.className = 'ddr-print-watermark';\n\n    // è®¾ç½®æ°´å°å®¹å™¨æ ·å¼ - è¦†ç›–æ•´ä¸ªå®¹å™¨\n    watermarkContainer.style.position = 'fixed';  // ä½¿ç”¨fixedå®šä½ç¡®ä¿è¦†ç›–æ•´ä¸ªè§†å£\n    watermarkContainer.style.top = '0';\n    watermarkContainer.style.left = '0';\n    watermarkContainer.style.width = '100vw';\n    watermarkContainer.style.height = '100vh';\n    watermarkContainer.style.pointerEvents = 'none';\n    watermarkContainer.style.zIndex = '999';  // æé«˜z-indexç¡®ä¿æ˜¾ç¤ºåœ¨æœ€ä¸Šå±‚\n    watermarkContainer.style.overflow = 'hidden';\n    watermarkContainer.style.opacity = '0.15';  // è®¾ç½®é€æ˜åº¦\n\n    // è®¡ç®—æ°´å°å¸ƒå±€ - æ›´å¯†é›†çš„å¹³é“º\n    const rows = 8;  // å¢åŠ è¡Œæ•°\n    const cols = 6;  // å¢åŠ åˆ—æ•°\n\n    for (let row = 0; row < rows; row++) {\n      for (let col = 0; col < cols; col++) {\n        const watermarkText = document.createElement('div');\n        watermarkText.className = 'ddr-print-watermark-text';\n        watermarkText.textContent = watermark;\n\n        // è®¾ç½®æ°´å°æ–‡å­—æ ·å¼\n        watermarkText.style.position = 'absolute';\n        watermarkText.style.fontSize = '24px';  // ç»Ÿä¸€çš„å­—ä½“å¤§å°\n        watermarkText.style.fontWeight = 'bold';\n        watermarkText.style.color = '#ccc';     // è°ƒæ•´é¢œè‰²\n        watermarkText.style.opacity = '1';      // ä¸è®¾ç½®é¢å¤–é€æ˜åº¦ï¼Œç”±å®¹å™¨æ§åˆ¶\n        watermarkText.style.whiteSpace = 'nowrap';\n        watermarkText.style.userSelect = 'none';\n        watermarkText.style.pointerEvents = 'none';\n\n        // è®¡ç®—ä½ç½® - å‡åŒ€åˆ†å¸ƒ\n        const x = (col + 0.5) * (100 / cols);\n        const y = (row + 0.5) * (100 / rows);\n\n        watermarkText.style.left = `${x}%`;\n        watermarkText.style.top = `${y}%`;\n        watermarkText.style.transform = 'translate(-50%, -50%) rotate(-45deg)';\n        watermarkText.style.transformOrigin = 'center';\n\n        watermarkContainer.appendChild(watermarkText);\n      }\n    }\n\n    // å°†æ°´å°å®¹å™¨æ·»åŠ åˆ°bodyï¼Œç¡®ä¿åœ¨æ‰“å°æ—¶è¦†ç›–æ•´ä¸ªé¡µé¢\n    document.body.appendChild(watermarkContainer);\n\n    // æ ‡è®°æ°´å°å®¹å™¨ï¼Œä»¥ä¾¿åç»­æ¸…ç†\n    watermarkContainer.setAttribute('data-ddr-print-watermark', 'true');\n\n    console.log(`ğŸ–¨ï¸ æ°´å°æ·»åŠ å®Œæˆï¼Œå…±åˆ›å»º ${rows * cols} ä¸ªæ°´å°å…ƒç´ `);\n  }\n}\n","/**\r\n * ä¿®å¤Excelå¯¼å‡ºæ ·å¼é—®é¢˜\r\n */\r\n\r\nimport * as XLSX from 'xlsx';\r\n\r\n// å®šä¹‰Excelæ ·å¼è¾…åŠ©å‡½æ•°\r\nexport function applyExcelStyles(ws: any, data: any[][]) {\r\n  // å®šä¹‰é€šç”¨æ ·å¼\r\n  const styles = {\r\n    header: {\r\n      font: { bold: true, sz: 12, color: { rgb: \"FFFFFF\" } },\r\n      fill: { fgColor: { rgb: \"4472C4\" } },\r\n      alignment: { horizontal: \"center\", vertical: \"center\", wrapText: true },\r\n      border: {\r\n        top: { style: 'medium', color: { rgb: '366092' } },\r\n        right: { style: 'thin', color: { rgb: '366092' } },\r\n        bottom: { style: 'medium', color: { rgb: '366092' } },\r\n        left: { style: 'thin', color: { rgb: '366092' } }\r\n      }\r\n    },\r\n    title: {\r\n      font: { bold: true, sz: 18, color: { rgb: \"000000\" } },\r\n      alignment: { horizontal: \"center\", vertical: \"center\" },\r\n      border: {\r\n        top: { style: 'thin', color: { rgb: 'CCCCCC' } },\r\n        bottom: { style: 'thin', color: { rgb: 'CCCCCC' } }\r\n      }\r\n    },\r\n    metadata: {\r\n      font: { sz: 11, color: { rgb: \"333333\" } },\r\n      alignment: { horizontal: \"left\", vertical: \"center\" },\r\n      border: { \r\n        top: { style: 'thin', color: { rgb: 'EEEEEE' } },\r\n        right: { style: 'thin', color: { rgb: 'EEEEEE' } },\r\n        bottom: { style: 'thin', color: { rgb: 'EEEEEE' } },\r\n        left: { style: 'thin', color: { rgb: 'EEEEEE' } }\r\n      }\r\n    },\r\n    cell: {\r\n      font: { sz: 11, color: { rgb: \"333333\" } },\r\n      alignment: { vertical: \"center\", wrapText: true },\r\n      border: {\r\n        top: { style: 'thin', color: { rgb: 'DDDDDD' } },\r\n        right: { style: 'thin', color: { rgb: 'DDDDDD' } },\r\n        bottom: { style: 'thin', color: { rgb: 'DDDDDD' } },\r\n        left: { style: 'thin', color: { rgb: 'DDDDDD' } }\r\n      }\r\n    },\r\n    oddRow: {\r\n      fill: { fgColor: { rgb: \"E9EDF4\" } }\r\n    },\r\n    evenRow: {\r\n      fill: { fgColor: { rgb: \"FFFFFF\" } }\r\n    },\r\n    summary: {\r\n      font: { bold: true, sz: 11, color: { rgb: \"000000\" } },\r\n      alignment: { horizontal: \"right\", vertical: \"center\" },\r\n      border: {\r\n        top: { style: 'medium', color: { rgb: 'CCCCCC' } },\r\n        bottom: { style: 'medium', color: { rgb: 'CCCCCC' } }\r\n      }\r\n    }\r\n  };\r\n\r\n  // åˆ¤æ–­è¡¨æ ¼ç»“æ„\r\n  if (!data || data.length === 0) return ws;\r\n\r\n  // æŸ¥æ‰¾æ ‡é¢˜è¡Œå’Œæ•°æ®è¡ŒèŒƒå›´\r\n  const headerRowIndex = findHeaderRowIndex(data);\r\n  const dataInfo = analyzeDataStructure(data, headerRowIndex);\r\n\r\n  // åº”ç”¨æ ·å¼åˆ°æ ‡é¢˜åŒºåŸŸ\r\n  if (dataInfo.titleRowIndex >= 0) {\r\n    for (let r = 0; r <= dataInfo.titleRowIndex; r++) {\r\n      for (let c = 0; c < (data[r] ? data[r].length : 0); c++) {\r\n        const cellRef = XLSX.utils.encode_cell({ r, c });\r\n        if (!ws[cellRef]) continue;\r\n        \r\n        if (r === 0 && c === 0) {\r\n          // æŠ¥è¡¨æ ‡é¢˜\r\n          ws[cellRef].s = styles.title;\r\n        } else {\r\n          // å…ƒæ•°æ®\r\n          ws[cellRef].s = styles.metadata;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  // åº”ç”¨æ ·å¼åˆ°è¡¨å¤´\r\n  if (headerRowIndex >= 0) {\r\n    for (let c = 0; c < data[headerRowIndex].length; c++) {\r\n      const cellRef = XLSX.utils.encode_cell({ r: headerRowIndex, c });\r\n      if (!ws[cellRef]) continue;\r\n      ws[cellRef].s = styles.header;\r\n    }\r\n  }\r\n\r\n  // åº”ç”¨æ ·å¼åˆ°æ•°æ®è¡Œ\r\n  for (let r = headerRowIndex + 1; r <= dataInfo.dataEndRowIndex; r++) {\r\n    const isAlternateRow = (r - headerRowIndex) % 2 === 1;\r\n    \r\n    for (let c = 0; c < (data[r] ? data[r].length : 0); c++) {\r\n      const cellRef = XLSX.utils.encode_cell({ r, c });\r\n      if (!ws[cellRef]) continue;\r\n      \r\n      // æ£€æŸ¥æ˜¯å¦æ˜¯æ•°å­—\r\n      const isNumber = isNumericCell(data[r][c]);\r\n      \r\n      // åˆå¹¶åŸºç¡€æ ·å¼ä¸è¡Œæ ·å¼\r\n      ws[cellRef].s = {\r\n        ...styles.cell,\r\n        ...(isAlternateRow ? styles.oddRow : styles.evenRow),\r\n        alignment: { \r\n          ...styles.cell.alignment,\r\n          horizontal: isNumber ? \"right\" : \"left\"\r\n        }\r\n      };\r\n    }\r\n  }\r\n\r\n  // åº”ç”¨æ ·å¼åˆ°æ±‡æ€»è¡Œ\r\n  if (dataInfo.summaryRowIndices.length > 0) {\r\n    for (const r of dataInfo.summaryRowIndices) {\r\n      for (let c = 0; c < (data[r] ? data[r].length : 0); c++) {\r\n        const cellRef = XLSX.utils.encode_cell({ r, c });\r\n        if (!ws[cellRef]) continue;\r\n        ws[cellRef].s = styles.summary;\r\n      }\r\n    }\r\n  }\r\n\r\n  return ws;\r\n}\r\n\r\n// è¾…åŠ©å‡½æ•°ï¼šæŸ¥æ‰¾è¡¨å¤´è¡Œ\r\nfunction findHeaderRowIndex(data: any[][]): number {\r\n  // å¦‚æœæ•°æ®å°‘äº3è¡Œï¼Œå‡è®¾æ²¡æœ‰è¡¨å¤´\r\n  if (data.length < 3) return 0;\r\n  \r\n  // é€šå¸¸è¡¨å¤´è¡Œæ˜¯æœ‰å›ºå®šåˆ—æ•°çš„ä¸€è¡Œï¼Œä½äºé¡¶éƒ¨é™„è¿‘\r\n  for (let i = 0; i < Math.min(10, data.length - 1); i++) {\r\n    if (data[i] && data[i+1] && \r\n        data[i].length === data[i+1].length && \r\n        data[i].length >= 3) {\r\n      return i;\r\n    }\r\n  }\r\n  \r\n  // é»˜è®¤è¿”å›ç¬¬ä¸€è¡Œ\r\n  return 0;\r\n}\r\n\r\n// è¾…åŠ©å‡½æ•°ï¼šåˆ†ææ•°æ®ç»“æ„\r\nfunction analyzeDataStructure(data: any[][], headerRowIndex: number) {\r\n  const result = {\r\n    titleRowIndex: -1,\r\n    dataEndRowIndex: data.length - 1,\r\n    summaryRowIndices: [] as number[]\r\n  };\r\n  \r\n  // æŸ¥æ‰¾æ ‡é¢˜è¡Œ\r\n  if (headerRowIndex > 0) {\r\n    result.titleRowIndex = 0;\r\n  }\r\n  \r\n  // æŸ¥æ‰¾æ±‡æ€»è¡Œå’Œæ•°æ®ç»“æŸè¡Œ\r\n  for (let r = data.length - 1; r > headerRowIndex; r--) {\r\n    const row = data[r];\r\n    if (!row || row.length === 0) continue;\r\n    \r\n    // æ£€æŸ¥æ˜¯å¦æ˜¯æ±‡æ€»è¡Œ\r\n    let isSummaryRow = false;\r\n    for (let c = 0; c < row.length; c++) {\r\n      const cell = row[c];\r\n      if (cell && typeof cell === 'string' && \r\n          (cell.includes('åˆè®¡') || cell.includes('æ€»è®¡') || \r\n           cell.includes('æ±‡æ€»') || cell.includes('å°è®¡'))) {\r\n        isSummaryRow = true;\r\n        result.summaryRowIndices.push(r);\r\n        break;\r\n      }\r\n    }\r\n    \r\n    // å¦‚æœä¸æ˜¯æ±‡æ€»è¡Œï¼Œå¯èƒ½æ˜¯æœ€åä¸€è¡Œæ•°æ®\r\n    if (!isSummaryRow && result.dataEndRowIndex === data.length - 1) {\r\n      result.dataEndRowIndex = r;\r\n    }\r\n  }\r\n  \r\n  return result;\r\n}\r\n\r\n// è¾…åŠ©å‡½æ•°ï¼šåˆ¤æ–­å•å…ƒæ ¼æ˜¯å¦åŒ…å«æ•°å­—\r\nfunction isNumericCell(value: any): boolean {\r\n  if (value === null || value === undefined) return false;\r\n  if (typeof value === 'number') return true;\r\n  \r\n  if (typeof value === 'string') {\r\n    const trimmed = value.trim();\r\n    if (trimmed === '') return false;\r\n    \r\n    // æ£€æŸ¥æ˜¯å¦æ˜¯æ•°å­—æ ¼å¼\r\n    return !isNaN(Number(trimmed)) && \r\n           !isNaN(parseFloat(trimmed)) &&\r\n           !trimmed.includes(' '); // ä¸åŒ…å«ç©ºæ ¼\r\n  }\r\n  \r\n  return false;\r\n}\r\n","/**\r\n * ä¿®å¤PDFå¯¼å‡ºå¼‚å¸¸çš„è¡¥ä¸æ–‡ä»¶\r\n * å¯¼å…¥åˆ°ä¸»é¡¹ç›®ä¸­ä»¥è§£å†³PDFå¯¼å‡ºçš„é—®é¢˜\r\n */\r\n\r\n// ä¿®å¤PDFå¯¼å‡ºæ—¶çš„åˆ†é¡µé—®é¢˜\r\nexport function fixPDFExport() {\r\n  try {\r\n    console.log('PDFå¯¼å‡ºä¿®å¤å·²åº”ç”¨ (ä½¿ç”¨å†…ç½®jsPDF)');\r\n\r\n    // ç”±äºjsPDFç°åœ¨æ˜¯é€šè¿‡ESæ¨¡å—å¯¼å…¥çš„ï¼Œä¿®å¤é€»è¾‘å·²ç»ç®€åŒ–\r\n    // ä¸»è¦çš„ä¿®å¤å·²ç»åœ¨ä¸»å¯¼å‡ºé€»è¾‘ä¸­å¤„ç†\r\n\r\n    console.log('PDFå¯¼å‡ºä¿®å¤å·²æˆåŠŸåº”ç”¨');\r\n  } catch (e) {\r\n    console.warn('åº”ç”¨PDFä¿®å¤æ—¶å‘ç”Ÿé”™è¯¯:', e);\r\n  }\r\n}\r\n\r\n// å¯¼å‡ºä¸­æ–‡æ”¯æŒçš„è¾…åŠ©å‡½æ•°\r\nexport function setupChineseSupport(pdf: any) {\r\n  try {\r\n    // è®¾ç½®é»˜è®¤å­—ä½“\r\n    pdf.setFont('helvetica');\r\n\r\n    // ä¼˜åŒ–ä¸­æ–‡å¤„ç†\r\n    const encodingFallback = function(text: string) {\r\n      try {\r\n        // ç®€å•æ›¿æ¢ä¸€äº›ä¸­æ–‡æ ‡ç‚¹ç¬¦å·ä¸ºè‹±æ–‡æ ‡ç‚¹\r\n        return text\r\n          .replace(/ï¼š/g, ':')\r\n          .replace(/ï¼Œ/g, ',')\r\n          .replace(/ã€‚/g, '.')\r\n          .replace(/ï¼ˆ/g, '(')\r\n          .replace(/ï¼‰/g, ')')\r\n          .replace(/ï¼›/g, ';');\r\n      } catch (e) {\r\n        return text;\r\n      }\r\n    };\r\n\r\n    // ä¿å­˜åŸå§‹çš„textæ–¹æ³•\r\n    const originalText = pdf.text;\r\n\r\n    // è¦†ç›–textæ–¹æ³•ï¼Œæ·»åŠ ä¸­æ–‡å¤„ç†\r\n    pdf.text = function(text: string, x: number, y: number, options?: any) {\r\n      try {\r\n        // å°è¯•ä½¿ç”¨åŸå§‹æ–¹æ³•\r\n        return originalText.call(this, encodingFallback(text), x, y, options);\r\n      } catch (e) {\r\n        console.warn('æ–‡å­—æ¸²æŸ“å¤±è´¥:', e);\r\n        // å¦‚æœå¤±è´¥ï¼Œå°è¯•ç›´æ¥æ¸²æŸ“ASCIIå­—ç¬¦\r\n        const asciiOnly = text.replace(/[^\\x00-\\x7F]/g, '?');\r\n        return originalText.call(this, asciiOnly, x, y, options);\r\n      }\r\n    };\r\n\r\n    return pdf;\r\n  } catch (e) {\r\n    console.warn('ä¸­æ–‡æ”¯æŒè®¾ç½®å¤±è´¥:', e);\r\n    return pdf;\r\n  }\r\n}\r\n"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","this","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","__generator","body","f","y","_","label","sent","trys","ops","g","create","Iterator","verb","Symbol","iterator","v","op","TypeError","pop","push","SuppressedError","DDR","XLSXStyle","options","data","metadata","pagination","filters","eventListeners","Map","formatters","initialized","container","el","document","querySelector","Error","concat","HTMLElement","classList","add","theme","globalFormatters","instance","init","catch","error","onError","console","registerFormatter","name","formatter","_b","_loadConfig","config","_c","_fetchData","dataSource","apiResponse","records","_a","grouping","enabled","_processGrouping","log","_render","_emitEvent","onLoad","error_1","reload","params","error_2","refreshMetadata","metadataSource","_fetchMetadata","response","_renderHeaderFooter","error_3","updateMetadata","Array","isArray","metadataWithoutData","indexOf","getOwnPropertySymbols","propertyIsEnumerable","__rest","exportTo","type","index","Exporter","toExcel","toPDF","fileName","meta","error_4","destroy","innerHTML","clear","setFilter","on","event","callback","has","set","get","off","callbacks","splice","print","toPrint","watermark","features","pdf","pdfConfig","error_5","_simplePrint","style","createElement","textContent","head","appendChild","window","setTimeout","removeChild","getData","to","from","pack","ar","l","slice","__spreadArray","getMetadata","_getValueByPath","path","split","reduce","acc","part","undefined","startsWith","fetch","ok","statusText","json","error_6","message","String","extraParams","mock","debug","location","hostname","api","method","headers","JSON","stringify","url","keys","queryParams_1","URLSearchParams","entries","forEach","key","append","toString","warn","success","code","queryParams_2","wrapper","className","layout","height","bordered","renderMode","_determineRenderMode","setAttribute","_renderCanvas","_renderDOM","_addWatermark","oldHeader","oldFooter","header","_createHeader","insertBefore","firstChild","ResizeObserver","entries_1","_i","headerHeight_1","contentRect","setProperty","tableContainer_1","marginTop","maxHeight","observe","headerHeight","getBoundingClientRect","tableContainer","footer","_createFooter","nextSibling","headerConfig","_this","headerElement","minHeight","topContainer","logo","logoContainer","position","logoImg","alt","src","metadataKey","width","centerContainer","title","titleText","metadataPath","text","titleElement","subtitle","subtitleElement","subtitleText","subtitleObj","fields","fieldsContainer","leftFields_1","rightFields_1","field","fieldElement","labelElement","valueElement","footerConfig","footerElement","fixed","summary","summaryElement_1","summaryConfig","summaryItem","column","summaryValue","_calculateSummary","fieldsContainer_1","signatures","signaturesElement_1","signature","signatureItem","nameElement","showTimestamp","dateElement","timestamp","dateMetadataPath","Date","toLocaleDateString","notes","notesElement","pageInfo","pageElement","pageText","format","replace","pageNumber","totalPages","values","map","item","sum","val","groupingConfig","_processSingleGroupSubtotals","groupBy","subtotals","subtotalLabel","showGrandTotal","grandTotalLabel","grouped","groupKey","_rowType","_level","_groupKey","grandTotals","groupData","subtotalRow","_isSubtotal","columns","col","subtotalConfig","subtotalValue","_calculateGroupSummary","grandTotalRow_1","_isGrandTotal","parseFloat","filter","isNaN","toLowerCase","Math","max","min","isFinite","_applyGroupingStyles","cell","rowData","defaultStyles","_getDefaultGroupingStyles","subtotalStyle","styles","subtotal","totalStyle","totalRow","total","groupByField","groupColumn","fontWeight","backgroundColor","borderTop","color","mode","entries_2","entry","target","updateHeaderSize","addEventListener","tableWrapper","table","stripe","hover","thead","_createTableHeader","tbody","_createTableBody","paginationElement","_createPagination","placeholder","rowCount","_calculateHeaderRowCount","rows","fill","tr","_fillHeaderCells","row","maxDepth","traverse","cols","currentDepth","children","rowIndex","colIndex","currentColIndex","align","textAlign","childColSpan","colSpan","rowSpan","flatColumns","_getFlatColumns","merges","emptyRow","emptyCell","emptyText","rowHeight","visible","cellKey","formatterFunc","merge","_handleCellMerge","conditional","condition","valueToCheck","_evaluateCondition","when","td","currentValue","nextValue","skipKey","context","expression_1","rowVarMatches","match","prop","Function","flatten","prevBtn","disabled","onclick","currentPage","startPage","endPage","pageBtn","nextBtn","sizeSelect","size","option","selected","pageSize","onchange","Number","existingWatermark","zIndex","includes","content","opacity","fontSize","defineProperty","writable","MutationObserver","mutations","mutation","removedNodes","some","node","Element","contains","newWatermark_1","cloneNode","attributeName","childList","subtree","attributes","attributeFilter","_prepareExportData","visibleColumns","includeHidden","includeHeader","showOnExport","_d","includeFooter","_e","_g","_f","_j","_h","_l","_k","signatureRow_1","_m","date","currency","locale","Intl","NumberFormat","number","precision","thousandSeparator","minimumFractionDigits","maximumFractionDigits","useGrouping","percentage","applyExcelStyles","ws","font","bold","sz","rgb","fgColor","alignment","horizontal","vertical","wrapText","border","top","right","bottom","left","oddRow","evenRow","headerRowIndex","findHeaderRowIndex","dataInfo","titleRowIndex","dataEndRowIndex","summaryRowIndices","r","isSummaryRow","c","analyzeDataStructure","cellRef","XLSX","utils","encode_cell","isAlternateRow","isNumber","isNumericCell","trimmed","trim","require","fixPDFExport","sheetName","excelData","domElement","extractDataFromDOM","ws_1","aoa_to_sheet","wscols","maxWidth","wch","dataRows","hasDOMElement","firstRow","lastRow","applyEnhancedStylesToExcel","enhancedError","applyBasicStylesToExcel","wb","book_new","book_append_sheet","Workbook","Views","RTL","hasStyles","sampleCells_1","Props","Title","Subject","Author","CreatedDate","writeOptions","bookType","cellStyles","sheetStubs","compression","excelBuffer","write","blob","Blob","URL","createObjectURL","link","href","download","click","revokeObjectURL","blobError","writeFile","fallbackError","element","fieldsElements","querySelectorAll","metadataRow_1","cells","summaryElements","summaryRow_1","footerFields","footerRow_1","applyDOMStylesToExcel","hasTitle","hasMetadata","currentRowIndex_1","headerStyle_1","dataStyle_1","isFirstRow_1","isHeader","cellIndex","excelRowIndex","range","decode_range","headerStyle","dataStyle","alternateRowStyle","rowStyle","rgbToHex","parseInt","padStart","toUpperCase","getExcelAlignment","pdfOptions","configPdfSettings","mergedPdfOptions","finalWatermark","orientation_1","orientation","quality","multiPage","relayout","margins","originalScrollTop","scrollTop","tempContainer","overflow","contentWidthMm","dpiRatio","contentWidthPx","floor","tableElem","tableLayout","padding","clientWidth","tableElement","setFont","originalText_1","x","encodingFallback_1","asciiOnly","setupChineseSupport","jsPDF","unit","pageWidth","internal","getWidth","pageHeight","getHeight","contentHeight","contentWidth","setFontSize","headerCanvas","headerRect","round","html2canvas","scale","useCORS","logging","allowTaint","e_1","footerHeight","footerCanvas","footerRect","e_2","tableRect","tableCanvas","tableWidth","tableHeight","totalRows","headerRowCount","dataRowCount","actualHeaderHeightMM","actualFooterHeightMM","avgRowHeightCanvas","dataRowHeightMM","configRowHeightPx","configRowHeightMM","baseAvailableHeight","firstPageDataHeight","middlePageDataHeight","lastPageDataHeight","firstPageMaxRows","middlePageMaxRows","lastPageMaxRows","pageBreakPoints","processedRows","pageIndex","maxRowsThisPage","remainingRows","rowsThisPage","breakYPercent","headerHeightRatio","yPercent","endRow","pagesNeeded","headerImgData","toDataURL","footerImgData","lastPageRows","lastPageRemainingHeight","lastPageDataHeightUsed","page","addPage","yOffset","addImage","repeatTableHeader","headerOnlyCanvas","headerHeightInCanvas","ceil","headerCtx","getContext","fillStyle","fillRect","drawImage","headerHeightInPDF","headerImgData_1","tableStartPercent","tableEndPercent","startRow","sourceY","sourceHeight","tablePartHeight","headerRowHeightCanvas","dataRowHeightCanvas","endRowHeightCanvas","startRowHeightCanvas","endY","maxAllowedHeight","pageTableCanvas","pageTableCtx","strokeStyle","lineWidth","beginPath","moveTo","lineTo","stroke","pageTableImgData","setTextColor","minPageNumberY","contentBottom","maxPageNumberY","pageNumberY","minFooterY","maxFooterY","footerY","newPageNumber","watermarkCanvas","ctx","textBaseline","translate","rotate","PI","fillText","watermarkImgData","clearRect","textLength","textMetrics","measureText","textWidth","spacingX","spacingY","rows_1","save","restore","watermarkError","centerX","centerY","baseline","angle","e_3","canvas","imgData","canvasAspectRatio","pageAspectRatio","imgWidth","imgHeight","orientation_2","_createPrintContainer","printContainer_1","printStyle_1","_createPrintStyle","originalElements_1","display","wm","remove","printContainer","backgroundImage","background","_applyPrintTableLayout","pageBreakInside","marginBottom","_addPrintWatermark","pageWidthMm","borderCollapse","visibleColumns_1","totalConfigWidth_1","colElements_1","allRows_1","columnWidth","configWidth","minWidth","boxSizing","cellElement","lineHeight","wordWrap","pageRule","sizeRule","watermarkContainer","pointerEvents","watermarkText","whiteSpace","userSelect","transform","transformOrigin"],"mappings":"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"}