{"version":3,"file":"ddr-core.js","sources":["../node_modules/tslib/tslib.es6.js","../src/core/index.ts","../src/core/exporter/index.ts","../src/core/exporter/excel-fixes.ts","../src/core/exporter/pdf-fixes.ts"],"sourcesContent":["/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise, SuppressedError, Symbol, Iterator */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __esDecorate(ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\r\n    function accept(f) { if (f !== void 0 && typeof f !== \"function\") throw new TypeError(\"Function expected\"); return f; }\r\n    var kind = contextIn.kind, key = kind === \"getter\" ? \"get\" : kind === \"setter\" ? \"set\" : \"value\";\r\n    var target = !descriptorIn && ctor ? contextIn[\"static\"] ? ctor : ctor.prototype : null;\r\n    var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\r\n    var _, done = false;\r\n    for (var i = decorators.length - 1; i >= 0; i--) {\r\n        var context = {};\r\n        for (var p in contextIn) context[p] = p === \"access\" ? {} : contextIn[p];\r\n        for (var p in contextIn.access) context.access[p] = contextIn.access[p];\r\n        context.addInitializer = function (f) { if (done) throw new TypeError(\"Cannot add initializers after decoration has completed\"); extraInitializers.push(accept(f || null)); };\r\n        var result = (0, decorators[i])(kind === \"accessor\" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);\r\n        if (kind === \"accessor\") {\r\n            if (result === void 0) continue;\r\n            if (result === null || typeof result !== \"object\") throw new TypeError(\"Object expected\");\r\n            if (_ = accept(result.get)) descriptor.get = _;\r\n            if (_ = accept(result.set)) descriptor.set = _;\r\n            if (_ = accept(result.init)) initializers.unshift(_);\r\n        }\r\n        else if (_ = accept(result)) {\r\n            if (kind === \"field\") initializers.unshift(_);\r\n            else descriptor[key] = _;\r\n        }\r\n    }\r\n    if (target) Object.defineProperty(target, contextIn.name, descriptor);\r\n    done = true;\r\n};\r\n\r\nexport function __runInitializers(thisArg, initializers, value) {\r\n    var useValue = arguments.length > 2;\r\n    for (var i = 0; i < initializers.length; i++) {\r\n        value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\r\n    }\r\n    return useValue ? value : void 0;\r\n};\r\n\r\nexport function __propKey(x) {\r\n    return typeof x === \"symbol\" ? x : \"\".concat(x);\r\n};\r\n\r\nexport function __setFunctionName(f, name, prefix) {\r\n    if (typeof name === \"symbol\") name = name.description ? \"[\".concat(name.description, \"]\") : \"\";\r\n    return Object.defineProperty(f, \"name\", { configurable: true, value: prefix ? \"\".concat(prefix, \" \", name) : name });\r\n};\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === \"function\" ? Iterator : Object).prototype);\r\n    return g.next = verb(0), g[\"throw\"] = verb(1), g[\"return\"] = verb(2), typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    var desc = Object.getOwnPropertyDescriptor(m, k);\r\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\r\n        desc = { enumerable: true, get: function() { return m[k]; } };\r\n    }\r\n    Object.defineProperty(o, k2, desc);\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = Object.create((typeof AsyncIterator === \"function\" ? AsyncIterator : Object).prototype), verb(\"next\"), verb(\"throw\"), verb(\"return\", awaitReturn), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function awaitReturn(f) { return function (v) { return Promise.resolve(v).then(f, reject); }; }\r\n    function verb(n, f) { if (g[n]) { i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; if (f) i[n] = f(i[n]); } }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: false } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nvar ownKeys = function(o) {\r\n    ownKeys = Object.getOwnPropertyNames || function (o) {\r\n        var ar = [];\r\n        for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;\r\n        return ar;\r\n    };\r\n    return ownKeys(o);\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== \"default\") __createBinding(result, mod, k[i]);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n\r\nexport function __classPrivateFieldIn(state, receiver) {\r\n    if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\r\n    return typeof state === \"function\" ? receiver === state : state.has(receiver);\r\n}\r\n\r\nexport function __addDisposableResource(env, value, async) {\r\n    if (value !== null && value !== void 0) {\r\n        if (typeof value !== \"object\" && typeof value !== \"function\") throw new TypeError(\"Object expected.\");\r\n        var dispose, inner;\r\n        if (async) {\r\n            if (!Symbol.asyncDispose) throw new TypeError(\"Symbol.asyncDispose is not defined.\");\r\n            dispose = value[Symbol.asyncDispose];\r\n        }\r\n        if (dispose === void 0) {\r\n            if (!Symbol.dispose) throw new TypeError(\"Symbol.dispose is not defined.\");\r\n            dispose = value[Symbol.dispose];\r\n            if (async) inner = dispose;\r\n        }\r\n        if (typeof dispose !== \"function\") throw new TypeError(\"Object not disposable.\");\r\n        if (inner) dispose = function() { try { inner.call(this); } catch (e) { return Promise.reject(e); } };\r\n        env.stack.push({ value: value, dispose: dispose, async: async });\r\n    }\r\n    else if (async) {\r\n        env.stack.push({ async: true });\r\n    }\r\n    return value;\r\n\r\n}\r\n\r\nvar _SuppressedError = typeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\r\n    var e = new Error(message);\r\n    return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\r\n};\r\n\r\nexport function __disposeResources(env) {\r\n    function fail(e) {\r\n        env.error = env.hasError ? new _SuppressedError(e, env.error, \"An error was suppressed during disposal.\") : e;\r\n        env.hasError = true;\r\n    }\r\n    var r, s = 0;\r\n    function next() {\r\n        while (r = env.stack.pop()) {\r\n            try {\r\n                if (!r.async && s === 1) return s = 0, env.stack.push(r), Promise.resolve().then(next);\r\n                if (r.dispose) {\r\n                    var result = r.dispose.call(r.value);\r\n                    if (r.async) return s |= 2, Promise.resolve(result).then(next, function(e) { fail(e); return next(); });\r\n                }\r\n                else s |= 1;\r\n            }\r\n            catch (e) {\r\n                fail(e);\r\n            }\r\n        }\r\n        if (s === 1) return env.hasError ? Promise.reject(env.error) : Promise.resolve();\r\n        if (env.hasError) throw env.error;\r\n    }\r\n    return next();\r\n}\r\n\r\nexport function __rewriteRelativeImportExtension(path, preserveJsx) {\r\n    if (typeof path === \"string\" && /^\\.\\.?\\//.test(path)) {\r\n        return path.replace(/\\.(tsx)$|((?:\\.d)?)((?:\\.[^./]+?)?)\\.([cm]?)ts$/i, function (m, tsx, d, ext, cm) {\r\n            return tsx ? preserveJsx ? \".jsx\" : \".js\" : d && (!ext || !cm) ? m : (d + ext + \".\" + cm.toLowerCase() + \"js\");\r\n        });\r\n    }\r\n    return path;\r\n}\r\n\r\nexport default {\r\n    __extends: __extends,\r\n    __assign: __assign,\r\n    __rest: __rest,\r\n    __decorate: __decorate,\r\n    __param: __param,\r\n    __esDecorate: __esDecorate,\r\n    __runInitializers: __runInitializers,\r\n    __propKey: __propKey,\r\n    __setFunctionName: __setFunctionName,\r\n    __metadata: __metadata,\r\n    __awaiter: __awaiter,\r\n    __generator: __generator,\r\n    __createBinding: __createBinding,\r\n    __exportStar: __exportStar,\r\n    __values: __values,\r\n    __read: __read,\r\n    __spread: __spread,\r\n    __spreadArrays: __spreadArrays,\r\n    __spreadArray: __spreadArray,\r\n    __await: __await,\r\n    __asyncGenerator: __asyncGenerator,\r\n    __asyncDelegator: __asyncDelegator,\r\n    __asyncValues: __asyncValues,\r\n    __makeTemplateObject: __makeTemplateObject,\r\n    __importStar: __importStar,\r\n    __importDefault: __importDefault,\r\n    __classPrivateFieldGet: __classPrivateFieldGet,\r\n    __classPrivateFieldSet: __classPrivateFieldSet,\r\n    __classPrivateFieldIn: __classPrivateFieldIn,\r\n    __addDisposableResource: __addDisposableResource,\r\n    __disposeResources: __disposeResources,\r\n    __rewriteRelativeImportExtension: __rewriteRelativeImportExtension,\r\n};\r\n","import { DDRInstance, DDROptions, DDRConfig, APIResponse, DDREvent, ExportOptions } from \"../types\";\r\n\r\n/**\r\n * DDRæ ¸å¿ƒç±»\r\n * æ•°æ®é©±åŠ¨æŠ¥è¡¨çš„ä¸»è¦å®ç°\r\n */\r\nclass DDR implements DDRInstance {\r\n  private container: HTMLElement;\r\n  private config: DDRConfig;\r\n  private data: any[] = [];\r\n  private metadata: Record<string, any> = {};\r\n  private pagination: Record<string, any> | null = null;\r\n  private filters: Record<string, any> = {};\r\n  private options: DDROptions;\r\n  private eventListeners: Map<DDREvent, Function[]> = new Map();\r\n  private formatters: Record<string, Function> = {};\r\n  private initialized: boolean = false;\r\n\r\n  /**\r\n   * åˆ›å»ºDDRå®ä¾‹\r\n   * @param options åˆå§‹åŒ–é€‰é¡¹\r\n   * @returns DDRå®ä¾‹\r\n   */\r\n  static create(options: DDROptions): DDRInstance {\r\n    const instance = new DDR(options);\r\n    instance.init().catch(error => {\r\n      if (options.onError) {\r\n        options.onError(error);\r\n      } else {\r\n        console.error('DDRåˆå§‹åŒ–å¤±è´¥:', error);\r\n      }\r\n    });\r\n    return instance;\r\n  }\r\n\r\n  /**\r\n   * æ³¨å†Œè‡ªå®šä¹‰æ ¼å¼åŒ–å‡½æ•°\r\n   * @param name æ ¼å¼åŒ–å‡½æ•°åç§°\r\n   * @param formatter æ ¼å¼åŒ–å‡½æ•°\r\n   */\r\n  static registerFormatter(name: string, formatter: Function): void {\r\n    DDR.globalFormatters[name] = formatter;\r\n  }\r\n\r\n  // å…¨å±€æ ¼å¼åŒ–å‡½æ•°\r\n  private static globalFormatters: Record<string, Function> = {\r\n    // å†…ç½®æ ¼å¼åŒ–å‡½æ•°\r\n    date: (value: string | number | Date) => {\r\n      const date = new Date(value);\r\n      return date.toLocaleDateString();\r\n    },\r\n    currency: (value: number, params?: { currency?: string, locale?: string }) => {\r\n      const { currency = 'CNY', locale = 'zh-CN' } = params || {};\r\n      return new Intl.NumberFormat(locale, {\r\n        style: 'currency',\r\n        currency\r\n      }).format(value);\r\n    },\r\n    number: (value: number, params?: { precision?: number, thousandSeparator?: boolean }) => {\r\n      const { precision = 2, thousandSeparator = true } = params || {};\r\n      const options = {\r\n        minimumFractionDigits: precision,\r\n        maximumFractionDigits: precision,\r\n        useGrouping: thousandSeparator\r\n      };\r\n      return new Intl.NumberFormat(undefined, options).format(value);\r\n    },\r\n    percentage: (value: number, params?: { precision?: number }) => {\r\n      const { precision = 2 } = params || {};\r\n      return new Intl.NumberFormat(undefined, {\r\n        style: 'percent',\r\n        minimumFractionDigits: precision,\r\n        maximumFractionDigits: precision\r\n      }).format(value);\r\n    }\r\n  };\r\n\r\n  constructor(options: DDROptions) {\r\n    this.options = options;\r\n\r\n    // è·å–å®¹å™¨å…ƒç´ \r\n    if (typeof options.container === 'string') {\r\n      const el = document.querySelector(options.container);\r\n      if (!el) {\r\n        throw new Error(`æ‰¾ä¸åˆ°å®¹å™¨å…ƒç´ : ${options.container}`);\r\n      }\r\n      this.container = el as HTMLElement;\r\n    } else if (options.container instanceof HTMLElement) {\r\n      this.container = options.container;\r\n    } else {\r\n      throw new Error('æ— æ•ˆçš„å®¹å™¨å…ƒç´ ');\r\n    }\r\n\r\n    // åº”ç”¨å®¹å™¨æ ·å¼\r\n    this.container.classList.add('ddr-container');\r\n    if (options.theme) {\r\n      this.container.classList.add(`ddr-theme-${options.theme}`);\r\n    } else {\r\n      this.container.classList.add('ddr-theme-default');\r\n    }\r\n\r\n    // åˆå¹¶æœ¬åœ°å’Œå…¨å±€æ ¼å¼åŒ–å‡½æ•°\r\n    this.formatters = { ...DDR.globalFormatters };\r\n\r\n    // åˆå§‹åŒ–å…ƒæ•°æ®\r\n    if (options.metadata) {\r\n      this.metadata = { ...options.metadata };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * åˆå§‹åŒ–æŠ¥è¡¨\r\n   */\r\n  async init(): Promise<void> {\r\n    try {\r\n      // åŠ è½½é…ç½®\r\n      this.config = await this._loadConfig(this.options.config);\r\n\r\n      // è·å–æ•°æ®\r\n      const apiResponse = await this._fetchData(this.config.dataSource);\r\n      this.data = apiResponse.records;\r\n      this.metadata = apiResponse.metadata || this.metadata;\r\n      this.pagination = apiResponse.pagination || null;\r\n\r\n      // æ¸²æŸ“æŠ¥è¡¨\r\n      this._render();\r\n\r\n      this.initialized = true;\r\n      this._emitEvent('data-loaded', { data: this.data });\r\n\r\n      if (this.options.onLoad) {\r\n        this.options.onLoad();\r\n      }\r\n    } catch (error) {\r\n      this._emitEvent('error', { error });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * é‡æ–°åŠ è½½æ•°æ®\r\n   * @param params é¢å¤–çš„æŸ¥è¯¢å‚æ•°\r\n   */\r\n  async reload(params?: Record<string, any>): Promise<void> {\r\n    if (!this.initialized) {\r\n      throw new Error('DDRå°šæœªåˆå§‹åŒ–');\r\n    }\r\n\r\n    try {\r\n      const apiResponse = await this._fetchData(this.config.dataSource, params);\r\n      this.data = apiResponse.records;\r\n\r\n      // åªæœ‰åœ¨APIè¿”å›äº†å…ƒæ•°æ®æ—¶æ‰æ›´æ–°\r\n      if (apiResponse.metadata) {\r\n        this.metadata = apiResponse.metadata;\r\n        this._emitEvent('metadata-updated', { metadata: this.metadata });\r\n      }\r\n\r\n      this.pagination = apiResponse.pagination || null;\r\n\r\n      // é‡æ–°æ¸²æŸ“\r\n      this._render();\r\n      this._emitEvent('data-loaded', { data: this.data });\r\n    } catch (error) {\r\n      this._emitEvent('error', { error });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * åˆ·æ–°å…ƒæ•°æ®\r\n   */\r\n  async refreshMetadata(): Promise<void> {\r\n    if (!this.initialized) {\r\n      throw new Error('DDRå°šæœªåˆå§‹åŒ–');\r\n    }\r\n\r\n    try {\r\n      // å¦‚æœé…ç½®äº†ç‹¬ç«‹çš„å…ƒæ•°æ®APIåˆ™ä½¿ç”¨å®ƒ\r\n      if (this.config.dataSource.metadataSource) {\r\n        const response = await this._fetchMetadata(this.config.dataSource.metadataSource);\r\n        this.metadata = response.metadata || {};\r\n      } else {\r\n        // å¦åˆ™é‡æ–°è·å–æ‰€æœ‰æ•°æ®\r\n        const apiResponse = await this._fetchData(this.config.dataSource);\r\n        if (apiResponse.metadata) {\r\n          this.metadata = apiResponse.metadata;\r\n        }\r\n      }\r\n\r\n      // é‡æ–°æ¸²æŸ“è¡¨å¤´å’Œè¡¨å°¾\r\n      this._renderHeaderFooter();\r\n      this._emitEvent('metadata-updated', { metadata: this.metadata });\r\n    } catch (error) {\r\n      this._emitEvent('error', { error });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * æ›´æ–°å…ƒæ•°æ®\r\n   * @param metadata è¦æ›´æ–°çš„å…ƒæ•°æ®\r\n   */\r\n  updateMetadata(metadata: Record<string, any>): void {\r\n    // æ£€æŸ¥æ˜¯å¦åŒ…å«æ•°æ®æ›´æ–°\r\n    if (metadata.data && Array.isArray(metadata.data)) {\r\n      console.log('ğŸ“Š é€šè¿‡updateMetadataæ›´æ–°æ•°æ®ï¼Œå…±', metadata.data.length, 'æ¡è®°å½•');\r\n      this.data = metadata.data;\r\n\r\n      // ä»metadataä¸­ç§»é™¤dataï¼Œé¿å…æ±¡æŸ“å…ƒæ•°æ®\r\n      const { data, ...metadataWithoutData } = metadata;\r\n      this.metadata = { ...this.metadata, ...metadataWithoutData };\r\n\r\n      if (this.initialized) {\r\n        // é‡æ–°æ¸²æŸ“æ•´ä¸ªæŠ¥è¡¨ï¼ˆåŒ…æ‹¬æ•°æ®è¡¨æ ¼ï¼‰\r\n        this._render();\r\n        this._emitEvent('data-loaded', { data: this.data });\r\n        this._emitEvent('metadata-updated', { metadata: this.metadata });\r\n      }\r\n    } else {\r\n      // åªæ›´æ–°å…ƒæ•°æ®ï¼Œä¸æ¶‰åŠæ•°æ®å˜æ›´\r\n      this.metadata = { ...this.metadata, ...metadata };\r\n\r\n      if (this.initialized) {\r\n        // åªé‡æ–°æ¸²æŸ“è¡¨å¤´å’Œè¡¨å°¾\r\n        this._renderHeaderFooter();\r\n        this._emitEvent('metadata-updated', { metadata: this.metadata });\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * å¯¼å‡ºä¸ºExcelæˆ–PDF\r\n   * @param type å¯¼å‡ºç±»å‹\r\n   * @param options å¯¼å‡ºé€‰é¡¹\r\n   */\r\n  async exportTo(type: \"excel\" | \"pdf\", options?: ExportOptions): Promise<void> {\r\n    if (!this.initialized) {\r\n      throw new Error('DDRå°šæœªåˆå§‹åŒ–');\r\n    }\r\n\r\n    try {\r\n      this._emitEvent('export-start', { type, options });\r\n        // å¯¼å…¥å¯¼å‡ºæ¨¡å—ï¼ŒæŒ‰éœ€åŠ è½½ä»¥å‡å°åŒ…ä½“ç§¯\r\n      // ä¿®æ”¹ä¸ºä½¿ç”¨é™æ€å¯¼å…¥ï¼Œé¿å…ä»£ç æ‹†åˆ†\r\n      const { Exporter } = await import('../core/exporter');\r\n\r\n      // æ‰§è¡Œå¯¼å‡º\r\n      if (type === 'excel') {\r\n        // Excelå¯¼å‡ºä¼ é€’DOMå…ƒç´ ä»¥ä¿ç•™æ ·å¼\r\n        await Exporter.toExcel(this.container, options);\r\n      } else if (type === 'pdf') {\r\n        // PDFå¯¼å‡ºä¼ é€’DOMå…ƒç´ å’Œé…ç½®\r\n        await Exporter.toPDF(this.container, this.config, options);\r\n      }\r\n\r\n      this._emitEvent('export-complete', {\r\n        type,\r\n        fileName: options?.fileName || `${this.config.meta.name}.${type === 'excel' ? 'xlsx' : 'pdf'}`\r\n      });\r\n    } catch (error) {\r\n      this._emitEvent('error', { error });\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * é”€æ¯å®ä¾‹å¹¶æ¸…ç†èµ„æº\r\n   */\r\n  destroy(): void {\r\n    // æ¸…é™¤DOM\r\n    this.container.innerHTML = '';\r\n\r\n    // ç§»é™¤äº‹ä»¶ç›‘å¬å™¨\r\n    this.eventListeners.clear();\r\n\r\n    // æ¸…é™¤å¼•ç”¨\r\n    this.data = [];\r\n    this.metadata = {};\r\n    this.initialized = false;\r\n  }\r\n\r\n  /**\r\n   * è®¾ç½®è¿‡æ»¤æ¡ä»¶\r\n   * @param filters è¿‡æ»¤æ¡ä»¶\r\n   */\r\n  setFilter(filters: Record<string, any>): void {\r\n    this.filters = { ...this.filters, ...filters };\r\n  }\r\n\r\n  /**\r\n   * æ·»åŠ äº‹ä»¶ç›‘å¬\r\n   * @param event äº‹ä»¶åç§°\r\n   * @param callback å›è°ƒå‡½æ•°\r\n   */\r\n  on(event: DDREvent, callback: Function): void {\r\n    if (!this.eventListeners.has(event)) {\r\n      this.eventListeners.set(event, []);\r\n    }\r\n    this.eventListeners.get(event)!.push(callback);\r\n  }\r\n\r\n  /**\r\n   * ç§»é™¤äº‹ä»¶ç›‘å¬\r\n   * @param event äº‹ä»¶åç§°\r\n   * @param callback å›è°ƒå‡½æ•°\r\n   */\r\n  off(event: DDREvent, callback: Function): void {\r\n    if (this.eventListeners.has(event)) {\r\n      const callbacks = this.eventListeners.get(event)!;\r\n      const index = callbacks.indexOf(callback);\r\n      if (index !== -1) {\r\n        callbacks.splice(index, 1);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * æ‰§è¡Œæ‰“å° - ä½¿ç”¨ä¸PDFå¯¼å‡ºä¸€è‡´çš„é€»è¾‘\r\n   */\r\n  async print(): Promise<void> {\r\n    try {\r\n      console.log('å¼€å§‹æ‰“å°ï¼Œä½¿ç”¨PDFå¯¼å‡ºé€»è¾‘ç”Ÿæˆæ‰“å°å†…å®¹');\r\n\r\n      // å¯¼å…¥å¯¼å‡ºæ¨¡å—\r\n      const { Exporter } = await import('../core/exporter');\r\n\r\n      // ä½¿ç”¨PDFå¯¼å‡ºçš„é€»è¾‘ç”Ÿæˆæ‰“å°å†…å®¹ï¼Œä½†ä¸ä¿å­˜æ–‡ä»¶\r\n      await Exporter.toPrint(this.container, this.config, {\r\n        watermark: this.config.features?.watermark,\r\n        pdf: this.config.features?.pdfConfig || {}\r\n      });\r\n\r\n    } catch (error) {\r\n      console.error('æ‰“å°å¤±è´¥ï¼Œé™çº§åˆ°ç®€å•æ‰“å°:', error);\r\n\r\n      // é™çº§åˆ°åŸæ¥çš„ç®€å•æ‰“å°æ–¹å¼\r\n      this._simplePrint();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ç®€å•æ‰“å°æ–¹å¼ï¼ˆé™çº§æ–¹æ¡ˆï¼‰\r\n   */\r\n  private _simplePrint(): void {\r\n    // åˆ›å»ºæ‰“å°æ ·å¼\r\n    const style = document.createElement('style');\r\n    style.textContent = `\r\n      @media print {\r\n        body * {\r\n          visibility: hidden;\r\n        }\r\n        .ddr-container, .ddr-container * {\r\n          visibility: visible;\r\n        }\r\n        .ddr-container {\r\n          position: absolute;\r\n          left: 0;\r\n          top: 0;\r\n          width: 100% !important;\r\n          height: auto !important;\r\n          overflow: visible !important;\r\n        }\r\n        .ddr-table-container {\r\n          overflow: visible !important;\r\n          height: auto !important;\r\n        }\r\n        .ddr-table {\r\n          page-break-inside: auto;\r\n        }\r\n        .ddr-table-row {\r\n          page-break-inside: avoid;\r\n          page-break-after: auto;\r\n        }\r\n        .ddr-header, .ddr-footer {\r\n          page-break-inside: avoid;\r\n        }\r\n      }\r\n    `;\r\n    document.head.appendChild(style);\r\n\r\n    // æ‰§è¡Œæ‰“å°\r\n    window.print();\r\n\r\n    // ç§»é™¤æ‰“å°æ ·å¼\r\n    setTimeout(() => {\r\n      document.head.removeChild(style);\r\n    }, 100);\r\n  }\r\n\r\n  /**\r\n   * è·å–åŸå§‹æ•°æ®\r\n   * @returns æ•°æ®æ•°ç»„\r\n   */\r\n  getData(): any[] {\r\n    return [...this.data];\r\n  }\r\n\r\n  /**\r\n   * è·å–å…ƒæ•°æ®\r\n   * @returns å…ƒæ•°æ®å¯¹è±¡\r\n   */\r\n  getMetadata(): Record<string, any> {\r\n    return { ...this.metadata };\r\n  }\r\n\r\n  /**\r\n   * ä»å…ƒæ•°æ®ä¸­æ ¹æ®è·¯å¾„è·å–å€¼\r\n   * @param path è·¯å¾„ï¼Œä¾‹å¦‚ï¼š\"company.name\"\r\n   * @returns æ‰¾åˆ°çš„å€¼æˆ–undefined\r\n   */\r\n  private _getValueByPath(path?: string): any {\r\n    if (!path) return undefined;\r\n    return path.split('.').reduce((acc, part) =>\r\n      acc && acc[part] !== undefined ? acc[part] : undefined, this.metadata);\r\n  }\r\n\r\n  /**\r\n   * åŠ è½½é…ç½®\r\n   * @param config é…ç½®è·¯å¾„æˆ–å¯¹è±¡\r\n   * @returns åŠ è½½åçš„é…ç½®\r\n   */\r\n  private async _loadConfig(config: string | DDRConfig): Promise<DDRConfig> {\r\n    if (typeof config === 'string') {\r\n      // æ”¯æŒæœ¬åœ°JSONæˆ–è¿œç¨‹API\r\n      if (config.startsWith('http')) {\r\n        const response = await fetch(config);\r\n        if (!response.ok) {\r\n          throw new Error(`åŠ è½½é…ç½®å¤±è´¥: ${response.statusText}`);\r\n        }\r\n        return await response.json();\r\n      } else {\r\n        // åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œå¯èƒ½éœ€è¦æ ¹æ®ç¯å¢ƒè°ƒæ•´å¯¼å…¥æ–¹å¼\r\n        // è¿™é‡Œç®€åŒ–å¤„ç†\r\n        try {\r\n          // å°è¯•ä»ç›¸å¯¹è·¯å¾„åŠ è½½\r\n          const response = await fetch(config);\r\n          if (!response.ok) {\r\n            throw new Error(`åŠ è½½é…ç½®å¤±è´¥: ${response.statusText}`);\r\n          }\r\n          return await response.json();\r\n        } catch (error) {\r\n          throw new Error(`åŠ è½½é…ç½®å¤±è´¥: ${error instanceof Error ? error.message : String(error)}`);\r\n        }\r\n      }\r\n    } else {\r\n      return config;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * è·å–æ•°æ®\r\n   * @param dataSource æ•°æ®æºé…ç½®\r\n   * @param extraParams é¢å¤–çš„æŸ¥è¯¢å‚æ•°\r\n   * @returns APIå“åº”å¯¹è±¡\r\n   */\r\n  private async _fetchData(\r\n    dataSource: DDRConfig['dataSource'],\r\n    extraParams?: Record<string, any>\r\n  ): Promise<{\r\n    records: any[];\r\n    metadata?: Record<string, any>;\r\n    pagination?: Record<string, any>;\r\n  }> {\r\n    // ä¼˜å…ˆçº§1ï¼šå¦‚æœç›´æ¥æä¾›äº†æ•°æ®ï¼Œåˆ™ä½¿ç”¨ç›´æ¥æ•°æ®\r\n    if (dataSource.data && Array.isArray(dataSource.data)) {\r\n      console.log('ğŸ“Š ä½¿ç”¨ç›´æ¥æä¾›çš„æ•°æ®ï¼Œå…±', dataSource.data.length, 'æ¡è®°å½•');\r\n      return {\r\n        records: dataSource.data,\r\n        metadata: this.metadata\r\n      };\r\n    }\r\n\r\n    // ä¼˜å…ˆçº§2ï¼šå¦‚æœæœ‰æ¨¡æ‹Ÿæ•°æ®åˆ™ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®\r\n    if (dataSource.mock && (!this.options.debug || window.location.hostname === 'localhost')) {\r\n      console.log('ğŸ“Š ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼Œå…±', dataSource.mock.length, 'æ¡è®°å½•');\r\n      return {\r\n        records: dataSource.mock,\r\n        metadata: this.metadata\r\n      };\r\n    }\r\n\r\n    // ä¼˜å…ˆçº§3ï¼šå¦‚æœæ²¡æœ‰APIé…ç½®ï¼Œåˆ™è¿”å›ç©ºæ•°æ®\r\n    if (!dataSource.api) {\r\n      console.warn('âš ï¸ æœªé…ç½®APIåœ°å€ä¸”æœªæä¾›ç›´æ¥æ•°æ®ï¼Œè¿”å›ç©ºæ•°æ®é›†');\r\n      return {\r\n        records: [],\r\n        metadata: this.metadata\r\n      };\r\n    }\r\n\r\n    // åˆå¹¶å‚æ•°\r\n    const params = { ...dataSource.params, ...this.filters, ...extraParams };\r\n\r\n    // æ„å»ºè¯·æ±‚é€‰é¡¹\r\n    const options: RequestInit = {\r\n      method: dataSource.method || 'GET',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        ...(dataSource.headers || {})\r\n      }\r\n    };\r\n\r\n    // å¯¹äºPOSTè¯·æ±‚ï¼Œæ·»åŠ body\r\n    if (options.method === 'POST') {\r\n      options.body = JSON.stringify(params);\r\n    }\r\n\r\n    // å¯¹äºGETè¯·æ±‚ï¼Œæ·»åŠ æŸ¥è¯¢å‚æ•°\r\n    let url = dataSource.api;\r\n    if (options.method === 'GET' && Object.keys(params).length > 0) {\r\n      const queryParams = new URLSearchParams();\r\n      Object.entries(params).forEach(([key, value]) => {\r\n        queryParams.append(key, String(value));\r\n      });\r\n      url += `?${queryParams.toString()}`;\r\n    }\r\n\r\n    // å‘é€è¯·æ±‚\r\n    const response = await fetch(url, options);\r\n    if (!response.ok) {\r\n      throw new Error(`APIè¯·æ±‚å¤±è´¥: ${response.statusText}`);\r\n    }\r\n\r\n    // è§£æå“åº”\r\n    const result: APIResponse = await response.json();\r\n\r\n    // æ£€æŸ¥APIè¿”å›çŠ¶æ€\r\n    if (!result.success) {\r\n      throw new Error(`APIé”™è¯¯: ${result.message || `çŠ¶æ€ç  ${result.code}`}`);\r\n    }\r\n\r\n    // æå–æ•°æ®\r\n    return {\r\n      records: result.data.records || [],\r\n      metadata: result.data.metadata,\r\n      pagination: result.data.pagination\r\n    };\r\n  }\r\n\r\n  /**\r\n   * è·å–å…ƒæ•°æ®\r\n   * @param metadataSource å…ƒæ•°æ®æºé…ç½®\r\n   * @returns å…ƒæ•°æ®å¯¹è±¡\r\n   */\r\n  private async _fetchMetadata(metadataSource: DDRConfig['dataSource']['metadataSource']): Promise<{\r\n    metadata: Record<string, any>;\r\n  }> {\r\n    if (!metadataSource) {\r\n      throw new Error('æœªé…ç½®å…ƒæ•°æ®æº');\r\n    }\r\n\r\n    // æ„å»ºè¯·æ±‚é€‰é¡¹\r\n    const options: RequestInit = {\r\n      method: metadataSource.method || 'GET',\r\n      headers: {\r\n        'Content-Type': 'application/json'\r\n      }\r\n    };\r\n\r\n    // å¯¹äºPOSTè¯·æ±‚ï¼Œæ·»åŠ body\r\n    if (options.method === 'POST' && metadataSource.params) {\r\n      options.body = JSON.stringify(metadataSource.params);\r\n    }\r\n\r\n    // å¯¹äºGETè¯·æ±‚ï¼Œæ·»åŠ æŸ¥è¯¢å‚æ•°\r\n    let url = metadataSource.api;\r\n    if (options.method === 'GET' && metadataSource.params && Object.keys(metadataSource.params).length > 0) {\r\n      const queryParams = new URLSearchParams();\r\n      Object.entries(metadataSource.params).forEach(([key, value]) => {\r\n        queryParams.append(key, String(value));\r\n      });\r\n      url += `?${queryParams.toString()}`;\r\n    }\r\n\r\n    // å‘é€è¯·æ±‚\r\n    const response = await fetch(url, options);\r\n    if (!response.ok) {\r\n      throw new Error(`å…ƒæ•°æ®APIè¯·æ±‚å¤±è´¥: ${response.statusText}`);\r\n    }\r\n\r\n    // è§£æå“åº”\r\n    const result: APIResponse = await response.json();\r\n\r\n    // æ£€æŸ¥APIè¿”å›çŠ¶æ€\r\n    if (!result.success) {\r\n      throw new Error(`å…ƒæ•°æ®APIé”™è¯¯: ${result.message || `çŠ¶æ€ç  ${result.code}`}`);\r\n    }\r\n\r\n    // æå–å…ƒæ•°æ®\r\n    return {\r\n      metadata: result.data.metadata || {}\r\n    };\r\n  }\r\n\r\n  /**\r\n   * æ¸²æŸ“æŠ¥è¡¨\r\n   */\r\n  private _render(): void {\r\n    // æ¸…ç©ºå®¹å™¨\r\n    this.container.innerHTML = '';\r\n\r\n    // åˆ›å»ºåŒ…è£…å™¨\r\n    const wrapper = document.createElement('div');\r\n    wrapper.className = 'ddr-wrapper';\r\n\r\n    // åº”ç”¨å¸ƒå±€è®¾ç½®\r\n    if (this.config.layout) {\r\n      if (this.config.layout.height) {\r\n        wrapper.style.height = typeof this.config.layout.height === 'number'\r\n          ? `${this.config.layout.height}px`\r\n          : this.config.layout.height;\r\n      }\r\n\r\n      if (this.config.layout.bordered) {\r\n        wrapper.classList.add('ddr-bordered');\r\n      }\r\n    }\r\n\r\n    this.container.appendChild(wrapper);\r\n\r\n    // æ ¹æ®æ•°æ®é‡é€‰æ‹©æ¸²æŸ“æ¨¡å¼\r\n    const renderMode = this._determineRenderMode();\r\n    wrapper.setAttribute('data-render-mode', renderMode);\r\n\r\n    // æ¸²æŸ“è¡¨å¤´å’Œè¡¨å°¾\r\n    this._renderHeaderFooter(wrapper);\r\n\r\n    // æ¸²æŸ“æ•°æ®è¡¨æ ¼\r\n    if (renderMode === 'canvas') {\r\n      this._renderCanvas(wrapper);\r\n    } else {\r\n      this._renderDOM(wrapper);\r\n    }\r\n\r\n    // æ·»åŠ æ°´å°\r\n    if (this.config.features?.watermark) {\r\n      this._addWatermark(wrapper, this.config.features.watermark);\r\n    }\r\n\r\n    this._emitEvent('render-complete');\r\n  }  /**\r\n   * æ¸²æŸ“è¡¨å¤´å’Œè¡¨å°¾\r\n   * @param container å®¹å™¨å…ƒç´ \r\n   */\r\n  private _renderHeaderFooter(container?: HTMLElement): void {\r\n    const wrapper = container || this.container.querySelector('.ddr-wrapper') as HTMLElement;\r\n    if (!wrapper) return;\r\n\r\n    // ç§»é™¤æ—§çš„è¡¨å¤´å’Œè¡¨å°¾\r\n    const oldHeader = wrapper.querySelector('.ddr-report-header');\r\n    const oldFooter = wrapper.querySelector('.ddr-report-footer');\r\n\r\n    if (oldHeader) {\r\n      wrapper.removeChild(oldHeader);\r\n    }\r\n\r\n    if (oldFooter) {\r\n      wrapper.removeChild(oldFooter);\r\n    }\r\n\r\n    // æ·»åŠ æ–°çš„è¡¨å¤´\r\n    if (this.config.header) {\r\n      const header = this._createHeader(this.config.header);\r\n      if (header) {\r\n        wrapper.insertBefore(header, wrapper.firstChild);\r\n\r\n        // ä½¿ç”¨MutationObserverç›‘å¬è¡¨å¤´é«˜åº¦å˜åŒ–\r\n        const resizeObserver = new ResizeObserver((entries) => {\r\n          for (const entry of entries) {\r\n            // è·å–å‡†ç¡®çš„headeré«˜åº¦\r\n            const headerHeight = entry.contentRect.height;\r\n            wrapper.style.setProperty('--header-height', `${headerHeight}px`);\r\n\r\n            // ç¡®ä¿è¡¨æ ¼å®¹å™¨çš„ä½ç½®å’Œé«˜åº¦æ­£ç¡®\r\n            const tableContainer = wrapper.querySelector('.ddr-table-container') as HTMLElement;\r\n            if (tableContainer) {\r\n              // ä¸å†ç›´æ¥è®¾ç½®topï¼Œä½¿ç”¨marginæ¥æ§åˆ¶ä½ç½®ï¼Œé¿å…ç»å¯¹å®šä½å¯¼è‡´çš„é‡å \r\n              tableContainer.style.marginTop = '10px';\r\n              tableContainer.style.maxHeight = `calc(100% - ${headerHeight + 10}px - var(--footer-height, 0px))`;\r\n            }\r\n          }\r\n        });\r\n\r\n        // å¼€å§‹ç›‘å¬è¡¨å¤´å°ºå¯¸å˜åŒ–\r\n        resizeObserver.observe(header);\r\n\r\n        // ç«‹å³æ‰§è¡Œä¸€æ¬¡è®¡ç®—\r\n        const headerHeight = header.getBoundingClientRect().height;\r\n        wrapper.style.setProperty('--header-height', `${headerHeight}px`);\r\n\r\n        // ç¡®ä¿è¡¨æ ¼å®¹å™¨çš„é«˜åº¦å’Œä½ç½®æ­£ç¡®\r\n        const tableContainer = wrapper.querySelector('.ddr-table-container') as HTMLElement;\r\n        if (tableContainer) {\r\n          tableContainer.style.marginTop = '10px';\r\n          tableContainer.style.maxHeight = `calc(100% - ${headerHeight + 10}px - var(--footer-height, 0px))`;\r\n        }\r\n      }\r\n    }\r\n      // è¡¨å°¾ç°åœ¨åœ¨_renderDOMä¸­å¤„ç†\r\n    // åˆå§‹æ¸²æŸ“æ—¶ä¸å†åœ¨è¿™é‡Œæ·»åŠ é¡µè„šï¼Œè€Œæ˜¯åœ¨æ¸²æŸ“å®Œè¡¨æ ¼åæ·»åŠ \r\n    // è¿™æ ·å¯ä»¥ç¡®ä¿é¡µè„šæ”¾ç½®åœ¨è¡¨æ ¼å®¹å™¨ä¹‹å\r\n    if (this.config.footer && this.initialized) {\r\n      // åªåœ¨åˆ·æ–°å…ƒæ•°æ®æ—¶æ·»åŠ é¡µè„š\r\n      const footer = this._createFooter(this.config.footer);\r\n      if (footer) {\r\n        // å°è¯•æŸ¥æ‰¾è¡¨æ ¼å®¹å™¨ï¼Œå¦‚æœæ‰¾åˆ°åˆ™åœ¨å…¶åæ·»åŠ é¡µè„š\r\n        const tableContainer = wrapper.querySelector('.ddr-table-container');\r\n        if (tableContainer) {\r\n          wrapper.insertBefore(footer, tableContainer.nextSibling);\r\n        } else {\r\n          wrapper.appendChild(footer);\r\n        }\r\n      }\r\n    }\r\n  }\r\n    /**\r\n   * åˆ›å»ºè¡¨å¤´\r\n   * @param headerConfig è¡¨å¤´é…ç½®\r\n   * @returns è¡¨å¤´å…ƒç´ \r\n   */\r\n  private _createHeader(headerConfig: DDRConfig['header']): HTMLElement | null {\r\n    if (!headerConfig) return null;\r\n\r\n    const headerElement = document.createElement('div');\r\n    headerElement.className = 'ddr-report-header';\r\n    // ä¸å†è®¾ç½®å›ºå®šé«˜åº¦ï¼Œæ”¹ä¸ºæœ€å°é«˜åº¦ï¼Œè®©å…¶è‡ªåŠ¨é€‚åº”å†…å®¹\r\n    headerElement.style.minHeight = `${headerConfig.height || 80}px`;\r\n\r\n    // åˆ›å»ºé¡¶éƒ¨åŒºåŸŸå®¹å™¨ï¼ˆLogo + æ ‡é¢˜ï¼‰\r\n    const topContainer = document.createElement('div');\r\n    topContainer.className = 'ddr-header-top';\r\n\r\n    // æ¸²æŸ“Logo\r\n    if (headerConfig.logo) {\r\n      const logoContainer = document.createElement('div');\r\n      logoContainer.className = `ddr-header-logo ddr-header-logo-${headerConfig.logo.position || 'left'}`;\r\n\r\n      const logoImg = document.createElement('img');\r\n      logoImg.alt = 'Logo';\r\n      // ä¼˜å…ˆä½¿ç”¨å…ƒæ•°æ®ä¸­çš„logo\r\n      logoImg.src = headerConfig.logo.metadataKey\r\n        ? this._getValueByPath(headerConfig.logo.metadataKey) || headerConfig.logo.url || ''\r\n        : headerConfig.logo.url || '';\r\n\r\n      if (headerConfig.logo.width) {\r\n        logoImg.width = headerConfig.logo.width;\r\n      }\r\n\r\n      if (headerConfig.logo.height) {\r\n        logoImg.height = headerConfig.logo.height;\r\n      }\r\n\r\n      logoContainer.appendChild(logoImg);\r\n      topContainer.appendChild(logoContainer);\r\n    }\r\n\r\n    // åˆ›å»ºä¸­é—´æ ‡é¢˜åŒºåŸŸ\r\n    const centerContainer = document.createElement('div');\r\n    centerContainer.className = 'ddr-header-center';\r\n\r\n    // æ¸²æŸ“æ ‡é¢˜åˆ°ä¸­é—´åŒºåŸŸ\r\n    if (headerConfig.title) {\r\n      const titleText = typeof headerConfig.title === 'string'\r\n        ? headerConfig.title\r\n        : headerConfig.title.metadataPath\r\n          ? this._getValueByPath(headerConfig.title.metadataPath) || headerConfig.title.text\r\n          : headerConfig.title.text;\r\n\r\n      const titleElement = document.createElement('h2');\r\n      titleElement.className = 'ddr-header-title';\r\n      titleElement.textContent = titleText;\r\n\r\n      if (typeof headerConfig.title === 'object' && headerConfig.title.style) {\r\n        Object.assign(titleElement.style, headerConfig.title.style);\r\n      }\r\n\r\n      centerContainer.appendChild(titleElement);\r\n    }\r\n\r\n    // æ¸²æŸ“å‰¯æ ‡é¢˜åˆ°ä¸­é—´åŒºåŸŸ\r\n    if (headerConfig.subtitle) {\r\n      const subtitleElement = document.createElement('div');\r\n      subtitleElement.className = 'ddr-header-subtitle';\r\n      subtitleElement.textContent = headerConfig.subtitle;\r\n      centerContainer.appendChild(subtitleElement);\r\n    }\r\n\r\n    topContainer.appendChild(centerContainer);\r\n    headerElement.appendChild(topContainer);\r\n\r\n    // æ¸²æŸ“å­—æ®µ\r\n    if (headerConfig.fields && headerConfig.fields.length > 0) {\r\n      const fieldsContainer = document.createElement('div');\r\n      fieldsContainer.className = 'ddr-header-fields';\r\n\r\n      const leftFields = document.createElement('div');\r\n      leftFields.className = 'ddr-header-fields-left';\r\n\r\n      const rightFields = document.createElement('div');\r\n      rightFields.className = 'ddr-header-fields-right';\r\n\r\n      headerConfig.fields.forEach(field => {\r\n        const fieldElement = document.createElement('div');\r\n        fieldElement.className = 'ddr-header-field';\r\n\r\n        // åˆ›å»ºæ ‡ç­¾\r\n        const labelElement = document.createElement('span');\r\n        labelElement.className = 'ddr-field-label';\r\n        labelElement.textContent = field.label || '';\r\n        fieldElement.appendChild(labelElement);\r\n\r\n        // åˆ›å»ºå€¼\r\n        const valueElement = document.createElement('span');\r\n        valueElement.className = 'ddr-field-value';\r\n\r\n        // ä¼˜å…ˆä»å…ƒæ•°æ®è·å–å€¼\r\n        let value = field.metadataPath\r\n          ? this._getValueByPath(field.metadataPath)\r\n          : field.value || '';\r\n\r\n        // åº”ç”¨æ ¼å¼åŒ–å‡½æ•°(å¦‚æœæœ‰)\r\n        if (value !== undefined && field.formatter && this.formatters[field.formatter]) {\r\n          value = this.formatters[field.formatter](value);\r\n        }\r\n\r\n        valueElement.textContent = value !== undefined ? String(value) : '';\r\n        fieldElement.appendChild(valueElement);\r\n\r\n        // åº”ç”¨è‡ªå®šä¹‰æ ·å¼\r\n        if (field.style) {\r\n          Object.assign(fieldElement.style, field.style);\r\n        }\r\n\r\n        // æ ¹æ®ä½ç½®æ·»åŠ åˆ°å·¦ä¾§æˆ–å³ä¾§\r\n        if (field.position === 'right') {\r\n          rightFields.appendChild(fieldElement);\r\n        } else {\r\n          leftFields.appendChild(fieldElement);\r\n        }\r\n      });\r\n\r\n      fieldsContainer.appendChild(leftFields);\r\n      fieldsContainer.appendChild(rightFields);\r\n      headerElement.appendChild(fieldsContainer);\r\n    }\r\n\r\n    return headerElement;\r\n  }\r\n\r\n  /**\r\n   * åˆ›å»ºè¡¨å°¾\r\n   * @param footerConfig è¡¨å°¾é…ç½®\r\n   * @returns è¡¨å°¾å…ƒç´ \r\n   */  private _createFooter(footerConfig: DDRConfig['footer']): HTMLElement | null {\r\n    if (!footerConfig) return null;\r\n\r\n    const footerElement = document.createElement('div');\r\n    footerElement.className = 'ddr-report-footer';\r\n    // æ”¹ä¸ºæœ€å°é«˜åº¦è€Œä¸æ˜¯å›ºå®šé«˜åº¦ï¼Œå…è®¸å†…å®¹å¢åŠ æ—¶è‡ªåŠ¨æ‰©å±•\r\n    footerElement.style.minHeight = `${footerConfig.height || 100}px`;\r\n\r\n    // å¦‚æœéœ€è¦å›ºå®šåœ¨åº•éƒ¨\r\n    if (footerConfig.fixed) {\r\n      footerElement.classList.add('ddr-footer-fixed');\r\n    }\r\n\r\n    // æ¸²æŸ“æ±‡æ€»è¡Œ\r\n    if (footerConfig.summary && footerConfig.summary.length > 0) {\r\n      const summaryElement = document.createElement('div');\r\n      summaryElement.className = 'ddr-footer-summary';\r\n\r\n      footerConfig.summary.forEach(summaryConfig => {\r\n        const summaryItem = document.createElement('div');\r\n        summaryItem.className = 'ddr-summary-item';\r\n\r\n        const labelElement = document.createElement('span');\r\n        labelElement.className = 'ddr-summary-label';\r\n        labelElement.textContent = `${summaryConfig.column}åˆè®¡:`;\r\n\r\n        const valueElement = document.createElement('span');\r\n        valueElement.className = 'ddr-summary-value';\r\n\r\n        // è·å–æ±‡æ€»å€¼ï¼Œä¼˜å…ˆä½¿ç”¨å…ƒæ•°æ®ä¸­çš„é¢„è®¡ç®—å€¼\r\n        let summaryValue;\r\n        if (summaryConfig.metadataPath) {\r\n          summaryValue = this._getValueByPath(summaryConfig.metadataPath);\r\n        } else {\r\n          // å‰ç«¯è®¡ç®—æ±‡æ€»å€¼\r\n          summaryValue = this._calculateSummary(this.data, summaryConfig);\r\n        }\r\n\r\n        // åº”ç”¨æ ¼å¼åŒ–å‡½æ•°(å¦‚æœæœ‰)\r\n        if (summaryConfig.formatter && this.formatters[summaryConfig.formatter]) {\r\n          summaryValue = this.formatters[summaryConfig.formatter](summaryValue);\r\n        }\r\n\r\n        valueElement.textContent = summaryValue !== undefined ? String(summaryValue) : '';\r\n\r\n        summaryItem.appendChild(labelElement);\r\n        summaryItem.appendChild(valueElement);\r\n        summaryElement.appendChild(summaryItem);\r\n      });\r\n\r\n      footerElement.appendChild(summaryElement);\r\n    }\r\n\r\n    // æ¸²æŸ“å­—æ®µ\r\n    if (footerConfig.fields && footerConfig.fields.length > 0) {\r\n      const fieldsContainer = document.createElement('div');\r\n      fieldsContainer.className = 'ddr-footer-fields';\r\n\r\n      footerConfig.fields.forEach(field => {\r\n        const fieldElement = document.createElement('div');\r\n        fieldElement.className = `ddr-footer-field ddr-align-${field.position || 'left'}`;\r\n\r\n        // åˆ›å»ºæ ‡ç­¾\r\n        const labelElement = document.createElement('span');\r\n        labelElement.className = 'ddr-field-label';\r\n        labelElement.textContent = field.label || '';\r\n        fieldElement.appendChild(labelElement);\r\n\r\n        // åˆ›å»ºå€¼\r\n        const valueElement = document.createElement('span');\r\n        valueElement.className = 'ddr-field-value';\r\n\r\n        // ä¼˜å…ˆä»å…ƒæ•°æ®è·å–å€¼\r\n        let value = field.metadataPath\r\n          ? this._getValueByPath(field.metadataPath)\r\n          : field.value || '';\r\n\r\n        // åº”ç”¨æ ¼å¼åŒ–å‡½æ•°(å¦‚æœæœ‰)\r\n        if (value !== undefined && field.formatter && this.formatters[field.formatter]) {\r\n          value = this.formatters[field.formatter](value);\r\n        }\r\n\r\n        valueElement.textContent = value !== undefined ? String(value) : '';\r\n        fieldElement.appendChild(valueElement);\r\n\r\n        // åº”ç”¨è‡ªå®šä¹‰æ ·å¼\r\n        if (field.style) {\r\n          Object.assign(fieldElement.style, field.style);\r\n        }\r\n\r\n        fieldsContainer.appendChild(fieldElement);\r\n      });\r\n\r\n      footerElement.appendChild(fieldsContainer);\r\n    }\r\n\r\n    // æ¸²æŸ“ç­¾ååŒºåŸŸ\r\n    if (footerConfig.signatures && footerConfig.signatures.length > 0) {\r\n      const signaturesElement = document.createElement('div');\r\n      signaturesElement.className = 'ddr-footer-signatures';\r\n\r\n      footerConfig.signatures.forEach(signature => {\r\n        const signatureItem = document.createElement('div');\r\n        signatureItem.className = 'ddr-signature-item';\r\n\r\n        // ç­¾åæ ‡ç­¾\r\n        const labelElement = document.createElement('div');\r\n        labelElement.className = 'ddr-signature-label';\r\n        labelElement.textContent = signature.label || '';\r\n        signatureItem.appendChild(labelElement);\r\n\r\n        // ç­¾åäºº\r\n        const nameElement = document.createElement('div');\r\n        nameElement.className = 'ddr-signature-name';\r\n\r\n        // ä¼˜å…ˆä»å…ƒæ•°æ®è·å–ç­¾åäºº\r\n        const name = signature.metadataPath\r\n          ? this._getValueByPath(signature.metadataPath)\r\n          : signature.name || '';\r\n\r\n        nameElement.textContent = name || '';\r\n        signatureItem.appendChild(nameElement);\r\n\r\n        // æ—¥æœŸ\r\n        if (signature.showTimestamp) {\r\n          const dateElement = document.createElement('div');\r\n          dateElement.className = 'ddr-signature-date';\r\n\r\n          // è·å–æ—¶é—´æˆ³\r\n          const timestamp = signature.dateMetadataPath\r\n            ? this._getValueByPath(signature.dateMetadataPath)\r\n            : null;\r\n\r\n          if (timestamp) {\r\n            dateElement.textContent = new Date(timestamp).toLocaleDateString();\r\n          }\r\n\r\n          signatureItem.appendChild(dateElement);\r\n        }\r\n\r\n        if (signature.width) {\r\n          signatureItem.style.width = `${signature.width}px`;\r\n        }\r\n\r\n        signaturesElement.appendChild(signatureItem);\r\n      });\r\n\r\n      footerElement.appendChild(signaturesElement);\r\n    }\r\n\r\n    // æ¸²æŸ“æ³¨é‡Š\r\n    if (footerConfig.notes) {\r\n      const notesElement = document.createElement('div');\r\n      notesElement.className = 'ddr-footer-notes';\r\n      notesElement.textContent = footerConfig.notes;\r\n      footerElement.appendChild(notesElement);\r\n    }\r\n\r\n    // æ¸²æŸ“é¡µç ä¿¡æ¯\r\n    if (footerConfig.pageInfo && this.pagination) {\r\n      const pageElement = document.createElement('div');\r\n      pageElement.className = `ddr-footer-page ddr-align-${footerConfig.pageInfo.position || 'right'}`;\r\n\r\n      // æ ¼å¼åŒ–é¡µç \r\n      const pageText = footerConfig.pageInfo.format\r\n        .replace('{current}', String(this.pagination.pageNumber || 1))\r\n        .replace('{total}', String(this.pagination.totalPages || 1));\r\n\r\n      pageElement.textContent = pageText;\r\n      footerElement.appendChild(pageElement);\r\n    }\r\n\r\n    return footerElement;\r\n  }\r\n\r\n  /**\r\n   * è®¡ç®—æ±‡æ€»å€¼\r\n   * @param data æ•°æ®æ•°ç»„\r\n   * @param summary æ±‡æ€»é…ç½®\r\n   * @returns æ±‡æ€»å€¼\r\n   */\r\n  private _calculateSummary(data: any[], summary: { column: string; type: string; }): any {\r\n    if (!data.length) return 0;\r\n\r\n    const values = data.map(item => {\r\n      const value = item[summary.column];\r\n      return typeof value === 'number' ? value : 0;\r\n    });\r\n\r\n    switch (summary.type) {\r\n      case 'sum':\r\n        return values.reduce((sum, val) => sum + val, 0);\r\n      case 'avg':\r\n        return values.reduce((sum, val) => sum + val, 0) / values.length;\r\n      case 'count':\r\n        return values.length;\r\n      default:\r\n        return 0;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ç¡®å®šæ¸²æŸ“æ¨¡å¼\r\n   * @returns æ¸²æŸ“æ¨¡å¼ 'dom' æˆ– 'canvas'\r\n   */\r\n  private _determineRenderMode(): 'dom' | 'canvas' {\r\n    // å¦‚æœç”¨æˆ·æŒ‡å®šäº†æ¸²æŸ“æ¨¡å¼\r\n    if (this.options.mode === 'dom' || this.options.mode === 'canvas') {\r\n      return this.options.mode;\r\n    }\r\n\r\n    // æ ¹æ®æ•°æ®é‡è‡ªåŠ¨é€‰æ‹©\r\n    if (this.data.length > 5000) {\r\n      return 'canvas';\r\n    }\r\n\r\n    return 'dom';\r\n  }\r\n    /**\r\n   * DOMæ¨¡å¼æ¸²æŸ“\r\n   * @param container å®¹å™¨å…ƒç´ \r\n   */  private _renderDOM(container: HTMLElement): void {\r\n    // åˆ›å»ºè¡¨æ ¼å®¹å™¨\r\n    const tableContainer = document.createElement('div');\r\n    tableContainer.className = 'ddr-table-container';    // æ£€æŸ¥æ˜¯å¦æœ‰æŠ¥è¡¨å¤´éƒ¨ï¼Œå¦‚æœæœ‰ï¼Œç¡®ä¿è¡¨æ ¼å®¹å™¨æœ‰æ­£ç¡®çš„topå€¼\r\n    const headerElement = container.querySelector('.ddr-report-header') as HTMLElement;\r\n    if (headerElement) {\r\n      // ä½¿ç”¨ResizeObserverç›‘å¬è¡¨å¤´å®é™…é«˜åº¦å˜åŒ–\r\n      if (window.ResizeObserver) {\r\n        const resizeObserver = new ResizeObserver(entries => {\r\n          for (const entry of entries) {\r\n            if (entry.target === headerElement) {\r\n              const contentRect = entry.contentRect;\r\n              const headerHeight = contentRect.height;\r\n              // æ›´æ–°CSSå˜é‡\r\n              container.style.setProperty('--header-height', `${headerHeight}px`);\r\n              container.style.setProperty('--table-offset-top', `${headerHeight}px`);\r\n              // ç¡®ä¿è¡¨æ ¼å®¹å™¨æœ‰è¶³å¤Ÿçš„é—´è·\r\n              tableContainer.style.marginTop = '20px';\r\n            }\r\n          }\r\n        });\r\n        resizeObserver.observe(headerElement);\r\n      } else {\r\n        // å…¼å®¹æ€§æ–¹æ¡ˆï¼šä½¿ç”¨getBoundingClientRectå’Œresizeäº‹ä»¶ç›‘å¬\r\n        const updateHeaderSize = () => {\r\n          const headerHeight = headerElement.getBoundingClientRect().height;\r\n          container.style.setProperty('--header-height', `${headerHeight}px`);\r\n          container.style.setProperty('--table-offset-top', `${headerHeight}px`);\r\n          tableContainer.style.marginTop = '20px';\r\n        };\r\n\r\n        updateHeaderSize(); // ç«‹å³æ‰§è¡Œä¸€æ¬¡\r\n        window.addEventListener('resize', updateHeaderSize);\r\n      }\r\n    }\r\n\r\n    const tableWrapper = document.createElement('div');\r\n    tableWrapper.className = 'ddr-table-wrapper';\r\n\r\n    const table = document.createElement('table');\r\n    table.className = 'ddr-table';\r\n\r\n    // åº”ç”¨è¡¨æ ¼æ ·å¼\r\n    if (this.config.layout) {\r\n      if (this.config.layout.stripe) {\r\n        table.classList.add('ddr-table-stripe');\r\n      }\r\n\r\n      if (this.config.layout.hover) {\r\n        table.classList.add('ddr-table-hover');\r\n      }\r\n    }\r\n\r\n    // åˆ›å»ºè¡¨å¤´\r\n    const thead = this._createTableHeader(this.config.columns);\r\n    table.appendChild(thead);\r\n\r\n    // åˆ›å»ºè¡¨ä½“\r\n    const tbody = this._createTableBody(this.config.columns, this.data);\r\n    table.appendChild(tbody);\r\n      tableWrapper.appendChild(table);\r\n    tableContainer.appendChild(tableWrapper);\r\n    container.appendChild(tableContainer);\r\n      // å¦‚æœéœ€è¦åˆ†é¡µ\r\n    if (this.config.features?.pagination && this.pagination) {\r\n      const paginationElement = this._createPagination(this.pagination);\r\n      container.appendChild(paginationElement);\r\n    }\r\n\r\n    // åœ¨æ¸²æŸ“å®Œè¡¨æ ¼åï¼Œå•ç‹¬å¤„ç†é¡µè„šæ·»åŠ \r\n    if (this.config.footer) {\r\n      const footer = this._createFooter(this.config.footer);\r\n      if (footer) {\r\n        // ç¡®ä¿é¡µè„šåœ¨è¡¨æ ¼å®¹å™¨ä¹‹åæ·»åŠ ï¼Œè€Œä¸æ˜¯åŒ…è£…åœ¨ddr-table-containerå†…éƒ¨\r\n        container.appendChild(footer);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Canvasæ¨¡å¼æ¸²æŸ“(å¤§æ•°æ®é‡)\r\n   * @param container å®¹å™¨å…ƒç´ \r\n   */\r\n  private _renderCanvas(container: HTMLElement): void {\r\n    // å¯¹äºå®é™…é¡¹ç›®ï¼Œå¯èƒ½éœ€è¦å¼•å…¥ä¸“é—¨çš„Canvasæ¸²æŸ“åº“\r\n    // è¿™é‡Œç®€åŒ–å¤„ç†ï¼Œä»…æ˜¾ç¤ºä¸€ä¸ªæç¤ºä¿¡æ¯\r\n    const placeholder = document.createElement('div');\r\n    placeholder.className = 'ddr-canvas-placeholder';\r\n    placeholder.textContent = `ä½¿ç”¨Canvasæ¨¡å¼æ¸²æŸ“${this.data.length}è¡Œæ•°æ®`;\r\n    container.appendChild(placeholder);\r\n\r\n    console.log('å®é™…é¡¹ç›®ä¸­éœ€è¦å®ç°Canvasæ¸²æŸ“å¼•æ“');\r\n\r\n    // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œä¼šå¼•å…¥Canvasæ¸²æŸ“å¼•æ“\r\n    // ä¾‹å¦‚: await import('../core/render-engine/canvas-renderer')\r\n  }\r\n\r\n  /**\r\n   * åˆ›å»ºè¡¨å¤´\r\n   * @param columns åˆ—é…ç½®\r\n   * @returns è¡¨å¤´å…ƒç´ \r\n   */\r\n  private _createTableHeader(columns: Array<any>): HTMLElement {\r\n    const thead = document.createElement('thead');\r\n    thead.className = 'ddr-thead';\r\n\r\n    // å¤„ç†åµŒå¥—è¡¨å¤´çš„æƒ…å†µ\r\n    const rowCount = this._calculateHeaderRowCount(columns);\r\n    const rows: HTMLElement[] = Array(rowCount).fill(null).map(() => {\r\n      const tr = document.createElement('tr');\r\n      tr.className = 'ddr-header-row';\r\n      return tr;\r\n    });\r\n\r\n    // å¡«å……è¡¨å¤´å•å…ƒæ ¼\r\n    this._fillHeaderCells(columns, rows, 0, 0);\r\n\r\n    // å°†è¡Œæ·»åŠ åˆ°è¡¨å¤´\r\n    rows.forEach(row => {\r\n      thead.appendChild(row);\r\n    });\r\n\r\n    return thead;\r\n  }\r\n\r\n  /**\r\n   * è®¡ç®—è¡¨å¤´è¡Œæ•°\r\n   * @param columns åˆ—é…ç½®\r\n   * @returns è¡Œæ•°\r\n   */\r\n  private _calculateHeaderRowCount(columns: Array<any>): number {\r\n    let maxDepth = 1;\r\n\r\n    const traverse = (cols: Array<any>, currentDepth: number = 1): void => {\r\n      cols.forEach(col => {\r\n        if (col.children && col.children.length) {\r\n          maxDepth = Math.max(maxDepth, currentDepth + 1);\r\n          traverse(col.children, currentDepth + 1);\r\n        }\r\n      });\r\n    };\r\n\r\n    traverse(columns);\r\n    return maxDepth;\r\n  }\r\n\r\n  /**\r\n   * å¡«å……è¡¨å¤´å•å…ƒæ ¼\r\n   * @param columns åˆ—é…ç½®\r\n   * @param rows è¡Œå…ƒç´ æ•°ç»„\r\n   * @param rowIndex å½“å‰è¡Œç´¢å¼•\r\n   * @param colIndex å½“å‰åˆ—ç´¢å¼•\r\n   * @returns å ç”¨çš„åˆ—æ•°\r\n   */\r\n  private _fillHeaderCells(\r\n    columns: Array<any>,\r\n    rows: HTMLElement[],\r\n    rowIndex: number,\r\n    colIndex: number\r\n  ): number {\r\n    let currentColIndex = colIndex;\r\n\r\n    columns.forEach(column => {\r\n      const cell = document.createElement('th');\r\n      cell.className = 'ddr-header-cell';\r\n      cell.textContent = column.title;\r\n\r\n      // è®¾ç½®å•å…ƒæ ¼æ ·å¼\r\n      if (column.align) {\r\n        cell.style.textAlign = column.align;\r\n      }\r\n\r\n      if (column.width) {\r\n        cell.style.width = typeof column.width === 'number' ? `${column.width}px` : column.width;\r\n      }\r\n\r\n      // å¦‚æœæœ‰å­åˆ—ï¼Œåˆ™è®¾ç½®colspanå’Œrowspan\r\n      if (column.children && column.children.length) {\r\n        const childColSpan = this._fillHeaderCells(column.children, rows, rowIndex + 1, currentColIndex);\r\n        cell.colSpan = childColSpan;\r\n        cell.rowSpan = 1;\r\n        currentColIndex += childColSpan;\r\n      } else {\r\n        cell.colSpan = 1;\r\n        cell.rowSpan = rows.length - rowIndex;\r\n        currentColIndex += 1;\r\n      }\r\n\r\n      rows[rowIndex].appendChild(cell);\r\n    });\r\n\r\n    return currentColIndex - colIndex;\r\n  }\r\n\r\n  /**\r\n   * åˆ›å»ºè¡¨ä½“\r\n   * @param columns åˆ—é…ç½®\r\n   * @param data æ•°æ®æ•°ç»„\r\n   * @returns è¡¨ä½“å…ƒç´ \r\n   */\r\n  private _createTableBody(columns: Array<any>, data: Array<any>): HTMLElement {\r\n    const tbody = document.createElement('tbody');\r\n    tbody.className = 'ddr-tbody';\r\n\r\n    // è·å–æ‰å¹³åŒ–çš„åˆ—\r\n    const flatColumns = this._getFlatColumns(columns);\r\n\r\n    // è®°å½•éœ€è¦åˆå¹¶çš„å•å…ƒæ ¼\r\n    const merges: Map<string, { rowSpan: number, colSpan: number }> = new Map();\r\n\r\n    // å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œæ˜¾ç¤ºç©ºè¡¨æ ¼æç¤º\r\n    if (!data.length) {\r\n      const emptyRow = document.createElement('tr');\r\n      emptyRow.className = 'ddr-empty-row';\r\n\r\n      const emptyCell = document.createElement('td');\r\n      emptyCell.className = 'ddr-empty-cell';\r\n      emptyCell.colSpan = flatColumns.length;\r\n      emptyCell.textContent = this.config.features?.emptyText || 'æš‚æ— æ•°æ®';\r\n\r\n      emptyRow.appendChild(emptyCell);\r\n      tbody.appendChild(emptyRow);\r\n      return tbody;\r\n    }\r\n\r\n    // åˆ›å»ºè¡Œ\r\n    data.forEach((rowData, rowIndex) => {\r\n      const row = document.createElement('tr');\r\n      row.className = 'ddr-body-row';\r\n      row.setAttribute('data-index', String(rowIndex));\r\n\r\n      // åº”ç”¨é…ç½®çš„è¡Œé«˜\r\n      if (this.config.layout?.rowHeight) {\r\n        row.style.height = typeof this.config.layout.rowHeight === 'number'\r\n          ? `${this.config.layout.rowHeight}px`\r\n          : this.config.layout.rowHeight;\r\n      }\r\n\r\n      // åˆ›å»ºå•å…ƒæ ¼\r\n      let colIndex = 0;\r\n      flatColumns.forEach(column => {\r\n        // è·³è¿‡éšè—åˆ—\r\n        if (column.visible === false) {\r\n          return;\r\n        }\r\n\r\n        // æ£€æŸ¥æ˜¯å¦å·²ç»è¢«åˆå¹¶è·³è¿‡\r\n        const cellKey = `${rowIndex}-${colIndex}`;\r\n        if (merges.has(cellKey) && merges.get(cellKey)?.rowSpan === 0) {\r\n          colIndex++;\r\n          return;\r\n        }\r\n\r\n        const cell = document.createElement('td');\r\n        cell.className = 'ddr-body-cell';\r\n\r\n        // è·å–å•å…ƒæ ¼å€¼\r\n        let value = rowData[column.key];\r\n\r\n        // åº”ç”¨æ ¼å¼åŒ–å‡½æ•°\r\n        if (column.formatter) {\r\n          if (typeof column.formatter === 'string' && this.formatters[column.formatter]) {\r\n            value = this.formatters[column.formatter](value);\r\n          } else if (typeof column.formatter === 'object') {\r\n            const formatterFunc = this.formatters[column.formatter.type];\r\n            if (formatterFunc) {\r\n              value = formatterFunc(value, column.formatter.params);\r\n            }\r\n          }\r\n        }\r\n\r\n        // è®¾ç½®å•å…ƒæ ¼å†…å®¹\r\n        cell.textContent = value !== undefined && value !== null ? String(value) : '';\r\n\r\n        // è®¾ç½®å•å…ƒæ ¼æ ·å¼\r\n        if (column.align) {\r\n          cell.style.textAlign = column.align;\r\n        }\r\n\r\n        // å¤„ç†å•å…ƒæ ¼åˆå¹¶\r\n        if (column.merge === 'vertical' || column.merge === true) {\r\n          this._handleCellMerge(cell, rowData, column, rowIndex, colIndex, data, merges);\r\n        }\r\n\r\n        // åº”ç”¨æ¡ä»¶æ ·å¼\r\n        if (column.style?.conditional) {\r\n          column.style.conditional.forEach((condition: { when: string; style: Record<string, any> }) => {\r\n            // ç®€å•æ¡ä»¶è¡¨è¾¾å¼è§£æ\r\n            // å®é™…é¡¹ç›®ä¸­å¯èƒ½éœ€è¦æ›´å¤æ‚çš„è¡¨è¾¾å¼è§£æ\r\n            const valueToCheck = rowData[column.key];\r\n            try {\r\n              const result = this._evaluateCondition(condition.when, { value: valueToCheck, row: rowData });\r\n              if (result) {\r\n                Object.assign(cell.style, condition.style);\r\n              }\r\n            } catch (e) {\r\n              console.error('æ¡ä»¶è§£æé”™è¯¯:', e);\r\n            }\r\n          });\r\n        }\r\n\r\n        row.appendChild(cell);\r\n        colIndex++;\r\n      });\r\n\r\n      tbody.appendChild(row);\r\n    });\r\n\r\n    return tbody;\r\n  }\r\n\r\n  /**\r\n   * å¤„ç†å•å…ƒæ ¼åˆå¹¶\r\n   */\r\n  private _handleCellMerge(\r\n    td: HTMLTableCellElement,\r\n    rowData: any,\r\n    column: any,\r\n    rowIndex: number,\r\n    colIndex: number,\r\n    data: any[],\r\n    merges: Map<string, { rowSpan: number, colSpan: number }>\r\n  ): void {\r\n    console.log(`ğŸ”„ å¤„ç†åˆ— \"${column.key}\" çš„åˆå¹¶ï¼Œå½“å‰è¡Œ ${rowIndex}ï¼Œå€¼: \"${rowData[column.key]}\"`);\r\n\r\n    const currentValue = rowData[column.key];\r\n    let rowSpan = 1;\r\n\r\n    // å‘ä¸‹æŸ¥æ‰¾ç›¸åŒå€¼çš„è¿ç»­å•å…ƒæ ¼\r\n    for (let i = rowIndex + 1; i < data.length; i++) {\r\n      const nextValue = data[i][column.key];\r\n\r\n      if (nextValue === currentValue) {\r\n        rowSpan++;\r\n\r\n        // æ ‡è®°è¢«åˆå¹¶çš„å•å…ƒæ ¼ï¼Œåé¢é‡åˆ°æ—¶è·³è¿‡\r\n        const skipKey = `${i}-${colIndex}`;\r\n        merges.set(skipKey, { rowSpan: 0, colSpan: 0 });\r\n        console.log(`  âœ… æ‰¾åˆ°ç›¸åŒå€¼ï¼Œè¡Œ ${i}ï¼Œå€¼: \"${nextValue}\"ï¼ŒrowSpan: ${rowSpan}`);\r\n      } else {\r\n        console.log(`  âŒ å€¼ä¸åŒï¼Œè¡Œ ${i}ï¼Œå€¼: \"${nextValue}\" !== \"${currentValue}\"ï¼Œåœæ­¢åˆå¹¶`);\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (rowSpan > 1) {\r\n      td.rowSpan = rowSpan;\r\n      console.log(`ğŸ¯ åˆ— \"${column.key}\" ç¬¬ ${rowIndex} è¡Œè®¾ç½® rowSpan = ${rowSpan}`);\r\n    } else {\r\n      console.log(`ğŸ“ åˆ— \"${column.key}\" ç¬¬ ${rowIndex} è¡Œæ— éœ€åˆå¹¶`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * è¯„ä¼°æ¡ä»¶è¡¨è¾¾å¼\r\n   * @param condition æ¡ä»¶è¡¨è¾¾å¼\r\n   * @param context ä¸Šä¸‹æ–‡å¯¹è±¡\r\n   * @returns æ¡ä»¶ç»“æœ\r\n   */\r\n  private _evaluateCondition(condition: string, context: Record<string, any>): boolean {\r\n    // ç®€åŒ–ç‰ˆæ¡ä»¶è¡¨è¾¾å¼è§£æ\r\n    // å®é™…é¡¹ç›®ä¸­å¯èƒ½éœ€è¦æ›´å¤æ‚çš„è¡¨è¾¾å¼è§£æ\r\n    try {\r\n      // ç®€å•æ›¿æ¢ï¼Œæ”¯æŒvalueå’Œrowå˜é‡\r\n      let expression = condition;\r\n\r\n      // æ›¿æ¢ value å˜é‡\r\n      expression = expression.replace(/value/g, JSON.stringify(context.value));\r\n\r\n      // æ›¿æ¢ row.xxx å˜é‡\r\n      const rowVarMatches = expression.match(/row\\.\\w+/g);\r\n      if (rowVarMatches) {\r\n        rowVarMatches.forEach(match => {\r\n          const prop = match.split('.')[1];\r\n          expression = expression.replace(match, JSON.stringify(context.row[prop]));\r\n        });\r\n      }\r\n\r\n      // ä½¿ç”¨Functionæ„é€ å‡½æ•°æ‰§è¡Œè¡¨è¾¾å¼\r\n      // æ³¨æ„ï¼šè¿™ç§æ–¹å¼åœ¨å®é™…é¡¹ç›®ä¸­å¯èƒ½å­˜åœ¨å®‰å…¨é£é™©\r\n      return new Function(`return ${expression}`)();\r\n    } catch (e) {\r\n      console.error('æ¡ä»¶è§£æé”™è¯¯:', e, condition);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * è·å–æ‰å¹³åŒ–çš„åˆ—é…ç½®\r\n   * @param columns åˆ—é…ç½®\r\n   * @returns æ‰å¹³åŒ–åçš„åˆ—é…ç½®\r\n   */\r\n  private _getFlatColumns(columns: Array<any>): Array<any> {\r\n    const result: Array<any> = [];\r\n\r\n    const flatten = (cols: Array<any>) => {\r\n      cols.forEach(col => {\r\n        if (col.children && col.children.length) {\r\n          flatten(col.children);\r\n        } else {\r\n          result.push(col);\r\n        }\r\n      });\r\n    };\r\n\r\n    flatten(columns);\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * åˆ›å»ºåˆ†é¡µç»„ä»¶\r\n   * @param pagination åˆ†é¡µä¿¡æ¯\r\n   * @returns åˆ†é¡µå…ƒç´ \r\n   */\r\n  private _createPagination(pagination: Record<string, any>): HTMLElement {\r\n    const paginationElement = document.createElement('div');\r\n    paginationElement.className = 'ddr-pagination';\r\n\r\n    const pageInfo = document.createElement('span');\r\n    pageInfo.className = 'ddr-pagination-info';\r\n    pageInfo.textContent = `ç¬¬${pagination.pageNumber || 1}é¡µ/å…±${pagination.totalPages || 1}é¡µ`;\r\n    paginationElement.appendChild(pageInfo);\r\n\r\n    // ä¸Šä¸€é¡µæŒ‰é’®\r\n    const prevBtn = document.createElement('button');\r\n    prevBtn.className = 'ddr-pagination-prev';\r\n    prevBtn.textContent = 'ä¸Šä¸€é¡µ';\r\n    prevBtn.disabled = (pagination.pageNumber || 1) <= 1;\r\n    prevBtn.onclick = () => {\r\n      this.reload({ ...this.filters, pageNumber: (pagination.pageNumber || 1) - 1 });\r\n    };\r\n    paginationElement.appendChild(prevBtn);\r\n\r\n    // é¡µç æŒ‰é’®\r\n    const totalPages = pagination.totalPages || 1;\r\n    const currentPage = pagination.pageNumber || 1;\r\n\r\n    // ç®€å•åˆ†é¡µé€»è¾‘\r\n    let startPage = Math.max(1, currentPage - 2);\r\n    let endPage = Math.min(totalPages, startPage + 4);\r\n\r\n    // è°ƒæ•´startPage\r\n    startPage = Math.max(1, endPage - 4);\r\n\r\n    for (let i = startPage; i <= endPage; i++) {\r\n      const pageBtn = document.createElement('button');\r\n      pageBtn.className = `ddr-pagination-page${i === currentPage ? ' active' : ''}`;\r\n      pageBtn.textContent = String(i);\r\n      pageBtn.onclick = () => {\r\n        if (i !== currentPage) {\r\n          this.reload({ ...this.filters, pageNumber: i });\r\n        }\r\n      };\r\n      paginationElement.appendChild(pageBtn);\r\n    }\r\n\r\n    // ä¸‹ä¸€é¡µæŒ‰é’®\r\n    const nextBtn = document.createElement('button');\r\n    nextBtn.className = 'ddr-pagination-next';\r\n    nextBtn.textContent = 'ä¸‹ä¸€é¡µ';\r\n    nextBtn.disabled = (pagination.pageNumber || 1) >= (pagination.totalPages || 1);\r\n    nextBtn.onclick = () => {\r\n      this.reload({ ...this.filters, pageNumber: (pagination.pageNumber || 1) + 1 });\r\n    };\r\n    paginationElement.appendChild(nextBtn);\r\n\r\n    // æ¯é¡µæ¡æ•°é€‰æ‹©\r\n    const sizeSelect = document.createElement('select');\r\n    sizeSelect.className = 'ddr-pagination-size';\r\n    [10, 20, 50, 100].forEach(size => {\r\n      const option = document.createElement('option');\r\n      option.value = String(size);\r\n      option.textContent = `${size}æ¡/é¡µ`;\r\n      option.selected = size === (pagination.pageSize || 20);\r\n      sizeSelect.appendChild(option);\r\n    });\r\n    sizeSelect.onchange = (e) => {\r\n      const pageSize = Number((e.target as HTMLSelectElement).value);\r\n      this.reload({ ...this.filters, pageSize, pageNumber: 1 });\r\n    };\r\n    paginationElement.appendChild(sizeSelect);\r\n\r\n    return paginationElement;\r\n  }\r\n    /**\r\n   * æ·»åŠ æ°´å°\r\n   * @param container å®¹å™¨å…ƒç´ \r\n   * @param text æ°´å°æ–‡æœ¬\r\n   */\r\n  private _addWatermark(container: HTMLElement, text: string): void {\r\n    // ç§»é™¤ç°æœ‰æ°´å°\r\n    const existingWatermark = container.querySelector('.ddr-watermark');\r\n    if (existingWatermark) {\r\n      container.removeChild(existingWatermark);\r\n    }\r\n\r\n    const watermark = document.createElement('div');\r\n    watermark.className = 'ddr-watermark';\r\n\r\n    // ç¡®ä¿æ°´å°å§‹ç»ˆå¯è§\r\n    watermark.style.zIndex = '10';\r\n\r\n    // å¤„ç†åŠ¨æ€æ›¿æ¢\r\n    if (text.includes('${')) {\r\n      text = text.replace(/\\${([^}]+)}/g, (match, key) => {\r\n        return String(this._getValueByPath(key) || match);\r\n      });\r\n    }\r\n\r\n    // è®¡ç®—éœ€è¦åˆ›å»ºå¤šå°‘è¡Œå’Œåˆ—çš„æ°´å°\r\n    const rows = 5;\r\n    const cols = 4;\r\n\r\n    // åˆ›å»ºæ°´å°ç½‘æ ¼\r\n    for (let i = 0; i < rows * cols; i++) {\r\n      const content = document.createElement('div');\r\n      content.className = 'ddr-watermark-content';\r\n      content.textContent = text;\r\n      // å¢åŠ ä¸é€æ˜åº¦ï¼Œæé«˜å¯è§æ€§\r\n      content.style.opacity = '0.2';\r\n      content.style.color = 'rgba(0, 0, 0, 0.25)';\r\n      content.style.fontSize = '18px';\r\n      watermark.appendChild(content);\r\n    }\r\n\r\n    // è®¾ç½®æ°´å°å±‚çš„ä½ç½®å¹¶é˜²æ­¢æ°´å°è¢«ç¯¡æ”¹\r\n    Object.defineProperty(watermark.style, 'pointerEvents', {\r\n      value: 'none',\r\n      writable: false\r\n    });\r\n\r\n    container.appendChild(watermark);\r\n      // å¢å¼ºç‰ˆï¼šé˜²æ­¢æ°´å°è¢«åˆ é™¤æˆ–ä¿®æ”¹çš„ç›‘è§†å™¨\r\n    const observer = new MutationObserver((mutations) => {\r\n      mutations.forEach((mutation) => {\r\n        // æ£€æŸ¥æ°´å°æ˜¯å¦è¢«ç§»é™¤\r\n        if (mutation.type === 'childList' &&\r\n            Array.from(mutation.removedNodes).some(node =>\r\n              node === watermark ||\r\n              (node instanceof Element && node.querySelector('.ddr-watermark')))\r\n           ) {\r\n          if (!container.contains(watermark)) {\r\n            // å¦‚æœæ°´å°è¢«ç§»é™¤ï¼Œé‡æ–°æ·»åŠ å®ƒ\r\n            const newWatermark = watermark.cloneNode(true) as HTMLElement;\r\n            setTimeout(() => container.appendChild(newWatermark), 100);\r\n          }\r\n        }\r\n\r\n        // æ£€æŸ¥æ°´å°æ ·å¼æ˜¯å¦è¢«ä¿®æ”¹\r\n        if (mutation.type === 'attributes' &&\r\n            mutation.target === watermark &&\r\n            (mutation.attributeName === 'style' || mutation.attributeName === 'class')) {\r\n          // æ¢å¤æ°´å°æ ·å¼\r\n          watermark.className = 'ddr-watermark';\r\n          watermark.style.zIndex = '10';\r\n          watermark.style.opacity = '0.8';\r\n        }\r\n      });\r\n    });\r\n\r\n    // ç›‘è§†å­å…ƒç´ å˜åŒ–å’Œå±æ€§å˜åŒ–\r\n    observer.observe(container, {\r\n      childList: true,\r\n      subtree: true,\r\n      attributes: true,\r\n      attributeFilter: ['style', 'class']\r\n    });\r\n  }\r\n\r\n  /**\r\n   * å‡†å¤‡å¯¼å‡ºæ•°æ®\r\n   * @param options å¯¼å‡ºé€‰é¡¹\r\n   * @returns å¯¼å‡ºæ•°æ®\r\n   */\r\n  private _prepareExportData(options?: ExportOptions): any[] {\r\n    // è·å–æ‰å¹³åŒ–çš„åˆ—\r\n    const flatColumns = this._getFlatColumns(this.config.columns);\r\n\r\n    // è¿‡æ»¤éšè—åˆ—\r\n    const visibleColumns = flatColumns.filter(col =>\r\n      col.visible !== false && (options?.includeHidden || col.visible !== false)\r\n    );\r\n\r\n    // å‡†å¤‡è¡¨å¤´\r\n    const result = [];\r\n\r\n    // æ·»åŠ è¡¨å¤´ä¿¡æ¯(å¦‚æœéœ€è¦)\r\n    if (options?.includeHeader !== false && this.config.header?.showOnExport !== false) {\r\n      if (this.config.header?.title) {\r\n        const titleText = typeof this.config.header.title === 'string'\r\n          ? this.config.header.title\r\n          : this.config.header.title.text;\r\n\r\n        result.push([titleText]);\r\n        result.push([]); // ç©ºè¡Œ\r\n      }\r\n\r\n      if (this.config.header?.fields?.length) {\r\n        this.config.header.fields.forEach(field => {\r\n          const value = field.metadataPath\r\n            ? this._getValueByPath(field.metadataPath)\r\n            : field.value || '';\r\n\r\n          result.push([`${field.label || ''}`, value]);\r\n        });\r\n\r\n        result.push([]); // ç©ºè¡Œ\r\n      }\r\n    }\r\n\r\n    // æ·»åŠ è¡¨æ ¼æ ‡é¢˜è¡Œ\r\n    const headers = visibleColumns.map(col => col.title);\r\n    result.push(headers);\r\n\r\n    // æ·»åŠ æ•°æ®è¡Œ\r\n    this.data.forEach(rowData => {\r\n      const row = visibleColumns.map(column => {\r\n        let value = rowData[column.key];\r\n\r\n        // åº”ç”¨æ ¼å¼åŒ–å‡½æ•°\r\n        if (column.formatter) {\r\n          if (typeof column.formatter === 'string' && this.formatters[column.formatter]) {\r\n            value = this.formatters[column.formatter](value);\r\n          } else if (typeof column.formatter === 'object') {\r\n            const formatterFunc = this.formatters[column.formatter.type];\r\n            if (formatterFunc) {\r\n              value = formatterFunc(value, column.formatter.params);\r\n            }\r\n          }\r\n        }\r\n\r\n        return value;\r\n      });\r\n\r\n      result.push(row);\r\n    });\r\n\r\n    // æ·»åŠ è¡¨å°¾ä¿¡æ¯(å¦‚æœéœ€è¦)\r\n    if (options?.includeFooter !== false && this.config.footer?.showOnExport !== false) {\r\n      result.push([]); // ç©ºè¡Œ\r\n\r\n      // æ·»åŠ æ±‡æ€»ä¿¡æ¯\r\n      if (this.config.footer?.summary?.length) {\r\n        this.config.footer.summary.forEach(sum => {\r\n          let summaryValue;\r\n          if (sum.metadataPath) {\r\n            summaryValue = this._getValueByPath(sum.metadataPath);\r\n          } else {\r\n            summaryValue = this._calculateSummary(this.data, sum);\r\n          }\r\n\r\n          if (sum.formatter && this.formatters[sum.formatter]) {\r\n            summaryValue = this.formatters[sum.formatter](summaryValue);\r\n          }\r\n\r\n          result.push([`${sum.column}åˆè®¡:`, summaryValue]);\r\n        });\r\n\r\n        result.push([]); // ç©ºè¡Œ\r\n      }\r\n\r\n      // æ·»åŠ è¡¨å°¾å­—æ®µ\r\n      if (this.config.footer?.fields?.length) {\r\n        this.config.footer.fields.forEach(field => {\r\n          const value = field.metadataPath\r\n            ? this._getValueByPath(field.metadataPath)\r\n            : field.value || '';\r\n\r\n          result.push([field.label || '', value]);\r\n        });\r\n      }\r\n        // æ·»åŠ ç­¾åä¿¡æ¯\r\n      if (this.config.footer?.signatures?.length) {\r\n        const signatureRow: string[] = [];\r\n\r\n        this.config.footer.signatures.forEach(signature => {\r\n          signatureRow.push(signature.label || '');\r\n\r\n          const name = signature.metadataPath\r\n            ? this._getValueByPath(signature.metadataPath)\r\n            : signature.name || '';\r\n\r\n          signatureRow.push(name);\r\n        });\r\n\r\n        result.push(signatureRow);\r\n      }\r\n\r\n      // æ·»åŠ æ³¨é‡Š\r\n      if (this.config.footer?.notes) {\r\n        result.push([this.config.footer.notes]);\r\n      }\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * è§¦å‘äº‹ä»¶\r\n   * @param event äº‹ä»¶åç§°\r\n   * @param data äº‹ä»¶æ•°æ®\r\n   */\r\n  private _emitEvent(event: DDREvent, data?: any): void {\r\n    if (this.eventListeners.has(event)) {\r\n      const callbacks = this.eventListeners.get(event)!;\r\n      callbacks.forEach(callback => {\r\n        try {\r\n          callback(data);\r\n        } catch (error) {\r\n          console.error(`äº‹ä»¶${event}å¤„ç†é”™è¯¯:`, error);\r\n        }\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\nexport default DDR;\r\n","import * as XLSX from 'xlsx';\n// å°è¯•å¯¼å…¥æ”¯æŒæ ·å¼çš„XLSXåº“\nlet XLSXStyle: any;\ntry {\n  XLSXStyle = require('xlsx-js-style');\n  console.log('ä½¿ç”¨æ”¯æŒæ ·å¼çš„XLSXåº“');\n} catch (e) {\n  XLSXStyle = XLSX;\n  console.log('ä½¿ç”¨æ ‡å‡†XLSXåº“ï¼ˆæ ·å¼æ”¯æŒæœ‰é™ï¼‰');\n}\nimport html2canvas from 'html2canvas';\nimport { jsPDF } from 'jspdf';\nimport { ExportOptions } from '../../types';\nimport { fixPDFExport, setupChineseSupport } from './pdf-fixes';\nimport { applyExcelStyles } from './excel-fixes';\n\n// åº”ç”¨PDFå¯¼å‡ºä¿®å¤\nif (typeof window !== 'undefined') {\n  setTimeout(() => {\n    try {\n      console.log('jsPDFåº“å·²å†…ç½®åˆ°ç»„ä»¶ä¸­');\n      fixPDFExport();\n    } catch (e) {\n      console.warn('åº”ç”¨PDFå¯¼å‡ºä¿®å¤å¤±è´¥:', e);\n    }\n  }, 0);\n}\n\n// å®šä¹‰è¡Œä¿¡æ¯æ¥å£\ninterface RowInfo {\n  index: number;\n  height: number;\n  top: number;\n  isHeader: boolean;\n  content: string;\n}\n\n// å®šä¹‰åˆ†é¡µç‚¹æ¥å£\ninterface PageBreakPoint {\n  rowIndex: number;\n  yPercent: number;\n}\n\n/**\n * æŠ¥è¡¨å¯¼å‡ºæ¨¡å—\n * æ”¯æŒExcelå’ŒPDFæ ¼å¼å¯¼å‡º\n */\nexport class Exporter {\n  /**\n   * å¯¼å‡ºä¸ºExcel\n   * @param data æŠ¥è¡¨æ•°æ®æˆ–DOMå…ƒç´ \n   * @param options å¯¼å‡ºé€‰é¡¹\n   */\n  static async toExcel(data: any[] | HTMLElement, options: ExportOptions = {}): Promise<void> {\n    try {\n      // é»˜è®¤é€‰é¡¹\n      const {\n        fileName = 'æŠ¥è¡¨',\n        sheetName = 'Sheet1',\n        includeHidden = false,\n        styles = {} // è‡ªå®šä¹‰æ ·å¼é€‰é¡¹\n      } = options;\n\n      let excelData: any[][];\n      let domElement: HTMLElement | null = null;\n\n      // åˆ¤æ–­è¾“å…¥ç±»å‹\n      if (data instanceof HTMLElement) {\n        domElement = data;\n        excelData = this.extractDataFromDOM(data);\n      } else {\n        excelData = data;\n      }\n\n      // åˆ›å»ºå·¥ä½œè¡¨ - ä½¿ç”¨æ”¯æŒæ ·å¼çš„åº“\n      const ws = XLSXStyle.utils.aoa_to_sheet(excelData);\n\n      // è®¾ç½®åˆ—å®½\n      const wscols = [];\n      if (excelData.length > 0) {\n        for (let i = 0; i < excelData[0].length; i++) {\n          // è®¡ç®—æœ€å¤§å®½åº¦\n          let maxWidth = 10; // é»˜è®¤å®½åº¦\n          excelData.forEach(row => {\n            if (row[i] && String(row[i]).length > maxWidth) {\n              maxWidth = Math.min(50, String(row[i]).length); // é™åˆ¶æœ€å¤§å®½åº¦\n            }\n          });\n          wscols.push({ wch: maxWidth });\n        }\n        ws['!cols'] = wscols;\n      }\n\n      // ä½¿ç”¨å¢å¼ºçš„æ ·å¼åŠŸèƒ½\n      console.log('Excelå¯¼å‡ºæ•°æ®ç»“æ„:', {\n        dataRows: excelData.length,\n        hasDOMElement: !!domElement,\n        firstRow: excelData[0],\n        lastRow: excelData[excelData.length - 1]\n      });\n\n      // å°è¯•ä½¿ç”¨å¢å¼ºæ ·å¼æ–¹æ³•\n      console.log('ä½¿ç”¨å¢å¼ºæ ·å¼åº”ç”¨åˆ°Excel');\n      try {\n        // ç›´æ¥è°ƒç”¨å¢å¼ºæ ·å¼æ–¹æ³•\n        this.applyEnhancedStylesToExcel(ws, excelData);\n        console.log('å¢å¼ºæ ·å¼åº”ç”¨æˆåŠŸ');\n      } catch (enhancedError) {\n        console.warn('å¢å¼ºæ ·å¼åº”ç”¨å¤±è´¥ï¼Œå›é€€åˆ°åŸºç¡€æ ·å¼:', enhancedError);\n        this.applyBasicStylesToExcel(ws, excelData);\n      }\n\n      // æ£€æŸ¥æ ·å¼æ˜¯å¦è¢«åº”ç”¨\n      const sampleCells = ['A1', 'A2', 'B1', 'B2'];\n      sampleCells.forEach(cellRef => {\n        if (ws[cellRef]) {\n          console.log(`å•å…ƒæ ¼ ${cellRef} æ ·å¼:`, ws[cellRef].s);\n        }\n      });\n\n      // åˆ›å»ºå·¥ä½œç°¿ - ä½¿ç”¨æ”¯æŒæ ·å¼çš„åº“\n      const wb = XLSXStyle.utils.book_new();\n      XLSXStyle.utils.book_append_sheet(wb, ws, sheetName);\n\n      // è®¾ç½®å·¥ä½œç°¿å±æ€§ä»¥æ”¯æŒæ ·å¼\n      if (!wb.Workbook) wb.Workbook = {};\n      if (!wb.Workbook.Views) wb.Workbook.Views = [];\n      wb.Workbook.Views[0] = { RTL: false };\n\n      // å¯¼å‡ºæ–‡ä»¶ - ä½¿ç”¨æ”¯æŒæ ·å¼çš„æ ¼å¼\n      try {\n        // æ£€æŸ¥æ˜¯å¦æœ‰æ ·å¼ä¿¡æ¯\n        let hasStyles = false;\n        const sampleCells = ['A1', 'A2', 'B1'];\n        for (const cellRef of sampleCells) {\n          if (ws[cellRef] && ws[cellRef].s) {\n            hasStyles = true;\n            break;\n          }\n        }\n\n        console.log(`Excelå¯¼å‡ºä¿¡æ¯: å·¥ä½œè¡¨åŒ…å«${Object.keys(ws).length}ä¸ªå•å…ƒæ ¼, æ ·å¼ä¿¡æ¯: ${hasStyles ? 'æœ‰' : 'æ— '}`);\n\n        // è®¾ç½®å·¥ä½œç°¿å±æ€§ä»¥æ”¯æŒæ ·å¼\n        wb.Props = {\n          Title: fileName,\n          Subject: \"æŠ¥è¡¨æ•°æ®\",\n          Author: \"DDRæŠ¥è¡¨ç»„ä»¶\",\n          CreatedDate: new Date()\n        };\n\n        // å°è¯•å¤šç§å¯¼å‡ºæ–¹å¼ä»¥ç¡®ä¿æ ·å¼ç”Ÿæ•ˆ\n        try {\n          // æ–¹å¼1ï¼šä½¿ç”¨æ”¯æŒæ ·å¼çš„å¯¼å‡ºé€‰é¡¹\n          const writeOptions = {\n            bookType: 'xlsx' as const,\n            type: 'buffer' as const,\n            cellStyles: true, // å¯ç”¨æ ·å¼æ”¯æŒ\n            sheetStubs: false,\n            compression: true\n          };\n\n          // ç”Ÿæˆæ–‡ä»¶æ•°æ® - ä½¿ç”¨æ”¯æŒæ ·å¼çš„åº“\n          const excelBuffer = XLSXStyle.write(wb, writeOptions);\n\n          // åˆ›å»ºBlobå¹¶ä¸‹è½½\n          const blob = new Blob([excelBuffer], {\n            type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'\n          });\n\n          const url = window.URL.createObjectURL(blob);\n          const link = document.createElement('a');\n          link.href = url;\n          link.download = `${fileName}.xlsx`;\n          document.body.appendChild(link);\n          link.click();\n          document.body.removeChild(link);\n          window.URL.revokeObjectURL(url);\n\n          console.log('Excelå¯¼å‡ºå®Œæˆï¼ˆBlobæ–¹å¼ï¼Œæ”¯æŒæ ·å¼ï¼‰');\n        } catch (blobError) {\n          console.warn('Blobå¯¼å‡ºå¤±è´¥ï¼Œå°è¯•ç›´æ¥å¯¼å‡º:', blobError);\n\n          // æ–¹å¼2ï¼šç›´æ¥ä½¿ç”¨writeFileï¼ˆå¯èƒ½æ ·å¼æ”¯æŒæ›´å¥½ï¼‰\n          XLSXStyle.writeFile(wb, `${fileName}.xlsx`, {\n            cellStyles: true,\n            compression: true\n          });\n          console.log('Excelå¯¼å‡ºå®Œæˆï¼ˆç›´æ¥å¯¼å‡ºæ–¹å¼ï¼‰');\n        }\n      } catch (error) {\n        console.error('Excelå¯¼å‡ºå¤±è´¥:', error);\n        // é™çº§åˆ°åŸºç¡€å¯¼å‡º\n        try {\n          XLSXStyle.writeFile(wb, `${fileName}.xlsx`);\n          console.log('Excelå¯¼å‡ºå®Œæˆï¼ˆåŸºç¡€æ¨¡å¼ï¼‰');\n        } catch (fallbackError) {\n          console.error('ExcelåŸºç¡€å¯¼å‡ºä¹Ÿå¤±è´¥:', fallbackError);\n          throw fallbackError;\n        }\n      }\n\n      return Promise.resolve();\n    } catch (error) {\n      return Promise.reject(error);\n    }\n  }\n\n  /**\n   * ä»DOMå…ƒç´ æå–æ•°æ®\n   * @param element DOMå…ƒç´ \n   */\n  static extractDataFromDOM(element: HTMLElement): any[][] {\n    const result: any[][] = [];\n\n    // æå–æŠ¥è¡¨æ ‡é¢˜\n    const titleElement = element.querySelector('.ddr-report-header .ddr-header-title');\n    if (titleElement) {\n      result.push([titleElement.textContent?.trim() || '']);\n      result.push([]); // ç©ºè¡Œåˆ†éš”\n    }\n\n    // æå–å…ƒæ•°æ®å­—æ®µ\n    const fieldsElements = element.querySelectorAll('.ddr-header-fields .ddr-header-field');\n    if (fieldsElements.length > 0) {\n      const metadataRow: string[] = [];\n      fieldsElements.forEach(field => {\n        const label = field.querySelector('.ddr-field-label')?.textContent?.trim() || '';\n        const value = field.querySelector('.ddr-field-value')?.textContent?.trim() || '';\n        if (label && value) {\n          metadataRow.push(`${label} ${value}`);\n        }\n      });\n      if (metadataRow.length > 0) {\n        result.push(metadataRow);\n        result.push([]); // ç©ºè¡Œåˆ†éš”\n      }\n    }\n\n    // æå–è¡¨æ ¼æ•°æ®\n    const table = element.querySelector('table');\n    if (table) {\n      const rows = table.querySelectorAll('tr');\n      rows.forEach(row => {\n        const cells = row.querySelectorAll('td, th');\n        const rowData: string[] = [];\n        cells.forEach(cell => {\n          rowData.push(cell.textContent?.trim() || '');\n        });\n        if (rowData.length > 0) {\n          result.push(rowData);\n        }\n      });\n    }\n\n    // æå–è¡¨å°¾ä¿¡æ¯\n    const footerElement = element.querySelector('.ddr-report-footer');\n    if (footerElement) {\n      result.push([]); // ç©ºè¡Œåˆ†éš”\n\n      // æå–æ±‡æ€»ä¿¡æ¯\n      const summaryElements = footerElement.querySelectorAll('.ddr-footer-summary .ddr-summary-item');\n      if (summaryElements.length > 0) {\n        const summaryRow: string[] = [];\n        summaryElements.forEach(item => {\n          const label = item.querySelector('.ddr-summary-label')?.textContent?.trim() || '';\n          const value = item.querySelector('.ddr-summary-value')?.textContent?.trim() || '';\n          if (label && value) {\n            summaryRow.push(`${label} ${value}`);\n          }\n        });\n        if (summaryRow.length > 0) {\n          result.push(summaryRow);\n        }\n      }\n\n      // æå–å…¶ä»–è¡¨å°¾å­—æ®µ\n      const footerFields = footerElement.querySelectorAll('.ddr-footer-fields .ddr-footer-field');\n      if (footerFields.length > 0) {\n        const footerRow: string[] = [];\n        footerFields.forEach(field => {\n          const label = field.querySelector('.ddr-field-label')?.textContent?.trim() || '';\n          const value = field.querySelector('.ddr-field-value')?.textContent?.trim() || '';\n          if (label && value) {\n            footerRow.push(`${label} ${value}`);\n          }\n        });\n        if (footerRow.length > 0) {\n          result.push(footerRow);\n        }\n      }\n    }\n\n    return result;\n  }\n\n  /**\n   * å°†DOMæ ·å¼åº”ç”¨åˆ°Excel\n   * @param ws å·¥ä½œè¡¨\n   * @param data æ•°æ®\n   * @param element DOMå…ƒç´ \n   */\n  static applyDOMStylesToExcel(ws: any, data: any[][], element: HTMLElement): void {\n    console.log('å¼€å§‹åº”ç”¨DOMæ ·å¼åˆ°Excel');\n\n    // ä½¿ç”¨ç®€åŒ–çš„æ ·å¼åº”ç”¨æ–¹å¼ï¼Œæé«˜å…¼å®¹æ€§\n    try {\n      // æŸ¥æ‰¾è¡¨æ ¼å…ƒç´ \n      const table = element.querySelector('table');\n      if (!table) {\n        console.log('æœªæ‰¾åˆ°è¡¨æ ¼ï¼Œä½¿ç”¨é»˜è®¤æ ·å¼');\n        applyExcelStyles(ws, data);\n        return;\n      }\n\n      // åˆ†æDOMç»“æ„\n      const titleElement = element.querySelector('.ddr-report-header .ddr-header-title');\n      const hasTitle = !!titleElement;\n      const hasMetadata = element.querySelectorAll('.ddr-header-fields .ddr-header-field').length > 0;\n\n      console.log('DOMç»“æ„åˆ†æ:', { hasTitle, hasMetadata });\n\n      // è®¡ç®—å„éƒ¨åˆ†åœ¨Excelä¸­çš„è¡Œç´¢å¼•\n      let currentRowIndex = 0;\n\n      // ç®€åŒ–çš„æ ·å¼å®šä¹‰\n      const headerStyle = {\n        font: { bold: true, sz: 12, color: { rgb: \"FFFFFF\" } },\n        fill: { fgColor: { rgb: \"4472C4\" } },\n        alignment: { horizontal: \"center\", vertical: \"center\" }\n      };\n\n      const dataStyle = {\n        font: { sz: 11 },\n        alignment: { vertical: \"center\" }\n      };\n\n      // æ ‡é¢˜è¡Œæ ·å¼\n      if (hasTitle) {\n        const cellRef = XLSX.utils.encode_cell({ r: currentRowIndex, c: 0 });\n        if (ws[cellRef]) {\n          ws[cellRef].s = {\n            font: { bold: true, sz: 16 },\n            alignment: { horizontal: \"center\", vertical: \"center\" }\n          };\n          console.log(`åº”ç”¨æ ‡é¢˜æ ·å¼åˆ° ${cellRef}`);\n        }\n        currentRowIndex += 2; // æ ‡é¢˜ + ç©ºè¡Œ\n      }\n\n      // å…ƒæ•°æ®è¡Œæ ·å¼\n      if (hasMetadata) {\n        currentRowIndex += 2; // å…ƒæ•°æ® + ç©ºè¡Œ\n      }\n\n      // è¡¨æ ¼æ ·å¼ - ç®€åŒ–å¤„ç†\n      const rows = table.querySelectorAll('tr');\n      let isFirstRow = true;\n\n      rows.forEach((row, rowIndex) => {\n        const cells = row.querySelectorAll('td, th');\n        const isHeader = row.querySelector('th') !== null || isFirstRow;\n\n        cells.forEach((cell, cellIndex) => {\n          const excelRowIndex = currentRowIndex + rowIndex;\n          const cellRef = XLSXStyle.utils.encode_cell({ r: excelRowIndex, c: cellIndex });\n\n          if (!ws[cellRef]) return;\n\n          // åº”ç”¨ç®€åŒ–æ ·å¼\n          if (isHeader) {\n            ws[cellRef].s = headerStyle;\n            console.log(`åº”ç”¨è¡¨å¤´æ ·å¼åˆ° ${cellRef}`);\n          } else {\n            ws[cellRef].s = dataStyle;\n          }\n        });\n\n        if (isFirstRow && isHeader) {\n          isFirstRow = false;\n        }\n      });\n\n      console.log('DOMæ ·å¼åº”ç”¨å®Œæˆ');\n    } catch (error) {\n      console.error('åº”ç”¨DOMæ ·å¼å¤±è´¥:', error);\n      // é™çº§åˆ°é»˜è®¤æ ·å¼\n      applyExcelStyles(ws, data);\n    }\n  }\n\n  /**\n   * åº”ç”¨åŸºç¡€æ ·å¼åˆ°Excelï¼ˆå…¼å®¹æ€§æ›´å¥½çš„æ–¹æ³•ï¼‰\n   */\n  static applyBasicStylesToExcel(ws: any, data: any[][]): void {\n    console.log('å¼€å§‹åº”ç”¨åŸºç¡€æ ·å¼åˆ°Excel');\n\n    try {\n      // è·å–æ•°æ®èŒƒå›´\n      const range = XLSXStyle.utils.decode_range(ws['!ref'] || 'A1');\n\n      // åº”ç”¨è¡¨å¤´æ ·å¼ï¼ˆç¬¬ä¸€è¡Œï¼‰\n      for (let col = range.s.c; col <= range.e.c; col++) {\n        const cellRef = XLSXStyle.utils.encode_cell({ r: 0, c: col });\n        if (ws[cellRef]) {\n          ws[cellRef].s = {\n            font: { bold: true, sz: 12 },\n            fill: { fgColor: { rgb: \"DDDDDD\" } },\n            alignment: { horizontal: \"center\", vertical: \"center\" }\n          };\n          console.log(`åº”ç”¨è¡¨å¤´æ ·å¼åˆ° ${cellRef}`);\n        }\n      }\n\n      // åº”ç”¨æ•°æ®è¡Œæ ·å¼\n      for (let row = 1; row <= range.e.r; row++) {\n        for (let col = range.s.c; col <= range.e.c; col++) {\n          const cellRef = XLSXStyle.utils.encode_cell({ r: row, c: col });\n          if (ws[cellRef]) {\n            ws[cellRef].s = {\n              font: { sz: 10 },\n              alignment: { vertical: \"center\" }\n            };\n          }\n        }\n      }\n\n      console.log('åŸºç¡€æ ·å¼åº”ç”¨å®Œæˆ');\n    } catch (error) {\n      console.error('åº”ç”¨åŸºç¡€æ ·å¼å¤±è´¥:', error);\n    }\n  }\n\n  /**\n   * åº”ç”¨å¢å¼ºæ ·å¼åˆ°Excelï¼ˆä½¿ç”¨æ›´å¤šæ ·å¼ç‰¹æ€§ï¼‰\n   */\n  static applyEnhancedStylesToExcel(ws: any, data: any[][]): void {\n    console.log('å¼€å§‹åº”ç”¨å¢å¼ºæ ·å¼åˆ°Excel');\n\n    try {\n      // è·å–æ•°æ®èŒƒå›´\n      const range = XLSXStyle.utils.decode_range(ws['!ref'] || 'A1');\n\n      // å®šä¹‰æ ·å¼\n      const headerStyle = {\n        font: { bold: true, sz: 12, color: { rgb: \"FFFFFF\" } },\n        fill: { fgColor: { rgb: \"4472C4\" } },\n        alignment: { horizontal: \"center\", vertical: \"center\" },\n        border: {\n          top: { style: \"thin\", color: { rgb: \"000000\" } },\n          bottom: { style: \"thin\", color: { rgb: \"000000\" } },\n          left: { style: \"thin\", color: { rgb: \"000000\" } },\n          right: { style: \"thin\", color: { rgb: \"000000\" } }\n        }\n      };\n\n      const dataStyle = {\n        font: { sz: 10 },\n        alignment: { vertical: \"center\" },\n        border: {\n          top: { style: \"thin\", color: { rgb: \"CCCCCC\" } },\n          bottom: { style: \"thin\", color: { rgb: \"CCCCCC\" } },\n          left: { style: \"thin\", color: { rgb: \"CCCCCC\" } },\n          right: { style: \"thin\", color: { rgb: \"CCCCCC\" } }\n        }\n      };\n\n      const alternateRowStyle = {\n        font: { sz: 10 },\n        fill: { fgColor: { rgb: \"F8F9FA\" } },\n        alignment: { vertical: \"center\" },\n        border: {\n          top: { style: \"thin\", color: { rgb: \"CCCCCC\" } },\n          bottom: { style: \"thin\", color: { rgb: \"CCCCCC\" } },\n          left: { style: \"thin\", color: { rgb: \"CCCCCC\" } },\n          right: { style: \"thin\", color: { rgb: \"CCCCCC\" } }\n        }\n      };\n\n      // åº”ç”¨è¡¨å¤´æ ·å¼ï¼ˆç¬¬ä¸€è¡Œï¼‰\n      for (let col = range.s.c; col <= range.e.c; col++) {\n        const cellRef = XLSXStyle.utils.encode_cell({ r: 0, c: col });\n        if (ws[cellRef]) {\n          ws[cellRef].s = headerStyle;\n          console.log(`åº”ç”¨å¢å¼ºè¡¨å¤´æ ·å¼åˆ° ${cellRef}`);\n        }\n      }\n\n      // åº”ç”¨æ•°æ®è¡Œæ ·å¼ï¼ˆäº¤æ›¿è¡Œé¢œè‰²ï¼‰\n      for (let row = 1; row <= range.e.r; row++) {\n        const isAlternateRow = row % 2 === 0;\n        const rowStyle = isAlternateRow ? alternateRowStyle : dataStyle;\n\n        for (let col = range.s.c; col <= range.e.c; col++) {\n          const cellRef = XLSXStyle.utils.encode_cell({ r: row, c: col });\n          if (ws[cellRef]) {\n            ws[cellRef].s = rowStyle;\n          }\n        }\n      }\n\n      // è®¾ç½®åˆ—å®½\n      if (!ws['!cols']) ws['!cols'] = [];\n      for (let col = range.s.c; col <= range.e.c; col++) {\n        ws['!cols'][col] = { wch: 15 }; // è®¾ç½®åˆ—å®½ä¸º15å­—ç¬¦\n      }\n\n      console.log('å¢å¼ºæ ·å¼åº”ç”¨å®Œæˆ');\n    } catch (error) {\n      console.error('åº”ç”¨å¢å¼ºæ ·å¼å¤±è´¥ï¼Œå›é€€åˆ°åŸºç¡€æ ·å¼:', error);\n      // å›é€€åˆ°åŸºç¡€æ ·å¼\n      this.applyBasicStylesToExcel(ws, data);\n    }\n  }\n\n  /**\n   * å°†RGBé¢œè‰²è½¬æ¢ä¸ºåå…­è¿›åˆ¶\n   */\n  static rgbToHex(rgb: string): string {\n    if (!rgb || rgb === 'transparent') return 'FFFFFF';\n\n    const match = rgb.match(/rgb\\((\\d+),\\s*(\\d+),\\s*(\\d+)\\)/);\n    if (match) {\n      const r = parseInt(match[1]);\n      const g = parseInt(match[2]);\n      const b = parseInt(match[3]);\n      return ((r << 16) | (g << 8) | b).toString(16).padStart(6, '0').toUpperCase();\n    }\n\n    return 'FFFFFF';\n  }\n\n  /**\n   * å°†CSSæ–‡æœ¬å¯¹é½è½¬æ¢ä¸ºExcelå¯¹é½\n   */\n  static getExcelAlignment(textAlign: string): string {\n    switch (textAlign) {\n      case 'center': return 'center';\n      case 'right': return 'right';\n      case 'justify': return 'justify';\n      default: return 'left';\n    }\n  }\n\n  /**\n   * å¯¼å‡ºä¸ºPDF\n   * @param element è¦å¯¼å‡ºçš„DOMå…ƒç´ \n   * @param config æŠ¥è¡¨é…ç½®\n   * @param options å¯¼å‡ºé€‰é¡¹\n   */\n  static async toPDF(element: HTMLElement, config?: any, options: ExportOptions = {}): Promise<void> {\n    try {\n      console.log('PDFå¯¼å‡ºå¼€å§‹ï¼Œä½¿ç”¨å†…ç½®jsPDFåº“');\n\n      // é»˜è®¤é€‰é¡¹\n      const {\n        fileName = 'æŠ¥è¡¨',\n        watermark,  // ä¸è®¾ç½®é»˜è®¤å€¼ï¼Œè®©åç»­é€»è¾‘å¤„ç†\n        pdf: pdfOptions = {}\n      } = options;\n\n      // ä»é…ç½®ä¸­è·å–PDFè®¾ç½®ï¼Œé€‰é¡¹å¯ä»¥è¦†ç›–é…ç½®\n      const configPdfSettings = config?.features?.pdfConfig || {};\n      const mergedPdfOptions = { ...configPdfSettings, ...pdfOptions };\n\n      // æ°´å°å¤„ç†ï¼šä¼˜å…ˆä½¿ç”¨æ–¹æ³•å‚æ•°ï¼Œå…¶æ¬¡ä½¿ç”¨é…ç½®ï¼Œæœ€åä½¿ç”¨ç©ºå­—ç¬¦ä¸²\n      const finalWatermark = watermark !== undefined ? watermark : (config?.features?.watermark || '');\n\n      // è°ƒè¯•ä¿¡æ¯ï¼šè¾“å‡ºPDFé…ç½®å’Œæ°´å°å¤„ç†\n      console.log('PDFå¯¼å‡ºé…ç½®:', {\n        configPdfSettings,\n        pdfOptions,\n        mergedPdfOptions\n      });\n      console.log('æ°´å°å¤„ç†:', {\n        'æ–¹æ³•å‚æ•°watermark': watermark,\n        'é…ç½®ä¸­çš„watermark': config?.features?.watermark,\n        'æœ€ç»ˆä½¿ç”¨çš„watermark': finalWatermark\n      });\n\n      // PDFé…ç½®\n      const pageSize = mergedPdfOptions.pageSize || 'A4';\n      const orientation = mergedPdfOptions.orientation || 'portrait';\n      const quality = mergedPdfOptions.quality || 0.95;\n      const multiPage = mergedPdfOptions.multiPage !== false;\n      const relayout = mergedPdfOptions.relayout !== false; // é»˜è®¤é‡æ–°æ’ç‰ˆ\n\n      console.log(`PDFè®¾ç½® - é¡µé¢å¤§å°: ${pageSize}, æ–¹å‘: ${orientation}, é‡æ–°æ’ç‰ˆ: ${relayout}`);\n\n      // è®¾ç½®é¡µè¾¹è·(mm)\n      const margins = {\n        top: mergedPdfOptions.margins?.top || 15,\n        right: mergedPdfOptions.margins?.right || 15,\n        bottom: mergedPdfOptions.margins?.bottom || 15,\n        left: mergedPdfOptions.margins?.left || 15\n      };\n\n      // ä¿å­˜åŸå§‹æ»šåŠ¨ä½ç½®\n      const originalScrollTop = element.scrollTop;\n\n      // åˆ›å»ºä¸´æ—¶å®¹å™¨\n      const tempContainer = element.cloneNode(true) as HTMLElement;\n      tempContainer.style.position = 'absolute';\n      tempContainer.style.left = '-9999px';\n      tempContainer.style.overflow = 'visible';\n      tempContainer.style.height = 'auto';\n\n      // å¦‚æœå¯ç”¨é‡æ–°æ’ç‰ˆï¼Œè®¾ç½®PDFé€‚åˆçš„å®½åº¦\n      if (relayout) {\n        // æ ¹æ®PDFé¡µé¢æ–¹å‘è®¾ç½®åˆé€‚çš„å®½åº¦\n        const pdfWidth = orientation === 'landscape' ?\n          (pageSize === 'A4' ? 297 : 279) : // A4æ¨ªç‰ˆ297mm, Letteræ¨ªç‰ˆ279mm\n          (pageSize === 'A4' ? 210 : 216);  // A4ç«–ç‰ˆ210mm, Letterç«–ç‰ˆ216mm\n\n        // è€ƒè™‘é¡µè¾¹è·ï¼Œè®¾ç½®å†…å®¹å®½åº¦(è½¬æ¢ä¸ºpxï¼Œå‡è®¾96dpi)\n        const contentWidthMm = pdfWidth - margins.left - margins.right;\n        // è°ƒæ•´DPIæ¯”ä¾‹ï¼Œä½¿æ¨ªç‰ˆèƒ½æ˜¾ç¤ºæ›´å¤šå†…å®¹\n        const dpiRatio = orientation === 'landscape' ? 4.0 : 3.78; // æ¨ªç‰ˆä½¿ç”¨ç¨é«˜çš„DPI\n        const contentWidthPx = Math.floor(contentWidthMm * dpiRatio);\n\n        tempContainer.style.width = contentWidthPx + 'px';\n        tempContainer.style.maxWidth = contentWidthPx + 'px';\n\n        // å¼ºåˆ¶è¡¨æ ¼é‡æ–°è®¡ç®—å¸ƒå±€ï¼Œåº”ç”¨æ¨ª/ç«–ç‰ˆé€‚å½“çš„æ ·å¼\n        const tableElements = tempContainer.querySelectorAll('table');\n        tableElements.forEach(table => {\n          const tableElem = table as HTMLElement;\n          tableElem.style.width = '100%';\n          tableElem.style.tableLayout = 'fixed';\n\n          // æ¨ªç‰ˆæ—¶ç‰¹æ®Šå¤„ç†ï¼Œä½¿è¡¨æ ¼æ›´åˆç†åˆ©ç”¨ç©ºé—´\n          if (orientation === 'landscape') {\n            // æ¨ªç‰ˆæ—¶è°ƒæ•´å•å…ƒæ ¼å°ºå¯¸ï¼Œä½¿æ–‡æœ¬æ›´ç´§å‡‘\n            const cells = tableElem.querySelectorAll('td, th');\n            cells.forEach(cell => {\n              (cell as HTMLElement).style.padding = '3px 4px'; // å‡å°å†…è¾¹è·\n            });\n          }\n        });\n      } else {\n        // ç¼©æ”¾æ¨¡å¼ï¼šä¿æŒåŸå§‹å®½åº¦ï¼Œä½†ç¡®ä¿ç­‰æ¯”ä¾‹ç¼©æ”¾\n        tempContainer.style.width = element.clientWidth + 'px';\n        console.log('ä½¿ç”¨ç¼©æ”¾æ¨¡å¼ï¼Œä¿æŒåŸå§‹å®½åº¦:', element.clientWidth + 'px');\n      }\n\n      document.body.appendChild(tempContainer);\n\n      // ç¡®ä¿æ‰€æœ‰å†…å®¹å¯è§\n      const headerElement = tempContainer.querySelector('.ddr-report-header') as HTMLElement;\n      const footerElement = tempContainer.querySelector('.ddr-report-footer') as HTMLElement;\n      const tableContainer = tempContainer.querySelector('.ddr-table-container') as HTMLElement;\n\n      // æ£€æŸ¥å¿…è¦çš„å…ƒç´ æ˜¯å¦å­˜åœ¨\n      if (!tableContainer) {\n        console.warn('æœªæ‰¾åˆ°è¡¨æ ¼å®¹å™¨å…ƒç´ ï¼Œå¯¼å‡ºå¯èƒ½ä¸å®Œæ•´');\n      }\n\n      // ä¼˜åŒ–DOMç»“æ„ä»¥ä¾¿æ›´å¥½åœ°å¯¼å‡º\n      if (tableContainer) {\n        tableContainer.style.maxHeight = 'none';\n        tableContainer.style.height = 'auto';\n        tableContainer.style.overflow = 'visible';\n\n        // ç¡®ä¿è¡¨æ ¼å†…å®¹æ­£ç¡®æ˜¾ç¤º\n        const tableElement = tableContainer.querySelector('table');\n        if (tableElement) {\n          // ç¡®ä¿è¡¨æ ¼å®½åº¦æ­£ç¡®\n          tableElement.style.width = '100%';\n\n          // ç¡®ä¿æ‰€æœ‰å•å…ƒæ ¼éƒ½æœ‰é€‚å½“çš„è¾¹æ¡†\n          const cells = tableElement.querySelectorAll('td, th');\n          cells.forEach(cell => {\n            (cell as HTMLElement).style.border = '1px solid #ddd';\n          });\n        }\n      }\n\n      // ä¼˜åŒ–è¡¨å¤´å’Œè¡¨å°¾\n      if (headerElement) {\n        headerElement.style.position = 'relative';\n        headerElement.style.height = 'auto';\n        headerElement.style.overflow = 'visible';\n      }\n\n      if (footerElement) {\n        footerElement.style.position = 'relative';\n        footerElement.style.height = 'auto';\n        footerElement.style.overflow = 'visible';\n      }\n        // åˆå§‹åŒ–PDF\n      const pdf = new jsPDF({\n        orientation,\n        unit: 'mm',\n        format: pageSize\n      });\n\n      // è®¾ç½®ä¸­æ–‡æ”¯æŒ\n      setupChineseSupport(pdf);\n\n      const pageWidth = pdf.internal.pageSize.getWidth();\n      const pageHeight = pdf.internal.pageSize.getHeight();\n\n      // å†…å®¹åŒºåŸŸé«˜åº¦ï¼ˆå‡å»é¡µè¾¹è·ï¼‰\n      const contentHeight = pageHeight - margins.top - margins.bottom;\n      const contentWidth = pageWidth - margins.left - margins.right;\n\n      // è®¾ç½®å­—ä½“å¤§å°\n      pdf.setFontSize(12);\n\n      if (multiPage) {\n        // -------------- å¤šé¡µå¤„ç† --------------\n\n        // è¡¨å¤´é«˜åº¦(å¦‚æœæœ‰) - ç²¾ç¡®æµ‹é‡å®é™…é«˜åº¦\n        let headerHeight = 0;\n        let headerCanvas;\n        if (headerElement) {\n          try {\n            // é¦–å…ˆè·å–å…ƒç´ çš„å®é™…åƒç´ å°ºå¯¸\n            const headerRect = headerElement.getBoundingClientRect();\n            console.log(`ğŸ“ æŠ¥è¡¨å¤´DOMå°ºå¯¸ï¼š${Math.round(headerRect.width)}px Ã— ${Math.round(headerRect.height)}px`);\n\n            headerCanvas = await html2canvas(headerElement, {\n              scale: 2.0, // é€‚ä¸­çš„æ¸…æ™°åº¦\n              useCORS: true,\n              logging: false,\n              allowTaint: true,\n              backgroundColor: '#FFFFFF' // ç¡®ä¿èƒŒæ™¯è‰²ä¸€è‡´\n            });\n\n            // åŸºäºCanvaså’ŒDOMçš„æ¯”ä¾‹å…³ç³»è®¡ç®—PDFä¸­çš„å®é™…é«˜åº¦\n            // è¿™æ ·å¯ä»¥é¿å…DPIå‡è®¾çš„é—®é¢˜\n            headerHeight = (headerCanvas.height / headerCanvas.width) * contentWidth;\n\n            console.log(`ğŸ“ æŠ¥è¡¨å¤´Canvaså°ºå¯¸ï¼š${headerCanvas.width}px Ã— ${headerCanvas.height}px`);\n            console.log(`ğŸ“ æŠ¥è¡¨å¤´å®é™…é«˜åº¦ï¼š${Math.round(headerHeight * 100) / 100}mm`);\n          } catch (e) {\n            console.warn('æ¸²æŸ“è¡¨å¤´æ—¶å‡ºé”™:', e);\n          }\n        }\n\n        // è¡¨å°¾é«˜åº¦(å¦‚æœæœ‰) - ç²¾ç¡®æµ‹é‡å®é™…é«˜åº¦\n        let footerHeight = 0;\n        let footerCanvas;\n        if (footerElement) {\n          try {\n            // é¦–å…ˆè·å–å…ƒç´ çš„å®é™…åƒç´ å°ºå¯¸\n            const footerRect = footerElement.getBoundingClientRect();\n            console.log(`ğŸ“ æŠ¥è¡¨å°¾DOMå°ºå¯¸ï¼š${Math.round(footerRect.width)}px Ã— ${Math.round(footerRect.height)}px`);\n\n            footerCanvas = await html2canvas(footerElement, {\n              scale: 2.0, // é€‚ä¸­çš„æ¸…æ™°åº¦\n              useCORS: true,\n              logging: false,\n              allowTaint: true,\n              backgroundColor: '#FFFFFF' // ç¡®ä¿èƒŒæ™¯è‰²ä¸€è‡´\n            });\n\n            // åŸºäºCanvaså’ŒDOMçš„æ¯”ä¾‹å…³ç³»è®¡ç®—PDFä¸­çš„å®é™…é«˜åº¦\n            // è¿™æ ·å¯ä»¥é¿å…DPIå‡è®¾çš„é—®é¢˜\n            footerHeight = (footerCanvas.height / footerCanvas.width) * contentWidth;\n\n            console.log(`ğŸ“ æŠ¥è¡¨å°¾Canvaså°ºå¯¸ï¼š${footerCanvas.width}px Ã— ${footerCanvas.height}px`);\n            console.log(`ğŸ“ æŠ¥è¡¨å°¾å®é™…é«˜åº¦ï¼š${Math.round(footerHeight * 100) / 100}mm`);\n          } catch (e) {\n            console.warn('æ¸²æŸ“è¡¨å°¾æ—¶å‡ºé”™:', e);\n          }\n        }\n\n        // æå–è¡¨æ ¼éƒ¨åˆ†\n        const tableElement = tableContainer?.querySelector('table') || tableContainer;\n        if (!tableElement) {\n          throw new Error('æ‰¾ä¸åˆ°è¡¨æ ¼å…ƒç´ ');\n        }\n\n        // è·å–è¡¨æ ¼çš„å®é™…DOMå°ºå¯¸\n        const tableRect = tableElement.getBoundingClientRect();\n        console.log(`ğŸ“ è¡¨æ ¼DOMå°ºå¯¸ï¼š${Math.round(tableRect.width)}px Ã— ${Math.round(tableRect.height)}px`);\n\n        // å°†è¡¨æ ¼è½¬æ¢ä¸ºcanvasï¼Œæé«˜æ¸…æ™°åº¦\n        let tableCanvas;\n        let tableWidth;\n        let tableHeight;\n\n        try {\n          tableCanvas = await html2canvas(tableElement, {\n            scale: 2.0, // é€‚ä¸­çš„æ¸…æ™°åº¦\n            useCORS: true,\n            logging: false,\n            allowTaint: true,\n            backgroundColor: '#FFFFFF' // ç¡®ä¿èƒŒæ™¯è‰²ä¸€è‡´\n          });\n\n          // åŸºäºCanvaså’ŒDOMçš„æ¯”ä¾‹å…³ç³»è®¡ç®—PDFä¸­çš„å®é™…å°ºå¯¸\n          tableWidth = contentWidth; // PDFå†…å®¹åŒºåŸŸå®½åº¦\n          tableHeight = (tableCanvas.height / tableCanvas.width) * tableWidth; // åŸºäºCanvasæ¯”ä¾‹è®¡ç®—\n\n          console.log(`ğŸ“ è¡¨æ ¼Canvaså°ºå¯¸ï¼š${tableCanvas.width}px Ã— ${tableCanvas.height}px`);\n          console.log(`ğŸ“ è¡¨æ ¼å®é™…é«˜åº¦ï¼š${Math.round(tableHeight * 100) / 100}mm`);\n\n          // è®¡ç®—è¡¨æ ¼è¡Œæ•°ä¿¡æ¯\n          const rows = tableElement.querySelectorAll('tr');\n          const totalRows = rows.length;\n\n          // è®¡ç®—è¡¨å¤´è¡Œæ•°\n          let headerRowCount = 0;\n          for (let i = 0; i < rows.length; i++) {\n            if (rows[i].querySelector('th')) {\n              headerRowCount++;\n            } else {\n              break; // é‡åˆ°ç¬¬ä¸€ä¸ªéè¡¨å¤´è¡Œå°±åœæ­¢\n            }\n          }\n\n          const dataRowCount = totalRows - headerRowCount;\n          console.log(`ğŸ“Š è¡¨æ ¼è¡Œæ•°ç»Ÿè®¡ï¼šæ€»è¡Œæ•°=${totalRows}, è¡¨å¤´è¡Œæ•°=${headerRowCount}, æ•°æ®è¡Œæ•°=${dataRowCount}`);\n\n          // é‡æ„åˆ†é¡µç®—æ³• - ç²¾ç¡®è®¡ç®—æ¯é¡µå¯ç”¨ç©ºé—´å’Œè¡Œæ•°\n          console.log(`ğŸ” å¼€å§‹é‡æ„PDFåˆ†é¡µç®—æ³•...`);\n\n          // 1. ç²¾ç¡®æµ‹é‡å„éƒ¨åˆ†å®é™…é«˜åº¦ï¼ˆæ¯«ç±³ï¼‰\n          let actualHeaderHeightMM = 0;\n          let actualFooterHeightMM = 0;\n\n          if (headerCanvas) {\n            actualHeaderHeightMM = headerHeight;\n            console.log(`ğŸ“ æŠ¥è¡¨å¤´å®é™…é«˜åº¦ï¼š${Math.round(actualHeaderHeightMM)}mm`);\n          }\n\n          if (footerCanvas) {\n            actualFooterHeightMM = footerHeight;\n            console.log(`ğŸ“ æŠ¥è¡¨å°¾å®é™…é«˜åº¦ï¼š${Math.round(actualFooterHeightMM)}mm`);\n          }\n\n          // 2. è®¡ç®—å•è¡Œæ•°æ®é«˜åº¦ - ä¿å®ˆä½†å‡†ç¡®çš„æ–¹å¼\n          let dataRowHeightMM: number;\n\n          // ä½¿ç”¨Canvasä¸­çš„å¹³å‡è¡Œé«˜ï¼Œè¿™ä¸å®é™…æ¸²æŸ“æ›´ä¸€è‡´\n          const avgRowHeightCanvas = tableCanvas.height / totalRows;\n          dataRowHeightMM = (avgRowHeightCanvas / tableCanvas.height) * tableHeight;\n\n          console.log(`ğŸ“ Canvasè¡Œé«˜è®¡ç®—ï¼šæ€»é«˜åº¦${tableCanvas.height}px Ã· ${totalRows}è¡Œ = ${Math.round(avgRowHeightCanvas * 100) / 100}px/è¡Œ`);\n          console.log(`ğŸ“ PDFè¡Œé«˜ï¼š${Math.round(dataRowHeightMM * 100) / 100}mm/è¡Œ`);\n\n          // å¦‚æœæœ‰é…ç½®çš„è¡Œé«˜ï¼Œè¿›è¡Œå¯¹æ¯”ä½†ä¸ç›´æ¥ä½¿ç”¨ï¼ˆé¿å…æº¢å‡ºï¼‰\n          if (config?.layout?.rowHeight) {\n            const configRowHeightPx = typeof config.layout.rowHeight === 'number'\n              ? config.layout.rowHeight\n              : parseInt(config.layout.rowHeight);\n            const configRowHeightMM = (configRowHeightPx * 25.4) / 96;\n\n            console.log(`ğŸ“ é…ç½®è¡Œé«˜ï¼š${configRowHeightPx}px â†’ ${Math.round(configRowHeightMM * 100) / 100}mm`);\n            console.log(`ğŸ“ Canvasè¡Œé«˜ï¼š${Math.round(dataRowHeightMM * 100) / 100}mm`);\n            console.log(`ğŸ“ ä½¿ç”¨Canvasè¡Œé«˜ä»¥ç¡®ä¿æ•°æ®å®Œæ•´æ€§`);\n          }\n\n          // 3. é¡µé¢å¸ƒå±€å¸¸é‡ - ä¿å®ˆçš„ç©ºé—´é…ç½®\n          const pageNumberReserve = 15; // é¡µç é¢„ç•™ç©ºé—´(mm) - é€‚ä¸­é¢„ç•™\n          const contentGap = 5; // å†…å®¹é—´è·(mm) - é€‚ä¸­é—´è·\n          const safetyMargin = 3; // å®‰å…¨è¾¹è·(mm) - é€‚ä¸­å®‰å…¨è¾¹è·\n\n          console.log(`ğŸ“ é¡µé¢å¸ƒå±€å‚æ•°ï¼š`);\n          console.log(`- é¡µé¢æ€»é«˜åº¦ï¼š${Math.round(pageHeight)}mm`);\n          console.log(`- ä¸Šä¸‹è¾¹è·ï¼š${margins.top + margins.bottom}mm`);\n          console.log(`- é¡µç é¢„ç•™ï¼š${pageNumberReserve}mm`);\n          console.log(`- å®‰å…¨è¾¹è·ï¼š${safetyMargin}mm`);\n\n          // 4. è®¡ç®—å„é¡µç±»å‹çš„å¯ç”¨æ•°æ®é«˜åº¦\n          const baseAvailableHeight = pageHeight - margins.top - margins.bottom - pageNumberReserve - safetyMargin;\n\n          const firstPageDataHeight = baseAvailableHeight - actualHeaderHeightMM - contentGap;\n          const middlePageDataHeight = baseAvailableHeight;\n          const lastPageDataHeight = baseAvailableHeight - actualFooterHeightMM - contentGap;\n\n          console.log(`ğŸ“ å„é¡µå¯ç”¨æ•°æ®é«˜åº¦ï¼š`);\n          console.log(`- ç¬¬ä¸€é¡µæ•°æ®åŒºï¼š${Math.round(firstPageDataHeight)}mm`);\n          console.log(`- ä¸­é—´é¡µæ•°æ®åŒºï¼š${Math.round(middlePageDataHeight)}mm`);\n          console.log(`- æœ€åé¡µæ•°æ®åŒºï¼š${Math.round(lastPageDataHeight)}mm`);\n\n          // 5. ä¿å®ˆè®¡ç®—å„é¡µæœ€å¤§è¡Œæ•° - ç¡®ä¿æ•°æ®å®Œæ•´æ€§\n          const firstPageMaxRows = Math.floor(firstPageDataHeight / dataRowHeightMM);\n          const middlePageMaxRows = Math.floor(middlePageDataHeight / dataRowHeightMM);\n          const lastPageMaxRows = Math.floor(lastPageDataHeight / dataRowHeightMM);\n\n          console.log(`ğŸ“Š ä¿å®ˆè®¡ç®—çš„å„é¡µæœ€å¤§è¡Œæ•°ï¼š`);\n          console.log(`- ç¬¬ä¸€é¡µï¼š${firstPageMaxRows}è¡Œ (${Math.round(firstPageDataHeight)}mm Ã· ${Math.round(dataRowHeightMM * 100) / 100}mm)`);\n          console.log(`- ä¸­é—´é¡µï¼š${middlePageMaxRows}è¡Œ (${Math.round(middlePageDataHeight)}mm Ã· ${Math.round(dataRowHeightMM * 100) / 100}mm)`);\n          console.log(`- æœ€åé¡µï¼š${lastPageMaxRows}è¡Œ (${Math.round(lastPageDataHeight)}mm Ã· ${Math.round(dataRowHeightMM * 100) / 100}mm)`);\n\n          // éªŒè¯è®¡ç®—å‡†ç¡®æ€§\n          console.log(`ğŸ” ç©ºé—´åˆ©ç”¨ç‡éªŒè¯ï¼š`);\n          console.log(`- ç¬¬ä¸€é¡µï¼š${firstPageMaxRows}è¡Œ Ã— ${Math.round(dataRowHeightMM * 100) / 100}mm = ${Math.round(firstPageMaxRows * dataRowHeightMM)}mmï¼Œå¯ç”¨${Math.round(firstPageDataHeight)}mmï¼Œåˆ©ç”¨ç‡${Math.round((firstPageMaxRows * dataRowHeightMM / firstPageDataHeight) * 100)}%`);\n          console.log(`- ä¸­é—´é¡µï¼š${middlePageMaxRows}è¡Œ Ã— ${Math.round(dataRowHeightMM * 100) / 100}mm = ${Math.round(middlePageMaxRows * dataRowHeightMM)}mmï¼Œå¯ç”¨${Math.round(middlePageDataHeight)}mmï¼Œåˆ©ç”¨ç‡${Math.round((middlePageMaxRows * dataRowHeightMM / middlePageDataHeight) * 100)}%`);\n\n          // 6. é‡æ„åˆ†é¡µç®—æ³• - ç¡®ä¿æ•°æ®å®Œæ•´æ€§\n          const pageBreakPoints: Array<{yPercent: number; endRow: number}> = [];\n          let processedRows = 0;\n          let pageIndex = 0;\n\n          console.log(`ğŸ”„ å¼€å§‹æ™ºèƒ½åˆ†é¡µç®—æ³•ï¼Œæ€»æ•°æ®è¡Œæ•°ï¼š${dataRowCount}`);\n\n          while (processedRows < dataRowCount) {\n            let maxRowsThisPage: number;\n\n            if (pageIndex === 0) {\n              // ç¬¬ä¸€é¡µï¼šåŒ…å«æŠ¥è¡¨å¤´\n              maxRowsThisPage = firstPageMaxRows;\n              console.log(`ğŸ“„ ç¬¬${pageIndex + 1}é¡µï¼ˆé¦–é¡µï¼‰ï¼šæœ€å¤§å¯å®¹çº³${maxRowsThisPage}è¡Œ`);\n            } else {\n              // æ£€æŸ¥æ˜¯å¦ä¸ºæœ€åä¸€é¡µ\n              const remainingRows = dataRowCount - processedRows;\n\n              if (remainingRows <= lastPageMaxRows) {\n                // æœ€åä¸€é¡µï¼šéœ€è¦å®¹çº³æŠ¥è¡¨å°¾\n                maxRowsThisPage = remainingRows;\n                console.log(`ğŸ“„ ç¬¬${pageIndex + 1}é¡µï¼ˆæœ«é¡µï¼‰ï¼šæ˜¾ç¤ºå‰©ä½™${remainingRows}è¡Œ`);\n              } else {\n                // ä¸­é—´é¡µï¼šå…¨éƒ¨ç”¨äºæ•°æ®\n                maxRowsThisPage = middlePageMaxRows;\n                console.log(`ğŸ“„ ç¬¬${pageIndex + 1}é¡µï¼ˆä¸­é—´é¡µï¼‰ï¼šæœ€å¤§å¯å®¹çº³${maxRowsThisPage}è¡Œ`);\n              }\n            }\n\n            const rowsThisPage = Math.min(maxRowsThisPage, dataRowCount - processedRows);\n            processedRows += rowsThisPage;\n\n            console.log(`ğŸ“Š ç¬¬${pageIndex + 1}é¡µå®é™…æ˜¾ç¤ºï¼š${rowsThisPage}è¡Œï¼Œç´¯è®¡å¤„ç†ï¼š${processedRows}/${dataRowCount}è¡Œ`);\n\n            // å¦‚æœè¿˜æœ‰å‰©ä½™æ•°æ®ï¼Œåˆ›å»ºåˆ†é¡µç‚¹\n            if (processedRows < dataRowCount) {\n              // ç²¾ç¡®è®¡ç®—åˆ†é¡µç‚¹ä½ç½®\n              const headerHeightRatio = actualHeaderHeightMM / tableHeight;\n              const dataAreaHeightRatio = 1 - headerHeightRatio - (actualFooterHeightMM / tableHeight);\n              const processedRowsRatio = processedRows / dataRowCount;\n              const breakYPercent = headerHeightRatio + (processedRowsRatio * dataAreaHeightRatio);\n\n              pageBreakPoints.push({\n                yPercent: breakYPercent,\n                endRow: processedRows\n              });\n\n              console.log(`ğŸ“ åˆ›å»ºåˆ†é¡µç‚¹${pageIndex + 1}ï¼šç¬¬${processedRows}è¡Œç»“æŸï¼ŒY=${Math.round(breakYPercent * 100)}%`);\n            }\n\n            pageIndex++;\n          }\n\n          console.log(`âœ… åˆ†é¡µç®—æ³•å®Œæˆï¼šå…±${pageIndex}é¡µï¼Œå¤„ç†${processedRows}è¡Œæ•°æ®ï¼Œåˆ›å»º${pageBreakPoints.length}ä¸ªåˆ†é¡µç‚¹`);\n\n          // è®¡ç®—æ€»é¡µæ•°\n          const pagesNeeded = pageBreakPoints.length + 1;\n          console.log(`ğŸ“Š æ€»è®¡éœ€è¦ ${pagesNeeded} é¡µæ˜¾ç¤º ${dataRowCount} è¡Œæ•°æ®`);\n\n          // è¡¨æ ¼å„éƒ¨åˆ†çš„å›¾åƒæ•°æ®\n          const headerImgData = headerCanvas ? headerCanvas.toDataURL('image/jpeg', quality) : null;\n          const footerImgData = footerCanvas ? footerCanvas.toDataURL('image/jpeg', quality) : null;\n\n          // æ£€æŸ¥æœ€åä¸€é¡µæ˜¯å¦éœ€è¦é¢å¤–é¡µé¢æ˜¾ç¤ºæŠ¥è¡¨å°¾\n          if (footerImgData) {\n            const lastPageRows = pageBreakPoints.length > 0 ?\n              dataRowCount - pageBreakPoints[pageBreakPoints.length - 1].endRow :\n              dataRowCount;\n            const lastPageDataHeightUsed = lastPageRows * dataRowHeightMM;\n            const lastPageRemainingHeight = lastPageDataHeight - lastPageDataHeightUsed;\n\n            console.log(`ğŸ“‹ æŠ¥è¡¨å°¾æ£€æŸ¥ï¼š`);\n            console.log(`- æœ€åä¸€é¡µæ•°æ®è¡Œæ•°ï¼š${lastPageRows}`);\n            console.log(`- æœ€åä¸€é¡µæ•°æ®å ç”¨é«˜åº¦ï¼š${Math.round(lastPageDataHeightUsed)}mm`);\n            console.log(`- æœ€åä¸€é¡µå‰©ä½™é«˜åº¦ï¼š${Math.round(lastPageRemainingHeight)}mm`);\n            console.log(`- æŠ¥è¡¨å°¾éœ€è¦é«˜åº¦ï¼š${Math.round(actualFooterHeightMM + contentGap)}mm`);\n\n            if (lastPageRemainingHeight < actualFooterHeightMM + contentGap) {\n              console.log(`âš ï¸ æœ€åä¸€é¡µç©ºé—´ä¸è¶³ï¼ŒæŠ¥è¡¨å°¾å°†åœ¨æ–°é¡µæ˜¾ç¤º`);\n            } else {\n              console.log(`âœ… æœ€åä¸€é¡µç©ºé—´å……è¶³ï¼ŒæŠ¥è¡¨å°¾å°†åœ¨å½“å‰é¡µæ˜¾ç¤º`);\n            }\n          }\n\n          // é€é¡µæ·»åŠ å†…å®¹\n          for (let page = 0; page < pagesNeeded; page++) {\n            // å¦‚æœä¸æ˜¯ç¬¬ä¸€é¡µï¼Œåˆ›å»ºæ–°é¡µ\n            if (page > 0) {\n              pdf.addPage();\n            }\n\n            let yOffset = margins.top;\n\n            // æ·»åŠ æŠ¥è¡¨å¤´ï¼ˆåªåœ¨ç¬¬ä¸€é¡µæ˜¾ç¤ºï¼‰\n            if (headerImgData && page === 0) {\n              pdf.addImage(\n                headerImgData,\n                'JPEG',\n                margins.left,\n                yOffset,\n                contentWidth,\n                headerHeight\n              );\n              yOffset += headerHeight + 5; // 5mmçš„é—´è·\n            }\n\n            // æ·»åŠ è¡¨æ ¼æ ‡é¢˜è¡Œï¼ˆæ ¹æ®é…ç½®å†³å®šæ˜¯å¦åœ¨æ¯é¡µæ˜¾ç¤ºï¼‰\n            const repeatTableHeader = mergedPdfOptions.repeatTableHeader !== false; // é»˜è®¤ä¸ºtrue\n            if (repeatTableHeader && page > 0 && headerRowCount > 0) {\n              // åœ¨éé¦–é¡µæ·»åŠ è¡¨æ ¼æ ‡é¢˜è¡Œ\n              try {\n                console.log(`ğŸ“„ ç¬¬${page + 1}é¡µæ·»åŠ è¡¨æ ¼æ ‡é¢˜è¡Œ`);\n\n                // åˆ›å»ºåªåŒ…å«è¡¨å¤´çš„ä¸´æ—¶canvasï¼ˆç²¾ç¡®æ§åˆ¶ï¼‰\n                const headerOnlyCanvas = document.createElement('canvas');\n                headerOnlyCanvas.width = tableCanvas.width;\n\n                // ç²¾ç¡®è®¡ç®—è¡¨å¤´é«˜åº¦\n                const headerHeightInCanvas = (headerRowCount / totalRows) * tableCanvas.height;\n                headerOnlyCanvas.height = Math.ceil(headerHeightInCanvas);\n\n                const headerCtx = headerOnlyCanvas.getContext('2d');\n                if (headerCtx) {\n                  // è®¾ç½®ç™½è‰²èƒŒæ™¯\n                  headerCtx.fillStyle = '#ffffff';\n                  headerCtx.fillRect(0, 0, headerOnlyCanvas.width, headerOnlyCanvas.height);\n\n                  // ä»åŸè¡¨æ ¼canvasä¸­ç²¾ç¡®å¤åˆ¶è¡¨å¤´éƒ¨åˆ†\n                  headerCtx.drawImage(\n                    tableCanvas,\n                    0, 0, tableCanvas.width, headerHeightInCanvas,\n                    0, 0, headerOnlyCanvas.width, headerOnlyCanvas.height\n                  );\n\n                  // è®¡ç®—è¡¨å¤´åœ¨PDFä¸­çš„é«˜åº¦\n                  const headerHeightInPDF = (headerOnlyCanvas.height / tableCanvas.height) * tableHeight;\n\n                  // å°†è¡¨å¤´æ·»åŠ åˆ°PDF\n                  const headerImgData = headerOnlyCanvas.toDataURL('image/jpeg', quality);\n                  pdf.addImage(\n                    headerImgData,\n                    'JPEG',\n                    margins.left,\n                    yOffset,\n                    contentWidth,\n                    headerHeightInPDF\n                  );\n\n                  yOffset += headerHeightInPDF; // ä¸æ·»åŠ é¢å¤–é—´è·ï¼Œç¡®ä¿ä¸æ•°æ®è¡Œç´§å¯†è¿æ¥\n                  console.log(`ğŸ“„ ç¬¬${page + 1}é¡µè¡¨æ ¼æ ‡é¢˜è¡Œæ·»åŠ å®Œæˆï¼Œé«˜åº¦ï¼š${Math.round(headerHeightInPDF)}mm`);\n                }\n              } catch (e) {\n                console.warn(`ç¬¬${page + 1}é¡µæ·»åŠ è¡¨æ ¼æ ‡é¢˜è¡Œå¤±è´¥:`, e);\n              }\n            }\n\n            // è®¡ç®—å½“å‰é¡µè¡¨æ ¼éƒ¨åˆ†çš„èµ·å§‹ä½ç½®å’Œç»“æŸä½ç½®\n            let tableStartPercent = 0;\n            let tableEndPercent = 1;\n\n            // æ ¹æ®åˆ†é¡µç‚¹è®¡ç®—æ¯é¡µå†…å®¹èŒƒå›´\n            if (pageBreakPoints.length > 0) {\n              if (page === 0) {\n                // ç¬¬ä¸€é¡µï¼šä»å¼€å§‹åˆ°ç¬¬ä¸€ä¸ªåˆ†é¡µç‚¹\n                tableStartPercent = 0;\n                tableEndPercent = pageBreakPoints[0].yPercent;\n\n                const endRow = pageBreakPoints[0].endRow;\n                console.log(`ğŸ“„ ç¬¬1é¡µï¼šæ˜¾ç¤ºè¡¨å¤´+ç¬¬1-${endRow}è¡Œï¼ŒYèŒƒå›´ï¼š0% åˆ° ${Math.round(pageBreakPoints[0].yPercent * 100)}%`);\n              } else {\n                // åç»­é¡µï¼šä»å‰ä¸€ä¸ªåˆ†é¡µç‚¹åˆ°å½“å‰åˆ†é¡µç‚¹ï¼ˆæˆ–ç»“æŸï¼‰\n                tableStartPercent = pageBreakPoints[page - 1].yPercent;\n                tableEndPercent = page < pageBreakPoints.length ? pageBreakPoints[page].yPercent : 1;\n\n                const startRow = pageBreakPoints[page - 1].endRow + 1;\n                const endRow = page < pageBreakPoints.length ? pageBreakPoints[page].endRow : dataRowCount;\n                console.log(`ğŸ“„ ç¬¬${page + 1}é¡µï¼šæ˜¾ç¤ºç¬¬${startRow}-${endRow}è¡Œï¼ŒYèŒƒå›´ï¼š${Math.round(tableStartPercent * 100)}% åˆ° ${Math.round(tableEndPercent * 100)}%`);\n              }\n            } else {\n              // å•é¡µæ˜¾ç¤ºæ‰€æœ‰å†…å®¹\n              console.log(`ğŸ“„ ç¬¬${page + 1}é¡µï¼šæ˜¾ç¤ºæ‰€æœ‰å†…å®¹ï¼ˆå•é¡µæ¨¡å¼ï¼‰`);\n            }\n\n            // æ ¹æ®åˆ†é¡µè®¡ç®—ç²¾ç¡®è£å‰ªæºå›¾åƒ\n            let sourceY: number;\n            let sourceHeight: number;\n            let tablePartHeight: number;\n\n            if (pageBreakPoints.length > 0) {\n              // å¤šé¡µæ¨¡å¼ï¼šåŸºäºè¡Œè¾¹ç•Œè¿›è¡Œç²¾ç¡®è£å‰ª\n              if (page === 0) {\n                // ç¬¬ä¸€é¡µï¼šä»é¡¶éƒ¨å¼€å§‹åˆ°ç¬¬ä¸€ä¸ªåˆ†é¡µç‚¹\n                const endRow = pageBreakPoints[0].endRow;\n                sourceY = 0; // ä»è¡¨å¤´å¼€å§‹\n\n                // åŸºäºè¡Œè¾¹ç•Œè®¡ç®—ï¼šè¡¨å¤´ + æŒ‡å®šè¡Œæ•°çš„æ•°æ®\n                const headerRowHeightCanvas = (headerRowCount / totalRows) * tableCanvas.height;\n                const dataRowHeightCanvas = tableCanvas.height / totalRows; // å•è¡Œåœ¨Canvasä¸­çš„é«˜åº¦\n                const endRowHeightCanvas = headerRowHeightCanvas + (endRow * dataRowHeightCanvas);\n\n                sourceHeight = Math.floor(endRowHeightCanvas);\n                tablePartHeight = (sourceHeight / tableCanvas.height) * tableHeight;\n\n                console.log(`ğŸ“ ç¬¬1é¡µè¡Œè¾¹ç•Œè£å‰ªï¼šè¡¨å¤´${headerRowCount}è¡Œ+æ•°æ®${endRow}è¡Œï¼ŒCanvasé«˜åº¦=${Math.round(sourceHeight)}pxï¼ŒPDFé«˜åº¦=${Math.round(tablePartHeight)}mm`);\n              } else {\n                // åç»­é¡µï¼šåªè£å‰ªæ•°æ®è¡Œéƒ¨åˆ†ï¼ˆè¡¨å¤´å·²å•ç‹¬æ·»åŠ ï¼‰\n                const startRow = pageBreakPoints[page - 1].endRow;\n                const endRow = page < pageBreakPoints.length ? pageBreakPoints[page].endRow : dataRowCount;\n                const rowsThisPage = endRow - startRow;\n\n                console.log(`ğŸ“ ç¬¬${page + 1}é¡µæ•°æ®è¡Œï¼šç¬¬${startRow + 1}-${endRow}è¡Œï¼ˆ${rowsThisPage}è¡Œï¼‰`);\n\n                // è®¡ç®—æ•°æ®è¡Œçš„è£å‰ªèŒƒå›´ï¼ˆä¸åŒ…å«è¡¨å¤´ï¼‰\n                const headerRowHeightCanvas = (headerRowCount / totalRows) * tableCanvas.height;\n                const dataRowHeightCanvas = tableCanvas.height / totalRows;\n\n                // ä»æ•°æ®è¡Œå¼€å§‹è£å‰ªï¼Œä¸åŒ…å«è¡¨å¤´ï¼Œç²¾ç¡®è®¡ç®—é¿å…å¤šä½™å†…å®¹\n                const startRowHeightCanvas = headerRowHeightCanvas + (startRow * dataRowHeightCanvas);\n                const endRowHeightCanvas = headerRowHeightCanvas + (endRow * dataRowHeightCanvas);\n\n                // æ›´ç²¾ç¡®çš„è£å‰ªä½ç½®è®¡ç®—\n                if (startRow === 0) {\n                  // å¦‚æœæ˜¯ç¬¬ä¸€æ‰¹æ•°æ®è¡Œï¼Œä»è¡¨å¤´ç»“æŸä½ç½®å¼€å§‹ï¼Œä½†è¦åŒ…å«ç¬¬ä¸€è¡Œçš„å®Œæ•´ä¸Šè¾¹æ¡†\n                  sourceY = Math.floor(headerRowHeightCanvas - 1); // å‘å‰åŒ…å«1pxç¡®ä¿è¾¹æ¡†å®Œæ•´\n                } else {\n                  // éç¬¬ä¸€æ‰¹æ•°æ®è¡Œï¼Œç²¾ç¡®ä»è¡Œå¼€å§‹ä½ç½®è£å‰ª\n                  sourceY = Math.floor(startRowHeightCanvas);\n                }\n\n                // ç²¾ç¡®è®¡ç®—ç»“æŸä½ç½®ï¼Œé¿å…åŒ…å«å¤šä½™çš„ç«–çº¿\n                const endY = Math.floor(endRowHeightCanvas); // ç²¾ç¡®åˆ°è¡Œç»“æŸä½ç½®ï¼Œä¸åŒ…å«é¢å¤–å†…å®¹\n                sourceHeight = Math.min(endY - sourceY, tableCanvas.height - sourceY);\n                tablePartHeight = (sourceHeight / tableCanvas.height) * tableHeight;\n\n                console.log(`ğŸ“ ç¬¬${page + 1}é¡µæ•°æ®è¡Œè£å‰ªï¼šç¬¬${startRow + 1}-${endRow}è¡Œï¼ŒCanvasèŒƒå›´=${Math.round(sourceY)}-${Math.round(sourceY + sourceHeight)}pxï¼ŒPDFé«˜åº¦=${Math.round(tablePartHeight)}mm`);\n              }\n            } else {\n              // å•é¡µæ¨¡å¼ï¼šä½¿ç”¨åŸæœ‰é€»è¾‘\n              sourceY = Math.floor(tableStartPercent * tableCanvas.height);\n              sourceHeight = Math.ceil((tableEndPercent - tableStartPercent) * tableCanvas.height);\n              tablePartHeight = (sourceHeight / tableCanvas.height) * tableHeight;\n\n              console.log(`ğŸ“ å•é¡µæ¨¡å¼ï¼šæºé«˜åº¦=${Math.round(sourceHeight)}pxï¼Œç›®æ ‡é«˜åº¦=${Math.round(tablePartHeight)}mm`);\n            }\n\n            // éªŒè¯å¯ç”¨ç©ºé—´å¹¶åŠ¨æ€è°ƒæ•´ï¼ˆæ›´æ™ºèƒ½çš„ç©ºé—´åˆ©ç”¨ï¼‰\n            const maxAllowedHeight = pageHeight - yOffset - margins.bottom - pageNumberReserve;\n\n            if (tablePartHeight > maxAllowedHeight) {\n              console.warn(`âš ï¸ ç¬¬${page + 1}é¡µå†…å®¹é«˜åº¦${Math.round(tablePartHeight)}mmè¶…å‡ºå¯ç”¨ç©ºé—´${Math.round(maxAllowedHeight)}mm`);\n              // åŠ¨æ€è°ƒæ•´ï¼šå¦‚æœè¶…å‡ºä¸å¤šï¼Œå¯ä»¥å‹ç¼©é¡µç é¢„ç•™ç©ºé—´\n              const overflow = tablePartHeight - maxAllowedHeight;\n              if (overflow <= 8) { // å¦‚æœè¶…å‡ºä¸è¶…è¿‡8mmï¼Œå¯ä»¥å‹ç¼©é¡µç ç©ºé—´\n                console.log(`ğŸ“ åŠ¨æ€è°ƒæ•´ï¼šå‹ç¼©é¡µç é¢„ç•™ç©ºé—´${Math.round(overflow)}mm`);\n                // ç»§ç»­ä½¿ç”¨åŸå§‹é«˜åº¦ï¼Œé¡µç ä½ç½®ä¼šè‡ªåŠ¨è°ƒæ•´\n              }\n            }\n\n            try {\n              // åˆ›å»ºä¸´æ—¶canvasæ¥ä¿å­˜è£å‰ªçš„è¡¨æ ¼éƒ¨åˆ†\n              const pageTableCanvas = document.createElement('canvas');\n              pageTableCanvas.width = tableCanvas.width;\n              pageTableCanvas.height = sourceHeight;\n\n              const pageTableCtx = pageTableCanvas.getContext('2d');\n              if (pageTableCtx) {\n                // è®¾ç½®ç™½è‰²èƒŒæ™¯\n                pageTableCtx.fillStyle = '#ffffff';\n                pageTableCtx.fillRect(0, 0, pageTableCanvas.width, pageTableCanvas.height);\n\n                // å°†è¡¨æ ¼å¯¹åº”éƒ¨åˆ†è£å‰ªåˆ°æ–°canvas\n                pageTableCtx.drawImage(\n                  tableCanvas,\n                  0, sourceY, tableCanvas.width, sourceHeight,\n                  0, 0, pageTableCanvas.width, pageTableCanvas.height\n                );\n\n                // å¦‚æœæ˜¯éé¦–é¡µä¸”æ²¡æœ‰è¡¨å¤´ï¼Œéœ€è¦åœ¨é¡¶éƒ¨æ·»åŠ è¾¹æ¡†çº¿\n                if (page > 0 && (!repeatTableHeader || headerRowCount === 0)) {\n                  // åœ¨æ•°æ®è¡Œé¡¶éƒ¨ç»˜åˆ¶è¾¹æ¡†çº¿ï¼Œè¡¥å……è¢«è£å‰ªæ‰çš„ä¸Šè¾¹æ¡†\n                  pageTableCtx.strokeStyle = '#ddd';\n                  pageTableCtx.lineWidth = 1;\n                  pageTableCtx.beginPath();\n                  pageTableCtx.moveTo(0, 0.5);\n                  pageTableCtx.lineTo(pageTableCanvas.width, 0.5);\n                  pageTableCtx.stroke();\n                  console.log(`ğŸ“„ ç¬¬${page + 1}é¡µæ·»åŠ é¡¶éƒ¨è¾¹æ¡†çº¿ï¼ˆæ— è¡¨å¤´æ¨¡å¼ï¼‰`);\n                }\n\n                // å°†è£å‰ªåçš„è¡¨æ ¼éƒ¨åˆ†è½¬æ¢ä¸ºå›¾åƒæ•°æ®\n                const pageTableImgData = pageTableCanvas.toDataURL('image/jpeg', quality);\n\n                // æ·»åŠ è£å‰ªåçš„è¡¨æ ¼éƒ¨åˆ†\n                pdf.addImage(\n                  pageTableImgData,\n                  'JPEG',\n                  margins.left,\n                  yOffset,\n                  contentWidth,\n                  tablePartHeight\n                );\n\n                yOffset += tablePartHeight;\n              }\n            } catch (e) {\n              console.warn('å¤„ç†è¡¨æ ¼é¡µç æ—¶å‡ºé”™:', e);\n            }\n\n            // æ·»åŠ é¡µç ï¼ˆå¦‚æœé¡µæ•°å¤§äº1ï¼‰\n            if (pagesNeeded > 1) {\n              // ä½¿ç”¨è‹±æ–‡æ ¼å¼é¡µç ï¼Œé¿å…ä¸­æ–‡ä¹±ç é—®é¢˜\n              try {\n                pdf.setFontSize(10);\n                pdf.setTextColor(80, 80, 80);\n\n                // æ™ºèƒ½é¡µç ä½ç½®ï¼šæ ¹æ®å†…å®¹é«˜åº¦åŠ¨æ€è°ƒæ•´\n                const contentBottom = yOffset;\n                const minPageNumberY = contentBottom + 5; // å†…å®¹ä¸‹æ–¹è‡³å°‘5mm\n                const maxPageNumberY = pageHeight - margins.bottom + 3; // åœ¨åº•éƒ¨è¾¹è·å†…\n                const pageNumberY = Math.min(maxPageNumberY, Math.max(minPageNumberY, pageHeight - 8));\n\n                pdf.text(\n                  `Page ${page + 1} / ${pagesNeeded}`,\n                  pageWidth / 2,\n                  pageNumberY,\n                  { align: 'center' }\n                );\n\n                console.log(`ç¬¬${page + 1}é¡µæ·»åŠ é¡µç ï¼Œå†…å®¹åº•éƒ¨ï¼š${Math.round(contentBottom)}mmï¼Œé¡µç ä½ç½®ï¼šY=${Math.round(pageNumberY)}mm`);\n              } catch (e) {\n                console.warn('é¡µç æ¸²æŸ“å¤±è´¥:', e);\n              }\n            }\n\n            // æ·»åŠ è¡¨å°¾ï¼ˆåªåœ¨æœ€åä¸€é¡µæ˜¾ç¤ºï¼‰\n            if (footerImgData && page === pagesNeeded - 1) {\n              // è®¡ç®—è¡¨å°¾ä½ç½®ï¼Œç¡®ä¿ä¸è¦†ç›–è¡¨æ ¼å†…å®¹å’Œé¡µç \n              const minFooterY = yOffset + contentGap; // è¡¨æ ¼å†…å®¹ä¸‹æ–¹é¢„ç•™é—´è·\n              const maxFooterY = pageHeight - margins.bottom - pageNumberReserve - footerHeight; // è€ƒè™‘é¡µç ç©ºé—´\n\n              const footerY = Math.max(minFooterY, maxFooterY);\n\n              // å¦‚æœå½“å‰é¡µæ²¡æœ‰è¶³å¤Ÿç©ºé—´æ˜¾ç¤ºè¡¨å°¾ï¼Œåˆ™åˆ›å»ºæ–°é¡µ\n              if (footerY + footerHeight > pageHeight - margins.bottom - pageNumberReserve) {\n                console.log(`ğŸ“„ è¡¨å°¾éœ€è¦æ–°é¡µæ˜¾ç¤ºï¼Œå½“å‰é¡µå‰©ä½™ç©ºé—´ä¸è¶³`);\n                pdf.addPage();\n\n                // åœ¨æ–°é¡µæ·»åŠ è¡¨å°¾\n                pdf.addImage(\n                  footerImgData,\n                  'JPEG',\n                  margins.left,\n                  margins.top,\n                  contentWidth,\n                  footerHeight\n                );\n\n                // åœ¨æ–°é¡µæ·»åŠ é¡µç \n                if (pagesNeeded > 1) {\n                  const newPageNumber = pagesNeeded + 1; // æ–°å¢çš„è¡¨å°¾é¡µ\n                  pdf.setFontSize(10);\n                  pdf.setTextColor(80, 80, 80);\n                  const pageNumberY = pageHeight - margins.bottom + 3;\n                  pdf.text(\n                    `Page ${newPageNumber} / ${newPageNumber}`,\n                    pageWidth / 2,\n                    pageNumberY,\n                    { align: 'center' }\n                  );\n                }\n\n                // åœ¨æ–°é¡µæ·»åŠ æ°´å°\n                if (finalWatermark) {\n                  try {\n                    const watermarkCanvas = document.createElement('canvas');\n                    watermarkCanvas.width = 400;\n                    watermarkCanvas.height = 100;\n                    const ctx = watermarkCanvas.getContext('2d');\n\n                    if (ctx) {\n                      ctx.font = '40px Arial, sans-serif';\n                      ctx.fillStyle = 'rgba(200, 200, 200, 0.3)';\n                      ctx.textAlign = 'center';\n                      ctx.textBaseline = 'middle';\n                      ctx.translate(200, 50);\n                      ctx.rotate(45 * Math.PI / 180);\n                      ctx.fillText(finalWatermark, 0, 0);\n\n                      const watermarkImgData = watermarkCanvas.toDataURL('image/png');\n                      pdf.addImage(\n                        watermarkImgData,\n                        'PNG',\n                        pageWidth / 2 - 50,\n                        pageHeight / 2 - 12.5,\n                        100,\n                        25,\n                        undefined,\n                        'NONE'\n                      );\n                    }\n                  } catch (e) {\n                    console.warn('æ–°é¡µæ°´å°æ·»åŠ å¤±è´¥:', e);\n                  }\n                }\n              } else {\n                // åœ¨å½“å‰é¡µæ·»åŠ è¡¨å°¾\n                console.log(`ğŸ“„ åœ¨ç¬¬${page + 1}é¡µæ·»åŠ è¡¨å°¾ï¼Œä½ç½®ï¼šY=${Math.round(footerY)}mm`);\n                pdf.addImage(\n                  footerImgData,\n                  'JPEG',\n                  margins.left,\n                  footerY,\n                  contentWidth,\n                  footerHeight\n                );\n              }\n            }\n\n            // åœ¨æ¯é¡µæ·»åŠ æ°´å° - æ”¹è¿›ç‰ˆï¼šå…¨é¡µé¢å¹³é“ºæ°´å°\n            if (finalWatermark) {\n              try {\n                console.log(`ç¬¬${page + 1}é¡µå¼€å§‹æ·»åŠ å…¨é¡µé¢æ°´å°: \"${finalWatermark}\"`);\n\n                // åˆ›å»ºå…¨é¡µé¢æ°´å°Canvas\n                const watermarkCanvas = document.createElement('canvas');\n\n                // æ ¹æ®PDFé¡µé¢å°ºå¯¸è®¾ç½®Canvaså°ºå¯¸ï¼ˆæé«˜åˆ†è¾¨ç‡ï¼‰\n                const scale = 2; // æé«˜æ¸…æ™°åº¦\n                watermarkCanvas.width = pageWidth * scale * 4; // è½¬æ¢ä¸ºåƒç´ å¹¶æ”¾å¤§\n                watermarkCanvas.height = pageHeight * scale * 4;\n\n                const ctx = watermarkCanvas.getContext('2d');\n                if (!ctx) {\n                  throw new Error('æ— æ³•åˆ›å»ºcanvasä¸Šä¸‹æ–‡');\n                }\n\n                // è®¾ç½®é€æ˜èƒŒæ™¯\n                ctx.clearRect(0, 0, watermarkCanvas.width, watermarkCanvas.height);\n\n                // è®¡ç®—æ°´å°æ–‡å­—çš„åˆé€‚å¤§å°\n                const textLength = finalWatermark.length;\n                let fontSize = Math.max(24, Math.min(48, 600 / textLength)); // æ ¹æ®æ–‡å­—é•¿åº¦åŠ¨æ€è°ƒæ•´å­—ä½“å¤§å°\n                ctx.font = `${fontSize}px Arial, sans-serif`;\n                ctx.fillStyle = 'rgba(180, 180, 180, 0.15)'; // æ›´æ·¡çš„æ°´å°\n                ctx.textAlign = 'center';\n                ctx.textBaseline = 'middle';\n\n                // æµ‹é‡æ–‡å­—å°ºå¯¸\n                const textMetrics = ctx.measureText(finalWatermark);\n                const textWidth = textMetrics.width;\n                const textHeight = fontSize;\n\n                // è®¡ç®—å¹³é“ºé—´è·ï¼ˆç¡®ä¿æ°´å°ä¸ä¼šé‡å ä¸”è¦†ç›–æ•´ä¸ªé¡µé¢ï¼‰\n                const spacingX = textWidth * 1.8; // æ°´å¹³é—´è·\n                const spacingY = textHeight * 4.5; // å‚ç›´é—´è· - å¢åŠ ä¸Šä¸‹é—´è·\n\n                // è®¡ç®—éœ€è¦çš„è¡Œåˆ—æ•°ï¼ˆç¡®ä¿å®Œå…¨è¦†ç›–é¡µé¢ï¼‰\n                const cols = Math.ceil(watermarkCanvas.width / spacingX) + 2;\n                const rows = Math.ceil(watermarkCanvas.height / spacingY) + 2;\n\n                console.log(`æ°´å°å‚æ•°: å­—ä½“${fontSize}px, æ–‡å­—å®½åº¦${Math.round(textWidth)}px, é—´è·${Math.round(spacingX)}x${Math.round(spacingY)}px, ç½‘æ ¼${cols}x${rows}`);\n\n                // å¹³é“ºç»˜åˆ¶æ°´å°\n                for (let row = 0; row < rows; row++) {\n                  for (let col = 0; col < cols; col++) {\n                    ctx.save();\n\n                    // è®¡ç®—å½“å‰æ°´å°ä½ç½®\n                    const x = (col * spacingX) - spacingX / 2;\n                    const y = (row * spacingY) - spacingY / 2;\n\n                    // ç§»åŠ¨åˆ°æ°´å°ä½ç½®\n                    ctx.translate(x, y);\n\n                    // æ—‹è½¬45åº¦\n                    ctx.rotate(45 * Math.PI / 180);\n\n                    // ç»˜åˆ¶æ°´å°æ–‡å­—\n                    ctx.fillText(finalWatermark, 0, 0);\n\n                    ctx.restore();\n                  }\n                }\n\n                // å°†canvasè½¬æ¢ä¸ºå›¾åƒ\n                const watermarkImgData = watermarkCanvas.toDataURL('image/png');\n\n                // æ·»åŠ æ°´å°å›¾åƒåˆ°PDFï¼ˆè¦†ç›–æ•´ä¸ªé¡µé¢ï¼‰\n                pdf.addImage(\n                  watermarkImgData,\n                  'PNG',\n                  0, // ä»é¡µé¢å·¦ä¸Šè§’å¼€å§‹\n                  0,\n                  pageWidth, // è¦†ç›–æ•´ä¸ªé¡µé¢å®½åº¦\n                  pageHeight, // è¦†ç›–æ•´ä¸ªé¡µé¢é«˜åº¦\n                  undefined,\n                  'NONE'\n                );\n\n                console.log(`ç¬¬${page + 1}é¡µæˆåŠŸæ·»åŠ å…¨é¡µé¢å¹³é“ºæ°´å°`);\n\n              } catch (watermarkError) {\n                console.warn(`ç¬¬${page + 1}é¡µæ·»åŠ æ°´å°å¤±è´¥ï¼Œå°è¯•ç®€åŒ–æ°´å°:`, watermarkError);\n\n                // é™çº§æ–¹æ¡ˆï¼šä½¿ç”¨PDFåŸç”Ÿæ–‡å­—æ°´å°\n                try {\n                  pdf.setTextColor(200, 200, 200);\n                  pdf.setFontSize(30);\n\n                  // åœ¨é¡µé¢ä¸­å¿ƒæ·»åŠ å•ä¸ªæ°´å°\n                  const centerX = pageWidth / 2;\n                  const centerY = pageHeight / 2;\n\n                  pdf.text(finalWatermark, centerX, centerY, {\n                    align: 'center',\n                    baseline: 'middle',\n                    angle: 45\n                  });\n\n                  console.log(`ç¬¬${page + 1}é¡µæ·»åŠ ç®€åŒ–æ°´å°: \"${finalWatermark}\"`);\n                } catch (fallbackError) {\n                  console.warn(`ç¬¬${page + 1}é¡µç®€åŒ–æ°´å°ä¹Ÿå¤±è´¥:`, fallbackError);\n                }\n              }\n            }\n\n            // æ³¨æ„ï¼šæ–°é¡µçš„æ·»åŠ å·²ç»åœ¨å¾ªç¯å¼€å§‹æ—¶å¤„ç†äº†ï¼Œè¿™é‡Œä¸éœ€è¦é‡å¤æ·»åŠ \n          }\n        } catch (e) {\n          console.warn('å¤„ç†è¡¨æ ¼æ—¶å‡ºé”™:', e);\n          // é™çº§å¤„ç†ï¼šä½¿ç”¨html2canvaså¯¹æ•´ä¸ªå…ƒç´ æˆªå›¾\n          const canvas = await html2canvas(tempContainer, {\n            scale: 1.5,\n            useCORS: true,\n            logging: false,\n            allowTaint: true,\n            backgroundColor: '#FFFFFF'\n          });\n\n          const imgData = canvas.toDataURL('image/jpeg', quality);\n\n          // è®¡ç®—ç­‰æ¯”ä¾‹ç¼©æ”¾å°ºå¯¸\n          const canvasAspectRatio = canvas.width / canvas.height;\n          const pageAspectRatio = contentWidth / contentHeight;\n\n          let imgWidth, imgHeight;\n\n          if (relayout) {\n            // é‡æ–°æ’ç‰ˆæ¨¡å¼ï¼šä½¿ç”¨å†…å®¹åŒºåŸŸçš„å®Œæ•´å®½åº¦\n            imgWidth = contentWidth;\n            imgHeight = (canvas.height / canvas.width) * imgWidth;\n            console.log('é‡æ–°æ’ç‰ˆæ¨¡å¼ - å›¾åƒå°ºå¯¸:', { imgWidth, imgHeight });\n          } else {\n            // ç¼©æ”¾æ¨¡å¼ï¼šç­‰æ¯”ä¾‹ç¼©æ”¾ä»¥é€‚åº”é¡µé¢\n            if (canvasAspectRatio > pageAspectRatio) {\n              // å›¾åƒæ›´å®½ï¼Œä»¥å®½åº¦ä¸ºå‡†\n              imgWidth = contentWidth;\n              imgHeight = imgWidth / canvasAspectRatio;\n            } else {\n              // å›¾åƒæ›´é«˜ï¼Œä»¥é«˜åº¦ä¸ºå‡†\n              imgHeight = contentHeight;\n              imgWidth = imgHeight * canvasAspectRatio;\n            }\n            console.log('ç¼©æ”¾æ¨¡å¼ - ç­‰æ¯”ä¾‹ç¼©æ”¾å›¾åƒå°ºå¯¸:', { imgWidth, imgHeight, canvasAspectRatio, pageAspectRatio });\n          }\n\n          pdf.addImage(imgData, 'JPEG', margins.left, margins.top, imgWidth, imgHeight);\n        }\n      }\n\n      // æ°´å°å·²åœ¨æ¯é¡µå¾ªç¯ä¸­æ·»åŠ \n\n      // æ¸…ç†ä¸´æ—¶å…ƒç´ \n      document.body.removeChild(tempContainer);\n\n      // æ¢å¤åŸå§‹æ»šåŠ¨ä½ç½®\n      element.scrollTop = originalScrollTop;\n\n      // ä¿å­˜æ–‡ä»¶\n      pdf.save(`${fileName}.pdf`);\n\n      return Promise.resolve();\n    } catch (error) {\n      console.error('PDFå¯¼å‡ºå¤±è´¥:', error);\n      return Promise.reject(error);\n    }\n  }\n\n  /**\n   * æ‰“å°åŠŸèƒ½ - é‡ç”¨PDFç»˜åˆ¶é€»è¾‘\n   * @param element è¦æ‰“å°çš„DOMå…ƒç´ \n   * @param config æŠ¥è¡¨é…ç½®\n   * @param options æ‰“å°é€‰é¡¹\n   */\n  static async toPrint(element: HTMLElement, config?: any, options: ExportOptions = {}): Promise<void> {\n    try {\n      console.log('å¼€å§‹æ‰“å°ï¼Œé‡ç”¨PDFç»˜åˆ¶é€»è¾‘');\n\n      // ä½¿ç”¨ä¸PDFç›¸åŒçš„å¤„ç†é€»è¾‘ï¼Œä½†ç”ŸæˆHTMLè€Œä¸æ˜¯PDF\n      const {\n        watermark,\n        pdf: pdfOptions = {}\n      } = options;\n\n      // ä»é…ç½®ä¸­è·å–PDFè®¾ç½®\n      const configPdfSettings = config?.features?.pdfConfig || {};\n      const mergedPdfOptions = { ...configPdfSettings, ...pdfOptions };\n\n      // æ°´å°å¤„ç†\n      const finalWatermark = watermark !== undefined ? watermark : (config?.features?.watermark || '');\n\n      // æ‰“å°é…ç½® - ä½¿ç”¨A4çº¸å¼ è®¾ç½®\n      const orientation = mergedPdfOptions.orientation || 'portrait';\n      const pageSize = mergedPdfOptions.pageSize || 'A4';\n\n      console.log(`æ‰“å°è®¾ç½® - é¡µé¢å¤§å°: ${pageSize}, æ–¹å‘: ${orientation}`);\n\n      // åˆ›å»ºæ‰“å°ä¸“ç”¨çš„ä¸´æ—¶å®¹å™¨\n      const printContainer = await this._createPrintContainer(element, config, mergedPdfOptions, finalWatermark);\n\n      // åˆ›å»ºæ‰“å°æ ·å¼\n      const printStyle = this._createPrintStyle(orientation, pageSize);\n\n      // æ·»åŠ æ ·å¼åˆ°é¡µé¢\n      document.head.appendChild(printStyle);\n\n      // å°†æ‰“å°å®¹å™¨æ·»åŠ åˆ°é¡µé¢ï¼ˆéšè—ï¼‰\n      printContainer.style.position = 'fixed';\n      printContainer.style.left = '-9999px';\n      printContainer.style.top = '0';\n      printContainer.style.zIndex = '9999';\n      document.body.appendChild(printContainer);\n\n      // ç­‰å¾…å†…å®¹æ¸²æŸ“å®Œæˆ\n      await new Promise(resolve => setTimeout(resolve, 100));\n\n      // æ˜¾ç¤ºæ‰“å°å®¹å™¨å¹¶éšè—å…¶ä»–å†…å®¹\n      printContainer.style.left = '0';\n      printContainer.style.position = 'absolute';\n\n      // éšè—åŸå§‹å†…å®¹\n      const originalElements = document.querySelectorAll('body > *:not(.ddr-print-container)');\n      originalElements.forEach(el => {\n        (el as HTMLElement).style.display = 'none';\n      });\n\n      // æ‰§è¡Œæ‰“å°\n      window.print();\n\n      // æ¸…ç†ï¼šæ¢å¤åŸå§‹å†…å®¹å¹¶ç§»é™¤æ‰“å°å®¹å™¨å’Œæ°´å°\n      setTimeout(() => {\n        originalElements.forEach(el => {\n          (el as HTMLElement).style.display = '';\n        });\n        document.body.removeChild(printContainer);\n        document.head.removeChild(printStyle);\n\n        // æ¸…ç†æ‰“å°æ°´å°\n        const printWatermarks = document.querySelectorAll('[data-ddr-print-watermark=\"true\"]');\n        printWatermarks.forEach(wm => wm.remove());\n      }, 100);\n\n      console.log('æ‰“å°å®Œæˆ');\n      return Promise.resolve();\n\n    } catch (error) {\n      console.error('æ‰“å°å¤±è´¥:', error);\n      return Promise.reject(error);\n    }\n  }\n\n  /**\n   * åˆ›å»ºæ‰“å°ä¸“ç”¨å®¹å™¨\n   */\n  private static async _createPrintContainer(\n    element: HTMLElement,\n    config: any,\n    pdfOptions: any,\n    watermark: string\n  ): Promise<HTMLElement> {\n    // å…‹éš†åŸå§‹å…ƒç´ \n    const printContainer = element.cloneNode(true) as HTMLElement;\n    printContainer.className = 'ddr-print-container';\n\n    // è®¾ç½®æ‰“å°å®¹å™¨æ ·å¼\n    printContainer.style.width = '100%';\n    printContainer.style.height = 'auto';\n    printContainer.style.overflow = 'visible';\n    printContainer.style.backgroundColor = '#ffffff';\n    printContainer.style.color = '#000000';\n\n    // ç§»é™¤æ‰€æœ‰åŸå§‹æ°´å°ï¼ˆåŒ…æ‹¬æŠ¥è¡¨å¤´ã€æŠ¥è¡¨å°¾ä¸­çš„æ°´å°ï¼‰\n    const existingWatermarks = printContainer.querySelectorAll('.ddr-watermark, .ddr-watermark-content');\n    existingWatermarks.forEach(wm => wm.remove());\n\n    // ç§»é™¤æŠ¥è¡¨å¤´å’ŒæŠ¥è¡¨å°¾ä¸­å¯èƒ½å­˜åœ¨çš„æ°´å°æ ·å¼\n    const headerFooterElements = printContainer.querySelectorAll('.ddr-report-header, .ddr-report-footer');\n    headerFooterElements.forEach(element => {\n      // ç§»é™¤èƒŒæ™¯æ°´å°æ ·å¼\n      const el = element as HTMLElement;\n      el.style.backgroundImage = 'none';\n      el.style.background = 'none';\n\n      // ç§»é™¤å†…éƒ¨çš„æ°´å°å…ƒç´ \n      const innerWatermarks = el.querySelectorAll('[class*=\"watermark\"]');\n      innerWatermarks.forEach(wm => wm.remove());\n    });\n\n    // é‡ç”¨PDFçš„åˆ—å®½é‡åˆ¶é€»è¾‘\n    await this._applyPrintTableLayout(printContainer, config, pdfOptions);\n\n    // ä¼˜åŒ–è¡¨å¤´å’Œè¡¨å°¾\n    const headerElement = printContainer.querySelector('.ddr-report-header') as HTMLElement;\n    if (headerElement) {\n      headerElement.style.pageBreakInside = 'avoid';\n      headerElement.style.marginBottom = '20px';\n    }\n\n    const footerElement = printContainer.querySelector('.ddr-report-footer') as HTMLElement;\n    if (footerElement) {\n      footerElement.style.pageBreakInside = 'avoid';\n      footerElement.style.marginTop = '20px';\n    }\n\n    // æ·»åŠ ç»Ÿä¸€çš„å…¨é¡µé¢æ°´å°\n    if (watermark) {\n      this._addPrintWatermark(printContainer, watermark);\n    }\n\n    return printContainer;\n  }\n\n  /**\n   * åº”ç”¨æ‰“å°è¡¨æ ¼å¸ƒå±€ - é‡ç”¨PDFçš„åˆ—å®½é€»è¾‘\n   */\n  private static async _applyPrintTableLayout(\n    container: HTMLElement,\n    config: any,\n    pdfOptions: any\n  ): Promise<void> {\n    const tableContainer = container.querySelector('.ddr-table-container') as HTMLElement;\n    if (!tableContainer) return;\n\n    tableContainer.style.maxHeight = 'none';\n    tableContainer.style.height = 'auto';\n    tableContainer.style.overflow = 'visible';\n\n    const tableElement = tableContainer.querySelector('table');\n    if (!tableElement) return;\n\n    // è·å–é¡µé¢æ–¹å‘å’Œçº¸å¼ å¤§å°\n    const orientation = pdfOptions.orientation || 'portrait';\n    const pageSize = pdfOptions.pageSize || 'A4';\n\n    console.log(`ğŸ–¨ï¸ åº”ç”¨æ‰“å°è¡¨æ ¼å¸ƒå±€ï¼š${pageSize} ${orientation}`);\n\n    // è®¡ç®—æ‰“å°é¡µé¢çš„å¯ç”¨å®½åº¦ï¼ˆç±»ä¼¼PDFé€»è¾‘ï¼‰\n    const pageWidthMm = orientation === 'landscape' ?\n      (pageSize === 'A4' ? 297 : 279) : // A4æ¨ªç‰ˆ297mm, Letteræ¨ªç‰ˆ279mm\n      (pageSize === 'A4' ? 210 : 216);  // A4ç«–ç‰ˆ210mm, Letterç«–ç‰ˆ216mm\n\n    // å‡å»é¡µè¾¹è·ï¼ˆ15mm * 2ï¼‰\n    const contentWidthMm = pageWidthMm - 30;\n\n    // è½¬æ¢ä¸ºåƒç´ ï¼ˆ96dpiï¼‰\n    const contentWidthPx = Math.floor(contentWidthMm * 3.78);\n\n    console.log(`ğŸ–¨ï¸ æ‰“å°é¡µé¢å®½åº¦ï¼š${pageWidthMm}mmï¼Œå†…å®¹å®½åº¦ï¼š${contentWidthMm}mm (${contentWidthPx}px)`);\n\n    // è®¾ç½®è¡¨æ ¼å®½åº¦å’Œå¸ƒå±€\n    tableElement.style.width = '100%';\n    tableElement.style.maxWidth = `${contentWidthPx}px`;\n    tableElement.style.tableLayout = 'fixed';\n    tableElement.style.borderCollapse = 'collapse';\n\n    // é‡æ–°è®¡ç®—åˆ—å®½ï¼ˆç±»ä¼¼PDFé€»è¾‘ï¼‰\n    if (config?.columns) {\n      const columns = this._getFlatColumns(config.columns);\n      const visibleColumns = columns.filter((col: any) => col.visible !== false);\n\n      // è®¡ç®—æ€»é…ç½®å®½åº¦\n      let totalConfigWidth = 0;\n      visibleColumns.forEach((col: any) => {\n        if (col.width) {\n          totalConfigWidth += typeof col.width === 'number' ? col.width : parseInt(col.width);\n        }\n      });\n\n      console.log(`ğŸ–¨ï¸ åˆ—é…ç½®æ€»å®½åº¦ï¼š${totalConfigWidth}pxï¼Œç›®æ ‡å®½åº¦ï¼š${contentWidthPx}px`);\n\n      // åº”ç”¨åˆ—å®½åˆ°æ‰€æœ‰å•å…ƒæ ¼\n      const colElements = tableElement.querySelectorAll('col');\n      const allRows = tableElement.querySelectorAll('tr');\n\n      visibleColumns.forEach((col: any, index: number) => {\n        let columnWidth: number;\n\n        if (col.width) {\n          const configWidth = typeof col.width === 'number' ? col.width : parseInt(col.width);\n          // æŒ‰æ¯”ä¾‹ç¼©æ”¾åˆ°æ‰“å°é¡µé¢å®½åº¦\n          columnWidth = Math.floor((configWidth / totalConfigWidth) * contentWidthPx);\n        } else {\n          // å¹³å‡åˆ†é…å‰©ä½™å®½åº¦\n          columnWidth = Math.floor(contentWidthPx / visibleColumns.length);\n        }\n\n        console.log(`ğŸ–¨ï¸ åˆ— \"${col.key}\" å®½åº¦ï¼š${columnWidth}px`);\n\n        // è®¾ç½®colå…ƒç´ å®½åº¦\n        if (colElements[index]) {\n          (colElements[index] as HTMLElement).style.width = `${columnWidth}px`;\n        }\n\n        // è®¾ç½®æ‰€æœ‰è¡Œçš„å¯¹åº”å•å…ƒæ ¼å®½åº¦\n        allRows.forEach(row => {\n          const cells = row.querySelectorAll('td, th');\n          if (cells[index]) {\n            const cell = cells[index] as HTMLElement;\n            cell.style.width = `${columnWidth}px`;\n            cell.style.maxWidth = `${columnWidth}px`;\n            cell.style.minWidth = `${columnWidth}px`;\n            cell.style.boxSizing = 'border-box';\n          }\n        });\n      });\n    }\n\n    // ä¼˜åŒ–å•å…ƒæ ¼æ ·å¼\n    const cells = tableElement.querySelectorAll('td, th');\n    cells.forEach(cell => {\n      const cellElement = cell as HTMLElement;\n      cellElement.style.border = '1px solid #ddd';\n      cellElement.style.padding = '6px 8px';\n      cellElement.style.fontSize = '11px';\n      cellElement.style.lineHeight = '1.3';\n      cellElement.style.wordWrap = 'break-word';\n      cellElement.style.overflow = 'hidden';\n    });\n\n    // è¡¨å¤´æ ·å¼\n    const headerCells = tableElement.querySelectorAll('th');\n    headerCells.forEach(cell => {\n      const cellElement = cell as HTMLElement;\n      cellElement.style.backgroundColor = '#f5f5f5';\n      cellElement.style.fontWeight = 'bold';\n      cellElement.style.fontSize = '11px';\n    });\n  }\n\n  /**\n   * è·å–æ‰å¹³åŒ–çš„åˆ—é…ç½®ï¼ˆé‡ç”¨PDFé€»è¾‘ï¼‰\n   */\n  private static _getFlatColumns(columns: any[]): any[] {\n    const flatColumns: any[] = [];\n\n    const flatten = (cols: any[]) => {\n      cols.forEach(col => {\n        if (col.children && col.children.length > 0) {\n          flatten(col.children);\n        } else {\n          flatColumns.push(col);\n        }\n      });\n    };\n\n    flatten(columns);\n    return flatColumns;\n  }\n\n  /**\n   * åˆ›å»ºæ‰“å°æ ·å¼\n   */\n  private static _createPrintStyle(orientation: string, pageSize: string): HTMLStyleElement {\n    const style = document.createElement('style');\n    style.className = 'ddr-print-style';\n\n    // æ ¹æ®é¡µé¢æ–¹å‘å’Œå¤§å°è®¾ç½®æ ·å¼\n    const pageRule = orientation === 'landscape' ? 'landscape' : 'portrait';\n    const sizeRule = pageSize.toLowerCase();\n\n    style.textContent = `\n      @media print {\n        @page {\n          size: ${sizeRule} ${pageRule};\n          margin: 15mm;\n        }\n\n        body {\n          margin: 0;\n          padding: 0;\n          font-family: Arial, sans-serif;\n          font-size: 12px;\n          line-height: 1.4;\n          color: #000;\n          background: #fff;\n        }\n\n        .ddr-print-container {\n          width: 100% !important;\n          height: auto !important;\n          overflow: visible !important;\n          position: relative !important;\n          left: 0 !important;\n          top: 0 !important;\n          margin: 0 !important;\n          padding: 0 !important;\n          box-shadow: none !important;\n          border: none !important;\n        }\n\n        .ddr-table-container {\n          overflow: visible !important;\n          height: auto !important;\n          max-height: none !important;\n        }\n\n        .ddr-table {\n          width: 100% !important;\n          border-collapse: collapse !important;\n          page-break-inside: auto !important;\n        }\n\n        .ddr-table-row {\n          page-break-inside: avoid !important;\n          page-break-after: auto !important;\n        }\n\n        .ddr-header, .ddr-report-header {\n          page-break-inside: avoid !important;\n          page-break-after: avoid !important;\n        }\n\n        .ddr-footer, .ddr-report-footer {\n          page-break-inside: avoid !important;\n          page-break-before: avoid !important;\n        }\n\n        .ddr-print-watermark {\n          position: fixed !important;\n          top: 0 !important;\n          left: 0 !important;\n          width: 100vw !important;\n          height: 100vh !important;\n          pointer-events: none !important;\n          z-index: 999 !important;\n          opacity: 0.15 !important;\n          overflow: hidden !important;\n        }\n\n        .ddr-print-watermark-text {\n          position: absolute !important;\n          font-size: 24px !important;\n          font-weight: bold !important;\n          color: #ccc !important;\n          transform: rotate(-45deg) !important;\n          white-space: nowrap !important;\n          user-select: none !important;\n        }\n\n        /* éšè—ä¸éœ€è¦æ‰“å°çš„å…ƒç´  */\n        .no-print {\n          display: none !important;\n        }\n      }\n    `;\n\n    return style;\n  }\n\n  /**\n   * æ·»åŠ ç»Ÿä¸€çš„å…¨é¡µé¢æ‰“å°æ°´å°\n   */\n  private static _addPrintWatermark(container: HTMLElement, watermark: string): void {\n    console.log(`ğŸ–¨ï¸ æ·»åŠ ç»Ÿä¸€çš„å…¨é¡µé¢æ‰“å°æ°´å°: \"${watermark}\"`);\n\n    // åˆ›å»ºæ°´å°å®¹å™¨ï¼Œè¦†ç›–æ•´ä¸ªæ‰“å°å®¹å™¨\n    const watermarkContainer = document.createElement('div');\n    watermarkContainer.className = 'ddr-print-watermark';\n\n    // è®¾ç½®æ°´å°å®¹å™¨æ ·å¼ - è¦†ç›–æ•´ä¸ªå®¹å™¨\n    watermarkContainer.style.position = 'fixed';  // ä½¿ç”¨fixedå®šä½ç¡®ä¿è¦†ç›–æ•´ä¸ªè§†å£\n    watermarkContainer.style.top = '0';\n    watermarkContainer.style.left = '0';\n    watermarkContainer.style.width = '100vw';\n    watermarkContainer.style.height = '100vh';\n    watermarkContainer.style.pointerEvents = 'none';\n    watermarkContainer.style.zIndex = '999';  // æé«˜z-indexç¡®ä¿æ˜¾ç¤ºåœ¨æœ€ä¸Šå±‚\n    watermarkContainer.style.overflow = 'hidden';\n    watermarkContainer.style.opacity = '0.15';  // è®¾ç½®é€æ˜åº¦\n\n    // è®¡ç®—æ°´å°å¸ƒå±€ - æ›´å¯†é›†çš„å¹³é“º\n    const rows = 8;  // å¢åŠ è¡Œæ•°\n    const cols = 6;  // å¢åŠ åˆ—æ•°\n\n    for (let row = 0; row < rows; row++) {\n      for (let col = 0; col < cols; col++) {\n        const watermarkText = document.createElement('div');\n        watermarkText.className = 'ddr-print-watermark-text';\n        watermarkText.textContent = watermark;\n\n        // è®¾ç½®æ°´å°æ–‡å­—æ ·å¼\n        watermarkText.style.position = 'absolute';\n        watermarkText.style.fontSize = '24px';  // ç»Ÿä¸€çš„å­—ä½“å¤§å°\n        watermarkText.style.fontWeight = 'bold';\n        watermarkText.style.color = '#ccc';     // è°ƒæ•´é¢œè‰²\n        watermarkText.style.opacity = '1';      // ä¸è®¾ç½®é¢å¤–é€æ˜åº¦ï¼Œç”±å®¹å™¨æ§åˆ¶\n        watermarkText.style.whiteSpace = 'nowrap';\n        watermarkText.style.userSelect = 'none';\n        watermarkText.style.pointerEvents = 'none';\n\n        // è®¡ç®—ä½ç½® - å‡åŒ€åˆ†å¸ƒ\n        const x = (col + 0.5) * (100 / cols);\n        const y = (row + 0.5) * (100 / rows);\n\n        watermarkText.style.left = `${x}%`;\n        watermarkText.style.top = `${y}%`;\n        watermarkText.style.transform = 'translate(-50%, -50%) rotate(-45deg)';\n        watermarkText.style.transformOrigin = 'center';\n\n        watermarkContainer.appendChild(watermarkText);\n      }\n    }\n\n    // å°†æ°´å°å®¹å™¨æ·»åŠ åˆ°bodyï¼Œç¡®ä¿åœ¨æ‰“å°æ—¶è¦†ç›–æ•´ä¸ªé¡µé¢\n    document.body.appendChild(watermarkContainer);\n\n    // æ ‡è®°æ°´å°å®¹å™¨ï¼Œä»¥ä¾¿åç»­æ¸…ç†\n    watermarkContainer.setAttribute('data-ddr-print-watermark', 'true');\n\n    console.log(`ğŸ–¨ï¸ æ°´å°æ·»åŠ å®Œæˆï¼Œå…±åˆ›å»º ${rows * cols} ä¸ªæ°´å°å…ƒç´ `);\n  }\n}\n","/**\r\n * ä¿®å¤Excelå¯¼å‡ºæ ·å¼é—®é¢˜\r\n */\r\n\r\nimport * as XLSX from 'xlsx';\r\n\r\n// å®šä¹‰Excelæ ·å¼è¾…åŠ©å‡½æ•°\r\nexport function applyExcelStyles(ws: any, data: any[][]) {\r\n  // å®šä¹‰é€šç”¨æ ·å¼\r\n  const styles = {\r\n    header: {\r\n      font: { bold: true, sz: 12, color: { rgb: \"FFFFFF\" } },\r\n      fill: { fgColor: { rgb: \"4472C4\" } },\r\n      alignment: { horizontal: \"center\", vertical: \"center\", wrapText: true },\r\n      border: {\r\n        top: { style: 'medium', color: { rgb: '366092' } },\r\n        right: { style: 'thin', color: { rgb: '366092' } },\r\n        bottom: { style: 'medium', color: { rgb: '366092' } },\r\n        left: { style: 'thin', color: { rgb: '366092' } }\r\n      }\r\n    },\r\n    title: {\r\n      font: { bold: true, sz: 18, color: { rgb: \"000000\" } },\r\n      alignment: { horizontal: \"center\", vertical: \"center\" },\r\n      border: {\r\n        top: { style: 'thin', color: { rgb: 'CCCCCC' } },\r\n        bottom: { style: 'thin', color: { rgb: 'CCCCCC' } }\r\n      }\r\n    },\r\n    metadata: {\r\n      font: { sz: 11, color: { rgb: \"333333\" } },\r\n      alignment: { horizontal: \"left\", vertical: \"center\" },\r\n      border: { \r\n        top: { style: 'thin', color: { rgb: 'EEEEEE' } },\r\n        right: { style: 'thin', color: { rgb: 'EEEEEE' } },\r\n        bottom: { style: 'thin', color: { rgb: 'EEEEEE' } },\r\n        left: { style: 'thin', color: { rgb: 'EEEEEE' } }\r\n      }\r\n    },\r\n    cell: {\r\n      font: { sz: 11, color: { rgb: \"333333\" } },\r\n      alignment: { vertical: \"center\", wrapText: true },\r\n      border: {\r\n        top: { style: 'thin', color: { rgb: 'DDDDDD' } },\r\n        right: { style: 'thin', color: { rgb: 'DDDDDD' } },\r\n        bottom: { style: 'thin', color: { rgb: 'DDDDDD' } },\r\n        left: { style: 'thin', color: { rgb: 'DDDDDD' } }\r\n      }\r\n    },\r\n    oddRow: {\r\n      fill: { fgColor: { rgb: \"E9EDF4\" } }\r\n    },\r\n    evenRow: {\r\n      fill: { fgColor: { rgb: \"FFFFFF\" } }\r\n    },\r\n    summary: {\r\n      font: { bold: true, sz: 11, color: { rgb: \"000000\" } },\r\n      alignment: { horizontal: \"right\", vertical: \"center\" },\r\n      border: {\r\n        top: { style: 'medium', color: { rgb: 'CCCCCC' } },\r\n        bottom: { style: 'medium', color: { rgb: 'CCCCCC' } }\r\n      }\r\n    }\r\n  };\r\n\r\n  // åˆ¤æ–­è¡¨æ ¼ç»“æ„\r\n  if (!data || data.length === 0) return ws;\r\n\r\n  // æŸ¥æ‰¾æ ‡é¢˜è¡Œå’Œæ•°æ®è¡ŒèŒƒå›´\r\n  const headerRowIndex = findHeaderRowIndex(data);\r\n  const dataInfo = analyzeDataStructure(data, headerRowIndex);\r\n\r\n  // åº”ç”¨æ ·å¼åˆ°æ ‡é¢˜åŒºåŸŸ\r\n  if (dataInfo.titleRowIndex >= 0) {\r\n    for (let r = 0; r <= dataInfo.titleRowIndex; r++) {\r\n      for (let c = 0; c < (data[r] ? data[r].length : 0); c++) {\r\n        const cellRef = XLSX.utils.encode_cell({ r, c });\r\n        if (!ws[cellRef]) continue;\r\n        \r\n        if (r === 0 && c === 0) {\r\n          // æŠ¥è¡¨æ ‡é¢˜\r\n          ws[cellRef].s = styles.title;\r\n        } else {\r\n          // å…ƒæ•°æ®\r\n          ws[cellRef].s = styles.metadata;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  // åº”ç”¨æ ·å¼åˆ°è¡¨å¤´\r\n  if (headerRowIndex >= 0) {\r\n    for (let c = 0; c < data[headerRowIndex].length; c++) {\r\n      const cellRef = XLSX.utils.encode_cell({ r: headerRowIndex, c });\r\n      if (!ws[cellRef]) continue;\r\n      ws[cellRef].s = styles.header;\r\n    }\r\n  }\r\n\r\n  // åº”ç”¨æ ·å¼åˆ°æ•°æ®è¡Œ\r\n  for (let r = headerRowIndex + 1; r <= dataInfo.dataEndRowIndex; r++) {\r\n    const isAlternateRow = (r - headerRowIndex) % 2 === 1;\r\n    \r\n    for (let c = 0; c < (data[r] ? data[r].length : 0); c++) {\r\n      const cellRef = XLSX.utils.encode_cell({ r, c });\r\n      if (!ws[cellRef]) continue;\r\n      \r\n      // æ£€æŸ¥æ˜¯å¦æ˜¯æ•°å­—\r\n      const isNumber = isNumericCell(data[r][c]);\r\n      \r\n      // åˆå¹¶åŸºç¡€æ ·å¼ä¸è¡Œæ ·å¼\r\n      ws[cellRef].s = {\r\n        ...styles.cell,\r\n        ...(isAlternateRow ? styles.oddRow : styles.evenRow),\r\n        alignment: { \r\n          ...styles.cell.alignment,\r\n          horizontal: isNumber ? \"right\" : \"left\"\r\n        }\r\n      };\r\n    }\r\n  }\r\n\r\n  // åº”ç”¨æ ·å¼åˆ°æ±‡æ€»è¡Œ\r\n  if (dataInfo.summaryRowIndices.length > 0) {\r\n    for (const r of dataInfo.summaryRowIndices) {\r\n      for (let c = 0; c < (data[r] ? data[r].length : 0); c++) {\r\n        const cellRef = XLSX.utils.encode_cell({ r, c });\r\n        if (!ws[cellRef]) continue;\r\n        ws[cellRef].s = styles.summary;\r\n      }\r\n    }\r\n  }\r\n\r\n  return ws;\r\n}\r\n\r\n// è¾…åŠ©å‡½æ•°ï¼šæŸ¥æ‰¾è¡¨å¤´è¡Œ\r\nfunction findHeaderRowIndex(data: any[][]): number {\r\n  // å¦‚æœæ•°æ®å°‘äº3è¡Œï¼Œå‡è®¾æ²¡æœ‰è¡¨å¤´\r\n  if (data.length < 3) return 0;\r\n  \r\n  // é€šå¸¸è¡¨å¤´è¡Œæ˜¯æœ‰å›ºå®šåˆ—æ•°çš„ä¸€è¡Œï¼Œä½äºé¡¶éƒ¨é™„è¿‘\r\n  for (let i = 0; i < Math.min(10, data.length - 1); i++) {\r\n    if (data[i] && data[i+1] && \r\n        data[i].length === data[i+1].length && \r\n        data[i].length >= 3) {\r\n      return i;\r\n    }\r\n  }\r\n  \r\n  // é»˜è®¤è¿”å›ç¬¬ä¸€è¡Œ\r\n  return 0;\r\n}\r\n\r\n// è¾…åŠ©å‡½æ•°ï¼šåˆ†ææ•°æ®ç»“æ„\r\nfunction analyzeDataStructure(data: any[][], headerRowIndex: number) {\r\n  const result = {\r\n    titleRowIndex: -1,\r\n    dataEndRowIndex: data.length - 1,\r\n    summaryRowIndices: [] as number[]\r\n  };\r\n  \r\n  // æŸ¥æ‰¾æ ‡é¢˜è¡Œ\r\n  if (headerRowIndex > 0) {\r\n    result.titleRowIndex = 0;\r\n  }\r\n  \r\n  // æŸ¥æ‰¾æ±‡æ€»è¡Œå’Œæ•°æ®ç»“æŸè¡Œ\r\n  for (let r = data.length - 1; r > headerRowIndex; r--) {\r\n    const row = data[r];\r\n    if (!row || row.length === 0) continue;\r\n    \r\n    // æ£€æŸ¥æ˜¯å¦æ˜¯æ±‡æ€»è¡Œ\r\n    let isSummaryRow = false;\r\n    for (let c = 0; c < row.length; c++) {\r\n      const cell = row[c];\r\n      if (cell && typeof cell === 'string' && \r\n          (cell.includes('åˆè®¡') || cell.includes('æ€»è®¡') || \r\n           cell.includes('æ±‡æ€»') || cell.includes('å°è®¡'))) {\r\n        isSummaryRow = true;\r\n        result.summaryRowIndices.push(r);\r\n        break;\r\n      }\r\n    }\r\n    \r\n    // å¦‚æœä¸æ˜¯æ±‡æ€»è¡Œï¼Œå¯èƒ½æ˜¯æœ€åä¸€è¡Œæ•°æ®\r\n    if (!isSummaryRow && result.dataEndRowIndex === data.length - 1) {\r\n      result.dataEndRowIndex = r;\r\n    }\r\n  }\r\n  \r\n  return result;\r\n}\r\n\r\n// è¾…åŠ©å‡½æ•°ï¼šåˆ¤æ–­å•å…ƒæ ¼æ˜¯å¦åŒ…å«æ•°å­—\r\nfunction isNumericCell(value: any): boolean {\r\n  if (value === null || value === undefined) return false;\r\n  if (typeof value === 'number') return true;\r\n  \r\n  if (typeof value === 'string') {\r\n    const trimmed = value.trim();\r\n    if (trimmed === '') return false;\r\n    \r\n    // æ£€æŸ¥æ˜¯å¦æ˜¯æ•°å­—æ ¼å¼\r\n    return !isNaN(Number(trimmed)) && \r\n           !isNaN(parseFloat(trimmed)) &&\r\n           !trimmed.includes(' '); // ä¸åŒ…å«ç©ºæ ¼\r\n  }\r\n  \r\n  return false;\r\n}\r\n","/**\r\n * ä¿®å¤PDFå¯¼å‡ºå¼‚å¸¸çš„è¡¥ä¸æ–‡ä»¶\r\n * å¯¼å…¥åˆ°ä¸»é¡¹ç›®ä¸­ä»¥è§£å†³PDFå¯¼å‡ºçš„é—®é¢˜\r\n */\r\n\r\n// ä¿®å¤PDFå¯¼å‡ºæ—¶çš„åˆ†é¡µé—®é¢˜\r\nexport function fixPDFExport() {\r\n  try {\r\n    console.log('PDFå¯¼å‡ºä¿®å¤å·²åº”ç”¨ (ä½¿ç”¨å†…ç½®jsPDF)');\r\n\r\n    // ç”±äºjsPDFç°åœ¨æ˜¯é€šè¿‡ESæ¨¡å—å¯¼å…¥çš„ï¼Œä¿®å¤é€»è¾‘å·²ç»ç®€åŒ–\r\n    // ä¸»è¦çš„ä¿®å¤å·²ç»åœ¨ä¸»å¯¼å‡ºé€»è¾‘ä¸­å¤„ç†\r\n\r\n    console.log('PDFå¯¼å‡ºä¿®å¤å·²æˆåŠŸåº”ç”¨');\r\n  } catch (e) {\r\n    console.warn('åº”ç”¨PDFä¿®å¤æ—¶å‘ç”Ÿé”™è¯¯:', e);\r\n  }\r\n}\r\n\r\n// å¯¼å‡ºä¸­æ–‡æ”¯æŒçš„è¾…åŠ©å‡½æ•°\r\nexport function setupChineseSupport(pdf: any) {\r\n  try {\r\n    // è®¾ç½®é»˜è®¤å­—ä½“\r\n    pdf.setFont('helvetica');\r\n\r\n    // ä¼˜åŒ–ä¸­æ–‡å¤„ç†\r\n    const encodingFallback = function(text: string) {\r\n      try {\r\n        // ç®€å•æ›¿æ¢ä¸€äº›ä¸­æ–‡æ ‡ç‚¹ç¬¦å·ä¸ºè‹±æ–‡æ ‡ç‚¹\r\n        return text\r\n          .replace(/ï¼š/g, ':')\r\n          .replace(/ï¼Œ/g, ',')\r\n          .replace(/ã€‚/g, '.')\r\n          .replace(/ï¼ˆ/g, '(')\r\n          .replace(/ï¼‰/g, ')')\r\n          .replace(/ï¼›/g, ';');\r\n      } catch (e) {\r\n        return text;\r\n      }\r\n    };\r\n\r\n    // ä¿å­˜åŸå§‹çš„textæ–¹æ³•\r\n    const originalText = pdf.text;\r\n\r\n    // è¦†ç›–textæ–¹æ³•ï¼Œæ·»åŠ ä¸­æ–‡å¤„ç†\r\n    pdf.text = function(text: string, x: number, y: number, options?: any) {\r\n      try {\r\n        // å°è¯•ä½¿ç”¨åŸå§‹æ–¹æ³•\r\n        return originalText.call(this, encodingFallback(text), x, y, options);\r\n      } catch (e) {\r\n        console.warn('æ–‡å­—æ¸²æŸ“å¤±è´¥:', e);\r\n        // å¦‚æœå¤±è´¥ï¼Œå°è¯•ç›´æ¥æ¸²æŸ“ASCIIå­—ç¬¦\r\n        const asciiOnly = text.replace(/[^\\x00-\\x7F]/g, '?');\r\n        return originalText.call(this, asciiOnly, x, y, options);\r\n      }\r\n    };\r\n\r\n    return pdf;\r\n  } catch (e) {\r\n    console.warn('ä¸­æ–‡æ”¯æŒè®¾ç½®å¤±è´¥:', e);\r\n    return pdf;\r\n  }\r\n}\r\n"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","this","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","__generator","body","f","y","_","label","sent","trys","ops","g","create","Iterator","verb","Symbol","iterator","v","op","TypeError","pop","push","SuppressedError","DDR","XLSXStyle","options","data","metadata","pagination","filters","eventListeners","Map","formatters","initialized","container","el","document","querySelector","Error","concat","HTMLElement","classList","add","theme","globalFormatters","instance","init","catch","error","onError","console","registerFormatter","name","formatter","_a","_loadConfig","config","_b","_fetchData","dataSource","apiResponse","records","_render","_emitEvent","onLoad","error_1","reload","params","error_2","refreshMetadata","metadataSource","_fetchMetadata","response","_renderHeaderFooter","error_3","updateMetadata","Array","isArray","log","metadataWithoutData","indexOf","getOwnPropertySymbols","propertyIsEnumerable","__rest","exportTo","type","index","Exporter","toExcel","toPDF","fileName","meta","error_4","destroy","innerHTML","clear","setFilter","on","event","callback","has","set","get","off","callbacks","splice","print","_c","toPrint","watermark","features","pdf","pdfConfig","error_5","_simplePrint","style","createElement","textContent","head","appendChild","window","setTimeout","removeChild","getData","to","from","pack","ar","l","slice","__spreadArray","getMetadata","_getValueByPath","path","split","reduce","acc","part","undefined","startsWith","fetch","ok","statusText","json","error_6","message","String","extraParams","mock","debug","location","hostname","api","method","headers","JSON","stringify","url","keys","queryParams_1","URLSearchParams","entries","forEach","key","append","toString","warn","success","code","queryParams_2","wrapper","className","layout","height","bordered","renderMode","_determineRenderMode","setAttribute","_renderCanvas","_renderDOM","_addWatermark","oldHeader","oldFooter","header","_createHeader","insertBefore","firstChild","ResizeObserver","entries_1","_i","headerHeight_1","contentRect","setProperty","tableContainer_1","marginTop","maxHeight","observe","headerHeight","getBoundingClientRect","tableContainer","footer","_createFooter","nextSibling","headerConfig","_this","headerElement","minHeight","topContainer","logo","logoContainer","position","logoImg","alt","src","metadataKey","width","centerContainer","title","titleText","metadataPath","text","titleElement","subtitle","subtitleElement","fields","fieldsContainer","leftFields_1","rightFields_1","field","fieldElement","labelElement","valueElement","footerConfig","footerElement","fixed","summary","summaryElement_1","summaryConfig","summaryItem","column","summaryValue","_calculateSummary","fieldsContainer_1","signatures","signaturesElement_1","signature","signatureItem","nameElement","showTimestamp","dateElement","timestamp","dateMetadataPath","Date","toLocaleDateString","notes","notesElement","pageInfo","pageElement","pageText","format","replace","pageNumber","totalPages","values","map","item","sum","val","mode","entries_2","entry","target","updateHeaderSize","addEventListener","tableWrapper","table","stripe","hover","thead","_createTableHeader","columns","tbody","_createTableBody","paginationElement","_createPagination","placeholder","rowCount","_calculateHeaderRowCount","rows","fill","tr","_fillHeaderCells","row","maxDepth","traverse","cols","currentDepth","col","children","Math","max","rowIndex","colIndex","currentColIndex","cell","align","textAlign","childColSpan","colSpan","rowSpan","flatColumns","_getFlatColumns","merges","emptyRow","emptyCell","emptyText","rowData","rowHeight","visible","cellKey","formatterFunc","merge","_handleCellMerge","conditional","condition","valueToCheck","_evaluateCondition","when","td","currentValue","nextValue","skipKey","context","expression_1","rowVarMatches","match","prop","Function","flatten","prevBtn","disabled","onclick","currentPage","startPage","endPage","min","pageBtn","nextBtn","sizeSelect","size","option","selected","pageSize","onchange","Number","existingWatermark","zIndex","includes","content","opacity","color","fontSize","defineProperty","writable","MutationObserver","mutations","mutation","removedNodes","some","node","Element","contains","newWatermark_1","cloneNode","attributeName","childList","subtree","attributes","attributeFilter","_prepareExportData","visibleColumns","filter","includeHidden","includeHeader","showOnExport","_d","includeFooter","_e","_g","_f","_j","_h","_l","_k","signatureRow_1","_m","date","currency","locale","Intl","NumberFormat","number","precision","thousandSeparator","minimumFractionDigits","maximumFractionDigits","useGrouping","percentage","applyExcelStyles","ws","styles","font","bold","sz","rgb","fgColor","alignment","horizontal","vertical","wrapText","border","top","right","bottom","left","oddRow","evenRow","headerRowIndex","findHeaderRowIndex","dataInfo","titleRowIndex","dataEndRowIndex","summaryRowIndices","r","isSummaryRow","c","analyzeDataStructure","cellRef","XLSX","utils","encode_cell","isAlternateRow","isNumber","isNumericCell","trimmed","trim","isNaN","parseFloat","require","fixPDFExport","sheetName","excelData","domElement","extractDataFromDOM","ws_1","aoa_to_sheet","wscols","maxWidth","wch","dataRows","hasDOMElement","firstRow","lastRow","applyEnhancedStylesToExcel","enhancedError","applyBasicStylesToExcel","wb","book_new","book_append_sheet","Workbook","Views","RTL","hasStyles","sampleCells_1","Props","Title","Subject","Author","CreatedDate","writeOptions","bookType","cellStyles","sheetStubs","compression","excelBuffer","write","blob","Blob","URL","createObjectURL","link","href","download","click","revokeObjectURL","blobError","writeFile","fallbackError","element","fieldsElements","querySelectorAll","metadataRow_1","cells","summaryElements","summaryRow_1","footerFields","footerRow_1","applyDOMStylesToExcel","hasTitle","hasMetadata","currentRowIndex_1","headerStyle_1","dataStyle_1","isFirstRow_1","isHeader","cellIndex","excelRowIndex","range","decode_range","headerStyle","dataStyle","alternateRowStyle","rowStyle","rgbToHex","parseInt","padStart","toUpperCase","getExcelAlignment","pdfOptions","configPdfSettings","mergedPdfOptions","finalWatermark","orientation_1","orientation","quality","multiPage","relayout","margins","originalScrollTop","scrollTop","tempContainer","overflow","contentWidthMm","dpiRatio","contentWidthPx","floor","tableElem","tableLayout","padding","clientWidth","tableElement","setFont","originalText_1","x","encodingFallback_1","asciiOnly","setupChineseSupport","jsPDF","unit","pageWidth","internal","getWidth","pageHeight","getHeight","contentHeight","contentWidth","setFontSize","headerCanvas","headerRect","round","html2canvas","scale","useCORS","logging","allowTaint","backgroundColor","e_1","footerHeight","footerCanvas","footerRect","e_2","tableRect","tableCanvas","tableWidth","tableHeight","totalRows","headerRowCount","dataRowCount","actualHeaderHeightMM","actualFooterHeightMM","avgRowHeightCanvas","dataRowHeightMM","configRowHeightPx","configRowHeightMM","baseAvailableHeight","firstPageDataHeight","middlePageDataHeight","lastPageDataHeight","firstPageMaxRows","middlePageMaxRows","lastPageMaxRows","pageBreakPoints","processedRows","pageIndex","maxRowsThisPage","remainingRows","rowsThisPage","breakYPercent","headerHeightRatio","yPercent","endRow","pagesNeeded","headerImgData","toDataURL","footerImgData","lastPageRows","lastPageRemainingHeight","lastPageDataHeightUsed","page","addPage","yOffset","addImage","repeatTableHeader","headerOnlyCanvas","headerHeightInCanvas","ceil","headerCtx","getContext","fillStyle","fillRect","drawImage","headerHeightInPDF","headerImgData_1","tableStartPercent","tableEndPercent","startRow","sourceY","sourceHeight","tablePartHeight","headerRowHeightCanvas","dataRowHeightCanvas","endRowHeightCanvas","startRowHeightCanvas","endY","maxAllowedHeight","pageTableCanvas","pageTableCtx","strokeStyle","lineWidth","beginPath","moveTo","lineTo","stroke","pageTableImgData","setTextColor","minPageNumberY","contentBottom","maxPageNumberY","pageNumberY","minFooterY","maxFooterY","footerY","newPageNumber","watermarkCanvas","ctx","textBaseline","translate","rotate","PI","fillText","watermarkImgData","clearRect","textLength","textMetrics","measureText","textWidth","spacingX","spacingY","rows_1","save","restore","watermarkError","centerX","centerY","baseline","angle","e_3","canvas","imgData","canvasAspectRatio","pageAspectRatio","imgWidth","imgHeight","orientation_2","_createPrintContainer","printContainer_1","printStyle_1","_createPrintStyle","originalElements_1","display","wm","remove","printContainer","backgroundImage","background","_applyPrintTableLayout","pageBreakInside","marginBottom","_addPrintWatermark","pageWidthMm","borderCollapse","visibleColumns_1","totalConfigWidth_1","colElements_1","allRows_1","columnWidth","configWidth","minWidth","boxSizing","cellElement","lineHeight","wordWrap","fontWeight","pageRule","sizeRule","toLowerCase","watermarkContainer","pointerEvents","watermarkText","whiteSpace","userSelect","transform","transformOrigin"],"mappings":"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"}