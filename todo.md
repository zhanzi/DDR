# 已完成的终端指令处理
- [x] 签退
- [x] 心跳
- [x] 消息获取
- [x] 消息确认
- [x] 数据上传
- [x] 增量名单下载
- [x] 银联终端密钥绑定
- [x] 文件内容下载
- [x] 签到
- [x] 统一提醒（未读消息及重签到）

# Todo（近期）

- [ ] 核心功能
  - [x] 签到，版本比对
  - [x] 统一的签到及未读消息提醒
  - [ ] 从数据库中读取原始交易记录打包成文件（通过配置文件控制是否启用）
- [ ] WEB后台
  - [x] 登录，登录增加多因素认证（短信验证码，动态口令等），考虑增加微信扫码登录
  - [x] 用户管理
  - [x] 角色管理
  - [x] 商户管理
  - [ ] 终端管理，终端状态，终端版本，终端属性等。链接终端日志、事件、消费数据等。
  - [ ] 文件发布，手动文件上上传，文件发布（按商户、线路、终端发布），文件版本管理
  - [ ] 消息管理，查看消息内容，消息类型，消息状态（未读，已读，已回）
  - [ ] 终端事件查询（签到，属性变更，版本变更，离线）
  - [ ] 终端日志信息（考虑服务端解析终端日志数据并保存，待定）
  - [ ] 终端消费数据查询（直接提供原始数据的查询页面，根据设备序列号，查找指定时段的记录）
  - [ ] 控制台实时日志(服务端日志文件保存，SSE输出实时日志)
  - [ ] 审计日志查询（操作日志，改密日志，登录日志）
  - [ ] 银联密钥管理，增加，导入，回收。
  - [ ] 票价文件管理，编辑票价信息，生成票价文件，下载票价文件，发布票价文件（默认线路发布）。
  - [ ] 语音文件管理，编辑语音信息，生成语音文件，下载语音文件，发布语音文件（默认商户发布）。


# Todo（远期）
- [ ] IC卡自助充值
- [ ] 守护卡
- [ ] 聚合支付


## 当前在做的事情
### 20250402
1. 调整handler的处理逻辑，IIso8583MessageHandler 中不再直接回复，而是返回一个response对象，由handler的调用者进行回复
2. 增加流量统计功能，统计每个终端的流量消耗情况
3. 修改数据库中保存的原始交易信息，采用BLOB存储，而不是TEXT，以节约空间
4. 仓储增加批量插入、更新、删除等方法

### 20250403
1. 调整Terminal中属性和版本为JSON字段，自动序列化
2. 拆分Terminal为Terminal和TerminalStatus两个表
3. 实现TerminalManager中的终端信息对比

### 20250409
1. 实现完整的签到逻辑，包括版本比对
2. 增加文件发布事件订阅处理

### 20250410
1. 文件发布事件处理，更新终端的期望版本
2. 完成终端期望版本过期后的重新处理逻辑

### 20250411
1. 优化Repository查询性能，增加asNoTracking参数
2. 完善期望版本的处理逻辑
3. TerminalManager中增加定时任务，定时检查终端的文件版本是否与期望版本一致，并提醒更新. 1分钟检查一次
4. TerminalManager中增加定时任务，定期对期望版本过期的终端进行更新. 5分钟检查一次
5. 增加消息类型类，避免魔法字符串
6. 增加消息表、文件发布表等表的查询索引
7. 增加消息发送事件服务，实现未读消息提醒相关功能


